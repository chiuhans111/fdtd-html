function YS(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(s){if(s!=="default"&&!(s in e)){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}})}),Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const qS=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}};qS();function od(e,t){const n=Object.create(null),s=e.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return t?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const KS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",JS=od(KS);function S0(e){return!!e||e===""}function ad(e){if(Mt(e)){const t={};for(let n=0;n<e.length;n++){const s=e[n],i=Ge(s)?tk(s):ad(s);if(i)for(const a in i)t[a]=i[a]}return t}else{if(Ge(e))return e;if(Re(e))return e}}const ZS=/;(?![^(]*\))/g,QS=/:(.+)/;function tk(e){const t={};return e.split(ZS).forEach(n=>{if(n){const s=n.split(QS);s.length>1&&(t[s[0].trim()]=s[1].trim())}}),t}function ld(e){let t="";if(Ge(e))t=e;else if(Mt(e))for(let n=0;n<e.length;n++){const s=ld(e[n]);s&&(t+=s+" ")}else if(Re(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function ek(e,t){if(e.length!==t.length)return!1;let n=!0;for(let s=0;n&&s<e.length;s++)n=Ac(e[s],t[s]);return n}function Ac(e,t){if(e===t)return!0;let n=mm(e),s=mm(t);if(n||s)return n&&s?e.getTime()===t.getTime():!1;if(n=Ho(e),s=Ho(t),n||s)return e===t;if(n=Mt(e),s=Mt(t),n||s)return n&&s?ek(e,t):!1;if(n=Re(e),s=Re(t),n||s){if(!n||!s)return!1;const i=Object.keys(e).length,a=Object.keys(t).length;if(i!==a)return!1;for(const u in e){const o=e.hasOwnProperty(u),r=t.hasOwnProperty(u);if(o&&!r||!o&&r||!Ac(e[u],t[u]))return!1}}return String(e)===String(t)}function k0(e,t){return e.findIndex(n=>Ac(n,t))}const nk=e=>Ge(e)?e:e==null?"":Mt(e)||Re(e)&&(e.toString===_0||!Gt(e.toString))?JSON.stringify(e,I0,2):String(e),I0=(e,t)=>t&&t.__v_isRef?I0(e,t.value):Br(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[s,i])=>(n[`${s} =>`]=i,n),{})}:Oc(t)?{[`Set(${t.size})`]:[...t.values()]}:Re(t)&&!Mt(t)&&!$0(t)?String(t):t,oe={},Lr=[],fs=()=>{},sk=()=>!1,ik=/^on[^a-z]/,Rc=e=>ik.test(e),cd=e=>e.startsWith("onUpdate:"),sn=Object.assign,ud=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},rk=Object.prototype.hasOwnProperty,Jt=(e,t)=>rk.call(e,t),Mt=Array.isArray,Br=e=>oa(e)==="[object Map]",Oc=e=>oa(e)==="[object Set]",mm=e=>oa(e)==="[object Date]",Gt=e=>typeof e=="function",Ge=e=>typeof e=="string",Ho=e=>typeof e=="symbol",Re=e=>e!==null&&typeof e=="object",T0=e=>Re(e)&&Gt(e.then)&&Gt(e.catch),_0=Object.prototype.toString,oa=e=>_0.call(e),ok=e=>oa(e).slice(8,-1),$0=e=>oa(e)==="[object Object]",hd=e=>Ge(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Xl=od(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Fc=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},ak=/-(\w)/g,Xr=Fc(e=>e.replace(ak,(t,n)=>n?n.toUpperCase():"")),lk=/\B([A-Z])/g,ho=Fc(e=>e.replace(lk,"-$1").toLowerCase()),E0=Fc(e=>e.charAt(0).toUpperCase()+e.slice(1)),kh=Fc(e=>e?`on${E0(e)}`:""),ec=(e,t)=>!Object.is(e,t),Yl=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},nc=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},Jh=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let xm;const ck=()=>xm||(xm=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Is;class uk{constructor(t=!1){this.active=!0,this.effects=[],this.cleanups=[],!t&&Is&&(this.parent=Is,this.index=(Is.scopes||(Is.scopes=[])).push(this)-1)}run(t){if(this.active){const n=Is;try{return Is=this,t()}finally{Is=n}}}on(){Is=this}off(){Is=this.parent}stop(t){if(this.active){let n,s;for(n=0,s=this.effects.length;n<s;n++)this.effects[n].stop();for(n=0,s=this.cleanups.length;n<s;n++)this.cleanups[n]();if(this.scopes)for(n=0,s=this.scopes.length;n<s;n++)this.scopes[n].stop(!0);if(this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function hk(e,t=Is){t&&t.active&&t.effects.push(e)}const fd=e=>{const t=new Set(e);return t.w=0,t.n=0,t},N0=e=>(e.w&di)>0,D0=e=>(e.n&di)>0,fk=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=di},dk=e=>{const{deps:t}=e;if(t.length){let n=0;for(let s=0;s<t.length;s++){const i=t[s];N0(i)&&!D0(i)?i.delete(e):t[n++]=i,i.w&=~di,i.n&=~di}t.length=n}},Zh=new WeakMap;let Ro=0,di=1;const Qh=30;let ls;const Ki=Symbol(""),tf=Symbol("");class dd{constructor(t,n=null,s){this.fn=t,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,hk(this,s)}run(){if(!this.active)return this.fn();let t=ls,n=ai;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=ls,ls=this,ai=!0,di=1<<++Ro,Ro<=Qh?fk(this):bm(this),this.fn()}finally{Ro<=Qh&&dk(this),di=1<<--Ro,ls=this.parent,ai=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ls===this?this.deferStop=!0:this.active&&(bm(this),this.onStop&&this.onStop(),this.active=!1)}}function bm(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let ai=!0;const A0=[];function fo(){A0.push(ai),ai=!1}function po(){const e=A0.pop();ai=e===void 0?!0:e}function Rn(e,t,n){if(ai&&ls){let s=Zh.get(e);s||Zh.set(e,s=new Map);let i=s.get(n);i||s.set(n,i=fd()),R0(i)}}function R0(e,t){let n=!1;Ro<=Qh?D0(e)||(e.n|=di,n=!N0(e)):n=!e.has(ls),n&&(e.add(ls),ls.deps.push(e))}function js(e,t,n,s,i,a){const u=Zh.get(e);if(!u)return;let o=[];if(t==="clear")o=[...u.values()];else if(n==="length"&&Mt(e))u.forEach((r,l)=>{(l==="length"||l>=s)&&o.push(r)});else switch(n!==void 0&&o.push(u.get(n)),t){case"add":Mt(e)?hd(n)&&o.push(u.get("length")):(o.push(u.get(Ki)),Br(e)&&o.push(u.get(tf)));break;case"delete":Mt(e)||(o.push(u.get(Ki)),Br(e)&&o.push(u.get(tf)));break;case"set":Br(e)&&o.push(u.get(Ki));break}if(o.length===1)o[0]&&ef(o[0]);else{const r=[];for(const l of o)l&&r.push(...l);ef(fd(r))}}function ef(e,t){const n=Mt(e)?e:[...e];for(const s of n)s.computed&&vm(s);for(const s of n)s.computed||vm(s)}function vm(e,t){(e!==ls||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const pk=od("__proto__,__v_isRef,__isVue"),O0=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Ho)),gk=pd(),mk=pd(!1,!0),xk=pd(!0),ym=bk();function bk(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const s=Zt(this);for(let a=0,u=this.length;a<u;a++)Rn(s,"get",a+"");const i=s[t](...n);return i===-1||i===!1?s[t](...n.map(Zt)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){fo();const s=Zt(this)[t].apply(this,n);return po(),s}}),e}function pd(e=!1,t=!1){return function(s,i,a){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&a===(e?t?Ok:B0:t?L0:M0).get(s))return s;const u=Mt(s);if(!e&&u&&Jt(ym,i))return Reflect.get(ym,i,a);const o=Reflect.get(s,i,a);return(Ho(i)?O0.has(i):pk(i))||(e||Rn(s,"get",i),t)?o:fn(o)?u&&hd(i)?o:o.value:Re(o)?e?z0(o):xd(o):o}}const vk=F0(),yk=F0(!0);function F0(e=!1){return function(n,s,i,a){let u=n[s];if(jo(u)&&fn(u)&&!fn(i))return!1;if(!e&&!jo(i)&&(nf(i)||(i=Zt(i),u=Zt(u)),!Mt(n)&&fn(u)&&!fn(i)))return u.value=i,!0;const o=Mt(n)&&hd(s)?Number(s)<n.length:Jt(n,s),r=Reflect.set(n,s,i,a);return n===Zt(a)&&(o?ec(i,u)&&js(n,"set",s,i):js(n,"add",s,i)),r}}function wk(e,t){const n=Jt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&js(e,"delete",t,void 0),s}function Ck(e,t){const n=Reflect.has(e,t);return(!Ho(t)||!O0.has(t))&&Rn(e,"has",t),n}function Sk(e){return Rn(e,"iterate",Mt(e)?"length":Ki),Reflect.ownKeys(e)}const P0={get:gk,set:vk,deleteProperty:wk,has:Ck,ownKeys:Sk},kk={get:xk,set(e,t){return!0},deleteProperty(e,t){return!0}},Ik=sn({},P0,{get:mk,set:yk}),gd=e=>e,Pc=e=>Reflect.getPrototypeOf(e);function Nl(e,t,n=!1,s=!1){e=e.__v_raw;const i=Zt(e),a=Zt(t);n||(t!==a&&Rn(i,"get",t),Rn(i,"get",a));const{has:u}=Pc(i),o=s?gd:n?yd:vd;if(u.call(i,t))return o(e.get(t));if(u.call(i,a))return o(e.get(a));e!==i&&e.get(t)}function Dl(e,t=!1){const n=this.__v_raw,s=Zt(n),i=Zt(e);return t||(e!==i&&Rn(s,"has",e),Rn(s,"has",i)),e===i?n.has(e):n.has(e)||n.has(i)}function Al(e,t=!1){return e=e.__v_raw,!t&&Rn(Zt(e),"iterate",Ki),Reflect.get(e,"size",e)}function wm(e){e=Zt(e);const t=Zt(this);return Pc(t).has.call(t,e)||(t.add(e),js(t,"add",e,e)),this}function Cm(e,t){t=Zt(t);const n=Zt(this),{has:s,get:i}=Pc(n);let a=s.call(n,e);a||(e=Zt(e),a=s.call(n,e));const u=i.call(n,e);return n.set(e,t),a?ec(t,u)&&js(n,"set",e,t):js(n,"add",e,t),this}function Sm(e){const t=Zt(this),{has:n,get:s}=Pc(t);let i=n.call(t,e);i||(e=Zt(e),i=n.call(t,e)),s&&s.call(t,e);const a=t.delete(e);return i&&js(t,"delete",e,void 0),a}function km(){const e=Zt(this),t=e.size!==0,n=e.clear();return t&&js(e,"clear",void 0,void 0),n}function Rl(e,t){return function(s,i){const a=this,u=a.__v_raw,o=Zt(u),r=t?gd:e?yd:vd;return!e&&Rn(o,"iterate",Ki),u.forEach((l,h)=>s.call(i,r(l),r(h),a))}}function Ol(e,t,n){return function(...s){const i=this.__v_raw,a=Zt(i),u=Br(a),o=e==="entries"||e===Symbol.iterator&&u,r=e==="keys"&&u,l=i[e](...s),h=n?gd:t?yd:vd;return!t&&Rn(a,"iterate",r?tf:Ki),{next(){const{value:c,done:f}=l.next();return f?{value:c,done:f}:{value:o?[h(c[0]),h(c[1])]:h(c),done:f}},[Symbol.iterator](){return this}}}}function ti(e){return function(...t){return e==="delete"?!1:this}}function Tk(){const e={get(a){return Nl(this,a)},get size(){return Al(this)},has:Dl,add:wm,set:Cm,delete:Sm,clear:km,forEach:Rl(!1,!1)},t={get(a){return Nl(this,a,!1,!0)},get size(){return Al(this)},has:Dl,add:wm,set:Cm,delete:Sm,clear:km,forEach:Rl(!1,!0)},n={get(a){return Nl(this,a,!0)},get size(){return Al(this,!0)},has(a){return Dl.call(this,a,!0)},add:ti("add"),set:ti("set"),delete:ti("delete"),clear:ti("clear"),forEach:Rl(!0,!1)},s={get(a){return Nl(this,a,!0,!0)},get size(){return Al(this,!0)},has(a){return Dl.call(this,a,!0)},add:ti("add"),set:ti("set"),delete:ti("delete"),clear:ti("clear"),forEach:Rl(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(a=>{e[a]=Ol(a,!1,!1),n[a]=Ol(a,!0,!1),t[a]=Ol(a,!1,!0),s[a]=Ol(a,!0,!0)}),[e,n,t,s]}const[_k,$k,Ek,Nk]=Tk();function md(e,t){const n=t?e?Nk:Ek:e?$k:_k;return(s,i,a)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?s:Reflect.get(Jt(n,i)&&i in s?n:s,i,a)}const Dk={get:md(!1,!1)},Ak={get:md(!1,!0)},Rk={get:md(!0,!1)},M0=new WeakMap,L0=new WeakMap,B0=new WeakMap,Ok=new WeakMap;function Fk(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Pk(e){return e.__v_skip||!Object.isExtensible(e)?0:Fk(ok(e))}function xd(e){return jo(e)?e:bd(e,!1,P0,Dk,M0)}function Mk(e){return bd(e,!1,Ik,Ak,L0)}function z0(e){return bd(e,!0,kk,Rk,B0)}function bd(e,t,n,s,i){if(!Re(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const a=i.get(e);if(a)return a;const u=Pk(e);if(u===0)return e;const o=new Proxy(e,u===2?s:n);return i.set(e,o),o}function zr(e){return jo(e)?zr(e.__v_raw):!!(e&&e.__v_isReactive)}function jo(e){return!!(e&&e.__v_isReadonly)}function nf(e){return!!(e&&e.__v_isShallow)}function W0(e){return zr(e)||jo(e)}function Zt(e){const t=e&&e.__v_raw;return t?Zt(t):e}function V0(e){return nc(e,"__v_skip",!0),e}const vd=e=>Re(e)?xd(e):e,yd=e=>Re(e)?z0(e):e;function Lk(e){ai&&ls&&(e=Zt(e),R0(e.dep||(e.dep=fd())))}function Bk(e,t){e=Zt(e),e.dep&&ef(e.dep)}function fn(e){return!!(e&&e.__v_isRef===!0)}function zk(e){return fn(e)?e.value:e}const Wk={get:(e,t,n)=>zk(Reflect.get(e,t,n)),set:(e,t,n,s)=>{const i=e[t];return fn(i)&&!fn(n)?(i.value=n,!0):Reflect.set(e,t,n,s)}};function U0(e){return zr(e)?e:new Proxy(e,Wk)}class Vk{constructor(t,n,s,i){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new dd(t,()=>{this._dirty||(this._dirty=!0,Bk(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=s}get value(){const t=Zt(this);return Lk(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}function Uk(e,t,n=!1){let s,i;const a=Gt(e);return a?(s=e,i=fs):(s=e.get,i=e.set),new Vk(s,i,a||!i,n)}function li(e,t,n,s){let i;try{i=s?e(...s):e()}catch(a){Mc(a,t,n)}return i}function jn(e,t,n,s){if(Gt(e)){const a=li(e,t,n,s);return a&&T0(a)&&a.catch(u=>{Mc(u,t,n)}),a}const i=[];for(let a=0;a<e.length;a++)i.push(jn(e[a],t,n,s));return i}function Mc(e,t,n,s=!0){const i=t?t.vnode:null;if(t){let a=t.parent;const u=t.proxy,o=n;for(;a;){const l=a.ec;if(l){for(let h=0;h<l.length;h++)if(l[h](e,u,o)===!1)return}a=a.parent}const r=t.appContext.config.errorHandler;if(r){li(r,null,10,[e,u,o]);return}}Gk(e,n,i,s)}function Gk(e,t,n,s=!0){console.error(e)}let sc=!1,sf=!1;const En=[];let Vs=0;const Wo=[];let Oo=null,Nr=0;const Vo=[];let ei=null,Dr=0;const G0=Promise.resolve();let wd=null,rf=null;function Hk(e){const t=wd||G0;return e?t.then(this?e.bind(this):e):t}function jk(e){let t=Vs+1,n=En.length;for(;t<n;){const s=t+n>>>1;Xo(En[s])<e?t=s+1:n=s}return t}function H0(e){(!En.length||!En.includes(e,sc&&e.allowRecurse?Vs+1:Vs))&&e!==rf&&(e.id==null?En.push(e):En.splice(jk(e.id),0,e),j0())}function j0(){!sc&&!sf&&(sf=!0,wd=G0.then(q0))}function Xk(e){const t=En.indexOf(e);t>Vs&&En.splice(t,1)}function X0(e,t,n,s){Mt(e)?n.push(...e):(!t||!t.includes(e,e.allowRecurse?s+1:s))&&n.push(e),j0()}function Yk(e){X0(e,Oo,Wo,Nr)}function qk(e){X0(e,ei,Vo,Dr)}function Lc(e,t=null){if(Wo.length){for(rf=t,Oo=[...new Set(Wo)],Wo.length=0,Nr=0;Nr<Oo.length;Nr++)Oo[Nr]();Oo=null,Nr=0,rf=null,Lc(e,t)}}function Y0(e){if(Lc(),Vo.length){const t=[...new Set(Vo)];if(Vo.length=0,ei){ei.push(...t);return}for(ei=t,ei.sort((n,s)=>Xo(n)-Xo(s)),Dr=0;Dr<ei.length;Dr++)ei[Dr]();ei=null,Dr=0}}const Xo=e=>e.id==null?1/0:e.id;function q0(e){sf=!1,sc=!0,Lc(e),En.sort((n,s)=>Xo(n)-Xo(s));const t=fs;try{for(Vs=0;Vs<En.length;Vs++){const n=En[Vs];n&&n.active!==!1&&li(n,null,14)}}finally{Vs=0,En.length=0,Y0(),sc=!1,wd=null,(En.length||Wo.length||Vo.length)&&q0(e)}}function Kk(e,t,...n){if(e.isUnmounted)return;const s=e.vnode.props||oe;let i=n;const a=t.startsWith("update:"),u=a&&t.slice(7);if(u&&u in s){const h=`${u==="modelValue"?"model":u}Modifiers`,{number:c,trim:f}=s[h]||oe;f&&(i=n.map(d=>d.trim())),c&&(i=n.map(Jh))}let o,r=s[o=kh(t)]||s[o=kh(Xr(t))];!r&&a&&(r=s[o=kh(ho(t))]),r&&jn(r,e,6,i);const l=s[o+"Once"];if(l){if(!e.emitted)e.emitted={};else if(e.emitted[o])return;e.emitted[o]=!0,jn(l,e,6,i)}}function K0(e,t,n=!1){const s=t.emitsCache,i=s.get(e);if(i!==void 0)return i;const a=e.emits;let u={},o=!1;if(!Gt(e)){const r=l=>{const h=K0(l,t,!0);h&&(o=!0,sn(u,h))};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return!a&&!o?(s.set(e,null),null):(Mt(a)?a.forEach(r=>u[r]=null):sn(u,a),s.set(e,u),u)}function Bc(e,t){return!e||!Rc(t)?!1:(t=t.slice(2).replace(/Once$/,""),Jt(e,t[0].toLowerCase()+t.slice(1))||Jt(e,ho(t))||Jt(e,t))}let cs=null,zc=null;function ic(e){const t=cs;return cs=e,zc=e&&e.type.__scopeId||null,t}function Jk(e){zc=e}function Zk(){zc=null}function Qk(e,t=cs,n){if(!t||e._n)return e;const s=(...i)=>{s._d&&Om(-1);const a=ic(t),u=e(...i);return ic(a),s._d&&Om(1),u};return s._n=!0,s._c=!0,s._d=!0,s}function Ih(e){const{type:t,vnode:n,proxy:s,withProxy:i,props:a,propsOptions:[u],slots:o,attrs:r,emit:l,render:h,renderCache:c,data:f,setupState:d,ctx:p,inheritAttrs:m}=e;let g,x;const b=ic(e);try{if(n.shapeFlag&4){const v=i||s;g=Ts(h.call(v,v,c,a,d,f,p)),x=r}else{const v=t;g=Ts(v.length>1?v(a,{attrs:r,slots:o,emit:l}):v(a,null)),x=t.props?r:tI(r)}}catch(v){Uo.length=0,Mc(v,e,1),g=As(ds)}let y=g;if(x&&m!==!1){const v=Object.keys(x),{shapeFlag:w}=y;v.length&&w&7&&(u&&v.some(cd)&&(x=eI(x,u)),y=pi(y,x))}return n.dirs&&(y=pi(y),y.dirs=y.dirs?y.dirs.concat(n.dirs):n.dirs),n.transition&&(y.transition=n.transition),g=y,ic(b),g}const tI=e=>{let t;for(const n in e)(n==="class"||n==="style"||Rc(n))&&((t||(t={}))[n]=e[n]);return t},eI=(e,t)=>{const n={};for(const s in e)(!cd(s)||!(s.slice(9)in t))&&(n[s]=e[s]);return n};function nI(e,t,n){const{props:s,children:i,component:a}=e,{props:u,children:o,patchFlag:r}=t,l=a.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&r>=0){if(r&1024)return!0;if(r&16)return s?Im(s,u,l):!!u;if(r&8){const h=t.dynamicProps;for(let c=0;c<h.length;c++){const f=h[c];if(u[f]!==s[f]&&!Bc(l,f))return!0}}}else return(i||o)&&(!o||!o.$stable)?!0:s===u?!1:s?u?Im(s,u,l):!0:!!u;return!1}function Im(e,t,n){const s=Object.keys(t);if(s.length!==Object.keys(e).length)return!0;for(let i=0;i<s.length;i++){const a=s[i];if(t[a]!==e[a]&&!Bc(n,a))return!0}return!1}function sI({vnode:e,parent:t},n){for(;t&&t.subTree===e;)(e=t.vnode).el=n,t=t.parent}const iI=e=>e.__isSuspense;function rI(e,t){t&&t.pendingBranch?Mt(e)?t.effects.push(...e):t.effects.push(e):qk(e)}function oI(e,t){if(Ke){let n=Ke.provides;const s=Ke.parent&&Ke.parent.provides;s===n&&(n=Ke.provides=Object.create(s)),n[e]=t}}function Th(e,t,n=!1){const s=Ke||cs;if(s){const i=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return n&&Gt(t)?t.call(s.proxy):t}}const Tm={};function _h(e,t,n){return J0(e,t,n)}function J0(e,t,{immediate:n,deep:s,flush:i,onTrack:a,onTrigger:u}=oe){const o=Ke;let r,l=!1,h=!1;if(fn(e)?(r=()=>e.value,l=nf(e)):zr(e)?(r=()=>e,s=!0):Mt(e)?(h=!0,l=e.some(x=>zr(x)||nf(x)),r=()=>e.map(x=>{if(fn(x))return x.value;if(zr(x))return ji(x);if(Gt(x))return li(x,o,2)})):Gt(e)?t?r=()=>li(e,o,2):r=()=>{if(!(o&&o.isUnmounted))return c&&c(),jn(e,o,3,[f])}:r=fs,t&&s){const x=r;r=()=>ji(x())}let c,f=x=>{c=g.onStop=()=>{li(x,o,4)}};if(qo)return f=fs,t?n&&jn(t,o,3,[r(),h?[]:void 0,f]):r(),fs;let d=h?[]:Tm;const p=()=>{if(!!g.active)if(t){const x=g.run();(s||l||(h?x.some((b,y)=>ec(b,d[y])):ec(x,d)))&&(c&&c(),jn(t,o,3,[x,d===Tm?void 0:d,f]),d=x)}else g.run()};p.allowRecurse=!!t;let m;i==="sync"?m=p:i==="post"?m=()=>xn(p,o&&o.suspense):m=()=>Yk(p);const g=new dd(r,m);return t?n?p():d=g.run():i==="post"?xn(g.run.bind(g),o&&o.suspense):g.run(),()=>{g.stop(),o&&o.scope&&ud(o.scope.effects,g)}}function aI(e,t,n){const s=this.proxy,i=Ge(e)?e.includes(".")?Z0(s,e):()=>s[e]:e.bind(s,s);let a;Gt(t)?a=t:(a=t.handler,n=t);const u=Ke;Yr(this);const o=J0(i,a.bind(s),n);return u?Yr(u):Ji(),o}function Z0(e,t){const n=t.split(".");return()=>{let s=e;for(let i=0;i<n.length&&s;i++)s=s[n[i]];return s}}function ji(e,t){if(!Re(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),fn(e))ji(e.value,t);else if(Mt(e))for(let n=0;n<e.length;n++)ji(e[n],t);else if(Oc(e)||Br(e))e.forEach(n=>{ji(n,t)});else if($0(e))for(const n in e)ji(e[n],t);return e}function lI(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return nb(()=>{e.isMounted=!0}),sb(()=>{e.isUnmounting=!0}),e}const Fn=[Function,Array],cI={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Fn,onEnter:Fn,onAfterEnter:Fn,onEnterCancelled:Fn,onBeforeLeave:Fn,onLeave:Fn,onAfterLeave:Fn,onLeaveCancelled:Fn,onBeforeAppear:Fn,onAppear:Fn,onAfterAppear:Fn,onAppearCancelled:Fn},setup(e,{slots:t}){const n=qI(),s=lI();let i;return()=>{const a=t.default&&tb(t.default(),!0);if(!a||!a.length)return;let u=a[0];if(a.length>1){for(const m of a)if(m.type!==ds){u=m;break}}const o=Zt(e),{mode:r}=o;if(s.isLeaving)return $h(u);const l=_m(u);if(!l)return $h(u);const h=of(l,o,s,n);af(l,h);const c=n.subTree,f=c&&_m(c);let d=!1;const{getTransitionKey:p}=l.type;if(p){const m=p();i===void 0?i=m:m!==i&&(i=m,d=!0)}if(f&&f.type!==ds&&(!zi(l,f)||d)){const m=of(f,o,s,n);if(af(f,m),r==="out-in")return s.isLeaving=!0,m.afterLeave=()=>{s.isLeaving=!1,n.update()},$h(u);r==="in-out"&&l.type!==ds&&(m.delayLeave=(g,x,b)=>{const y=Q0(s,f);y[String(f.key)]=f,g._leaveCb=()=>{x(),g._leaveCb=void 0,delete h.delayedLeave},h.delayedLeave=b})}return u}}},uI=cI;function Q0(e,t){const{leavingVNodes:n}=e;let s=n.get(t.type);return s||(s=Object.create(null),n.set(t.type,s)),s}function of(e,t,n,s){const{appear:i,mode:a,persisted:u=!1,onBeforeEnter:o,onEnter:r,onAfterEnter:l,onEnterCancelled:h,onBeforeLeave:c,onLeave:f,onAfterLeave:d,onLeaveCancelled:p,onBeforeAppear:m,onAppear:g,onAfterAppear:x,onAppearCancelled:b}=t,y=String(e.key),v=Q0(n,e),w=(k,T)=>{k&&jn(k,s,9,T)},C=(k,T)=>{const N=T[1];w(k,T),Mt(k)?k.every(R=>R.length<=1)&&N():k.length<=1&&N()},S={mode:a,persisted:u,beforeEnter(k){let T=o;if(!n.isMounted)if(i)T=m||o;else return;k._leaveCb&&k._leaveCb(!0);const N=v[y];N&&zi(e,N)&&N.el._leaveCb&&N.el._leaveCb(),w(T,[k])},enter(k){let T=r,N=l,R=h;if(!n.isMounted)if(i)T=g||r,N=x||l,R=b||h;else return;let L=!1;const z=k._enterCb=U=>{L||(L=!0,U?w(R,[k]):w(N,[k]),S.delayedLeave&&S.delayedLeave(),k._enterCb=void 0)};T?C(T,[k,z]):z()},leave(k,T){const N=String(e.key);if(k._enterCb&&k._enterCb(!0),n.isUnmounting)return T();w(c,[k]);let R=!1;const L=k._leaveCb=z=>{R||(R=!0,T(),z?w(p,[k]):w(d,[k]),k._leaveCb=void 0,v[N]===e&&delete v[N])};v[N]=e,f?C(f,[k,L]):L()},clone(k){return of(k,t,n,s)}};return S}function $h(e){if(Wc(e))return e=pi(e),e.children=null,e}function _m(e){return Wc(e)?e.children?e.children[0]:void 0:e}function af(e,t){e.shapeFlag&6&&e.component?af(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function tb(e,t=!1,n){let s=[],i=0;for(let a=0;a<e.length;a++){let u=e[a];const o=n==null?u.key:String(n)+String(u.key!=null?u.key:a);u.type===rs?(u.patchFlag&128&&i++,s=s.concat(tb(u.children,t,o))):(t||u.type!==ds)&&s.push(o!=null?pi(u,{key:o}):u)}if(i>1)for(let a=0;a<s.length;a++)s[a].patchFlag=-2;return s}const ql=e=>!!e.type.__asyncLoader,Wc=e=>e.type.__isKeepAlive;function hI(e,t){eb(e,"a",t)}function fI(e,t){eb(e,"da",t)}function eb(e,t,n=Ke){const s=e.__wdc||(e.__wdc=()=>{let i=n;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(Vc(t,s,n),n){let i=n.parent;for(;i&&i.parent;)Wc(i.parent.vnode)&&dI(s,t,n,i),i=i.parent}}function dI(e,t,n,s){const i=Vc(t,e,s,!0);ib(()=>{ud(s[t],i)},n)}function Vc(e,t,n=Ke,s=!1){if(n){const i=n[e]||(n[e]=[]),a=t.__weh||(t.__weh=(...u)=>{if(n.isUnmounted)return;fo(),Yr(n);const o=jn(t,n,e,u);return Ji(),po(),o});return s?i.unshift(a):i.push(a),a}}const qs=e=>(t,n=Ke)=>(!qo||e==="sp")&&Vc(e,t,n),pI=qs("bm"),nb=qs("m"),gI=qs("bu"),mI=qs("u"),sb=qs("bum"),ib=qs("um"),xI=qs("sp"),bI=qs("rtg"),vI=qs("rtc");function yI(e,t=Ke){Vc("ec",e,t)}function Pn(e,t){const n=cs;if(n===null)return e;const s=Gc(n)||n.proxy,i=e.dirs||(e.dirs=[]);for(let a=0;a<t.length;a++){let[u,o,r,l=oe]=t[a];Gt(u)&&(u={mounted:u,updated:u}),u.deep&&ji(o),i.push({dir:u,instance:s,value:o,oldValue:void 0,arg:r,modifiers:l})}return e}function Di(e,t,n,s){const i=e.dirs,a=t&&t.dirs;for(let u=0;u<i.length;u++){const o=i[u];a&&(o.oldValue=a[u].value);let r=o.dir[s];r&&(fo(),jn(r,n,8,[e.el,o,e,t]),po())}}const wI=Symbol();function CI(e,t,n,s){let i;const a=n&&n[s];if(Mt(e)||Ge(e)){i=new Array(e.length);for(let u=0,o=e.length;u<o;u++)i[u]=t(e[u],u,void 0,a&&a[u])}else if(typeof e=="number"){i=new Array(e);for(let u=0;u<e;u++)i[u]=t(u+1,u,void 0,a&&a[u])}else if(Re(e))if(e[Symbol.iterator])i=Array.from(e,(u,o)=>t(u,o,void 0,a&&a[o]));else{const u=Object.keys(e);i=new Array(u.length);for(let o=0,r=u.length;o<r;o++){const l=u[o];i[o]=t(e[l],l,o,a&&a[o])}}else i=[];return n&&(n[s]=i),i}const lf=e=>e?xb(e)?Gc(e)||e.proxy:lf(e.parent):null,rc=sn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>lf(e.parent),$root:e=>lf(e.root),$emit:e=>e.emit,$options:e=>ob(e),$forceUpdate:e=>e.f||(e.f=()=>H0(e.update)),$nextTick:e=>e.n||(e.n=Hk.bind(e.proxy)),$watch:e=>aI.bind(e)}),SI={get({_:e},t){const{ctx:n,setupState:s,data:i,props:a,accessCache:u,type:o,appContext:r}=e;let l;if(t[0]!=="$"){const d=u[t];if(d!==void 0)switch(d){case 1:return s[t];case 2:return i[t];case 4:return n[t];case 3:return a[t]}else{if(s!==oe&&Jt(s,t))return u[t]=1,s[t];if(i!==oe&&Jt(i,t))return u[t]=2,i[t];if((l=e.propsOptions[0])&&Jt(l,t))return u[t]=3,a[t];if(n!==oe&&Jt(n,t))return u[t]=4,n[t];cf&&(u[t]=0)}}const h=rc[t];let c,f;if(h)return t==="$attrs"&&Rn(e,"get",t),h(e);if((c=o.__cssModules)&&(c=c[t]))return c;if(n!==oe&&Jt(n,t))return u[t]=4,n[t];if(f=r.config.globalProperties,Jt(f,t))return f[t]},set({_:e},t,n){const{data:s,setupState:i,ctx:a}=e;return i!==oe&&Jt(i,t)?(i[t]=n,!0):s!==oe&&Jt(s,t)?(s[t]=n,!0):Jt(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(a[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:s,appContext:i,propsOptions:a}},u){let o;return!!n[u]||e!==oe&&Jt(e,u)||t!==oe&&Jt(t,u)||(o=a[0])&&Jt(o,u)||Jt(s,u)||Jt(rc,u)||Jt(i.config.globalProperties,u)},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:Jt(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};let cf=!0;function kI(e){const t=ob(e),n=e.proxy,s=e.ctx;cf=!1,t.beforeCreate&&$m(t.beforeCreate,e,"bc");const{data:i,computed:a,methods:u,watch:o,provide:r,inject:l,created:h,beforeMount:c,mounted:f,beforeUpdate:d,updated:p,activated:m,deactivated:g,beforeDestroy:x,beforeUnmount:b,destroyed:y,unmounted:v,render:w,renderTracked:C,renderTriggered:S,errorCaptured:k,serverPrefetch:T,expose:N,inheritAttrs:R,components:L,directives:z,filters:U}=t;if(l&&II(l,s,null,e.appContext.config.unwrapInjectedRef),u)for(const Q in u){const K=u[Q];Gt(K)&&(s[Q]=K.bind(n))}if(i){const Q=i.call(n,n);Re(Q)&&(e.data=xd(Q))}if(cf=!0,a)for(const Q in a){const K=a[Q],I=Gt(K)?K.bind(n,n):Gt(K.get)?K.get.bind(n,n):fs,A=!Gt(K)&&Gt(K.set)?K.set.bind(n):fs,D=eT({get:I,set:A});Object.defineProperty(s,Q,{enumerable:!0,configurable:!0,get:()=>D.value,set:F=>D.value=F})}if(o)for(const Q in o)rb(o[Q],s,n,Q);if(r){const Q=Gt(r)?r.call(n):r;Reflect.ownKeys(Q).forEach(K=>{oI(K,Q[K])})}h&&$m(h,e,"c");function Y(Q,K){Mt(K)?K.forEach(I=>Q(I.bind(n))):K&&Q(K.bind(n))}if(Y(pI,c),Y(nb,f),Y(gI,d),Y(mI,p),Y(hI,m),Y(fI,g),Y(yI,k),Y(vI,C),Y(bI,S),Y(sb,b),Y(ib,v),Y(xI,T),Mt(N))if(N.length){const Q=e.exposed||(e.exposed={});N.forEach(K=>{Object.defineProperty(Q,K,{get:()=>n[K],set:I=>n[K]=I})})}else e.exposed||(e.exposed={});w&&e.render===fs&&(e.render=w),R!=null&&(e.inheritAttrs=R),L&&(e.components=L),z&&(e.directives=z)}function II(e,t,n=fs,s=!1){Mt(e)&&(e=uf(e));for(const i in e){const a=e[i];let u;Re(a)?"default"in a?u=Th(a.from||i,a.default,!0):u=Th(a.from||i):u=Th(a),fn(u)&&s?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>u.value,set:o=>u.value=o}):t[i]=u}}function $m(e,t,n){jn(Mt(e)?e.map(s=>s.bind(t.proxy)):e.bind(t.proxy),t,n)}function rb(e,t,n,s){const i=s.includes(".")?Z0(n,s):()=>n[s];if(Ge(e)){const a=t[e];Gt(a)&&_h(i,a)}else if(Gt(e))_h(i,e.bind(n));else if(Re(e))if(Mt(e))e.forEach(a=>rb(a,t,n,s));else{const a=Gt(e.handler)?e.handler.bind(n):t[e.handler];Gt(a)&&_h(i,a,e)}}function ob(e){const t=e.type,{mixins:n,extends:s}=t,{mixins:i,optionsCache:a,config:{optionMergeStrategies:u}}=e.appContext,o=a.get(t);let r;return o?r=o:!i.length&&!n&&!s?r=t:(r={},i.length&&i.forEach(l=>oc(r,l,u,!0)),oc(r,t,u)),a.set(t,r),r}function oc(e,t,n,s=!1){const{mixins:i,extends:a}=t;a&&oc(e,a,n,!0),i&&i.forEach(u=>oc(e,u,n,!0));for(const u in t)if(!(s&&u==="expose")){const o=TI[u]||n&&n[u];e[u]=o?o(e[u],t[u]):t[u]}return e}const TI={data:Em,props:Mi,emits:Mi,methods:Mi,computed:Mi,beforeCreate:ln,created:ln,beforeMount:ln,mounted:ln,beforeUpdate:ln,updated:ln,beforeDestroy:ln,beforeUnmount:ln,destroyed:ln,unmounted:ln,activated:ln,deactivated:ln,errorCaptured:ln,serverPrefetch:ln,components:Mi,directives:Mi,watch:$I,provide:Em,inject:_I};function Em(e,t){return t?e?function(){return sn(Gt(e)?e.call(this,this):e,Gt(t)?t.call(this,this):t)}:t:e}function _I(e,t){return Mi(uf(e),uf(t))}function uf(e){if(Mt(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function ln(e,t){return e?[...new Set([].concat(e,t))]:t}function Mi(e,t){return e?sn(sn(Object.create(null),e),t):t}function $I(e,t){if(!e)return t;if(!t)return e;const n=sn(Object.create(null),e);for(const s in t)n[s]=ln(e[s],t[s]);return n}function EI(e,t,n,s=!1){const i={},a={};nc(a,Uc,1),e.propsDefaults=Object.create(null),ab(e,t,i,a);for(const u in e.propsOptions[0])u in i||(i[u]=void 0);n?e.props=s?i:Mk(i):e.type.props?e.props=i:e.props=a,e.attrs=a}function NI(e,t,n,s){const{props:i,attrs:a,vnode:{patchFlag:u}}=e,o=Zt(i),[r]=e.propsOptions;let l=!1;if((s||u>0)&&!(u&16)){if(u&8){const h=e.vnode.dynamicProps;for(let c=0;c<h.length;c++){let f=h[c];if(Bc(e.emitsOptions,f))continue;const d=t[f];if(r)if(Jt(a,f))d!==a[f]&&(a[f]=d,l=!0);else{const p=Xr(f);i[p]=hf(r,o,p,d,e,!1)}else d!==a[f]&&(a[f]=d,l=!0)}}}else{ab(e,t,i,a)&&(l=!0);let h;for(const c in o)(!t||!Jt(t,c)&&((h=ho(c))===c||!Jt(t,h)))&&(r?n&&(n[c]!==void 0||n[h]!==void 0)&&(i[c]=hf(r,o,c,void 0,e,!0)):delete i[c]);if(a!==o)for(const c in a)(!t||!Jt(t,c)&&!0)&&(delete a[c],l=!0)}l&&js(e,"set","$attrs")}function ab(e,t,n,s){const[i,a]=e.propsOptions;let u=!1,o;if(t)for(let r in t){if(Xl(r))continue;const l=t[r];let h;i&&Jt(i,h=Xr(r))?!a||!a.includes(h)?n[h]=l:(o||(o={}))[h]=l:Bc(e.emitsOptions,r)||(!(r in s)||l!==s[r])&&(s[r]=l,u=!0)}if(a){const r=Zt(n),l=o||oe;for(let h=0;h<a.length;h++){const c=a[h];n[c]=hf(i,r,c,l[c],e,!Jt(l,c))}}return u}function hf(e,t,n,s,i,a){const u=e[n];if(u!=null){const o=Jt(u,"default");if(o&&s===void 0){const r=u.default;if(u.type!==Function&&Gt(r)){const{propsDefaults:l}=i;n in l?s=l[n]:(Yr(i),s=l[n]=r.call(null,t),Ji())}else s=r}u[0]&&(a&&!o?s=!1:u[1]&&(s===""||s===ho(n))&&(s=!0))}return s}function lb(e,t,n=!1){const s=t.propsCache,i=s.get(e);if(i)return i;const a=e.props,u={},o=[];let r=!1;if(!Gt(e)){const h=c=>{r=!0;const[f,d]=lb(c,t,!0);sn(u,f),d&&o.push(...d)};!n&&t.mixins.length&&t.mixins.forEach(h),e.extends&&h(e.extends),e.mixins&&e.mixins.forEach(h)}if(!a&&!r)return s.set(e,Lr),Lr;if(Mt(a))for(let h=0;h<a.length;h++){const c=Xr(a[h]);Nm(c)&&(u[c]=oe)}else if(a)for(const h in a){const c=Xr(h);if(Nm(c)){const f=a[h],d=u[c]=Mt(f)||Gt(f)?{type:f}:f;if(d){const p=Rm(Boolean,d.type),m=Rm(String,d.type);d[0]=p>-1,d[1]=m<0||p<m,(p>-1||Jt(d,"default"))&&o.push(c)}}}const l=[u,o];return s.set(e,l),l}function Nm(e){return e[0]!=="$"}function Dm(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function Am(e,t){return Dm(e)===Dm(t)}function Rm(e,t){return Mt(t)?t.findIndex(n=>Am(n,e)):Gt(t)&&Am(t,e)?0:-1}const cb=e=>e[0]==="_"||e==="$stable",Cd=e=>Mt(e)?e.map(Ts):[Ts(e)],DI=(e,t,n)=>{if(t._n)return t;const s=Qk((...i)=>Cd(t(...i)),n);return s._c=!1,s},ub=(e,t,n)=>{const s=e._ctx;for(const i in e){if(cb(i))continue;const a=e[i];if(Gt(a))t[i]=DI(i,a,s);else if(a!=null){const u=Cd(a);t[i]=()=>u}}},hb=(e,t)=>{const n=Cd(t);e.slots.default=()=>n},AI=(e,t)=>{if(e.vnode.shapeFlag&32){const n=t._;n?(e.slots=Zt(t),nc(t,"_",n)):ub(t,e.slots={})}else e.slots={},t&&hb(e,t);nc(e.slots,Uc,1)},RI=(e,t,n)=>{const{vnode:s,slots:i}=e;let a=!0,u=oe;if(s.shapeFlag&32){const o=t._;o?n&&o===1?a=!1:(sn(i,t),!n&&o===1&&delete i._):(a=!t.$stable,ub(t,i)),u=t}else t&&(hb(e,t),u={default:1});if(a)for(const o in i)!cb(o)&&!(o in u)&&delete i[o]};function fb(){return{app:null,config:{isNativeTag:sk,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let OI=0;function FI(e,t){return function(s,i=null){Gt(s)||(s=Object.assign({},s)),i!=null&&!Re(i)&&(i=null);const a=fb(),u=new Set;let o=!1;const r=a.app={_uid:OI++,_component:s,_props:i,_container:null,_context:a,_instance:null,version:nT,get config(){return a.config},set config(l){},use(l,...h){return u.has(l)||(l&&Gt(l.install)?(u.add(l),l.install(r,...h)):Gt(l)&&(u.add(l),l(r,...h))),r},mixin(l){return a.mixins.includes(l)||a.mixins.push(l),r},component(l,h){return h?(a.components[l]=h,r):a.components[l]},directive(l,h){return h?(a.directives[l]=h,r):a.directives[l]},mount(l,h,c){if(!o){const f=As(s,i);return f.appContext=a,h&&t?t(f,l):e(f,l,c),o=!0,r._container=l,l.__vue_app__=r,Gc(f.component)||f.component.proxy}},unmount(){o&&(e(null,r._container),delete r._container.__vue_app__)},provide(l,h){return a.provides[l]=h,r}};return r}}function ff(e,t,n,s,i=!1){if(Mt(e)){e.forEach((f,d)=>ff(f,t&&(Mt(t)?t[d]:t),n,s,i));return}if(ql(s)&&!i)return;const a=s.shapeFlag&4?Gc(s.component)||s.component.proxy:s.el,u=i?null:a,{i:o,r}=e,l=t&&t.r,h=o.refs===oe?o.refs={}:o.refs,c=o.setupState;if(l!=null&&l!==r&&(Ge(l)?(h[l]=null,Jt(c,l)&&(c[l]=null)):fn(l)&&(l.value=null)),Gt(r))li(r,o,12,[u,h]);else{const f=Ge(r),d=fn(r);if(f||d){const p=()=>{if(e.f){const m=f?h[r]:r.value;i?Mt(m)&&ud(m,a):Mt(m)?m.includes(a)||m.push(a):f?(h[r]=[a],Jt(c,r)&&(c[r]=h[r])):(r.value=[a],e.k&&(h[e.k]=r.value))}else f?(h[r]=u,Jt(c,r)&&(c[r]=u)):d&&(r.value=u,e.k&&(h[e.k]=u))};u?(p.id=-1,xn(p,n)):p()}}}const xn=rI;function PI(e){return MI(e)}function MI(e,t){const n=ck();n.__VUE__=!0;const{insert:s,remove:i,patchProp:a,createElement:u,createText:o,createComment:r,setText:l,setElementText:h,parentNode:c,nextSibling:f,setScopeId:d=fs,cloneNode:p,insertStaticContent:m}=e,g=($,E,B,G=null,W=null,J=null,at=!1,ct=null,ut=!!E.dynamicChildren)=>{if($===E)return;$&&!zi($,E)&&(G=rt($),j($,W,J,!0),$=null),E.patchFlag===-2&&(ut=!1,E.dynamicChildren=null);const{type:q,ref:gt,shapeFlag:xt}=E;switch(q){case Sd:x($,E,B,G);break;case ds:b($,E,B,G);break;case Eh:$==null&&y(E,B,G,at);break;case rs:z($,E,B,G,W,J,at,ct,ut);break;default:xt&1?C($,E,B,G,W,J,at,ct,ut):xt&6?U($,E,B,G,W,J,at,ct,ut):(xt&64||xt&128)&&q.process($,E,B,G,W,J,at,ct,ut,ot)}gt!=null&&W&&ff(gt,$&&$.ref,J,E||$,!E)},x=($,E,B,G)=>{if($==null)s(E.el=o(E.children),B,G);else{const W=E.el=$.el;E.children!==$.children&&l(W,E.children)}},b=($,E,B,G)=>{$==null?s(E.el=r(E.children||""),B,G):E.el=$.el},y=($,E,B,G)=>{[$.el,$.anchor]=m($.children,E,B,G,$.el,$.anchor)},v=({el:$,anchor:E},B,G)=>{let W;for(;$&&$!==E;)W=f($),s($,B,G),$=W;s(E,B,G)},w=({el:$,anchor:E})=>{let B;for(;$&&$!==E;)B=f($),i($),$=B;i(E)},C=($,E,B,G,W,J,at,ct,ut)=>{at=at||E.type==="svg",$==null?S(E,B,G,W,J,at,ct,ut):N($,E,W,J,at,ct,ut)},S=($,E,B,G,W,J,at,ct)=>{let ut,q;const{type:gt,props:xt,shapeFlag:vt,transition:Ct,patchFlag:It,dirs:Ft}=$;if($.el&&p!==void 0&&It===-1)ut=$.el=p($.el);else{if(ut=$.el=u($.type,J,xt&&xt.is,xt),vt&8?h(ut,$.children):vt&16&&T($.children,ut,null,G,W,J&&gt!=="foreignObject",at,ct),Ft&&Di($,null,G,"created"),xt){for(const Ht in xt)Ht!=="value"&&!Xl(Ht)&&a(ut,Ht,null,xt[Ht],J,$.children,G,W,X);"value"in xt&&a(ut,"value",null,xt.value),(q=xt.onVnodeBeforeMount)&&ks(q,G,$)}k(ut,$,$.scopeId,at,G)}Ft&&Di($,null,G,"beforeMount");const Ot=(!W||W&&!W.pendingBranch)&&Ct&&!Ct.persisted;Ot&&Ct.beforeEnter(ut),s(ut,E,B),((q=xt&&xt.onVnodeMounted)||Ot||Ft)&&xn(()=>{q&&ks(q,G,$),Ot&&Ct.enter(ut),Ft&&Di($,null,G,"mounted")},W)},k=($,E,B,G,W)=>{if(B&&d($,B),G)for(let J=0;J<G.length;J++)d($,G[J]);if(W){let J=W.subTree;if(E===J){const at=W.vnode;k($,at,at.scopeId,at.slotScopeIds,W.parent)}}},T=($,E,B,G,W,J,at,ct,ut=0)=>{for(let q=ut;q<$.length;q++){const gt=$[q]=ct?si($[q]):Ts($[q]);g(null,gt,E,B,G,W,J,at,ct)}},N=($,E,B,G,W,J,at)=>{const ct=E.el=$.el;let{patchFlag:ut,dynamicChildren:q,dirs:gt}=E;ut|=$.patchFlag&16;const xt=$.props||oe,vt=E.props||oe;let Ct;B&&Ai(B,!1),(Ct=vt.onVnodeBeforeUpdate)&&ks(Ct,B,E,$),gt&&Di(E,$,B,"beforeUpdate"),B&&Ai(B,!0);const It=W&&E.type!=="foreignObject";if(q?R($.dynamicChildren,q,ct,B,G,It,J):at||I($,E,ct,null,B,G,It,J,!1),ut>0){if(ut&16)L(ct,E,xt,vt,B,G,W);else if(ut&2&&xt.class!==vt.class&&a(ct,"class",null,vt.class,W),ut&4&&a(ct,"style",xt.style,vt.style,W),ut&8){const Ft=E.dynamicProps;for(let Ot=0;Ot<Ft.length;Ot++){const Ht=Ft[Ot],Te=xt[Ht],Fe=vt[Ht];(Fe!==Te||Ht==="value")&&a(ct,Ht,Te,Fe,W,$.children,B,G,X)}}ut&1&&$.children!==E.children&&h(ct,E.children)}else!at&&q==null&&L(ct,E,xt,vt,B,G,W);((Ct=vt.onVnodeUpdated)||gt)&&xn(()=>{Ct&&ks(Ct,B,E,$),gt&&Di(E,$,B,"updated")},G)},R=($,E,B,G,W,J,at)=>{for(let ct=0;ct<E.length;ct++){const ut=$[ct],q=E[ct],gt=ut.el&&(ut.type===rs||!zi(ut,q)||ut.shapeFlag&70)?c(ut.el):B;g(ut,q,gt,null,G,W,J,at,!0)}},L=($,E,B,G,W,J,at)=>{if(B!==G){for(const ct in G){if(Xl(ct))continue;const ut=G[ct],q=B[ct];ut!==q&&ct!=="value"&&a($,ct,q,ut,at,E.children,W,J,X)}if(B!==oe)for(const ct in B)!Xl(ct)&&!(ct in G)&&a($,ct,B[ct],null,at,E.children,W,J,X);"value"in G&&a($,"value",B.value,G.value)}},z=($,E,B,G,W,J,at,ct,ut)=>{const q=E.el=$?$.el:o(""),gt=E.anchor=$?$.anchor:o("");let{patchFlag:xt,dynamicChildren:vt,slotScopeIds:Ct}=E;Ct&&(ct=ct?ct.concat(Ct):Ct),$==null?(s(q,B,G),s(gt,B,G),T(E.children,B,gt,W,J,at,ct,ut)):xt>0&&xt&64&&vt&&$.dynamicChildren?(R($.dynamicChildren,vt,B,W,J,at,ct),(E.key!=null||W&&E===W.subTree)&&db($,E,!0)):I($,E,B,gt,W,J,at,ct,ut)},U=($,E,B,G,W,J,at,ct,ut)=>{E.slotScopeIds=ct,$==null?E.shapeFlag&512?W.ctx.activate(E,B,G,at,ut):H(E,B,G,W,J,at,ut):Y($,E,ut)},H=($,E,B,G,W,J,at)=>{const ct=$.component=YI($,G,W);if(Wc($)&&(ct.ctx.renderer=ot),KI(ct),ct.asyncDep){if(W&&W.registerDep(ct,Q),!$.el){const ut=ct.subTree=As(ds);b(null,ut,E,B)}return}Q(ct,$,E,B,W,J,at)},Y=($,E,B)=>{const G=E.component=$.component;if(nI($,E,B))if(G.asyncDep&&!G.asyncResolved){K(G,E,B);return}else G.next=E,Xk(G.update),G.update();else E.el=$.el,G.vnode=E},Q=($,E,B,G,W,J,at)=>{const ct=()=>{if($.isMounted){let{next:gt,bu:xt,u:vt,parent:Ct,vnode:It}=$,Ft=gt,Ot;Ai($,!1),gt?(gt.el=It.el,K($,gt,at)):gt=It,xt&&Yl(xt),(Ot=gt.props&&gt.props.onVnodeBeforeUpdate)&&ks(Ot,Ct,gt,It),Ai($,!0);const Ht=Ih($),Te=$.subTree;$.subTree=Ht,g(Te,Ht,c(Te.el),rt(Te),$,W,J),gt.el=Ht.el,Ft===null&&sI($,Ht.el),vt&&xn(vt,W),(Ot=gt.props&&gt.props.onVnodeUpdated)&&xn(()=>ks(Ot,Ct,gt,It),W)}else{let gt;const{el:xt,props:vt}=E,{bm:Ct,m:It,parent:Ft}=$,Ot=ql(E);if(Ai($,!1),Ct&&Yl(Ct),!Ot&&(gt=vt&&vt.onVnodeBeforeMount)&&ks(gt,Ft,E),Ai($,!0),xt&&mt){const Ht=()=>{$.subTree=Ih($),mt(xt,$.subTree,$,W,null)};Ot?E.type.__asyncLoader().then(()=>!$.isUnmounted&&Ht()):Ht()}else{const Ht=$.subTree=Ih($);g(null,Ht,B,G,$,W,J),E.el=Ht.el}if(It&&xn(It,W),!Ot&&(gt=vt&&vt.onVnodeMounted)){const Ht=E;xn(()=>ks(gt,Ft,Ht),W)}(E.shapeFlag&256||Ft&&ql(Ft.vnode)&&Ft.vnode.shapeFlag&256)&&$.a&&xn($.a,W),$.isMounted=!0,E=B=G=null}},ut=$.effect=new dd(ct,()=>H0(q),$.scope),q=$.update=()=>ut.run();q.id=$.uid,Ai($,!0),q()},K=($,E,B)=>{E.component=$;const G=$.vnode.props;$.vnode=E,$.next=null,NI($,E.props,G,B),RI($,E.children,B),fo(),Lc(void 0,$.update),po()},I=($,E,B,G,W,J,at,ct,ut=!1)=>{const q=$&&$.children,gt=$?$.shapeFlag:0,xt=E.children,{patchFlag:vt,shapeFlag:Ct}=E;if(vt>0){if(vt&128){D(q,xt,B,G,W,J,at,ct,ut);return}else if(vt&256){A(q,xt,B,G,W,J,at,ct,ut);return}}Ct&8?(gt&16&&X(q,W,J),xt!==q&&h(B,xt)):gt&16?Ct&16?D(q,xt,B,G,W,J,at,ct,ut):X(q,W,J,!0):(gt&8&&h(B,""),Ct&16&&T(xt,B,G,W,J,at,ct,ut))},A=($,E,B,G,W,J,at,ct,ut)=>{$=$||Lr,E=E||Lr;const q=$.length,gt=E.length,xt=Math.min(q,gt);let vt;for(vt=0;vt<xt;vt++){const Ct=E[vt]=ut?si(E[vt]):Ts(E[vt]);g($[vt],Ct,B,null,W,J,at,ct,ut)}q>gt?X($,W,J,!0,!1,xt):T(E,B,G,W,J,at,ct,ut,xt)},D=($,E,B,G,W,J,at,ct,ut)=>{let q=0;const gt=E.length;let xt=$.length-1,vt=gt-1;for(;q<=xt&&q<=vt;){const Ct=$[q],It=E[q]=ut?si(E[q]):Ts(E[q]);if(zi(Ct,It))g(Ct,It,B,null,W,J,at,ct,ut);else break;q++}for(;q<=xt&&q<=vt;){const Ct=$[xt],It=E[vt]=ut?si(E[vt]):Ts(E[vt]);if(zi(Ct,It))g(Ct,It,B,null,W,J,at,ct,ut);else break;xt--,vt--}if(q>xt){if(q<=vt){const Ct=vt+1,It=Ct<gt?E[Ct].el:G;for(;q<=vt;)g(null,E[q]=ut?si(E[q]):Ts(E[q]),B,It,W,J,at,ct,ut),q++}}else if(q>vt)for(;q<=xt;)j($[q],W,J,!0),q++;else{const Ct=q,It=q,Ft=new Map;for(q=It;q<=vt;q++){const an=E[q]=ut?si(E[q]):Ts(E[q]);an.key!=null&&Ft.set(an.key,q)}let Ot,Ht=0;const Te=vt-It+1;let Fe=!1,zs=0;const Cs=new Array(Te);for(q=0;q<Te;q++)Cs[q]=0;for(q=Ct;q<=xt;q++){const an=$[q];if(Ht>=Te){j(an,W,J,!0);continue}let Ss;if(an.key!=null)Ss=Ft.get(an.key);else for(Ot=It;Ot<=vt;Ot++)if(Cs[Ot-It]===0&&zi(an,E[Ot])){Ss=Ot;break}Ss===void 0?j(an,W,J,!0):(Cs[Ss-It]=q+1,Ss>=zs?zs=Ss:Fe=!0,g(an,E[Ss],B,null,W,J,at,ct,ut),Ht++)}const Ir=Fe?LI(Cs):Lr;for(Ot=Ir.length-1,q=Te-1;q>=0;q--){const an=It+q,Ss=E[an],gm=an+1<gt?E[an+1].el:G;Cs[q]===0?g(null,Ss,B,gm,W,J,at,ct,ut):Fe&&(Ot<0||q!==Ir[Ot]?F(Ss,B,gm,2):Ot--)}}},F=($,E,B,G,W=null)=>{const{el:J,type:at,transition:ct,children:ut,shapeFlag:q}=$;if(q&6){F($.component.subTree,E,B,G);return}if(q&128){$.suspense.move(E,B,G);return}if(q&64){at.move($,E,B,ot);return}if(at===rs){s(J,E,B);for(let xt=0;xt<ut.length;xt++)F(ut[xt],E,B,G);s($.anchor,E,B);return}if(at===Eh){v($,E,B);return}if(G!==2&&q&1&&ct)if(G===0)ct.beforeEnter(J),s(J,E,B),xn(()=>ct.enter(J),W);else{const{leave:xt,delayLeave:vt,afterLeave:Ct}=ct,It=()=>s(J,E,B),Ft=()=>{xt(J,()=>{It(),Ct&&Ct()})};vt?vt(J,It,Ft):Ft()}else s(J,E,B)},j=($,E,B,G=!1,W=!1)=>{const{type:J,props:at,ref:ct,children:ut,dynamicChildren:q,shapeFlag:gt,patchFlag:xt,dirs:vt}=$;if(ct!=null&&ff(ct,null,B,$,!0),gt&256){E.ctx.deactivate($);return}const Ct=gt&1&&vt,It=!ql($);let Ft;if(It&&(Ft=at&&at.onVnodeBeforeUnmount)&&ks(Ft,E,$),gt&6)V($.component,B,G);else{if(gt&128){$.suspense.unmount(B,G);return}Ct&&Di($,null,E,"beforeUnmount"),gt&64?$.type.remove($,E,B,W,ot,G):q&&(J!==rs||xt>0&&xt&64)?X(q,E,B,!1,!0):(J===rs&&xt&384||!W&&gt&16)&&X(ut,E,B),G&&O($)}(It&&(Ft=at&&at.onVnodeUnmounted)||Ct)&&xn(()=>{Ft&&ks(Ft,E,$),Ct&&Di($,null,E,"unmounted")},B)},O=$=>{const{type:E,el:B,anchor:G,transition:W}=$;if(E===rs){_(B,G);return}if(E===Eh){w($);return}const J=()=>{i(B),W&&!W.persisted&&W.afterLeave&&W.afterLeave()};if($.shapeFlag&1&&W&&!W.persisted){const{leave:at,delayLeave:ct}=W,ut=()=>at(B,J);ct?ct($.el,J,ut):ut()}else J()},_=($,E)=>{let B;for(;$!==E;)B=f($),i($),$=B;i(E)},V=($,E,B)=>{const{bum:G,scope:W,update:J,subTree:at,um:ct}=$;G&&Yl(G),W.stop(),J&&(J.active=!1,j(at,$,E,B)),ct&&xn(ct,E),xn(()=>{$.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&$.asyncDep&&!$.asyncResolved&&$.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},X=($,E,B,G=!1,W=!1,J=0)=>{for(let at=J;at<$.length;at++)j($[at],E,B,G,W)},rt=$=>$.shapeFlag&6?rt($.component.subTree):$.shapeFlag&128?$.suspense.next():f($.anchor||$.el),st=($,E,B)=>{$==null?E._vnode&&j(E._vnode,null,null,!0):g(E._vnode||null,$,E,null,null,null,B),Y0(),E._vnode=$},ot={p:g,um:j,m:F,r:O,mt:H,mc:T,pc:I,pbc:R,n:rt,o:e};let ht,mt;return t&&([ht,mt]=t(ot)),{render:st,hydrate:ht,createApp:FI(st,ht)}}function Ai({effect:e,update:t},n){e.allowRecurse=t.allowRecurse=n}function db(e,t,n=!1){const s=e.children,i=t.children;if(Mt(s)&&Mt(i))for(let a=0;a<s.length;a++){const u=s[a];let o=i[a];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=i[a]=si(i[a]),o.el=u.el),n||db(u,o))}}function LI(e){const t=e.slice(),n=[0];let s,i,a,u,o;const r=e.length;for(s=0;s<r;s++){const l=e[s];if(l!==0){if(i=n[n.length-1],e[i]<l){t[s]=i,n.push(s);continue}for(a=0,u=n.length-1;a<u;)o=a+u>>1,e[n[o]]<l?a=o+1:u=o;l<e[n[a]]&&(a>0&&(t[s]=n[a-1]),n[a]=s)}}for(a=n.length,u=n[a-1];a-- >0;)n[a]=u,u=t[u];return n}const BI=e=>e.__isTeleport,rs=Symbol(void 0),Sd=Symbol(void 0),ds=Symbol(void 0),Eh=Symbol(void 0),Uo=[];let us=null;function ni(e=!1){Uo.push(us=e?null:[])}function zI(){Uo.pop(),us=Uo[Uo.length-1]||null}let Yo=1;function Om(e){Yo+=e}function pb(e){return e.dynamicChildren=Yo>0?us||Lr:null,zI(),Yo>0&&us&&us.push(e),e}function Li(e,t,n,s,i,a){return pb(At(e,t,n,s,i,a,!0))}function WI(e,t,n,s,i){return pb(As(e,t,n,s,i,!0))}function VI(e){return e?e.__v_isVNode===!0:!1}function zi(e,t){return e.type===t.type&&e.key===t.key}const Uc="__vInternal",gb=({key:e})=>e!=null?e:null,Kl=({ref:e,ref_key:t,ref_for:n})=>e!=null?Ge(e)||fn(e)||Gt(e)?{i:cs,r:e,k:t,f:!!n}:e:null;function At(e,t=null,n=null,s=0,i=null,a=e===rs?0:1,u=!1,o=!1){const r={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&gb(t),ref:t&&Kl(t),scopeId:zc,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:s,dynamicProps:i,dynamicChildren:null,appContext:null};return o?(kd(r,n),a&128&&e.normalize(r)):n&&(r.shapeFlag|=Ge(n)?8:16),Yo>0&&!u&&us&&(r.patchFlag>0||a&6)&&r.patchFlag!==32&&us.push(r),r}const As=UI;function UI(e,t=null,n=null,s=0,i=null,a=!1){if((!e||e===wI)&&(e=ds),VI(e)){const o=pi(e,t,!0);return n&&kd(o,n),Yo>0&&!a&&us&&(o.shapeFlag&6?us[us.indexOf(e)]=o:us.push(o)),o.patchFlag|=-2,o}if(tT(e)&&(e=e.__vccOpts),t){t=GI(t);let{class:o,style:r}=t;o&&!Ge(o)&&(t.class=ld(o)),Re(r)&&(W0(r)&&!Mt(r)&&(r=sn({},r)),t.style=ad(r))}const u=Ge(e)?1:iI(e)?128:BI(e)?64:Re(e)?4:Gt(e)?2:0;return At(e,t,n,s,i,u,a,!0)}function GI(e){return e?W0(e)||Uc in e?sn({},e):e:null}function pi(e,t,n=!1){const{props:s,ref:i,patchFlag:a,children:u}=e,o=t?HI(s||{},t):s;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:o,key:o&&gb(o),ref:t&&t.ref?n&&i?Mt(i)?i.concat(Kl(t)):[i,Kl(t)]:Kl(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:u,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==rs?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&pi(e.ssContent),ssFallback:e.ssFallback&&pi(e.ssFallback),el:e.el,anchor:e.anchor}}function mb(e=" ",t=0){return As(Sd,null,e,t)}function Nh(e="",t=!1){return t?(ni(),WI(ds,null,e)):As(ds,null,e)}function Ts(e){return e==null||typeof e=="boolean"?As(ds):Mt(e)?As(rs,null,e.slice()):typeof e=="object"?si(e):As(Sd,null,String(e))}function si(e){return e.el===null||e.memo?e:pi(e)}function kd(e,t){let n=0;const{shapeFlag:s}=e;if(t==null)t=null;else if(Mt(t))n=16;else if(typeof t=="object")if(s&65){const i=t.default;i&&(i._c&&(i._d=!1),kd(e,i()),i._c&&(i._d=!0));return}else{n=32;const i=t._;!i&&!(Uc in t)?t._ctx=cs:i===3&&cs&&(cs.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Gt(t)?(t={default:t,_ctx:cs},n=32):(t=String(t),s&64?(n=16,t=[mb(t)]):n=8);e.children=t,e.shapeFlag|=n}function HI(...e){const t={};for(let n=0;n<e.length;n++){const s=e[n];for(const i in s)if(i==="class")t.class!==s.class&&(t.class=ld([t.class,s.class]));else if(i==="style")t.style=ad([t.style,s.style]);else if(Rc(i)){const a=t[i],u=s[i];u&&a!==u&&!(Mt(a)&&a.includes(u))&&(t[i]=a?[].concat(a,u):u)}else i!==""&&(t[i]=s[i])}return t}function ks(e,t,n,s=null){jn(e,t,7,[n,s])}const jI=fb();let XI=0;function YI(e,t,n){const s=e.type,i=(t?t.appContext:e.appContext)||jI,a={uid:XI++,vnode:e,type:s,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new uk(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:lb(s,i),emitsOptions:K0(s,i),emit:null,emitted:null,propsDefaults:oe,inheritAttrs:s.inheritAttrs,ctx:oe,data:oe,props:oe,attrs:oe,slots:oe,refs:oe,setupState:oe,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=Kk.bind(null,a),e.ce&&e.ce(a),a}let Ke=null;const qI=()=>Ke||cs,Yr=e=>{Ke=e,e.scope.on()},Ji=()=>{Ke&&Ke.scope.off(),Ke=null};function xb(e){return e.vnode.shapeFlag&4}let qo=!1;function KI(e,t=!1){qo=t;const{props:n,children:s}=e.vnode,i=xb(e);EI(e,n,i,t),AI(e,s);const a=i?JI(e,t):void 0;return qo=!1,a}function JI(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=V0(new Proxy(e.ctx,SI));const{setup:s}=n;if(s){const i=e.setupContext=s.length>1?QI(e):null;Yr(e),fo();const a=li(s,e,0,[e.props,i]);if(po(),Ji(),T0(a)){if(a.then(Ji,Ji),t)return a.then(u=>{Fm(e,u,t)}).catch(u=>{Mc(u,e,0)});e.asyncDep=a}else Fm(e,a,t)}else bb(e,t)}function Fm(e,t,n){Gt(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Re(t)&&(e.setupState=U0(t)),bb(e,n)}let Pm;function bb(e,t,n){const s=e.type;if(!e.render){if(!t&&Pm&&!s.render){const i=s.template;if(i){const{isCustomElement:a,compilerOptions:u}=e.appContext.config,{delimiters:o,compilerOptions:r}=s,l=sn(sn({isCustomElement:a,delimiters:o},u),r);s.render=Pm(i,l)}}e.render=s.render||fs}Yr(e),fo(),kI(e),po(),Ji()}function ZI(e){return new Proxy(e.attrs,{get(t,n){return Rn(e,"get","$attrs"),t[n]}})}function QI(e){const t=s=>{e.exposed=s||{}};let n;return{get attrs(){return n||(n=ZI(e))},slots:e.slots,emit:e.emit,expose:t}}function Gc(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(U0(V0(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in rc)return rc[n](e)}}))}function tT(e){return Gt(e)&&"__vccOpts"in e}const eT=(e,t)=>Uk(e,t,qo),nT="3.2.37",sT="http://www.w3.org/2000/svg",Wi=typeof document!="undefined"?document:null,Mm=Wi&&Wi.createElement("template"),iT={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,s)=>{const i=t?Wi.createElementNS(sT,e):Wi.createElement(e,n?{is:n}:void 0);return e==="select"&&s&&s.multiple!=null&&i.setAttribute("multiple",s.multiple),i},createText:e=>Wi.createTextNode(e),createComment:e=>Wi.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Wi.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode(e){const t=e.cloneNode(!0);return"_value"in e&&(t._value=e._value),t},insertStaticContent(e,t,n,s,i,a){const u=n?n.previousSibling:t.lastChild;if(i&&(i===a||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),n),!(i===a||!(i=i.nextSibling)););else{Mm.innerHTML=s?`<svg>${e}</svg>`:e;const o=Mm.content;if(s){const r=o.firstChild;for(;r.firstChild;)o.appendChild(r.firstChild);o.removeChild(r)}t.insertBefore(o,n)}return[u?u.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}};function rT(e,t,n){const s=e._vtc;s&&(t=(t?[t,...s]:[...s]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}function oT(e,t,n){const s=e.style,i=Ge(n);if(n&&!i){for(const a in n)df(s,a,n[a]);if(t&&!Ge(t))for(const a in t)n[a]==null&&df(s,a,"")}else{const a=s.display;i?t!==n&&(s.cssText=n):t&&e.removeAttribute("style"),"_vod"in e&&(s.display=a)}}const Lm=/\s*!important$/;function df(e,t,n){if(Mt(n))n.forEach(s=>df(e,t,s));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const s=aT(e,t);Lm.test(n)?e.setProperty(ho(s),n.replace(Lm,""),"important"):e[s]=n}}const Bm=["Webkit","Moz","ms"],Dh={};function aT(e,t){const n=Dh[t];if(n)return n;let s=Xr(t);if(s!=="filter"&&s in e)return Dh[t]=s;s=E0(s);for(let i=0;i<Bm.length;i++){const a=Bm[i]+s;if(a in e)return Dh[t]=a}return t}const zm="http://www.w3.org/1999/xlink";function lT(e,t,n,s,i){if(s&&t.startsWith("xlink:"))n==null?e.removeAttributeNS(zm,t.slice(6,t.length)):e.setAttributeNS(zm,t,n);else{const a=JS(t);n==null||a&&!S0(n)?e.removeAttribute(t):e.setAttribute(t,a?"":n)}}function cT(e,t,n,s,i,a,u){if(t==="innerHTML"||t==="textContent"){s&&u(s,i,a),e[t]=n==null?"":n;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=n;const r=n==null?"":n;(e.value!==r||e.tagName==="OPTION")&&(e.value=r),n==null&&e.removeAttribute(t);return}let o=!1;if(n===""||n==null){const r=typeof e[t];r==="boolean"?n=S0(n):n==null&&r==="string"?(n="",o=!0):r==="number"&&(n=0,o=!0)}try{e[t]=n}catch{}o&&e.removeAttribute(t)}const[vb,uT]=(()=>{let e=Date.now,t=!1;if(typeof window!="undefined"){Date.now()>document.createEvent("Event").timeStamp&&(e=performance.now.bind(performance));const n=navigator.userAgent.match(/firefox\/(\d+)/i);t=!!(n&&Number(n[1])<=53)}return[e,t]})();let pf=0;const hT=Promise.resolve(),fT=()=>{pf=0},dT=()=>pf||(hT.then(fT),pf=vb());function Vi(e,t,n,s){e.addEventListener(t,n,s)}function pT(e,t,n,s){e.removeEventListener(t,n,s)}function gT(e,t,n,s,i=null){const a=e._vei||(e._vei={}),u=a[t];if(s&&u)u.value=s;else{const[o,r]=mT(t);if(s){const l=a[t]=xT(s,i);Vi(e,o,l,r)}else u&&(pT(e,o,u,r),a[t]=void 0)}}const Wm=/(?:Once|Passive|Capture)$/;function mT(e){let t;if(Wm.test(e)){t={};let n;for(;n=e.match(Wm);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[ho(e.slice(2)),t]}function xT(e,t){const n=s=>{const i=s.timeStamp||vb();(uT||i>=n.attached-1)&&jn(bT(s,n.value),t,5,[s])};return n.value=e,n.attached=dT(),n}function bT(e,t){if(Mt(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(s=>i=>!i._stopped&&s&&s(i))}else return t}const Vm=/^on[a-z]/,vT=(e,t,n,s,i=!1,a,u,o,r)=>{t==="class"?rT(e,s,i):t==="style"?oT(e,n,s):Rc(t)?cd(t)||gT(e,t,n,s,u):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):yT(e,t,s,i))?cT(e,t,s,a,u,o,r):(t==="true-value"?e._trueValue=s:t==="false-value"&&(e._falseValue=s),lT(e,t,s,i))};function yT(e,t,n,s){return s?!!(t==="innerHTML"||t==="textContent"||t in e&&Vm.test(t)&&Gt(n)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||Vm.test(t)&&Ge(n)?!1:t in e}const wT={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};uI.props;const ac=e=>{const t=e.props["onUpdate:modelValue"]||!1;return Mt(t)?n=>Yl(t,n):t};function CT(e){e.target.composing=!0}function Um(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const ss={created(e,{modifiers:{lazy:t,trim:n,number:s}},i){e._assign=ac(i);const a=s||i.props&&i.props.type==="number";Vi(e,t?"change":"input",u=>{if(u.target.composing)return;let o=e.value;n&&(o=o.trim()),a&&(o=Jh(o)),e._assign(o)}),n&&Vi(e,"change",()=>{e.value=e.value.trim()}),t||(Vi(e,"compositionstart",CT),Vi(e,"compositionend",Um),Vi(e,"change",Um))},mounted(e,{value:t}){e.value=t==null?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:n,trim:s,number:i}},a){if(e._assign=ac(a),e.composing||document.activeElement===e&&e.type!=="range"&&(n||s&&e.value.trim()===t||(i||e.type==="number")&&Jh(e.value)===t))return;const u=t==null?"":t;e.value!==u&&(e.value=u)}},ST={deep:!0,created(e,t,n){e._assign=ac(n),Vi(e,"change",()=>{const s=e._modelValue,i=kT(e),a=e.checked,u=e._assign;if(Mt(s)){const o=k0(s,i),r=o!==-1;if(a&&!r)u(s.concat(i));else if(!a&&r){const l=[...s];l.splice(o,1),u(l)}}else if(Oc(s)){const o=new Set(s);a?o.add(i):o.delete(i),u(o)}else u(yb(e,a))})},mounted:Gm,beforeUpdate(e,t,n){e._assign=ac(n),Gm(e,t,n)}};function Gm(e,{value:t,oldValue:n},s){e._modelValue=t,Mt(t)?e.checked=k0(t,s.props.value)>-1:Oc(t)?e.checked=t.has(s.props.value):t!==n&&(e.checked=Ac(t,yb(e,!0)))}function kT(e){return"_value"in e?e._value:e.value}function yb(e,t){const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t}const IT=sn({patchProp:vT},iT);let Hm;function TT(){return Hm||(Hm=PI(IT))}const _T=(...e)=>{const t=TT().createApp(...e),{mount:n}=t;return t.mount=s=>{const i=$T(s);if(!i)return;const a=t._component;!Gt(a)&&!a.render&&!a.template&&(a.template=i.innerHTML),i.innerHTML="";const u=n(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),u},t};function $T(e){return Ge(e)?document.querySelector(e):e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ET=1e-7,NT=1e-4;class wb{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Id{refCount(t){return $n("refCount")}incRef(t){return $n("incRef")}timerAvailable(){return!0}time(t){return $n("time")}read(t){return $n("read")}readSync(t){return $n("readSync")}readToGPU(t,n){return $n("readToGPU")}numDataIds(){return $n("numDataIds")}disposeData(t,n){return $n("disposeData")}write(t,n,s){return $n("write")}move(t,n,s,i,a){return $n("move")}memory(){return $n("memory")}floatPrecision(){return $n("floatPrecision")}epsilon(){return this.floatPrecision()===32?ET:NT}dispose(){return $n("dispose")}}function $n(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Ar(e,t,n)}function sr(e,t,n){return Math.max(e,Math.min(t,n))}function Cb(e){return e%2===0?e:e+1}function Ar(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function AT(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function P(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Jn(e,t,n=""){P(Qt(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Td(e){P(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function qr(e,t=[],n=!1){if(t==null&&(t=[]),Array.isArray(e)||Ms(e)&&!n)for(let s=0;s<e.length;++s)qr(e[s],t,n);else t.push(e);return t}function pt(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Qt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Kr(e){return e%1===0}function gf(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Wr(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function jm(e,t=s=>0,n){return new Promise((s,i)=>{let a=0;const u=()=>{if(e()){s();return}a++;const o=t(a);if(n!=null&&a>=n){i();return}setTimeout(u,o)};u()})}function Sb(e,t){let n=1,s=-1;for(let a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(e[a]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${a}`);s=a}else if(e[a]<0)throw Error(`Shapes can not be < 0. Found ${e[a]} at dim ${a}`);if(s===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[s]=t/n,i}function Ut(e,t){const n=t.length;return e=e==null?t.map((s,i)=>i):[].concat(e),P(e.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),P(e.every(s=>Kr(s)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(s=>s<0?n+s:s)}function wi(e,t){const n=[],s=[],i=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||i?null:Ut(t,e).sort();let u=0;for(let o=0;o<e.length;++o){if(a!=null){if(a[u]===o&&e[o]!==1)throw new Error(`Can't squeeze axis ${o} since its dim '${e[o]}' is not 1`);(a[u]==null||a[u]>o)&&e[o]===1&&(n.push(e[o]),s.push(o)),a[u]<=o&&u++}e[o]!==1&&(n.push(e[o]),s.push(o))}return{newShape:n,keptDims:s}}function He(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else throw new Error(`Unknown data type ${e}`);return n}function nn(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function RT(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function OT(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function kb(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function Ms(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function mf(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function FT(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function aa(e){return typeof e=="string"||e instanceof String}function PT(e){return typeof e=="boolean"}function xf(e){return typeof e=="number"}function la(e){return Array.isArray(e)?la(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":xf(e)?"float32":aa(e)?"string":PT(e)?"bool":"float32"}function bf(e){return!!(e&&e.constructor&&e.call&&e.apply)}function vf(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Dt(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let s=t-3;s>=0;--s)n[s]=n[s+1]*e[s+1];return n}function Ib(e,t,n,s=!1){const i=new Array;if(t.length===1){const a=t[0]*(s?2:1);for(let u=0;u<a;u++)i[u]=n[e+u]}else{const a=t[0],u=t.slice(1),o=u.reduce((r,l)=>r*l)*(s?2:1);for(let r=0;r<a;r++)i[r]=Ib(e+r*o,u,n,s)}return i}function ps(e,t,n=!1){if(e.length===0)return t[0];const s=e.reduce((i,a)=>i*a)*(n?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return Ib(0,e,t,n)}function _d(e,t){const n=Ze(e,t);for(let s=0;s<n.length;s++)n[s]=1;return n}function Ze(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Tb(e,t){const n=e.reduce((s,i)=>s*i,1);if(t==null||t==="float32")return ps(e,new Float32Array(n));if(t==="int32")return ps(e,new Int32Array(n));if(t==="bool")return ps(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function _b(e){e.forEach(t=>{P(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function Rs(e,t,n){if(t===0)return 0;if(t===1)return e[0];let s=e[e.length-1];for(let i=0;i<e.length-1;++i)s+=n[i]*e[i];return s}function ca(e,t,n){if(t===0)return[];if(t===1)return[e];const s=new Array(t);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(e/n[i]),e-=s[i]*n[i];return s[s.length-1]=e,s}function $b(e){return e&&e.then&&typeof e.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xm="tfjsflags";class MT{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=LT,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,s){if(this.flagRegistry[t]={evaluationFn:n,setHook:s},this.urlFlags[t]!=null){const i=this.urlFlags[t];dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${i}.`),this.set(t,i)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if($b(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global=="undefined"||typeof this.global.location=="undefined"||typeof this.global.location.search=="undefined")return;const t=this.getQueryParams(this.global.location.search);Xm in t&&t[Xm].split(",").forEach(s=>{const[i,a]=s.split(":");this.urlFlags[i]=zT(i,a)})}}function LT(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(BT(t,s[0],s[1]),s.join("="))),t}function BT(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function zT(e,t){if(t=t.toLowerCase(),t==="true"||t==="false")return t==="true";if(`${+t}`===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}function dt(){return Eb}let Eb=null;function WT(e){Eb=e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ah;function Nb(){if(Ah==null){let e;if(typeof window!="undefined")e=window;else if(typeof global!="undefined")e=global;else if(typeof process!="undefined")e=process;else if(typeof self!="undefined")e=self;else throw new Error("Could not find a global object");Ah=e}return Ah}function VT(){const e=Nb();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function $d(e,t){const n=VT();if(n.has(e))return n.get(e);{const s=t();return n.set(e,s),n.get(e)}}const Hc="Abs",ua="Acos",ha="Acosh",go="Add",Ed="AddN",Nd="All",Dd="Any",jc="ArgMax",Xc="ArgMin",fa="Asin",da="Asinh",pa="Atan",ga="Atanh",ma="Atan2",Yc="AvgPool",Ad="AvgPoolGrad",qc="AvgPool3D",Rd="AvgPool3DGrad",Kc="BatchMatMul",Jc="BatchToSpaceND",Od="Bincount",UT="BroadcastTo",Db="BroadcastArgs",xa="Cast",ba="Ceil",va="ClipByValue",Fd="Complex",Zc="ComplexAbs",Qc="Concat",tu="Conv2D",Pd="Conv2DBackpropFilter",eu="Conv2DBackpropInput",nu="Conv3D",Md="Conv3DBackpropFilterV2",Ld="Conv3DBackpropInputV2",ya="Cos",wa="Cosh",Bd="Cumprod",su="Cumsum",zd="CropAndResize",Ab="DenseBincount",Wd="DepthToSpace",iu="DepthwiseConv2dNative",Vd="DepthwiseConv2dNativeBackpropFilter",Ud="DepthwiseConv2dNativeBackpropInput",Rb="Diag",ru="Dilation2D",yf="Dilation2DBackpropInput",wf="Dilation2DBackpropFilter",Ca="RealDiv",Ob="Einsum",Sa="Elu",Gd="EluGrad",ka="Erf",ou="Equal",Ia="Exp",au="ExpandDims",Ta="Expm1",Hd="FFT",jd="Fill",Xd="FlipLeftRight",_a="Floor",$a="FloorDiv",lu="FusedBatchNorm",cu="GatherV2",Fb="GatherNd",uu="Greater",Ea="GreaterEqual",Na="Identity",Yd="IFFT",qd="Imag",Da="IsFinite",Aa="IsInf",Ra="IsNan",hu="LeakyRelu",fu="Less",du="LessEqual",Pb="LinSpace",Oa="Log",Fa="Log1p",pu="LogicalAnd",gu="LogicalNot",mu="LogicalOr",GT="LogSoftmax",xu="LRN",Kd="LRNGrad",bu="Max",Pa="Maximum",vu="MaxPool",Jd="MaxPoolGrad",yu="MaxPool3D",Zd="MaxPool3DGrad",Mb="MaxPoolWithArgmax",wu="Mean",Cu="Min",Ma="Minimum",Su="MirrorPad",La="Mod",Lb="Multinomial",Ba="Multiply",ku="Neg",Iu="NotEqual",Qd="NonMaxSuppressionV3",tp="NonMaxSuppressionV4",ep="NonMaxSuppressionV5",Tu="OnesLike",_u="OneHot",$u="Pack",Eu="PadV2",za="Pow",Nu="Prelu",Du="Prod",np="Range",sp="Real",Wa="Reciprocal",Va="Relu",Au="Reshape",Ru="ResizeNearestNeighbor",ip="ResizeNearestNeighborGrad",Ou="ResizeBilinear",rp="ResizeBilinearGrad",Ua="Relu6",Fu="Reverse",Ga="Round",Ha="Rsqrt",Bb="ScatterNd",zb="SearchSorted",Pu="Select",ja="Selu",Mu="Slice",Xa="Sin",Ya="Sinh",qa="Sign",Ka="Sigmoid",Ja="Softplus",Za="Sqrt",Lu="Sum",Bu="SpaceToBatchND",zu="SplitV",Wu="Softmax",op="SparseFillEmptyRows",ap="SparseReshape",lp="SparseSegmentMean",cp="SparseSegmentSum",Wb="SparseToDense",Qa="SquaredDifference",up="Square",hp="StridedSlice",fp="StringNGrams",dp="StringSplit",pp="StringToHashBucketFast",tl="Sub",el="Tan",nl="Tanh",sl="Tile",gp="TopK",mp="Transform",Vr="Transpose",xp="Unique",Vu="Unpack",Uu="UnsortedSegmentSum",Gu="ZerosLike",il="Step",Cf="FromPixels",bp="RotateWithOffset",lc="_FusedMatMul",cc="FusedConv2D",Vb="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(...e){dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(...e)}function HT(...e){dt().getBool("IS_TEST")||dt().getBool("PROD")||console.log(...e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uc=$d("kernelRegistry",()=>new Map),Sf=$d("gradRegistry",()=>new Map);function kf(e,t){const n=Gb(e,t);return uc.get(n)}function Ym(e){return Sf.get(e)}function qm(e){const t=uc.entries(),n=[];for(;;){const{done:s,value:i}=t.next();if(s)break;const[a,u]=i,[o]=a.split("_");o===e&&n.push(u)}return n}function Ub(e){const{kernelName:t,backendName:n}=e,s=Gb(t,n);uc.has(s)&&Nn(`The kernel '${t}' for backend '${n}' is already registered`),uc.set(s,e)}function jT(e){const{kernelName:t}=e;Sf.has(t)&&dt().getBool("DEBUG")&&Nn(`Overriding the gradient for '${t}'`),Sf.set(t,e)}function Gb(e,t){return`${t}_${e}`}var je=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function XT(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),t}var If=he,Wn=null;try{Wn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function he(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}he.prototype.__isLong__;Object.defineProperty(he.prototype,"__isLong__",{value:!0});function _n(e){return(e&&e.__isLong__)===!0}he.isLong=_n;var Km={},Jm={};function mr(e,t){var n,s,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(s=Jm[e],s)?s:(n=fe(e,(e|0)<0?-1:0,!0),i&&(Jm[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(s=Km[e],s)?s:(n=fe(e,e<0?-1:0,!1),i&&(Km[e]=n),n))}he.fromInt=mr;function Vn(e,t){if(isNaN(e))return t?Xi:Un;if(t){if(e<0)return Xi;if(e>=Hb)return Yb}else{if(e<=-Qm)return vn;if(e+1>=Qm)return Xb}return e<0?Vn(-e,t).neg():fe(e%Jr|0,e/Jr|0,t)}he.fromNumber=Vn;function fe(e,t,n){return new he(e,t,n)}he.fromBits=fe;var hc=Math.pow;function vp(e,t,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Un;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=e.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return vp(e.substring(1),t,n).neg();for(var i=Vn(hc(n,8)),a=Un,u=0;u<e.length;u+=8){var o=Math.min(8,e.length-u),r=parseInt(e.substring(u,u+o),n);if(o<8){var l=Vn(hc(n,o));a=a.mul(l).add(Vn(r))}else a=a.mul(i),a=a.add(Vn(r))}return a.unsigned=t,a}he.fromString=vp;function ys(e,t){return typeof e=="number"?Vn(e,t):typeof e=="string"?vp(e,t):fe(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}he.fromValue=ys;var Zm=1<<16,YT=1<<24,Jr=Zm*Zm,Hb=Jr*Jr,Qm=Hb/2,tx=mr(YT),Un=mr(0);he.ZERO=Un;var Xi=mr(0,!0);he.UZERO=Xi;var Pr=mr(1);he.ONE=Pr;var jb=mr(1,!0);he.UONE=jb;var Tf=mr(-1);he.NEG_ONE=Tf;var Xb=fe(-1,2147483647,!1);he.MAX_VALUE=Xb;var Yb=fe(-1,-1,!0);he.MAX_UNSIGNED_VALUE=Yb;var vn=fe(0,-2147483648,!1);he.MIN_VALUE=vn;var wt=he.prototype;wt.toInt=function(){return this.unsigned?this.low>>>0:this.low};wt.toNumber=function(){return this.unsigned?(this.high>>>0)*Jr+(this.low>>>0):this.high*Jr+(this.low>>>0)};wt.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(vn)){var n=Vn(t),s=this.div(n),i=s.mul(n).sub(this);return s.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var a=Vn(hc(t,6),this.unsigned),u=this,o="";;){var r=u.div(a),l=u.sub(r.mul(a)).toInt()>>>0,h=l.toString(t);if(u=r,u.isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}};wt.getHighBits=function(){return this.high};wt.getHighBitsUnsigned=function(){return this.high>>>0};wt.getLowBits=function(){return this.low};wt.getLowBitsUnsigned=function(){return this.low>>>0};wt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(vn)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&(t&1<<n)==0;n--);return this.high!=0?n+33:n+1};wt.isZero=function(){return this.high===0&&this.low===0};wt.eqz=wt.isZero;wt.isNegative=function(){return!this.unsigned&&this.high<0};wt.isPositive=function(){return this.unsigned||this.high>=0};wt.isOdd=function(){return(this.low&1)===1};wt.isEven=function(){return(this.low&1)===0};wt.equals=function(t){return _n(t)||(t=ys(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};wt.eq=wt.equals;wt.notEquals=function(t){return!this.eq(t)};wt.neq=wt.notEquals;wt.ne=wt.notEquals;wt.lessThan=function(t){return this.comp(t)<0};wt.lt=wt.lessThan;wt.lessThanOrEqual=function(t){return this.comp(t)<=0};wt.lte=wt.lessThanOrEqual;wt.le=wt.lessThanOrEqual;wt.greaterThan=function(t){return this.comp(t)>0};wt.gt=wt.greaterThan;wt.greaterThanOrEqual=function(t){return this.comp(t)>=0};wt.gte=wt.greaterThanOrEqual;wt.ge=wt.greaterThanOrEqual;wt.compare=function(t){if(_n(t)||(t=ys(t)),this.eq(t))return 0;var n=this.isNegative(),s=t.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};wt.comp=wt.compare;wt.negate=function(){return!this.unsigned&&this.eq(vn)?vn:this.not().add(Pr)};wt.neg=wt.negate;wt.add=function(t){_n(t)||(t=ys(t));var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,a=this.low&65535,u=t.high>>>16,o=t.high&65535,r=t.low>>>16,l=t.low&65535,h=0,c=0,f=0,d=0;return d+=a+l,f+=d>>>16,d&=65535,f+=i+r,c+=f>>>16,f&=65535,c+=s+o,h+=c>>>16,c&=65535,h+=n+u,h&=65535,fe(f<<16|d,h<<16|c,this.unsigned)};wt.subtract=function(t){return _n(t)||(t=ys(t)),this.add(t.neg())};wt.sub=wt.subtract;wt.multiply=function(t){if(this.isZero())return Un;if(_n(t)||(t=ys(t)),Wn){var n=Wn.mul(this.low,this.high,t.low,t.high);return fe(n,Wn.get_high(),this.unsigned)}if(t.isZero())return Un;if(this.eq(vn))return t.isOdd()?vn:Un;if(t.eq(vn))return this.isOdd()?vn:Un;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(tx)&&t.lt(tx))return Vn(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,a=this.low>>>16,u=this.low&65535,o=t.high>>>16,r=t.high&65535,l=t.low>>>16,h=t.low&65535,c=0,f=0,d=0,p=0;return p+=u*h,d+=p>>>16,p&=65535,d+=a*h,f+=d>>>16,d&=65535,d+=u*l,f+=d>>>16,d&=65535,f+=i*h,c+=f>>>16,f&=65535,f+=a*l,c+=f>>>16,f&=65535,f+=u*r,c+=f>>>16,f&=65535,c+=s*h+i*l+a*r+u*o,c&=65535,fe(d<<16|p,c<<16|f,this.unsigned)};wt.mul=wt.multiply;wt.divide=function(t){if(_n(t)||(t=ys(t)),t.isZero())throw Error("division by zero");if(Wn){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?Wn.div_u:Wn.div_s)(this.low,this.high,t.low,t.high);return fe(n,Wn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xi:Un;var s,i,a;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Xi;if(t.gt(this.shru(1)))return jb;a=Xi}else{if(this.eq(vn)){if(t.eq(Pr)||t.eq(Tf))return vn;if(t.eq(vn))return Pr;var u=this.shr(1);return s=u.div(t).shl(1),s.eq(Un)?t.isNegative()?Pr:Tf:(i=this.sub(t.mul(s)),a=s.add(i.div(t)),a)}else if(t.eq(vn))return this.unsigned?Xi:Un;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();a=Un}for(i=this;i.gte(t);){s=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(s)/Math.LN2),r=o<=48?1:hc(2,o-48),l=Vn(s),h=l.mul(t);h.isNegative()||h.gt(i);)s-=r,l=Vn(s,this.unsigned),h=l.mul(t);l.isZero()&&(l=Pr),a=a.add(l),i=i.sub(h)}return a};wt.div=wt.divide;wt.modulo=function(t){if(_n(t)||(t=ys(t)),Wn){var n=(this.unsigned?Wn.rem_u:Wn.rem_s)(this.low,this.high,t.low,t.high);return fe(n,Wn.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};wt.mod=wt.modulo;wt.rem=wt.modulo;wt.not=function(){return fe(~this.low,~this.high,this.unsigned)};wt.and=function(t){return _n(t)||(t=ys(t)),fe(this.low&t.low,this.high&t.high,this.unsigned)};wt.or=function(t){return _n(t)||(t=ys(t)),fe(this.low|t.low,this.high|t.high,this.unsigned)};wt.xor=function(t){return _n(t)||(t=ys(t)),fe(this.low^t.low,this.high^t.high,this.unsigned)};wt.shiftLeft=function(t){return _n(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?fe(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):fe(0,this.low<<t-32,this.unsigned)};wt.shl=wt.shiftLeft;wt.shiftRight=function(t){return _n(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?fe(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):fe(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};wt.shr=wt.shiftRight;wt.shiftRightUnsigned=function(t){if(_n(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var s=this.low;return fe(s>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?fe(n,0,this.unsigned):fe(n>>>t-32,0,this.unsigned)};wt.shru=wt.shiftRightUnsigned;wt.shr_u=wt.shiftRightUnsigned;wt.toSigned=function(){return this.unsigned?fe(this.low,this.high,!1):this};wt.toUnsigned=function(){return this.unsigned?this:fe(this.low,this.high,!0)};wt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};wt.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};wt.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};he.fromBytes=function(t,n,s){return s?he.fromBytesLE(t,n):he.fromBytesBE(t,n)};he.fromBytesLE=function(t,n){return new he(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};he.fromBytesBE=function(t,n){return new he(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};var qT=YS({__proto__:null,default:If},[If]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ui=If||qT;function Hu(e){return Ui.fromString(e,!0,16)}const qb=Hu("c3a5c85c97cb3127"),Bi=Hu("b492b66fbe98f273"),tn=Hu("9ae16a3b2f90404f");function _f(e){return e.xor(e.shru(47))}function Kb(e,t,n){const s=e.slice(t,t+n);return Ui.fromBytes(Array.from(s),!0,!0)}function re(e,t){return Kb(e,t,8)}function ex(e,t){return Kb(e,t,4)}function Be(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function ci(e,t,n=Hu("9ddfea08eb382d69")){let s=e.xor(t).mul(n);s=s.xor(s.shru(47));let i=t.xor(s).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function KT(e,t,n,s,i,a){i=i.add(e),a=Be(a.add(i).add(s),21);const u=i;return i=i.add(t),i=i.add(n),a=a.add(Be(i,44)),[i.add(s),a.add(u)]}function Fl(e,t,n,s){return KT(re(e,t),re(e,t+8),re(e,t+16),re(e,t+24),n,s)}function JT(e,t=e.length){if(t>=8){const n=tn.add(t*2),s=re(e,0).add(tn),i=re(e,t-8),a=Be(i,37).mul(n).add(s),u=Be(s,25).add(i).mul(n);return ci(a,u,n)}if(t>=4){const n=tn.add(t*2),s=ex(e,0);return ci(s.shl(3).add(t),ex(e,t-4),n)}if(t>0){const n=e[0],s=e[t>>1],i=e[t-1],a=n+(s<<8),u=t+(i<<2);return _f(tn.mul(a).xor(qb.mul(u))).mul(tn)}return tn}function ZT(e,t=e.length){const n=tn.add(t*2),s=re(e,0).mul(Bi),i=re(e,8),a=re(e,t-8).mul(n),u=re(e,t-16).mul(tn);return ci(Be(s.add(i),43).add(Be(a,30)).add(u),s.add(Be(i.add(tn),18)).add(a),n)}function QT(e,t=e.length){const n=tn.add(t*2),s=re(e,0).mul(tn),i=re(e,8),a=re(e,t-8).mul(n),u=re(e,t-16).mul(tn),o=Be(s.add(i),43).add(Be(a,30)).add(u),r=ci(o,s.add(Be(i.add(tn),18)).add(a),n),l=re(e,16).mul(n),h=re(e,24),c=o.add(re(e,t-32)).mul(n),f=r.add(re(e,t-24)).mul(n);return ci(Be(l.add(h),43).add(Be(c,30)).add(f),l.add(Be(h.add(s),18)).add(c),n)}function t_(e,t=e.length){const n=Ui.fromNumber(81,!0);if(t<=32)return t<=16?JT(e,t):ZT(e,t);if(t<=64)return QT(e,t);let s=n,i=n.mul(Bi).add(113),a=_f(i.mul(tn).add(113)).mul(tn),u=[Ui.UZERO,Ui.UZERO],o=[Ui.UZERO,Ui.UZERO];s=s.mul(tn).add(re(e,0));let r=0;const l=(t-1>>6)*64,h=l+(t-1&63)-63;do s=Be(s.add(i).add(u[0]).add(re(e,r+8)),37).mul(Bi),i=Be(i.add(u[1]).add(re(e,r+48)),42).mul(Bi),s=s.xor(o[1]),i=i.add(u[0]).add(re(e,r+40)),a=Be(a.add(o[0]),33).mul(Bi),u=Fl(e,r,u[1].mul(Bi),s.add(o[0])),o=Fl(e,r+32,a.add(o[1]),i.add(re(e,r+16))),[a,s]=[s,a],r+=64;while(r!==l);const c=Bi.add(a.and(255).shl(1));return r=h,o[0]=o[0].add(t-1&63),u[0]=u[0].add(o[0]),o[0]=o[0].add(u[0]),s=Be(s.add(i).add(u[0]).add(re(e,r+8)),37).mul(c),i=Be(i.add(u[1]).add(re(e,r+48)),42).mul(c),s=s.xor(o[1].mul(9)),i=i.add(u[0].mul(9).add(re(e,r+40))),a=Be(a.add(o[0]),33).mul(c),u=Fl(e,r,u[1].mul(c),s.add(o[0])),o=Fl(e,r+32,a.add(o[1]),i.add(re(e,r+16))),[a,s]=[s,a],ci(ci(u[0],o[0],c).add(_f(i).mul(qb)).add(a),ci(u[1],o[1],c).add(s),c)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(e,t){return t==="string"?ui(e):xr([e],t)}function e_(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function xr(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=qr(e)),dt().getBool("DEBUG")&&RT(e,t),e_(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){const n=new Uint8Array(e.length);for(let s=0;s<n.length;++s)Math.round(e[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${t}`)}function cn(){return dt().platform.now()}function ui(e,t="utf-8"){return t=t||"utf-8",dt().platform.encode(e,t)}function gi(e,t="utf-8"){return t=t||"utf-8",dt().platform.decode(e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n_{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new i_)}profileKernel(t,n,s){let i;const a=()=>{i=s()};let u;const o=cn();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(a);else{a();for(const l of i)l.dataSync();u=Promise.resolve({kernelMs:cn()-o})}if(dt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<i.length;l++){const h=i[l];h.data().then(c=>{s_(c,h.dtype,t)})}return{kernelName:t,outputs:i,inputs:n,timeMs:u.then(l=>l.kernelMs),extraInfo:u.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:s,timeMs:i,inputs:a,extraInfo:u}=t;s.forEach(o=>{Promise.all([o.data(),i,u]).then(r=>{this.logger.logKernelProfile(n,o,r[0],r[1],a,r[2])})})}}function s_(e,t,n){if(t!=="float32")return!1;for(let s=0;s<e.length;s++){const i=e[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class i_{logKernelProfile(t,n,s,i,a,u){const o=typeof i=="number"?Wr(`${i}ms`,9):i.error,r=Wr(t,25),l=n.rank,h=n.size,c=Wr(n.shape.toString(),14);let f="";for(const d in a){const p=a[d];if(p!=null){const m=p.shape||n.shape,g=m.length;f+=`${d}: ${g}D ${g>0?m:""} `}}console.log(`%c${r}	%c${o}	%c${l}D ${c}	%c${h}	%c${f}	%c${u}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_(e,t,n){const s={},i={};for(let r=0;r<t.length;r++)s[t[r].id]=!0;for(let r=0;r<e.length;r++){const l=e[r],h=l.inputs;for(const c in h){const f=h[c];let d=!1;for(let p=0;p<t.length;p++)if(s[f.id]){l.outputs.forEach(m=>s[m.id]=!0),d=!0,i[l.id]=!0;break}if(d)break}}const a={};a[n.id]=!0;const u={};for(let r=e.length-1;r>=0;r--){const l=e[r],h=l.inputs;for(let c=0;c<l.outputs.length;c++)if(a[l.outputs[c].id]){for(const f in h)a[h[f].id]=!0,u[l.id]=!0;break}}const o=[];for(let r=0;r<e.length;r++){const l=e[r];if(i[l.id]&&u[l.id]){const h={};for(const f in l.inputs){const d=l.inputs[f];s[d.id]&&(h[f]=d)}const c=Object.assign({},l);c.inputs=h,c.outputs=l.outputs,o.push(c)}}return o}function o_(e,t,n,s){for(let i=t.length-1;i>=0;i--){const a=t[i],u=[];if(a.outputs.forEach(r=>{const l=e[r.id];l!=null?u.push(l):u.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const o=a.gradient(u);for(const r in a.inputs){if(!(r in o))throw new Error(`Cannot backprop through input ${r}. Available gradients found: ${Object.keys(o)}.`);const l=n(()=>o[r]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${r} must have 'float32' dtype, but has '${l.dtype}'`);const h=a.inputs[r];if(!Qt(l.shape,h.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${r}' has shape '${l.shape}', which does not match the shape of the input '${h.shape}'`);if(e[h.id]==null)e[h.id]=l;else{const c=e[h.id];e[h.id]=s(c,l),c.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nx=20,Do=3,Rh=7;function a_(e,t,n,s){const i=Dt(t),a=l_(e,t,n,i),u=t.length,o=Jl(e,t,n,i,a),r=["Tensor"];return s&&(r.push(`  dtype: ${n}`),r.push(`  rank: ${u}`),r.push(`  shape: [${t}]`),r.push("  values:")),r.push(o.map(l=>"    "+l).join(`
`)),r.join(`
`)}function l_(e,t,n,s){const i=pt(t),a=s[s.length-1],u=new Array(a).fill(0),o=t.length,r=n==="complex64"?Po(e):e;if(o>1)for(let l=0;l<i/a;l++){const h=l*a;for(let c=0;c<a;c++)u[c]=Math.max(u[c],Fo(r[h+c],0,n).length)}return u}function Fo(e,t,n){let s;return Array.isArray(e)?s=`${parseFloat(e[0].toFixed(Rh))} + ${parseFloat(e[1].toFixed(Rh))}j`:aa(e)?s=`'${e}'`:n==="bool"?s=Jb(e):s=parseFloat(e.toFixed(Rh)).toString(),Wr(s,t)}function Jb(e){return e===0?"false":"true"}function Jl(e,t,n,s,i,a=!0){const u=n==="complex64"?2:1,o=t[0],r=t.length;if(r===0){if(n==="complex64"){const m=Po(e);return[Fo(m[0],0,n)]}return n==="bool"?[Jb(e[0])]:[e[0].toString()]}if(r===1){if(o>nx){const g=Do*u;let x=Array.from(e.slice(0,g)),b=Array.from(e.slice((o-Do)*u,o*u));return n==="complex64"&&(x=Po(x),b=Po(b)),["["+x.map((y,v)=>Fo(y,i[v],n)).join(", ")+", ..., "+b.map((y,v)=>Fo(y,i[o-Do+v],n)).join(", ")+"]"]}const m=n==="complex64"?Po(e):Array.from(e);return["["+m.map((g,x)=>Fo(g,i[x],n)).join(", ")+"]"]}const l=t.slice(1),h=s.slice(1),c=s[0]*u,f=[];if(o>nx){for(let m=0;m<Do;m++){const g=m*c,x=g+c;f.push(...Jl(e.slice(g,x),l,n,h,i,!1))}f.push("...");for(let m=o-Do;m<o;m++){const g=m*c,x=g+c;f.push(...Jl(e.slice(g,x),l,n,h,i,m===o-1))}}else for(let m=0;m<o;m++){const g=m*c,x=g+c;f.push(...Jl(e.slice(g,x),l,n,h,i,m===o-1))}const d=r===2?",":"";f[0]="["+f[0]+d;for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+d;let p=`,
`;for(let m=2;m<r;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(a?"":p),f}function Po(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Je{constructor(t,n,s){if(this.dtype=n,this.shape=t.slice(),this.size=pt(t),s!=null){const i=s.length;P(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||nn(n,this.size),this.strides=Dt(t)}set(t,...n){n.length===0&&(n=[0]),P(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const i of t){if(i<0||i>=this.shape[n]){const a=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(a)}n++}let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=this.strides[i]*t[i];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let s=0;s<t.length-1;++s)n+=this.strides[s]*t[s];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(t/this.strides[s]),t-=n[s]*this.strides[s];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return os().makeTensor(this.values,this.shape,this.dtype)}}let os=null,Rr=null;function c_(e){os=e}function u_(e){Rr=e}class ge{constructor(t,n,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=pt(t),this.strides=Dt(t),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Rr.buffer(this.shape,this.dtype,t)}bufferSync(){return Rr.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return ps(this.shape,t,this.dtype==="complex64")}arraySync(){return ps(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=os().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(s=>gi(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),os().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=os().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>gi(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await os().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(os().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Rr.print(this,t)}clone(){return this.throwIfDisposed(),Rr.clone(this)}toString(t=!1){const n=this.dataSync();return a_(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Rr.cast(this,t)}variable(t=!0,n,s){return this.throwIfDisposed(),os().makeVariable(this,t,n,s)}}Object.defineProperty(ge,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function ft(){return $d("Tensor",()=>ge)}ft();class fc extends ge{constructor(t,n,s,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=n,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Qt(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);os().disposeTensor(this),this.dataId=t.dataId,os().incRef(this,null)}dispose(){os().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(fc,Symbol.hasInstance,{value:e=>e instanceof ge&&e.assign!=null&&e.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sx;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(sx||(sx={}));var $f;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})($f||($f={}));var Ef;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(Ef||(Ef={}));var Nf;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(Nf||(Nf={}));var Df;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(Df||(Df={}));const h_={float32:Nf,int32:$f,bool:Ef,complex64:Df};function Cn(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return h_[e][t]}function yp(e){return Cn(e,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ce(e,t){if(e.dtype===t.dtype)return[e,t];const n=Cn(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Zb(e){const t=[];return Qb(e,t,new Set),t}function Qb(e,t,n){if(e==null)return;if(e instanceof ge){t.push(e);return}if(!f_(e))return;const s=e;for(const i in s){const a=s[i];n.has(a)||(n.add(a),Qb(a,t,n))}}function f_(e){return Array.isArray(e)||typeof e=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(e){return e.kernelName!=null}class ix{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Zr{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ix}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const s=t[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,s=1){return t in this.registryFactory?(Nn(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(t);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new n_(this.backendInstance),!0}setupRegisteredKernels(){qm(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){qm(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof Id)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,a=s.then(u=>i<this.pendingBackendInitId?!1:(this.registry[t]=u,this.pendingBackendInit=null,!0)).catch(u=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Nn(`Initialization of backend ${t} failed`),Nn(u.stack||u.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return Nn(`Initialization of backend ${t} failed`),Nn(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const s=t[n],{success:i,asyncInit:a}=this.initializeBackend(s);if(a||i)return{name:s,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const s=this.state.tensorInfo.get(n),i=s.backend,a=this.readSync(n),u=i.refCount(n);i.disposeData(n,!0),s.backend=t,t.move(n,a,s.shape,s.dtype,u),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let s=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(t,n,s){t();try{const i=s();return n(),i}catch(i){throw n(),i}}nextTensorId(){return Zr.nextTensorId++}nextVariableId(){return Zr.nextVariableId++}clone(t){const n=tt.runKernel(Na,{x:t}),s={x:t},i=u=>({x:()=>{const o="float32",r={x:u},l={dtype:o};return tt.runKernel(xa,r,l)}}),a=[];return this.addTapeNode(this.state.activeScope.name,s,[n],i,a,{}),n}runKernel(t,n,s){if(this.backendName==null&&this.backend,!(kf(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,s){const i=this.backend.numDataIds();let a=0;s.forEach(r=>{a+=r.dtype==="complex64"?3:1});const u=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=i-n-a-u;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t){let n,s=[];const i=this.isTapeOn(),a=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let o;this.backendName==null&&this.backend;let r;const l=Oh(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Oh(t)){const{kernelName:p,inputs:m,attrs:g}=t;this.backendName==null&&this.backend;const x=kf(p,this.backendName);P(x!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),o=()=>{const b=this.backend.numDataIds();r=x.kernelFunc({inputs:m,attrs:g,backend:this.backend});const y=Array.isArray(r)?r:[r];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,y);const v=y.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(i){const w=this.getTensorsForGradient(p,m,v);s=this.saveTensorsForBackwardMode(w)}return v}}else{const{forwardFunc:p}=t,m=g=>{!i||(s=g.map(x=>this.keep(this.clone(x))))};o=()=>{const g=this.backend.numDataIds();r=this.tidy(()=>p(this.backend,m));const x=Array.isArray(r)?r:[r];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,g,x),x}}const{inputs:h,attrs:c}=t,f=Oh(t)?null:t.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=o():(d=this.profiler.profileKernel(l,h,()=>o()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(l,h,n,f,s,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(p=>h[p]!=null?h[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(r)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,n,s){const i=Ym(t);if(i!=null){const a=i.inputsToSave||[],u=i.outputsToSave||[];let o;i.saveAllInputs?(P(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),o=Object.keys(n).map(l=>n[l])):o=a.map(l=>n[l]);const r=s.filter((l,h)=>u[h]);return o.concat(r)}return[]}makeTensor(t,n,s,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let a=t;s==="string"&&aa(t[0])&&(a=t.map(r=>ui(r)));const u=i.write(a,n,s),o=new ge(n,s,u,this.nextTensorId());if(this.trackTensor(o,i),s==="string"){const r=this.state.tensorInfo.get(u),l=FT(a);this.state.numBytes+=l-r.bytes,r.bytes=l}return o}makeTensorFromDataId(t,n,s,i){s=s||"float32";const a={dataId:t,shape:n,dtype:s};return this.makeTensorFromTensorInfo(a,i)}makeTensorFromTensorInfo(t,n){const{dataId:s,shape:i,dtype:a}=t,u=new ge(i,a,s,this.nextTensorId());return this.trackTensor(u,n),u}makeVariable(t,n=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.cast(i));const a=new fc(t,n,s,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*mf(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof fc||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*mf(t.dtype);this.state.numBytes-=s}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,s,i,a,u){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:s,saved:a},r=Ym(t);r!=null&&(i=r.gradFunc),i!=null&&(o.gradient=l=>(l=l.map((h,c)=>{if(h==null){const f=s[c],d=Ze(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return h}),i(l.length>1?l:l[0],a,u))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=Zb(t),s=new Set(n.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const u=this.state.activeScope.track[a];!u.kept&&!s.has(u.id)&&u.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(a=>{!a.kept&&a.scopeId===i.id&&this.track(a)})}gradients(t,n,s,i=!1){if(P(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));P(a instanceof ge,()=>"The result y returned by f() must be a tensor.");const u=r_(this.state.activeTape,n,a);if(!i&&u.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const o={};o[a.id]=s==null?d_(a.shape):s,o_(o,u,l=>this.tidy(l),p_);const r=n.map(l=>o[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const h of l.saved)h.dispose()}),this.state.activeTape=null),{value:a,grads:r}})}customGrad(t){return P(bf(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{P(n.every(o=>o instanceof ge),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};n.forEach((o,r)=>{i[r]=o});const a=(o,r)=>(s=t(...n,r),P(s.value instanceof ge,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),P(bf(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),u=(o,r)=>{const l=s.gradFunc(o,r),h=Array.isArray(l)?l:[l];P(h.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),P(h.every(f=>f instanceof ge),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const c={};return h.forEach((f,d)=>{c[d]=()=>f}),c};return this.runKernelFunc({forwardFunc:a,backwardsFunc:u,inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=cn(),s=await this.backend.time(t);return s.wallMs=cn()-n,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ix;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Zr.nextTensorId=0;Zr.nextVariableId=0;function d_(e){const t=_d(pt(e),"float32");return tt.makeTensor(t,e,"float32")}function tv(){const e=Nb();if(e._tfengine==null){const t=new MT(e);e._tfengine=new Zr(t)}return WT(e._tfengine.ENV),c_(()=>e._tfengine),e._tfengine}const tt=tv();function p_(e,t){const n={a:e,b:t};return tt.runKernel(go,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(){return typeof navigator!="undefined"&&navigator!=null}function ev(e){if(e||g_()){if(e||(e=navigator),e.product==="ReactNative")return!0;const t=e.userAgent||e.vendor||(typeof window!="undefined"?window.opera:"");if(!t){const n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function nv(){return typeof window!="undefined"&&window.document!=null||typeof WorkerGlobalScope!="undefined"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xn=dt();Xn.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Xn.registerFlag("IS_BROWSER",()=>nv());Xn.registerFlag("IS_NODE",()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined");Xn.registerFlag("IS_CHROME",()=>typeof navigator!="undefined"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Xn.registerFlag("PROD",()=>!1);Xn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Xn.getBool("DEBUG"));Xn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Xn.registerFlag("IS_TEST",()=>!1);Xn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Xn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Xn.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rl(e,t){let n=e;if(Ms(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];const s=[];for(;Array.isArray(n)||Ms(n)&&t!=="string";)s.push(n.length),n=n[0];return Array.isArray(e)&&dt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&sv(e,s,[]),s}function sv(e,t,n){if(n=n||[],!Array.isArray(e)&&!Ms(e)){P(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}P(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),P(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const s=t.slice(1);for(let i=0;i<e.length;++i)sv(e[i],s,n.concat(i))}function rx(e,t,n,s){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${e} tensor, but got ${t} tensor`)}}function M(e,t,n,s="numeric"){if(e instanceof ge)return rx(s,e.dtype,t,n),e;let i=la(e);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),rx(s,i,t,n),e==null||!Ms(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){const r=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const a=rl(e,i);!Ms(e)&&!Array.isArray(e)&&(e=[e]);const o=i!=="string"?xr(e,i):qr(e,[],!0);return tt.makeTensor(o,a,i)}function iv(e,t,n,s="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((a,u)=>M(a,`${t}[${u}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_="__op";function et(e){const t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const s=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+m_;const i=(...a)=>{tt.startScope(n);try{const u=s(...a);return $b(u)&&console.error("Cannot return a Promise inside of tidy."),tt.endScope(u),u}catch(u){throw tt.endScope(null),u}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_(e,t){const n=M(e,"real","complex"),s=M(t,"imag","complex");Jn(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:n,imag:s};return tt.runKernel(Fd,i)}const Qr=et({complex_:x_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ol(e,t,n,s){if(s==null&&(s=la(e)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ms(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){_b(t);const i=pt(t),a=pt(n);P(i===a,()=>`Based on the provided shape, [${t}], the tensor should have ${i} values but has ${a}`);for(let u=0;u<n.length;++u){const o=n[u],r=u===n.length-1?o!==pt(t.slice(u)):!0;P(n[u]===t[u]||!r,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Ms(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=s!=="string"?xr(e,s):qr(e,[],!0),tt.makeTensor(e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_(e,t,n){const s=rl(e,n);return ol(e,t,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ox=4;async function ax(e,t){const n=[],s=[],i=Array.isArray(e)?e.map(u=>u.name):Object.keys(e);for(let u=0;u<i.length;++u){const o=i[u],r=Array.isArray(e)?e[u].tensor:e[o];if(r.dtype!=="float32"&&r.dtype!=="int32"&&r.dtype!=="bool"&&r.dtype!=="string"&&r.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${o}': ${r.dtype}`);const l={name:o,shape:r.shape,dtype:r.dtype};if(r.dtype==="string"){const h=new Promise(async c=>{const f=await r.bytes(),d=f.reduce((g,x)=>g+x.length,0)+ox*f.length,p=new Uint8Array(d);let m=0;for(let g=0;g<f.length;g++){const x=f[g],b=new Uint8Array(new Uint32Array([x.length]).buffer);p.set(b,m),m+=ox,p.set(x,m),m+=x.length}c(p)});s.push(h)}else s.push(r.data());t!=null&&(l.group=t),n.push(l)}const a=await Promise.all(s);return{data:v_(a),specs:n}}function v_(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(a=>{if(t+=a.byteLength,n.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const s=new Uint8Array(t);let i=0;return n.forEach(a=>{s.set(new Uint8Array(a.buffer),i),i+=a.byteLength}),s.buffer}const wp=typeof Buffer!="undefined"&&(typeof Blob=="undefined"||typeof atob=="undefined"||typeof btoa=="undefined");function lx(e){return wp?Buffer.byteLength(e):new Blob([e]).size}function y_(e){if(wp)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let s=0,i=t.length;s<i;s++)n+=String.fromCharCode(t[s]);return btoa(n)}function w_(e){if(wp){const s=Buffer.from(e,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let s=0;s<t.length;++s)n.set([t.charCodeAt(s)],s);return n.buffer}function rv(e){if(e.length===1)return e[0];let t=0;e.forEach(i=>{t+=i.byteLength});const n=new Uint8Array(t);let s=0;return e.forEach(i=>{n.set(new Uint8Array(i),s),s+=i.byteLength}),n.buffer}function ov(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}async function C_(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),e.weightsManifest!=null){const[s,i]=await t(e.weightsManifest);n.weightSpecs=s,n.weightData=i}return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),n}function ju(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:lx(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:lx(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Me{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Me.instance==null&&(Me.instance=new Me),Me.instance}static registerSaveRouter(t){Me.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Me.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Me.getHandlers(t,"save")}static getLoadHandlers(t,n){return Me.getHandlers(t,"load",n)}static getHandlers(t,n,s){const i=[];return(n==="load"?Me.getInstance().loadRouters:Me.getInstance().saveRouters).forEach(u=>{const o=u(t,s);o!==null&&i.push(o)}),i}}const S_=e=>Me.getSaveHandlers(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Af="tensorflowjs",Rf=1,Yi="models_store",ri="model_info_store";function av(){if(!dt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window=="undefined"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Of(e){const t=e.result;t.createObjectStore(Yi,{keyPath:"modelPath"}),t.createObjectStore(ri,{keyPath:"modelPath"})}class ir{constructor(t){if(this.indexedDB=av(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((s,i)=>{const a=this.indexedDB.open(Af,Rf);a.onupgradeneeded=()=>Of(a),a.onsuccess=()=>{const u=a.result;if(n==null){const o=u.transaction(Yi,"readonly"),l=o.objectStore(Yi).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return u.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=h=>(u.close(),i(l.error)),o.oncomplete=()=>u.close()}else{const o=ju(n),r=u.transaction(ri,"readwrite");let l=r.objectStore(ri);const h=l.put({modelPath:this.modelPath,modelArtifactsInfo:o});let c;h.onsuccess=()=>{c=u.transaction(Yi,"readwrite");const d=c.objectStore(Yi).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:o});d.onsuccess=()=>s({modelArtifactsInfo:o}),d.onerror=p=>{l=r.objectStore(ri);const m=l.delete(this.modelPath);m.onsuccess=()=>(u.close(),i(d.error)),m.onerror=g=>(u.close(),i(d.error))}},h.onerror=f=>(u.close(),i(h.error)),r.oncomplete=()=>{c==null?u.close():c.oncomplete=()=>u.close()}}},a.onerror=u=>i(a.error)})}}ir.URL_SCHEME="indexeddb://";const lv=e=>dt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ir.URL_SCHEME)?k_(e.slice(ir.URL_SCHEME.length)):null;Me.registerSaveRouter(lv);Me.registerLoadRouter(lv);function k_(e){return new ir(e)}function I_(e){return e.startsWith(ir.URL_SCHEME)?e.slice(ir.URL_SCHEME.length):e}class T_{constructor(){this.indexedDB=av()}async listModels(){return new Promise((t,n)=>{const s=this.indexedDB.open(Af,Rf);s.onupgradeneeded=()=>Of(s),s.onsuccess=()=>{const i=s.result,a=i.transaction(ri,"readonly"),o=a.objectStore(ri).getAll();o.onsuccess=()=>{const r={};for(const l of o.result)r[l.modelPath]=l.modelArtifactsInfo;t(r)},o.onerror=r=>(i.close(),n(o.error)),a.oncomplete=()=>i.close()},s.onerror=i=>n(s.error)})}async removeModel(t){return t=I_(t),new Promise((n,s)=>{const i=this.indexedDB.open(Af,Rf);i.onupgradeneeded=()=>Of(i),i.onsuccess=()=>{const a=i.result,u=a.transaction(ri,"readwrite"),o=u.objectStore(ri),r=o.get(t);let l;r.onsuccess=()=>{if(r.result==null)return a.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const h=o.delete(t),c=()=>{l=a.transaction(Yi,"readwrite");const d=l.objectStore(Yi).delete(t);d.onsuccess=()=>n(r.result.modelArtifactsInfo),d.onerror=p=>s(r.error)};h.onsuccess=c,h.onerror=f=>(c(),a.close(),s(r.error))}},r.onerror=h=>(a.close(),s(r.error)),u.oncomplete=()=>{l==null?a.close():l.oncomplete=()=>a.close()}},i.onerror=a=>s(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Us="/",Or="tensorflowjs_models",cv="info",__="model_topology",$_="weight_specs",E_="weight_data",N_="model_metadata";function uv(e){return{info:[Or,e,cv].join(Us),topology:[Or,e,__].join(Us),weightSpecs:[Or,e,$_].join(Us),weightData:[Or,e,E_].join(Us),modelMetadata:[Or,e,N_].join(Us)}}function hv(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function D_(e){const t=e.split(Us);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Us)}function A_(e){return e.startsWith(rr.URL_SCHEME)?e.slice(rr.URL_SCHEME.length):e}class rr{constructor(t){if(!dt().getBool("IS_BROWSER")||typeof window=="undefined"||typeof window.localStorage=="undefined")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=uv(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),i=ju(t);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,y_(t.weightData));const a={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:i}}catch{throw hv(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const o=JSON.parse(a);n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,o.signature!=null&&(n.signature=o.signature),o.userDefinedMetadata!=null&&(n.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(n.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(n.trainingConfig=o.trainingConfig)}const u=this.LS.getItem(this.keys.weightData);if(u==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=w_(u),n}}rr.URL_SCHEME="localstorage://";const fv=e=>dt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(rr.URL_SCHEME)?R_(e.slice(rr.URL_SCHEME.length)):null;Me.registerSaveRouter(fv);Me.registerLoadRouter(fv);function R_(e){return new rr(e)}class O_{constructor(){P(dt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),P(typeof window=="undefined"||typeof window.localStorage!="undefined",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=Or+Us,s=Us+cv;for(let i=0;i<this.LS.length;++i){const a=this.LS.key(i);if(a.startsWith(n)&&a.endsWith(s)){const u=D_(a);t[u]=JSON.parse(this.LS.getItem(a))}}return t}async removeModel(t){t=A_(t);const n=uv(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(n.info));return hv(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx="://";class ii{constructor(){this.managers={}}static getInstance(){return ii.instance==null&&(ii.instance=new ii),ii.instance}static registerManager(t,n){P(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(cx)&&(t=t.slice(0,t.indexOf(cx))),P(t.length>0,()=>"scheme must not be an empty string.");const s=ii.getInstance();P(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=n}static getManager(t){const n=this.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(this.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F_{fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}}if(dt().get("IS_BROWSER")){dt().setPlatform("browser",new F_);try{ii.registerManager(rr.URL_SCHEME,new O_)}catch{}try{ii.registerManager(ir.URL_SCHEME,new T_)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_={importFetch:()=>require("node-fetch")};let Fh;class M_{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return dt().global.fetch!=null?dt().global.fetch(t,n):(Fh==null&&(Fh=P_.importFetch()),Fh(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}}dt().get("IS_NODE")&&!dt().get("IS_BROWSER")&&dt().setPlatform("node",new M_);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(e,t="float32",n){return t=t||"float32",_b(e),new Je(e,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_(e,t){const n=M(e,"x","cast");if(!OT(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},i={dtype:t};return tt.runKernel(xa,s,i)}const St=et({cast_:L_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_(e){const n={x:M(e,"x","clone","string_or_numeric")};return tt.runKernel(Na,n)}const Zi=et({clone_:B_});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_(e,t=!1){console.log(e.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tv();const W_={buffer:Vt,cast:St,clone:Zi,print:z_};u_(W_);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V_="model",U_=".json",G_=".weights.bin";function ux(e){return new Promise(t=>setTimeout(t)).then(e)}class or{constructor(t){if(!dt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(or.URL_SCHEME)&&(t=t.slice(or.URL_SCHEME.length)),(t==null||t.length===0)&&(t=V_),this.modelJsonFileName=t+U_,this.weightDataFileName=t+G_}async save(t){if(typeof document=="undefined")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const s=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=ov(t,s),a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),u=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(u.download=this.modelJsonFileName,u.href=a,await ux(()=>u.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const o=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;o.download=this.weightDataFileName,o.href=n,await ux(()=>o.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ju(t)}}}}or.URL_SCHEME="downloads://";const H_=e=>dt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(or.URL_SCHEME)?j_(e.slice(or.URL_SCHEME.length)):null;Me.registerSaveRouter(H_);function j_(e="model"){return new or(e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(e,t,n,s){u(e),n=n==null?0:n,s=s==null?1:s,o(n,s);let i=0;const a=r=>(r.then(l=>{const h=n+ ++i/e.length*(s-n);return t(h),l}),r);function u(r){P(r!=null&&Array.isArray(r)&&r.length>0,()=>"promises must be a none empty array")}function o(r,l){P(r>=0&&r<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${r}`),P(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),P(l>=r,()=>`startFraction must be no more than endFraction, but got startFraction ${r} and endFraction ${l}`)}return Promise.all(e.map(a))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function X_(e,t){t==null&&(t={});const n=t.fetchFunc==null?dt().platform.fetch:t.fetchFunc,s=e.map(c=>n(c,t.requestInit,{isBinary:!0})),i=0,a=.5,o=(t.onProgress==null?await Promise.all(s):await hx(s,t.onProgress,i,a)).map(c=>c.arrayBuffer()),r=.5,l=1;return t.onProgress==null?await Promise.all(o):await hx(o,t.onProgress,r,l)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y_="application/octet-stream",q_="application/json";class Cp{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(P(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=dt().platform.fetch,P(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&P(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i=ov(t,s);n.body.append("model.json",new Blob([JSON.stringify(i)],{type:q_}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:Y_}),"model.weights.bin");const a=await this.fetch(this.path,n);if(a.ok)return{modelArtifactsInfo:ju(t),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let u=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?u+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":u+=" Please make sure the server is serving valid JSON for this request.",new Error(u)}const s=n.modelTopology,i=n.weightsManifest;if(s==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return C_(n,a=>this.loadWeights(a))}async loadWeights(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,i]=K_(n),a=this.weightPathPrefix||s,u=[];for(const h of t)u.push(...h.weights);const o=[],r=[];for(const h of t)for(const c of h.paths)this.weightUrlConverter!=null?r.push(this.weightUrlConverter(c)):o.push(a+c+i);this.weightUrlConverter&&o.push(...await Promise.all(r));const l=await X_(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[u,rv(l)]}}Cp.URL_SCHEME_REGEX=/^https?:\/\//;function K_(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),s=e.substring(0,t),i=n>t?e.substring(n):"";return[s+"/",i]}function fx(e){return e.match(Cp.URL_SCHEME_REGEX)!=null}const dv=(e,t)=>{if(typeof fetch=="undefined"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(s=>fx(s)):n=fx(e),n)return J_(e,t)}return null};Me.registerSaveRouter(dv);Me.registerLoadRouter(dv);function J_(e,t){return new Cp(e,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_(e,t,n=!1,s=!1){let i=M(e,"a","matMul"),a=M(t,"b","matMul");[i,a]=Ce(i,a);const u={a:i,b:a},o={transposeA:n,transposeB:s};return tt.runKernel(Kc,u,o)}const jt=et({matMul_:Z_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_(e,t,n=1,s=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const a={indices:M(e,"indices","oneHot","int32")},u={depth:t,onValue:n,offValue:s};return tt.runKernel(_u,a,u)}const pv=et({oneHot_:Q_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(){return tt}function Ff(){return tt.memory()}function lt(e,t){return tt.tidy(e,t)}function Lt(e){Zb(e).forEach(n=>n.dispose())}function ms(e){return tt.keep(e)}function gv(e,t,n=1){return tt.registerBackend(e,t,n)}function t2(){return tt.backend}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e2(e){const n={input:M(e,"input","imag")};return tt.runKernel(qd,n)}const Sp=et({imag_:e2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2(e){const n={x:M(e,"x","neg")};return tt.runKernel(ku,n)}const xe=et({neg_:n2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2(e){const n={input:M(e,"input","real")};return tt.runKernel(sp,n)}const dc=et({real_:s2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2(e,t,n){const s=M(e,"x","transpose");if(t==null&&(t=s.shape.map((u,o)=>o).reverse()),P(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(u=>{P(u>=0&&u<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const i={x:s},a={perm:t};return s.dtype==="complex64"?lt(()=>{let u=dc(s),o=Sp(s);return u=tt.runKernel(Vr,{x:u},a),o=tt.runKernel(Vr,{x:o},a),n&&(o=xe(o)),Qr(u,o)}):tt.runKernel(Vr,i,a)}const Xt=et({transpose_:i2});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(e,t){const n=e.length,s=[];for(let i=0;i<n;i++){const a=n-1-i,u=e[a]||1;(t[t.length-1-i]||1)>1&&u===1&&s.unshift(a)}return s}function Oe(e,t){const n=[];for(let s=0;s<t.length;s++){const i=e[e.length-s-1],a=t.length-s-1,u=t[a];(i==null||i===1&&u>1)&&n.unshift(a)}return n}function Bt(e,t){const n=[],s=Math.max(e.length,t.length);for(let i=0;i<s;i++){let a=e[e.length-i-1];a==null&&(a=1);let u=t[t.length-i-1];if(u==null&&(u=1),a===1)n.unshift(u);else if(u===1)n.unshift(a);else if(a!==u){const o=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(o)}else n.unshift(a)}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2(e,t,n){if(Td(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=rl(e,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ol(e,t,s,n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ri;function o2(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,i=!1,a=!1,u=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData!="undefined"&&e instanceof ImageData)s=!0;else if(typeof HTMLVideoElement!="undefined"&&e instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement)a=!0;else if(e.getContext!=null)u=!0;else if(typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap)o=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(kf(Cf,tt.backendName)!=null){const p={pixels:e},m={numChannels:t};return tt.runKernel(Cf,p,m)}const[l,h]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let c;if(u)c=e.getContext("2d").getImageData(0,0,l,h).data;else if(s||n)c=e.data;else if(a||i||o){if(Ri==null)if(typeof document=="undefined")if(typeof OffscreenCanvas!="undefined"&&typeof OffscreenCanvasRenderingContext2D!="undefined")Ri=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Ri=document.createElement("canvas").getContext("2d");Ri.canvas.width=l,Ri.canvas.height=h,Ri.drawImage(e,0,0,l,h),c=Ri.getImageData(0,0,l,h).data}let f;if(t===4)f=new Int32Array(c);else{const p=l*h;f=new Int32Array(p*t);for(let m=0;m<p;m++)for(let g=0;g<t;++g)f[m*t+g]=c[m*4+g]}return r2(f,[h,l,t],"int32")}async function dx(e,t){let n=M(e,"img","toPixels");if(!(e instanceof ge)){const l=n;n=St(l,"int32"),l.dispose()}if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[s,i]=n.shape.slice(0,2),a=n.rank===2?1:n.shape[2];if(a>4||a===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${a}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const u=await n.data(),o=n.dtype==="float32"?255:1,r=new Uint8ClampedArray(i*s*4);for(let l=0;l<s*i;++l){const h=[0,0,0,255];for(let f=0;f<a;f++){const d=u[l*a+f];if(n.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(n.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);a===1?(h[0]=d*o,h[1]=d*o,h[2]=d*o):h[f]=d*o}const c=l*4;r[c+0]=Math.round(h[0]),r[c+1]=Math.round(h[1]),r[c+2]=Math.round(h[2]),r[c+3]=Math.round(h[3])}if(t!=null){t.width=i,t.height=s;const l=t.getContext("2d"),h=new ImageData(r,i,s);l.putImageData(h,0,0)}return n!==e&&n.dispose(),r}const Ph=et({fromPixels_:o2});function kp(e,t){const n=e.shape.length,s=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${n}`);if(pt(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,a=i[i.length-1];let u=1;for(let c=0;c<i.length-1;++c)u*=i[c];const o=e.shape,r=i.slice();r.pop();let l=1;for(let c=a;c<n;++c)l*=o[c],r.push(o[c]);const h=[...Dt(e.shape).map(c=>c/l),1].slice(0,a);return[r,u,l,h]}function mv(e,t,n){const s=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${s}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(a+` update.rank < ${i}. `);if(e.length<s+(n.rank-i))throw new Error(a+` Output shape length < ${s+(n.rank-i)}`);if(n.rank!==i+e.length-s)throw new Error(a+` update.rank != ${i+e.length-s}`);for(let u=0;u<i;++u)if(n.shape[u]!==t.shape[u])throw new Error(a+` updates.shape[${u}] (${n.shape[u]}) != indices.shape[${u}] (${t.shape[u]}).`);for(let u=0;u<n.rank-i;++u)if(n.shape[u+i]!==e[u+s])throw new Error(a+` updates.shape[${u+i}] (${n.shape[u+i]}) != shape[${u+i}] (${e[u+i]})`)}function a2(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}mv(n,t,e)}function al(e,t,n){const s=t.shape.length,i=s>1?t.shape[s-1]:1,a=n.length;let u=1;for(let c=i;c<a;++c)u*=n[c];const o=i<1?1:i,r=pt(t.shape)/o,l=[...Dt(n.slice(0,i)),1],h=pt(n);return{sliceRank:i,numUpdates:r,sliceSize:u,strides:l,outputSize:h}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pf=-2,l2=-1;function Ip(e,t,n){const s=e.shape.length;P(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),P(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)P(t[i]+n[i]<=e.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function c2(e){const t=[];let n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function Tp(e,t,n){const s=[];for(let i=0;i<e.length;i++)s[i]=Math.ceil((t[i]-e[i])/n[i]);return s}function xv(e,t,n,s){const i=[...e];for(let a=i.length;a<s.length;a++)i.push(1);for(let a=0;a<n;a++)a===0?i[t]=1:(i.splice(t,0,1),i.pop());return i}function bv(e,t,n){return n<=e?n:n-(t-1)}function vv(e,t){const n=[];for(let s=0;s<e;s++)n.push(t+s);return n}function u2(e,t,n,s,i,a,u,o,r){const l=e.length;let h=new Array(l),c=new Array(l),f=new Array(l);if(t.length&&n>0){const d=t[0],p=n+1;h=yv(u,d,p,s,e),c=wv(o,d,p,i,e),f=xv(a,d,p,e)}else for(let d=0;d<l;d++)h[d]=Sv(u,s,a,e,d,r),c[d]=kv(o,i,a,e,d,r),f[d]=Cv(a,d,r);return{begin:h,end:c,strides:f}}function yv(e,t,n,s,i){const a=[...i],u=vv(n,t);for(let o=0;o<a.length;o++)if(u.indexOf(o)>-1)a[o]=0;else{const r=bv(t,n,o);let l=s[r];e&1<<r&&(l=0),a[o]=l}return a}function wv(e,t,n,s,i){const a=[...i],u=vv(n,t);for(let o=0;o<a.length;o++)if(u.indexOf(o)>-1)a[o]=Number.MAX_SAFE_INTEGER;else{const r=bv(t,n,o);let l=s[r];e&1<<r&&(l=Number.MAX_SAFE_INTEGER),a[o]=l}for(let o=0;o<a.length;o++){const r=i[o];a[o]<0&&(a[o]+=r),a[o]=sr(0,a[o],i[o])}return a}function Cv(e,t,n){let s=e[t];return(n&1<<t||s==null)&&(s=1),s}function Sv(e,t,n,s,i,a){let u=t[i];const o=n[i]||1;(e&1<<i||a&1<<i||u==null)&&(o>0?u=Number.MIN_SAFE_INTEGER:u=Number.MAX_SAFE_INTEGER);const r=s[i];return u<0&&(u+=r),u=sr(0,u,r-1),u}function kv(e,t,n,s,i,a){let u=t[i];const o=n[i]||1;(e&1<<i||a&1<<i||u==null)&&(o>0?u=Number.MAX_SAFE_INTEGER:u=Number.MIN_SAFE_INTEGER);const r=s[i];return u<0&&(u+=r),o>0?u=sr(0,u,r):u=sr(-1,u,r-1),u}function _p(e,t,n){let s=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){s=i;break}for(let i=s+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function $p(e,t){let n=e.length>0?e[e.length-1]:1;for(let s=0;s<e.length-1;s++)n+=e[s]*t[s];return n}function Xu(e,t,n){let s;const i=e.shape.length;typeof t=="number"?s=[t,...new Array(i-1).fill(0)]:t.length<i?s=t.concat(new Array(i-t.length).fill(0)):s=t.slice(),s.forEach(u=>{P(u!==-1,()=>"slice() does not support negative begin indexing.")});let a;return n==null?a=new Array(i).fill(-1):typeof n=="number"?a=[n,...new Array(i-1).fill(-1)]:n.length<i?a=n.concat(new Array(i-n.length).fill(-1)):a=n,a=a.map((u,o)=>u>=0?u:(P(u===-1,()=>`Negative size values should be exactly -1 but got ${u} for the slice() size at index ${o}.`),e.shape[o]-s[o])),[s,a]}function Ep(e,t,n,s,i,a,u,o,r){let l;if(s==null?(l=new Array(t.length),l.fill(1)):l=s,u!=null&&(u&u-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const c={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:a,ellipsisMask:u,newAxisMask:o,shrinkAxisMask:r};for(let y=0;y<c.dims;y++)h&&(1<<y&o)!==0&&c.numAddAxisAfterEllipsis++,1<<y&u&&(h=!0);h||(c.ellipsisMask|=1<<c.dims,c.dims++);const f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};h2(c,f);let d=!0,p=!0,m=!0;const g=[],x=[];for(let y=0;y<e.length;++y){if(f.strides[y]===0)throw Error(`strides[${y}] must be non-zero`);const v=!!(f.shrinkAxisMask&1<<y),w=e[y];if(w===-1){g.push(v?1:-1);continue}const C=[f.beginMask&1<<y,f.endMask&1<<y],S=[f.strides[y]>0?0:-1,f.strides[y]>0?w:w-1];if(v&&f.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[y]===1;const k=!!(f.beginMask&1<<y&&f.endMask&1<<y);if(f.beginValid&&f.endValid){if(v){const L=f.begin[y]<0?w+f.begin[y]:f.begin[y];if(f.begin[y]=L,f.end[y]=f.begin[y]+1,L<0||L>=w)throw Error(`slice index ${f.begin[y]} of dimension ${y} out of bounds.`)}else f.begin[y]=px(f.begin[y],0,f.strides[y],w,C,S),f.end[y]=px(f.end[y],1,f.strides[y],w,C,S);const R=f.strides[y]===1&&f.begin[y]===0&&f.end[y]===w;d=d&&R,p=p&&(y===0&&f.strides[y]===1||R)}else d=d&&f.strides[y]===1&&k,p=p&&(y===0&&f.strides[y]===1||k);let T,N=!1;if(f.beginValid&&f.endValid?(T=f.end[y]-f.begin[y],N=!0):v?(T=1,N=!0):k&&w>=0&&(f.strides[y]<0?T=-w:T=w,N=!0),N){let R;T===0||T<0!=f.strides[y]<0?R=0:R=Math.trunc(T/f.strides[y])+(T%f.strides[y]!==0?1:0),g.push(R)}else g.push(-1)}for(let y=0;y<f.finalShapeGatherIndices.length;++y){const v=f.finalShapeGatherIndices[y];v>=0?x.push(g[v]):v===Pf&&x.push(1)}return{finalShapeSparse:x.filter((y,v)=>f.finalShapeGatherIndices[v]!==Pf),finalShape:x,isIdentity:d,sliceDim0:p,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function h2(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<e.dims;s++)if(1<<s&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-s)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&e.newAxisMask)t.finalShapeGatherIndices.push(Pf),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[s]),e.end!=null&&(t.end[n]=e.end[s]),t.strides[n]=e.strides[s],e.beginMask&1<<s&&(t.beginMask|=1<<n),e.endMask&1<<s&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(l2),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[n]=s,n++}}function px(e,t,n,s,i,a){if(i[t])return n>0?a[t]:a[t+1&1];{const u=e<0?s+e:e;return u<a[0]?a[0]:u>a[1]?a[1]:u}}var f2=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Ip,maskToAxes:c2,computeOutShape:Tp,stridesWithElidedDims:xv,getNormalizedAxes:u2,startIndicesWithElidedDims:yv,stopIndicesWithElidedDims:wv,stridesForAxis:Cv,startForAxis:Sv,stopForAxis:kv,isSliceContinous:_p,computeFlatOffset:$p,parseSliceParams:Xu,sliceInfo:Ep},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mo{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class zn{constructor(){this.classNameMap={}}static getMap(){return zn.instance==null&&(zn.instance=new zn),zn.instance}static register(t){zn.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function bt(e){P(e.className!=null,()=>"Class being registered does not have the static className property defined."),P(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),P(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),zn.register(e)}/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2(e,t){let n=M(e,"a","add"),s=M(t,"b","add");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(go,i)}const yt=et({add_:d2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2(e,t){let n=M(e,"a","floorDiv"),s=M(t,"b","floorDiv");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel($a,i)}const Iv=et({floorDiv_:p2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2(e,t){let n=M(e,"a","div"),s=M(t,"b","div");if([n,s]=Ce(n,s),n.dtype==="int32"&&s.dtype==="int32")return Iv(n,s);const i={a:n,b:s},a={};return tt.runKernel(Ca,i,a)}const Nt=et({div_:g2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m2(e,t){let n=M(e,"a","mul"),s=M(t,"b","mul");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(Ba,i)}const Z=et({mul_:m2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(e){const t=M(e,"x","abs");if(t.dtype==="complex64"){const n={x:t};return tt.runKernel(Zc,n)}else{const n={x:t};return tt.runKernel(Hc,n)}}const Le=et({abs_:x2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b2(e){const n={x:M(e,"x","acos")};return tt.runKernel(ua,n)}const v2=et({acos_:b2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2(e){const n={x:M(e,"x","acosh")};return tt.runKernel(ha,n)}const w2=et({acosh_:y2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C2(e,t=null,n=!1){const i={x:M(e,"x","all","bool")},a={axis:t,keepDims:n};return tt.runKernel(Nd,i,a)}const Tv=et({all_:C2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(e,t=null,n=!1){const i={x:M(e,"x","any","bool")},a={axis:t,keepDims:n};return tt.runKernel(Dd,i,a)}const Mf=et({any_:S2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k2(e,t=0){const s={x:M(e,"x","argMax")},i={axis:t};return tt.runKernel(jc,s,i)}const Ko=et({argMax_:k2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2(e,t=0){const s={x:M(e,"x","argMin")},i={axis:t};return tt.runKernel(Xc,s,i)}const T2=et({argMin_:I2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _2(e){const n={x:M(e,"x","asin")};return tt.runKernel(fa,n)}const $2=et({asin_:_2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E2(e){const n={x:M(e,"x","asinh")};return tt.runKernel(da,n)}const N2=et({asinh_:E2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D2(e){const n={x:M(e,"x","atan")};return tt.runKernel(pa,n)}const A2=et({atan_:D2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2(e,t){let n=M(e,"a","atan2"),s=M(t,"b","atan2");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(ma,i)}const O2=et({atan2_:R2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F2(e){const n={x:M(e,"x","atanh")};return tt.runKernel(ga,n)}const P2=et({atanh_:F2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ll(e,t,n,s,i="NHWC",a){const u=e[3],o=[...t,u],r=Js(i);return Xe(e,o,n,a,s,null,null,r)}function Zn(e,t,n,s,i,a,u="channelsLast"){const[o,r]=pc(t);let l;if(u==="channelsLast")l=[o,r,e[3],e[3]];else if(u==="channelsFirst")l=[o,r,e[1],e[1]];else throw new Error(`Unknown dataFormat ${u}`);return Xe(e,l,n,s,i,a,!1,u)}function Ks(e,t,n,s,i,a,u="NDHWC"){const[o,r,l]=Lf(t);let h,c;if(u==="NDHWC")c="channelsLast",h=[o,r,l,e[4],e[4]];else if(u==="NCDHW")c="channelsFirst",h=[o,r,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${u}`);return Si(e,h,n,s,i,!1,c,a)}function Xe(e,t,n,s,i,a,u=!1,o="channelsLast"){let[r,l,h,c]=[-1,-1,-1,-1];if(o==="channelsLast")[r,l,h,c]=e;else if(o==="channelsFirst")[r,c,l,h]=e;else throw new Error(`Unknown dataFormat ${o}`);const[f,d,,p]=t,[m,g]=pc(n),[x,b]=pc(s),y=Ur(f,x),v=Ur(d,b),{padInfo:w,outHeight:C,outWidth:S}=B2(i,l,h,m,g,y,v,a,o),k=u?p*c:p;let T;return o==="channelsFirst"?T=[r,k,C,S]:o==="channelsLast"&&(T=[r,C,S,k]),{batchSize:r,dataFormat:o,inHeight:l,inWidth:h,inChannels:c,outHeight:C,outWidth:S,outChannels:k,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:f,filterWidth:d,effectiveFilterHeight:y,effectiveFilterWidth:v,dilationHeight:x,dilationWidth:b,inShape:e,outShape:T,filterShape:t}}function Si(e,t,n,s,i,a=!1,u="channelsLast",o){let[r,l,h,c,f]=[-1,-1,-1,-1,-1];if(u==="channelsLast")[r,l,h,c,f]=e;else if(u==="channelsFirst")[r,f,l,h,c]=e;else throw new Error(`Unknown dataFormat ${u}`);const[d,p,m,,g]=t,[x,b,y]=Lf(n),[v,w,C]=Lf(s),S=Ur(d,v),k=Ur(p,w),T=Ur(m,C),{padInfo:N,outDepth:R,outHeight:L,outWidth:z}=z2(i,l,h,c,x,b,y,S,k,T,o),U=a?g*f:g;let H;return u==="channelsFirst"?H=[r,U,R,L,z]:u==="channelsLast"&&(H=[r,R,L,z,U]),{batchSize:r,dataFormat:u,inDepth:l,inHeight:h,inWidth:c,inChannels:f,outDepth:R,outHeight:L,outWidth:z,outChannels:U,padInfo:N,strideDepth:x,strideHeight:b,strideWidth:y,filterDepth:d,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:k,effectiveFilterWidth:T,dilationDepth:v,dilationHeight:w,dilationWidth:C,inShape:e,outShape:H,filterShape:t}}function M2(e,t,n,s,i){s==null&&(s=Np(e,t,n));const a=e[0],u=e[1],o=Qi((a-t+2*s)/n+1,i),r=Qi((u-t+2*s)/n+1,i);return[o,r]}function L2(e,t,n,s,i,a){i==null&&(i=Np(e,t,s));const u=e[0],o=e[1],r=e[2],l=Qi((u-t+2*i)/s+1,a),h=Qi((o-t+2*i)/s+1,a),c=Qi((r-t+2*i)/s+1,a);return[l,h,c,n]}function Np(e,t,n,s=1){const i=Ur(t,s);return Math.floor((e[0]*(n-1)-n+i)/2)}function pc(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Lf(e){return typeof e=="number"?[e,e,e]:e}function Ur(e,t){return t<=1?e:e+(e-1)*(t-1)}function B2(e,t,n,s,i,a,u,o,r){let l,h,c;if(typeof e=="number"){l={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};const d=M2([t,n],a,s,e,o);h=d[0],c=d[1]}else if(e==="same"){h=Math.ceil(t/s),c=Math.ceil(n/i);const f=Math.max(0,(h-1)*s+a-t),d=Math.max(0,(c-1)*i+u-n),p=Math.floor(f/2),m=f-p,g=Math.floor(d/2),x=d-g;l={top:p,bottom:m,left:g,right:x,type:"SAME"}}else if(e==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-a+1)/s),c=Math.ceil((n-u+1)/i);else if(typeof e=="object"){const f=r==="channelsLast"?e[1][0]:e[2][0],d=r==="channelsLast"?e[1][1]:e[2][1],p=r==="channelsLast"?e[2][0]:e[3][0],m=r==="channelsLast"?e[2][1]:e[3][1];l={top:f,bottom:d,left:p,right:m,type:f===0&&d===0&&p===0&&m===0?"VALID":"EXPLICIT"},h=Qi((t-a+f+d)/s+1,o),c=Qi((n-u+p+m)/i+1,o)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:l,outHeight:h,outWidth:c}}function z2(e,t,n,s,i,a,u,o,r,l,h){let c,f,d,p;if(typeof e=="number"){c={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};const g=L2([t,n,s,1],o,1,i,e,h);f=g[0],d=g[1],p=g[2]}else if(e==="same"){f=Math.ceil(t/i),d=Math.ceil(n/a),p=Math.ceil(s/u);const m=(f-1)*i+o-t,g=(d-1)*a+r-n,x=(p-1)*u+l-s,b=Math.floor(m/2),y=m-b,v=Math.floor(g/2),w=g-v,C=Math.floor(x/2),S=x-C;c={top:v,bottom:w,left:C,right:S,front:b,back:y,type:"SAME"}}else if(e==="valid")c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-o+1)/i),d=Math.ceil((n-r+1)/a),p=Math.ceil((s-l+1)/u);else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:c,outDepth:f,outHeight:d,outWidth:p}}function Qi(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function ar(e){const[t,n,s]=pc(e);return t===1&&n===1&&s===1}function Qe(e,t){return ar(e)||ar(t)}function Js(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function pn(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")P(Kr(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(i=>{P(Kr(i),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2(e,t){const s={x:M(e,"x","reshape","string_or_numeric")},i={shape:t};return tt.runKernel(Au,s,i)}const it=et({reshape_:W2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2(e,t,n,s,i){const a=M(e,"x","avgPool","float32"),u=1;P(Qe(n,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${u}'`);let o=a,r=!1;a.rank===3&&(r=!0,o=it(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(o.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),pn("avgPool",s,i);const l={x:o},h={filterSize:t,strides:n,pad:s,dimRoundingMode:i};let c=tt.runKernel(Yc,l,h);return c=St(c,a.dtype),r?it(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Dp=et({avgPool_:V2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U2(e,t,n,s,i,a="NDHWC"){const u=M(e,"x","avgPool3d","float32");let o=u,r=!1;u.rank===4&&(r=!0,o=it(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),P(o.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),P(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),pn("avgPool3d",s,i);const l={x:o},h={filterSize:t,strides:n,pad:s,dimRoundingMode:i,dataFormat:a};let c=tt.runKernel(qc,l,h);return c=St(c,o.dtype),r?it(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}const G2=et({avgPool3d_:U2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2(e,t=0){P(e.length>=1,()=>"Pass at least one tensor to concat");const n=iv(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),n.length===1)return Zi(n[0]);const s=n,i={axis:t};return tt.runKernel(Qc,s,i)}const we=et({concat_:H2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2(e){const n={x:M(e,"x","sigmoid","float32")};return tt.runKernel(Ka,n)}const xo=et({sigmoid_:j2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2(e,t,n){const s=M(e,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},a={begin:t,size:n};return tt.runKernel(Mu,i,a)}const ne=et({slice_:X2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2(e){const n={x:M(e,"x","tanh","float32")};return tt.runKernel(nl,n)}const Ap=et({tanh_:Y2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2(e,t,n){const s=M(e,"x","batchToSpaceND"),i=t.reduce((o,r)=>o*r);P(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),P(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),P(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);const a={x:s},u={blockShape:t,crops:n};return tt.runKernel(Jc,a,u)}const Rp=et({batchToSpaceND_:q2});function K2(e){let t;return e.rank===0||e.rank===1?t=it(e,[1,1,1,e.size]):e.rank===2?t=it(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=it(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(e,t,n,s,i,a){a==null&&(a=.001);const u=M(e,"x","batchNorm"),o=M(t,"mean","batchNorm"),r=M(n,"variance","batchNorm");let l;i!=null&&(l=M(i,"scale","batchNorm"));let h;s!=null&&(h=M(s,"offset","batchNorm")),P(o.rank===r.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(h==null||o.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(l==null||o.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:K2(u),scale:l,offset:h,mean:o,variance:r},d={varianceEpsilon:a},p=tt.runKernel(lu,f,d);return it(p,u.shape)}const Yu=et({batchNorm_:J2});function Z2(e,t,n,s,i,a){const u=M(e,"x","batchNorm"),o=M(t,"mean","batchNorm"),r=M(n,"variance","batchNorm");let l;i!=null&&(l=M(i,"scale","batchNorm"));let h;return s!=null&&(h=M(s,"offset","batchNorm")),P(u.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${u.rank}.`),P(o.rank===2||o.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`),P(r.rank===2||r.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${r.rank}.`),l!=null&&P(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),h!=null&&P(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Yu(u,o,r,h,l,a)}const Q2=et({batchNorm2d_:Z2});function t$(e,t,n,s,i,a){const u=M(e,"x","batchNorm"),o=M(t,"mean","batchNorm"),r=M(n,"variance","batchNorm");let l;i!=null&&(l=M(i,"scale","batchNorm"));let h;return s!=null&&(h=M(s,"offset","batchNorm")),P(u.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${u.rank}.`),P(o.rank===3||o.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`),P(r.rank===3||r.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${r.rank}.`),l!=null&&P(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),h!=null&&P(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Yu(u,o,r,h,l,a)}const e$=et({batchNorm3d_:t$});function n$(e,t,n,s,i,a){const u=M(e,"x","batchNorm"),o=M(t,"mean","batchNorm"),r=M(n,"variance","batchNorm");let l;i!=null&&(l=M(i,"scale","batchNorm"));let h;return s!=null&&(h=M(s,"offset","batchNorm")),P(u.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${u.rank}.`),P(o.rank===4||o.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`),P(r.rank===4||r.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${r.rank}.`),l!=null&&P(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),h!=null&&P(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Yu(u,o,r,h,l,a)}const s$=et({batchNorm4d_:n$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i$(e,t,n){const s=M(e,"x","bincount"),i=M(t,"weights","bincount");P(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),P(n>=0,()=>`size must be non-negative, but got ${n}.`),P(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const a={x:s,weights:i},u={size:n};return tt.runKernel(Od,a,u)}const r$=et({bincount_:i$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o$(e,t){let n=M(e,"broadcastTo","x");const s=n.shape;if(t.some(l=>!(l>0)||l%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=it(n,l)}const i=n.shape,a=Array.from(t);for(let l=t.length-1;l>=0;l--)if(i[l]===t[l])a[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(a.map((l,h)=>l>1?h:-1).filter(l=>l>=0).length===0)return Zi(n);const o={x:n},r={reps:a};return tt.runKernel(sl,o,r)}const Zl=et({broadcastTo_:o$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$(e){const n={x:M(e,"x","ceil","float32")};return tt.runKernel(ba,n)}const l$=et({ceil_:a$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$(e,t,n){const s=M(e,"x","clipByValue");P(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`);const i={x:s},a={clipValueMin:t,clipValueMax:n};return tt.runKernel(va,i,a)}const Sn=et({clipByValue_:c$});function u$(e){return we(e,0)}const h$=et({concat1d_:u$});function f$(e,t){return we(e,t)}const d$=et({concat2d_:f$});function p$(e,t){return we(e,t)}const g$=et({concat3d_:p$});function m$(e,t){return we(e,t)}const x$=et({concat4d_:m$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$(e,t,n,s,i="NHWC",a=[1,1],u){const o=M(e,"x","conv2d","float32"),r=M(t,"filter","conv2d","float32");let l=o,h=!1;o.rank===3&&(h=!0,l=it(o,[1,o.shape[0],o.shape[1],o.shape[2]])),P(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),P(r.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${r.rank}.`),pn("conv2d",s,u);const c=i==="NHWC"?l.shape[3]:l.shape[1];P(c===r.shape[2],()=>`Error in conv2d: depth of input (${c}) must match input depth for filter ${r.shape[2]}.`),P(Qe(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const f={x:l,filter:r},d={strides:n,pad:s,dataFormat:i,dilations:a,dimRoundingMode:u},p=tt.runKernel(tu,f,d);return h?it(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const lr=et({conv2d_:b$});function v$(e,t,n,s,i="NWC",a=1,u){const o=M(e,"x","conv1d"),r=M(t,"filter","conv1d");let l=o,h=!1;o.rank===2&&(h=!0,l=it(o,[1,o.shape[0],o.shape[1]])),P(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),P(r.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${r.rank}.`),pn("conv1d",s,u),P(l.shape[2]===r.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${r.shape[1]}.`),P(Qe(n,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${a}'`),P(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const c=it(r,[1,r.shape[0],r.shape[1],r.shape[2]]),f=it(l,[l.shape[0],1,l.shape[1],l.shape[2]]),g=lr(f,c,[1,n],s,"NHWC",[1,a],u);return h?it(g,[g.shape[2],g.shape[3]]):it(g,[g.shape[0],g.shape[2],g.shape[3]])}const _v=et({conv1d_:v$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y$(e,t,n,s,i,a="NHWC",u){P(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let o=e,r=t,l=!1;t.rank===3&&(l=!0,r=it(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),P(o.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),P(r.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${r.rank}`),P(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const h=a==="NHWC"?o[3]:o[1],c=a==="NHWC"?r.shape[3]:r.shape[1];P(h===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`),P(c===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[3]}.`),pn("conv2dDerInput",i,u);const f={dy:r,filter:n},d={strides:s,pad:i,dataFormat:a,dimRoundingMode:u,inputShape:o},p=tt.runKernel(eu,f,d);return l?it(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Op=et({conv2DBackpropInput_:y$});function w$(e,t,n,s,i,a){const u=M(e,"x","conv2dTranspose"),o=M(t,"filter","conv2dTranspose");return Op(n,u,o,s,i,"NHWC",a)}const $v=et({conv2dTranspose_:w$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C$(e,t,n,s,i="NDHWC",a=[1,1,1]){const u=M(e,"x","conv3d"),o=M(t,"filter","conv3d");let r=u,l=!1;u.rank===4&&(l=!0,r=it(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),P(r.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${r.rank}.`),P(o.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),P(r.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${r.shape[4]}) must match input depth for filter ${o.shape[3]}.`),P(Qe(n,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),P(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const h={x:r,filter:o},c={strides:n,pad:s,dataFormat:i,dilations:a},f=tt.runKernel(nu,h,c);return l?it(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const S$=et({conv3d_:C$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$(e,t,n,s,i){P(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,u=t,o=!1;t.rank===4&&(o=!0,u=it(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);const r=a[4],l=u.shape[4];P(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),P(u.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${u.rank}`),P(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),P(r===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${r}) must match input depth for filter ${n.shape[3]}.`),P(l===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`);const h={dy:u,filter:n},c={pad:i,strides:s,inputShape:a},f=tt.runKernel(Ld,h,c);return o?it(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Ev=et({conv3DBackpropInput_:k$});function I$(e,t,n,s,i){const a=M(e,"x","conv3dTranspose"),u=M(t,"filter","conv3dTranspose");return Ev(n,a,u,s,i)}const T$=et({conv3dTranspose_:I$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _$(e){const n={x:M(e,"x","cos","float32")};return tt.runKernel(ya,n)}const Jo=et({cos_:_$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $$(e){const n={x:M(e,"x","cosh","float32")};return tt.runKernel(wa,n)}const Nv=et({cosh_:$$});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E$(e,t=0,n=!1,s=!1){const a={x:M(e,"x","cumprod")},u={axis:t,exclusive:n,reverse:s};return tt.runKernel(Bd,a,u)}const Bf=et({cumprod_:E$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N$(e,t=0,n=!1,s=!1){const a={x:M(e,"x","cumsum")},u={axis:t,exclusive:n,reverse:s};return tt.runKernel(su,a,u)}const Dv=et({cumsum_:N$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D$(e,t,n="NHWC"){const s=M(e,"x","depthToSpace","float32"),i=n==="NHWC"?s.shape[1]:s.shape[2],a=n==="NHWC"?s.shape[2]:s.shape[3],u=n==="NHWC"?s.shape[3]:s.shape[1];P(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),P(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${s.shape}`),P(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t} for depthToSpace with input shape
        ${s.shape}`),P(u%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${u} for depthToSpace with input shape ${s.shape}`);const o={x:s},r={blockSize:t,dataFormat:n};return tt.runKernel(Wd,o,r)}const A$=et({depthToSpace_:D$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$(e,t,n,s,i="NHWC",a=[1,1],u){const o=M(e,"x","depthwiseConv2d","float32"),r=M(t,"filter","depthwiseConv2d","float32");let l=o,h=!1;o.rank===3&&(h=!0,l=it(o,[1,o.shape[0],o.shape[1],o.shape[2]])),P(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),P(r.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${r.rank}.`),P(l.shape[3]===r.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${r.shape[2]}.`),pn("depthwiseConv2d",s,u);const c={x:l,filter:r},f={strides:n,pad:s,dataFormat:i,dilations:a,dimRoundingMode:u},d=tt.runKernel(iu,c,f);return h?it(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Fp=et({depthwiseConv2d_:R$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O$(e,t,n,s,i=[1,1],a="NHWC"){const u=M(e,"x","dilation2d"),o=M(t,"filter","dilation2d");P(u.rank===3||u.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${u.rank}.`),P(o.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),P(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let r=u,l=!1;u.rank===3&&(r=it(u,[1,u.shape[0],u.shape[1],u.shape[2]]),l=!0);const h={x:r,filter:o},c={strides:n,pad:s,dilations:i},f=tt.runKernel(ru,h,c);return l?it(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const F$=et({dilation2d_:O$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$(e,t){let n=M(e,"a","equal","string_or_numeric"),s=M(t,"b","equal","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(ou,i)}const Ls=et({equal_:P$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(e,t,n){const s=M(t,"a","where"),i=M(n,"b","where"),a=M(e,"condition","where","bool"),u=Bt(Bt(a.shape,s.shape),i.shape),o=Zl(a,u),r=Zl(s,u),l=Zl(i,u),h={condition:o,t:r,e:l};return tt.runKernel(Pu,h)}const kn=et({where_:M$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$(e){const n={x:M(e,"x","zerosLike")};return tt.runKernel(Gu,n)}const Yt=et({zerosLike_:L$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$(e,t){let n=M(e,"a","div"),s=M(t,"b","div");[n,s]=Ce(n,s);const i=Nt(n,s),a=Yt(i),u=Ls(s,a);return kn(u,a,i)}const z$=et({divNoNan_:B$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$(e,t){const n=M(e,"t1","dot"),s=M(t,"t2","dot");P((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const i=n.rank===1?n.size:n.shape[1],a=s.rank===1?s.size:s.shape[0];if(P(i===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${a}.`),n.rank===1&&s.rank===1){const u=it(n,[1,-1]),o=it(s,[-1,1]),r=jt(u,o);return it(r,[])}else if(n.rank===1&&s.rank===2){const u=it(n,[1,-1]),o=it(s,[s.shape[0],s.shape[1]]),r=jt(u,o);return it(r,[r.size])}else if(n.rank===2&&s.rank===1){const u=it(s,[-1,1]),o=jt(n,u);return it(o,[o.size])}else{const u=it(s,[s.shape[0],s.shape[1]]);return jt(n,u)}}const V$=et({dot_:W$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$(e){const n={x:M(e,"x","elu","float32")};return tt.runKernel(Sa,n)}const qu=et({elu_:U$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$(e){let t=M(e,"x","erf");P(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=St(t,"float32"));const n={x:t};return tt.runKernel(ka,n)}const H$=et({erf_:G$});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pp(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Av(e,t,n){const s=e.length+t.length,i=[];let a=0,u=0;for(let o=0;o<s;o++)n.indexOf(o)===-1?i.push(e[a++]):i.push(t[u++]);return i}function We(e,t){const n=[],s=e.length;for(let a=0;a<s;a++)t.indexOf(a)===-1&&n.push(e[a]);const i=t.map(a=>e[a]);return[n,i]}function Se(e,t){const n=t.map(s=>1);return Av(e,n,t)}function Ye(e,t,n){P(Pp(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function be(e,t){if(Pp(e,t))return null;const n=[];for(let s=0;s<t;++s)e.indexOf(s)===-1&&n.push(s);return e.forEach(s=>n.push(s)),n}function ki(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function ke(e,t){const n=[];for(let s=t-e;s<t;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$(e,t=null,n=!1){const i={x:M(e,"x","max")},a={reductionIndices:t,keepDims:n};return tt.runKernel(bu,i,a)}const Os=et({max_:j$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$(e,t=null,n=!1){const i={x:M(e,"x","min")},a={axis:t,keepDims:n};return tt.runKernel(Cu,i,a)}const zf=et({min_:X$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(e,t){let n=M(e,"base","pow"),s=M(t,"exp","pow");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(za,i)}const eo=et({pow_:Y$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pt(e,t){if((Ms(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Ms(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ol(e,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(e){const n={x:M(e,"x","sqrt","float32")};return tt.runKernel(Za,n)}const rn=et({sqrt_:q$});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(e){const t=M(e,"x","square"),n={};return tt.runKernel("Square",{x:t},n)}const le=et({square_:K$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$(e,t=null,n=!1){let s=M(e,"x","sum");s.dtype==="bool"&&(s=St(s,"int32"));const i={x:s},a={axis:t,keepDims:n};return tt.runKernel(Lu,i,a)}const Et=et({sum_:J$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$(e,t="euclidean",n=null,s=!1){e=M(e,"x","norm");const i=Rv(e,t,n);let a=i.shape;if(s){const u=Ut(n,e.shape);a=Se(i.shape,u)}return it(i,a)}function Rv(e,t,n=null){if(e.rank===0)return Le(e);if(e.rank!==1&&n===null)return Rv(it(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return Et(Le(e),n);if(t===1/0)return Os(Le(e),n);if(t===-1/0)return zf(Le(e),n);if(t==="euclidean"||t===2)return rn(Et(eo(Le(e),Pt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Os(Et(Le(e),n[0]),n[1]-1);if(t===1/0)return Os(Et(Le(e),n[1]),n[0]);if(t===-1/0)return zf(Et(Le(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return rn(Et(le(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Ku=et({norm_:Z$});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(e,t=null,n=!1){return Ku(e,"euclidean",t,n)}const tE=et({euclideanNorm_:Q$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(e){const n={x:M(e,"x","exp")};return tt.runKernel(Ia,n)}const Yn=et({exp_:eE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nE(e,t=0){const n=M(e,"x","expandDims","string_or_numeric");P(t<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},i={dim:t};return tt.runKernel(au,s,i)}const Bn=et({expandDims_:nE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(e){const n={x:M(e,"x","expm1")};return tt.runKernel(Ta,n)}const iE=et({expm1_:sE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(e,t){const n=M(e,"x","tile","string_or_numeric");P(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const s={x:n},i={reps:t};return tt.runKernel(sl,s,i)}const hs=et({tile_:rE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(e,t,n,s="float32"){t==null&&(t=e);const i=Vt([e,t],s),a=e<=t?e:t;for(let o=0;o<a;++o)i.set(1,o,o);const u=it(i.toTensor(),[e,t]);if(n==null)return u;if(n.length===1)return hs(Bn(u,0),[n[0],1,1]);if(n.length===2)return hs(Bn(Bn(u,0),0),[n[0],n[1],1,1]);if(n.length===3)return hs(Bn(Bn(Bn(u,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const Ov=et({eye_:oE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(e,t,n){const s={shape:e,value:t,dtype:n};return tt.runKernel(jd,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(e){const n={x:M(e,"x","floor","float32")};return tt.runKernel(_a,n)}const Zu=et({floor_:aE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(e,t,n=0,s=0){const i=M(e,"x","gather"),a=M(t,"indices","gather","int32"),u={x:i,indices:a},o={axis:n,batchDims:s};return tt.runKernel(cu,u,o)}const Mp=et({gather_:lE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(e,t){let n=M(e,"a","greater","string_or_numeric"),s=M(t,"b","greater","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(uu,i)}const Qn=et({greater_:cE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uE(e,t){let n=M(e,"a","greaterEqual","string_or_numeric"),s=M(t,"b","greaterEqual","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(Ea,i)}const bo=et({greaterEqual_:uE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(e){const n={x:M(e,"x","isFinite")};return tt.runKernel(Da,n)}const fE=et({isFinite_:hE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dE(e){const n={x:M(e,"x","isInf")};return tt.runKernel(Aa,n)}const pE=et({isInf_:dE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(e){const n={x:M(e,"x","isNaN")};return tt.runKernel(Ra,n)}const mE=et({isNaN_:gE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xE(e,t=.2){const s={x:M(e,"x","leakyRelu")},i={alpha:t};return tt.runKernel(hu,s,i)}const Lp=et({leakyRelu_:xE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bE(e,t){let n=M(e,"a","less","string_or_numeric"),s=M(t,"b","less","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(fu,i)}const Fv=et({less_:bE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(e,t){let n=M(e,"a","lessEqual","string_or_numeric"),s=M(t,"b","lessEqual","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(du,i)}const vo=et({lessEqual_:vE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(e,t=5,n=1,s=1,i=.5){const a=M(e,"x","localResponseNormalization");P(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),P(Kr(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let u=a,o=!1;a.rank===3&&(o=!0,u=it(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const r={x:u},l={depthRadius:t,bias:n,alpha:s,beta:i},h=tt.runKernel(xu,r,l);return o?it(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const wE=et({localResponseNormalization_:yE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CE(e){const n={x:M(e,"x","log","float32")};return tt.runKernel(Oa,n)}const qn=et({log_:CE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SE(e){const n={x:M(e,"x","log1p")};return tt.runKernel(Fa,n)}const Bp=et({log1p_:SE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kE(e,t){P(bf(e),()=>"The f passed in variableGrads(f) must be a function"),P(t==null||Array.isArray(t)&&t.every(l=>l instanceof fc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const l in tt.registeredVariables)t.push(tt.registeredVariables[l])}const s=n?t.filter(l=>!l.trainable):null,i=t.length;t=t.filter(l=>l.trainable),P(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const a=!0,{value:u,grads:o}=tt.gradients(e,t,null,a);P(o.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),P(u.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${u.rank} tensor`);const r={};return t.forEach((l,h)=>{o[h]!=null&&(r[l.name]=o[h])}),s!=null&&s.forEach(l=>r[l.name]=null),{value:u,grads:r}}function cr(e){return tt.customGrad(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(e){const n={x:M(e,"x","softplus")};return tt.runKernel(Ja,n)}const cl=et({softplus_:IE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TE(e){const t=M(e,"x","logSigmoid");return cr(s=>({value:xe(cl(xe(s))),gradFunc:u=>Z(u,xo(xe(s)))}))(t)}const _E=et({logSigmoid_:TE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(e,t){let n=M(e,"a","sub"),s=M(t,"b","sub");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(tl,i)}const Tt=et({sub_:$E});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(e,t=-1){const n=M(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return cr((i,a)=>{const o=Os(i,t,!0),r=Tt(i,o),l=Tt(St(r,"float32"),qn(Et(Yn(r),t,!0)));return a([l]),{value:l,gradFunc:(c,f)=>{const[d]=f,p=!0,m=Yn(d);return Tt(c,Z(Et(c,t,p),m))}}})(n)}const Pv=et({logSoftmax_:EE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(e,t=null,n=!1){const s=M(e,"x","logSumExp"),i=Ut(t,s.shape),a=Os(s,i,!0),u=Tt(s,a),o=Yn(u),r=Et(o,i),l=qn(r),h=yt(it(a,l.shape),l);if(n){const c=Se(h.shape,i);return it(h,c)}return h}const Mv=et({logSumExp_:NE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DE(e,t){const n=M(e,"a","logicalAnd","bool"),s=M(t,"b","logicalAnd","bool");Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(pu,i)}const Xs=et({logicalAnd_:DE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(e){const n={x:M(e,"x","logicalNot","bool")};return tt.runKernel(gu,n)}const zp=et({logicalNot_:AE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(e,t){const n=M(e,"a","logicalOr","bool"),s=M(t,"b","logicalOr","bool");Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(mu,i)}const Lv=et({logicalOr_:RE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(e,t){const n=M(e,"a","logicalXor","bool"),s=M(t,"b","logicalXor","bool");return Bt(n.shape,s.shape),Xs(Lv(e,t),zp(Xs(e,t)))}const FE=et({logicalXor_:OE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(e,t,n,s,i){const a=M(e,"x","maxPool"),u=1;let o=a,r=!1;a.rank===3&&(r=!0,o=it(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(o.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),P(Qe(n,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${u}'`),pn("maxPool",s,i);const l={x:o},h={filterSize:t,strides:n,pad:s,dimRoundingMode:i},c=tt.runKernel(vu,l,h);return r?it(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Wp=et({maxPool_:PE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(e,t=[1,1,1],n,s,i,a="NDHWC"){const u=M(e,"x","maxPool3d");let o=u,r=!1;u.rank===4&&(r=!0,o=it(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),P(o.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),P(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),pn("maxPool3d",s,i);const l={x:o},h={filterSize:t,strides:n,pad:s,dimRoundingMode:i,dataFormat:a},c=tt.runKernel(yu,l,h);return r?it(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}const LE=et({maxPool3d_:ME});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(e,t){let n=M(e,"a","maximum"),s=M(t,"b","maximum");[n,s]=Ce(n,s),n.dtype==="bool"&&(n=St(n,"int32"),s=St(s,"int32")),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(Pa,i)}const Ii=et({maximum_:BE});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(e,t=null,n=!1){const i={x:M(e,"x","mean")},a={axis:t,keepDims:n};return tt.runKernel(wu,i,a)}const ye=et({mean_:zE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(e,t="float32"){if(t==="complex64"){const s=ae(e,"float32"),i=ae(e,"float32");return Qr(s,i)}const n=Ze(pt(e),t);return tt.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yn(e,t="float32"){if(t==="complex64"){const s=yn(e,"float32"),i=ae(e,"float32");return Qr(s,i)}const n=_d(pt(e),t);return tt.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let s=M(e,"x","meshgrid",e instanceof ge?e.dtype:"float32");if(t===void 0)return[s];let i=M(t,"y","meshgrid",t instanceof ge?t.dtype:"float32");const a=pt(s.shape),u=pt(i.shape);return n==="xy"?(s=it(s,[1,-1]),i=it(i,[-1,1]),[jt(yn([u,1],s.dtype),s),jt(i,yn([1,a],i.dtype))]):(s=it(s,[-1,1]),i=it(i,[1,-1]),[jt(s,yn([1,u],s.dtype)),jt(yn([a,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VE(e,t){let n=M(e,"a","minimum"),s=M(t,"b","minimum");[n,s]=Ce(n,s),n.dtype==="bool"&&(n=St(n,"int32"),s=St(s,"int32")),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(Ma,i)}const tr=et({minimum_:VE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(e,t,n){P(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=M(e,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");P(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const i=n==="reflect"?1:0;for(let o=0;o<s.rank;o++)P(t[o].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),P(t[o][0]>=0&&t[o][0]<=s.shape[o]-i&&t[o][1]>=0&&t[o][1]<=s.shape[o]-i,()=>`Padding in dimension ${o} cannot be greater than or equal to ${s.shape[o]-i} or less than 0 for input of shape ${s.shape}`);const a={paddings:t,mode:n},u={x:s};return tt.runKernel(Su,u,a)}const GE=et({mirrorPad_:UE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(e,t){let n=M(e,"a","mod"),s=M(t,"b","mod");[n,s]=Ce(n,s);const i={a:n,b:s};return tt.runKernel(La,i)}const jE=et({mod_:HE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(e,t=null,n=!1){e=M(e,"x","moments");const s=Ut(t,e.shape),i=ye(e,s,n);let a=i.shape;n||(a=Se(i.shape,s));const u=le(Tt(St(e,"float32"),it(i,a))),o=ye(u,s,n);return{mean:i,variance:o}}const Vp=et({moments_:XE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(e,t){let n=M(e,"a","notEqual","string_or_numeric"),s=M(t,"b","notEqual","string_or_numeric");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s};return tt.runKernel(Iu,i)}const Zo=et({notEqual_:YE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(e){const n={x:M(e,"x","onesLike")};return tt.runKernel(Tu,n)}const Kn=et({onesLike_:qE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KE(e,t,n=0){const s=M(e,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:n},a={x:s};return tt.runKernel(Eu,a,i)}const Up=et({pad_:KE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(e,t,n){const s=M(e,"x","spaceToBatchND");P(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),P(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),P(s.shape.reduce((u,o,r)=>r>0&&r<=t.length?u&&(o+n[r-1][0]+n[r-1][1])%t[r-1]===0:u,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const i={x:s},a={blockShape:t,paddings:n};return tt.runKernel(Bu,i,a)}const Gp=et({spaceToBatchND_:JE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(e,t,n,s,i,a,u){i==null&&(i=[1,1]),a==null&&(a=1),s===0&&(s="valid");const o=M(e,"x","maxPool");let r=o,l=!1;o.rank===3&&(l=!0,r=it(o,[1,o.shape[0],o.shape[1],o.shape[2]])),P(Qe(a,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${i}'`);const h=Zn(r.shape,t,a,i,s),c=[h.dilationHeight,h.dilationWidth];let f;s==="same"?f=tN([h.filterHeight,h.filterWidth],c):f=[[0,0],[0,0]];const d=c[0]===1&&c[1]===1,[p,m]=QE([h.inHeight,h.inWidth],c,f),g=d?s:"valid",x=d?r:Gp(r,c,p),y=(n==="avg"?()=>Dp(x,t,a,g,u):()=>Wp(x,t,a,g,u))(),v=d?y:Rp(y,c,m);return l?it(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function QE(e,t,n){const s=n.map(h=>h[0]),i=n.map(h=>h[1]),a=e.concat(s,i),u=t.map((h,c)=>(h-a[c]%h)%h),o=i.map((h,c)=>h+u[c]),r=t.map((h,c)=>[s[c],o[c]]),l=t.map((h,c)=>[0,u[c]]);return[r,l]}function tN(e,t){const s=e.map((u,o)=>u+(u-1)*(t[o]-1)).map(u=>u-1),i=s.map(u=>Math.floor(u/2)),a=s.map((u,o)=>u-i[o]);return s.map((u,o)=>[i[o],a[o]])}const eN=et({pool_:ZE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nN(e,t){const n=M(e,"x","prelu"),s=M(t,"alpha","prelu"),i={x:n,alpha:s};return tt.runKernel(Nu,i)}const Hp=et({prelu_:nN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sN(e,t=null,n=!1){let s=M(e,"x","prod");s.dtype==="bool"&&(s=St(s,"int32"));const i={x:s},a={axis:t,keepDims:n};return tt.runKernel(Du,i,a)}const iN=et({prod_:sN});var Bv={exports:{}};(function(e){(function(t,n,s){function i(r){var l=this,h=o();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=h(" "),l.s1=h(" "),l.s2=h(" "),l.s0-=h(r),l.s0<0&&(l.s0+=1),l.s1-=h(r),l.s1<0&&(l.s1+=1),l.s2-=h(r),l.s2<0&&(l.s2+=1),h=null}function a(r,l){return l.c=r.c,l.s0=r.s0,l.s1=r.s1,l.s2=r.s2,l}function u(r,l){var h=new i(r),c=l&&l.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,c&&(typeof c=="object"&&a(c,h),f.state=function(){return a(h,{})}),f}function o(){var r=4022871197,l=function(h){h=h.toString();for(var c=0;c<h.length;c++){r+=h.charCodeAt(c);var f=.02519603282416938*r;r=f>>>0,f-=r,f*=r,r=f>>>0,f-=r,r+=f*4294967296}return(r>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.alea=u})(je,e,!1)})(Bv);var zv={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var c=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^c^c>>>8},o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor128=u})(je,e,!1)})(zv);var Wv={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(c^c<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,h==l.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r.v=o.v,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorwow=u})(je,e,!1)})(Wv);var Vv={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.x,c=r.i,f,d;return f=h[c],f^=f>>>7,d=f^f<<24,f=h[c+1&7],d^=f^f>>>10,f=h[c+3&7],d^=f^f>>>3,f=h[c+4&7],d^=f^f<<7,f=h[c+7&7],f=f^f<<13,d^=f^f<<9,h[c]=d,r.i=c+1&7,d};function l(h,c){var f,d=[];if(c===(c|0))d[0]=c;else for(c=""+c,f=0;f<c.length;++f)d[f&7]=d[f&7]<<15^c.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],h.x=d,h.i=0,f=256;f>0;--f)h.next()}l(r,o)}function a(o,r){return r.x=o.x.slice(),r.i=o.i,r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.x&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorshift7=u})(je,e,!1)})(Vv);var Uv={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.w,c=r.X,f=r.i,d,p;return r.w=h=h+1640531527|0,p=c[f+34&127],d=c[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=c[f]=p^d,r.i=f,p+(h^h>>>16)|0};function l(h,c){var f,d,p,m,g,x=[],b=128;for(c===(c|0)?(d=c,c=null):(c=c+"\0",d=0,b=Math.max(b,c.length)),p=0,m=-32;m<b;++m)c&&(d^=c.charCodeAt((m+32)%c.length)),m===0&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(g=g+1640531527|0,f=x[m&127]^=d+g,p=f==0?p+1:0);for(p>=128&&(x[(c&&c.length||0)&127]=-1),p=127,m=4*128;m>0;--m)d=x[p+34&127],f=x[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,x[p]=d^f;h.w=g,h.X=x,h.i=p}l(r,o)}function a(o,r){return r.i=o.i,r.w=o.w,r.X=o.X.slice(),r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.X&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor4096=u})(je,e,!1)})(Uv);var Gv={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.b,f=r.c,d=r.d,p=r.a;return c=c<<25^c>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-c|0,r.b=c=c<<20^c>>>12^f,r.c=f=f-d|0,r.d=d<<16^f>>>16^p,r.a=p-c|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,o===Math.floor(o)?(r.a=o/4294967296|0,r.b=o|0):l+=o;for(var h=0;h<l.length+20;h++)r.b^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.a=o.a,r.b=o.b,r.c=o.c,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.tychei=u})(je,e,!1)})(Gv);var Hv={exports:{}};(function(e){(function(t,n){var s=this,i=256,a=6,u=52,o="random",r=n.pow(i,a),l=n.pow(2,u),h=l*2,c=i-1,f;function d(v,w,C){var S=[];w=w==!0?{entropy:!0}:w||{};var k=x(g(w.entropy?[v,y(t)]:v==null?b():v,3),S),T=new p(S),N=function(){for(var R=T.g(a),L=r,z=0;R<l;)R=(R+z)*i,L*=i,z=T.g(1);for(;R>=h;)R/=2,L/=2,z>>>=1;return(R+z)/L};return N.int32=function(){return T.g(4)|0},N.quick=function(){return T.g(4)/4294967296},N.double=N,x(y(T.S),t),(w.pass||C||function(R,L,z,U){return U&&(U.S&&m(U,T),R.state=function(){return m(T,{})}),z?(n[o]=R,L):R})(N,k,"global"in w?w.global:this==n,w.state)}n["seed"+o]=d;function p(v){var w,C=v.length,S=this,k=0,T=S.i=S.j=0,N=S.S=[];for(C||(v=[C++]);k<i;)N[k]=k++;for(k=0;k<i;k++)N[k]=N[T=c&T+v[k%C]+(w=N[k])],N[T]=w;(S.g=function(R){for(var L,z=0,U=S.i,H=S.j,Y=S.S;R--;)L=Y[U=c&U+1],z=z*i+Y[c&(Y[U]=Y[H=c&H+L])+(Y[H]=L)];return S.i=U,S.j=H,z})(i)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function g(v,w){var C=[],S=typeof v,k;if(w&&S=="object")for(k in v)try{C.push(g(v[k],w-1))}catch{}return C.length?C:S=="string"?v:v+"\0"}function x(v,w){for(var C=v+"",S,k=0;k<C.length;)w[c&k]=c&(S^=w[c&k]*19)+C.charCodeAt(k++);return y(w)}function b(){try{var v;return f&&(v=f.randomBytes)?v=v(i):(v=new Uint8Array(i),(s.crypto||s.msCrypto).getRandomValues(v)),y(v)}catch{var w=s.navigator,C=w&&w.plugins;return[+new Date,s,C,s.screen,y(t)]}}function y(v){return String.fromCharCode.apply(0,v)}if(x(n.random(),t),e.exports){e.exports=d;try{f=require("crypto")}catch{}}})([],Math)})(Hv);var rN=Bv.exports,oN=zv.exports,aN=Wv.exports,lN=Vv.exports,cN=Uv.exports,uN=Gv.exports,br=Hv.exports;br.alea=rN;br.xor128=oN;br.xorwow=aN;br.xorshift7=lN;br.xor4096=cN;br.tychei=uN;var jv=br;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xv{constructor(t,n,s,i,a){this.mean=t,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const u=a||Math.random();this.random=jv.alea(u.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let t,n,s=!1;for(;!s;){let i,a,u;do i=2*this.random()-1,a=2*this.random()-1,u=i*i+a*a;while(u>=1||u===0);const o=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*i*o,n=this.mean+this.stdDev*a*o,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class hN{constructor(t=0,n=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=jv.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(e,t=0,n=1,s,i){if(s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const a=new Xv(t,n,s,!1,i),u=Vt(e,s);for(let o=0;o<u.values.length;o++)u.values[o]=a.nextValue();return u.toTensor()}const dN=et({randomNormal_:fN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pN(e,t=0,n=1,s="float32",i){const a=Vt(e,s),u=new hN(t,n,null,i);for(let o=0;o<a.values.length;o++)a.values[o]=u.nextValue();return a.toTensor()}const Qu=et({randomUniform_:pN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(e,t,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:s};return tt.runKernel(np,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(e){const n={x:M(e,"x","reciprocal")};return tt.runKernel(Wa,n)}const mN=et({reciprocal_:gN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xN(e){const n={x:M(e,"x","relu")};return tt.runKernel(Va,n)}const Zs=et({relu_:xN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(e){const n={x:M(e,"x","relu6")};return tt.runKernel(Ua,n)}const Yv=et({relu6_:bN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vN(e,t){const s={x:M(e,"x","reverse")},i={dims:t};return tt.runKernel(Fu,s,i)}const ur=et({reverse_:vN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yN(e){const n={x:M(e,"x","round")};return tt.runKernel(Ga,n)}const qv=et({round_:yN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wN(e){const n={x:M(e,"x","rsqrt","float32")};return tt.runKernel(Ha,n)}const Kv=et({rsqrt_:wN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CN(e){const n={x:M(e,"x","selu")};return tt.runKernel(ja,n)}const Jv=et({selu_:CN});function SN(e,t,n,s,i,a=[1,1],u="NHWC"){const o=M(e,"x","separableConv2d"),r=M(t,"depthwiseFilter","separableConv2d"),l=M(n,"pointwiseFilter","separableConv2d");let h=o,c=!1;if(o.rank===3&&(c=!0,h=it(o,[1,o.shape[0],o.shape[1],o.shape[2]])),u==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");P(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),P(r.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${r.rank}.`),P(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${r.rank}.`),P(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),P(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const f=r.shape[2],d=r.shape[3];P(l.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${l.shape[2]}.`);const p=Fp(h,r,s,i,u,a),g=lr(p,l,1,"valid",u);return c?it(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Zv=et({separableConv2d_:SN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kN(e){const n={x:M(e,"x","sign")};return tt.runKernel(qa,n)}const IN=et({sign_:kN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TN(e){const n={x:M(e,"x","sin","float32")};return tt.runKernel(Xa,n)}const jp=et({sin_:TN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _N(e){const n={x:M(e,"x","sinh")};return tt.runKernel(Ya,n)}const Qv=et({sinh_:_N});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(e,t,n){const s=M(e,"x","slice1d");return P(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),ne(s,[t],[n])}const Xp=et({slice1d_:$N});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EN(e,t,n){const s=M(e,"x","slice2d");return P(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),ne(s,t,n)}const ty=et({slice2d_:EN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NN(e,t,n){const s=M(e,"x","slice3d");return P(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),ne(s,t,n)}const Yp=et({slice3d_:NN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DN(e,t,n){const s=M(e,"x","slice4d");return P(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),ne(s,t,n)}const gc=et({slice4d_:DN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AN(e,t=-1){const n=M(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const s={logits:n},i={dim:t};return tt.runKernel(Wu,s,i)}const qp=et({softmax_:AN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RN(e){P(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return tt.runKernel(Hd,t)}const ey=et({fft_:RN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ON(e){P(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return tt.runKernel(Yd,t)}const Wf=et({ifft_:ON});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FN(e){const t=e.shape[e.shape.length-1],n=e.size/t;let s;if(t<=2){const i=it(e,[n,t]);s=Wf(i)}else{const i=[n,2*(t-1)],a=it(dc(e),[n,t]),u=it(Sp(e),[n,t]),o=ur(ne(a,[0,1],[n,t-2]),1),r=Z(ur(ne(u,[0,1],[n,t-2]),1),Pt(-1)),l=we([a,o],1),h=we([u,r],1),c=it(Qr(l,h),[i[0],i[1]]);s=Wf(c)}if(s=dc(s),e.rank===3&&e.shape[0]!==0){const i=s,a=e.shape[0];s=it(s,[a,s.shape[0]/a,s.shape[1]]),i.dispose()}return s}const PN=et({irfft_:FN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MN(e,t,n=0){const i={x:M(e,"x","split")},a={numOrSizeSplits:t,axis:n};return tt.runKernel(zu,i,a)}const An=et({split_:MN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LN(e,t){P(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const s=e.size/n;let i;if(t!=null&&t<n){const p=e.shape.map(g=>0),m=e.shape.map(g=>g);m[e.shape.length-1]=t,i=ne(e,p,m),n=t}else if(t!=null&&t>n){const p=e.shape.map(m=>m);p[e.shape.length-1]=t-n,i=we([e,ae(p)],e.shape.length-1),n=t}else i=e;const a=Yt(i),u=it(Qr(i,a),[s,n]),o=ey(u),r=Math.floor(n/2)+1,l=dc(o),h=Sp(o),c=An(l,[r,n-r],l.shape.length-1),f=An(h,[r,n-r],h.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=r,it(Qr(c[0],f[0]),d)}const ny=et({rfft_:LN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BN(e,t){let n=M(e,"a","squaredDifference"),s=M(t,"b","squaredDifference");[n,s]=Ce(n,s),Bt(n.shape,s.shape);const i={a:n,b:s},a={};return tt.runKernel(Qa,i,a)}const sy=et({squaredDifference_:BN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zN(e,t){const n=M(e,"x","squeeze");return it(n,wi(n.shape,t).newShape)}const ul=et({squeeze_:zN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WN(e,t=0){const n=iv(e,"tensors","stack","string_or_numeric");P(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&P(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,i={axis:t};return tt.runKernel($u,s,i)}const hr=et({stack_:WN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VN(e,t=0){const s={x:M(e,"x","step")},i={alpha:t};return tt.runKernel(il,s,i)}const hl=et({step_:VN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UN(e,t,n,s,i=0,a=0,u=0,o=0,r=0){const h={x:M(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:s,beginMask:i,endMask:a,ellipsisMask:u,newAxisMask:o,shrinkAxisMask:r};return tt.runKernel(hp,h,c)}const GN=et({stridedSlice_:UN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(e){const n={x:M(e,"x","tan","float32")};return tt.runKernel(el,n)}const jN=et({tan_:HN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wn(e,t){Td(e);const n=rl(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ol(e,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(e,t,n){if(Td(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=rl(e,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ol(e,t,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XN(e,t=1,n=!0){const s=M(e,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);const a={x:s},u={k:t,sorted:n},[o,r]=tt.runKernel(gp,a,u);return{values:o,indices:r}}const YN=et({topk_:XN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qN(e,t=0,n=1,s,i){if(s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new Xv(t,n,s,!0,i),u=Vt(e,s);for(let o=0;o<u.values.length;o++)u.values[o]=a.nextValue();return u.toTensor()}const iy=et({truncatedNormal_:qN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KN(e,t=0){const n=M(e,"x","unique","string_or_numeric");P(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},i={axis:t},[a,u]=tt.runKernel(xp,s,i);return{values:a,indices:u}}const JN=et({unique_:KN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZN(e,t,n){const s=M(e,"x","unsortedSegmentSum"),i=M(t,"segmentIds","unsortedSegmentSum","int32");P(Kr(n),()=>"numSegments must be of dtype int");const a={x:s,segmentIds:i},u={numSegments:n};return tt.runKernel(Uu,a,u)}const ry=et({unsortedSegmentSum_:ZN});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QN(e,t=0){const n=M(e,"x","unstack","string_or_numeric");P(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},i={axis:t};return tt.runKernel(Vu,s,i)}const so=et({unstack_:QN});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(e,t=!0,n,s){return tt.makeVariable(e,t,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oy(e,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const s=Vt(e,"int32"),i=Vt([n.length,e.length],"int32");for(let a=0;a<n.length;a++){const u=s.indexToLoc(n[a]),o=a*e.length;i.values.set(u,o)}return i.toTensor()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD(e,t){if(t==null)return e.shape.slice();if(Qt(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let s=0;s<e.shape.length;s++)t[s]==null&&e.shape[s]!=null?n.push(e.shape[s]):n.push(t[s]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(e,t,n,s){const i=M(e,"x","dropout");if(P(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),P(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof ge?i.clone():i;const a=eD(i,n),u=1-t,o=Nt(Zu(yt(Qu(a,0,1,"float32",s),u)),u);return Z(i,o)}const sD=et({dropout_:nD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function ay(e,t,n){const s=1-e%2,i=new Float32Array(e);for(let a=0;a<e;++a){const u=2*Math.PI*a/(e+s-1);i[a]=t-n*Math.cos(u)}return wn(i,"float32")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(e,t,n,s,i,a="NHWC",u){let o=e;e.rank===3&&(o=it(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let r=t;r.rank===3&&(r=it(t,[1,t.shape[0],t.shape[1],t.shape[2]])),P(o.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),P(r.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${r.shape}.`),P(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const l=a==="NHWC"?o.shape[3]:o.shape[1],h=a==="NHWC"?r.shape[3]:r.shape[1];P(l===n[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`),P(h===n[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`),pn("conv2dDerFilter",i,u);const c={x:o,dy:r},f={strides:s,pad:i,dataFormat:a,dimRoundingMode:u,filterShape:n};return tt.runKernel(Pd,c,f)}const Kp=et({conv2DBackpropFilter_:rD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jp(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return Z(e,hl(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Zp(e,t){let n=t;const s=Oe(e.shape,t.shape);return s.length>0&&(n=Et(n,s)),it(n,e.shape)}function Qp(e,t,n,s){if(t==="linear")return e;if(t==="relu")return Zs(e);if(t==="elu")return qu(e);if(t==="relu6")return Yv(e);if(t==="prelu")return Hp(e,n);if(t==="leakyrelu")return Lp(e,s);if(t==="sigmoid")return xo(e);throw new Error(`Unknown fused activation ${t}.`)}const tg=(e,t)=>!(e>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD({x:e,filter:t,strides:n,pad:s,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:u,bias:o,activation:r="linear",preluActivationWeights:l,leakyreluAlpha:h}){if(r=r||"linear",tg(tt.state.gradientDepth,r)===!1){P(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=lr(e,t,n,s,i,a,u);return o!=null&&(C=yt(C,o)),Qp(C,r,l,h)}const c=M(e,"x","conv2d","float32"),f=M(t,"filter","conv2d","float32");let d=c,p=!1;c.rank===3&&(p=!0,d=it(c,[1,c.shape[0],c.shape[1],c.shape[2]])),P(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),P(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),pn("fused conv2d",s,u);const m=i==="NHWC"?d.shape[3]:d.shape[1];P(f.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${f.shape[2]}.`),P(Qe(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const g=Xe(d.shape,f.shape,n,a,s,u);let x;o!=null&&(x=M(o,"bias","fused conv2d"),[x]=Ce(x,c),i==="NHWC"?Bt(g.outShape,x.shape):(P(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),P(x.shape.length===0||x.shape[0]===g.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let b;if(l!=null){const C=l.shape;if(P(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)P(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{Bt(C,g.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(k)}b=M(l,"prelu weights","fused conv2d")}const y=(C,S)=>{P(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[k,T,N,R]=S,L=Jp(C,N,r);P(ar(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const z=Op(T.shape,L,k,n,s),U=Kp(T,L,k.shape,n,s),H=[z,U];if(R!=null){const Y=Zp(R,L);H.push(Y)}return H},v={x:d,filter:f,bias:x,preluActivationWeights:b},w={strides:n,pad:s,dataFormat:i,dilations:a,dimRoundingMode:u,activation:r,leakyreluAlpha:h};return o==null?cr((S,k,T)=>{let N=tt.runKernel(cc,v,w);return T([k,S,N]),p&&(N=it(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:y}})(d,f):cr((S,k,T,N)=>{let R=tt.runKernel(cc,v,w);return N([k,S,R,T]),p&&(R=it(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:y}})(d,f,x)}const aD=et({fusedConv2d_:oD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lD(e,t,n,s,i,a=[1,1],u){let o=e;e.rank===3&&(o=it(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let r=t;r.rank===3&&(r=it(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:o,dy:r},h={strides:s,pad:i,dimRoundingMode:u,dilations:a,filterShape:n};return tt.runKernel(Vd,l,h)}const cD=et({depthwiseConv2dNativeBackpropFilter_:lD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(e,t,n,s,i,a=[1,1],u){let o=t,r=!1;t.rank===3&&(r=!0,o=it(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:o,filter:n},h={strides:s,pad:i,dimRoundingMode:u,dilations:a,inputShape:e},c=tt.runKernel(Ud,l,h);return r?it(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const hD=et({depthwiseConv2dNativeBackpropInput_:uD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD({a:e,b:t,transposeA:n=!1,transposeB:s=!1,bias:i,activation:a="linear",preluActivationWeights:u,leakyreluAlpha:o}){if(tg(tt.state.gradientDepth,a)===!1){let R=jt(e,t,n,s);return i!=null&&(R=yt(R,i)),Qp(R,a,u,o)}let r=M(e,"a","fused matMul"),l=M(t,"b","fused matMul");[r,l]=Ce(r,l);const h=n?r.shape[r.rank-2]:r.shape[r.rank-1],c=s?l.shape[l.rank-1]:l.shape[l.rank-2],f=n?r.shape[r.rank-1]:r.shape[r.rank-2],d=s?l.shape[l.rank-2]:l.shape[l.rank-1],p=r.shape.slice(0,-2),m=l.shape.slice(0,-2),g=pt(p),x=pt(m);P(h===c,()=>`Error in fused matMul: inner shapes (${h}) and (${c}) of Tensors with shapes ${r.shape} and ${l.shape} and transposeA=${n} and transposeB=${s} must match.`);const y=Bt(r.shape.slice(0,-2),l.shape.slice(0,-2)).concat([f,d]),v=n?it(r,[g,h,f]):it(r,[g,f,h]),w=s?it(l,[x,d,c]):it(l,[x,c,d]);let C;i!=null&&(C=M(i,"bias","fused matMul"),[C]=Ce(C,r),Bt(y,C.shape));let S;u!=null&&(S=M(u,"prelu weights","fused matMul"));const k=(R,L)=>{const[z,U,H,Y]=L,Q=Jp(it(R,H.shape),H,a);let K,I;if(!n&&!s?(K=jt(Q,U,!1,!0),I=jt(z,Q,!0,!1)):!n&&s?(K=jt(Q,U,!1,!1),I=jt(Q,z,!0,!1)):n&&!s?(K=jt(U,Q,!1,!0),I=jt(z,Q,!1,!1)):(K=jt(U,Q,!0,!0),I=jt(Q,z,!0,!0)),i!=null){const A=Zp(Y,Q);return[K,I,A]}else return[K,I]},T={a:v,b:w,bias:C,preluActivationWeights:S},N={transposeA:n,transposeB:s,activation:a,leakyreluAlpha:o};return i==null?cr((L,z,U)=>{const H=tt.runKernel(lc,T,N);return U([L,z,H]),{value:it(H,y),gradFunc:k}})(v,w):cr((L,z,U,H)=>{const Y=tt.runKernel(lc,T,N);return H([L,z,Y,U]),{value:it(Y,y),gradFunc:k}})(v,w,C)}const gx=et({fusedMatMul_:fD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dD(e){return ay(e,.54,.46)}const g8=et({hammingWindow_:dD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pD(e){return ay(e,.5,.5)}const gD=et({hannWindow_:pD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(e,t,n,s=!1,i=0){let a=0;const u=[];for(;a+t<=e.size;)u.push(ne(e,a,t)),a+=n;if(s)for(;a<e.size;){const o=a+t-e.size,r=we([ne(e,a,t-o),Ju([o],i)]);u.push(r),a+=n}return u.length===0?Ql([],[0,t]):it(we(u),[u.length,t])}const xD=et({frame_:mD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(e,t,n,s,i=gD){s==null&&(s=iD(t));const a=xD(e,t,n),u=Z(a,i(t));return ny(u,s)}const m8=et({stft_:bD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(e,t,n,s,i="bilinear",a=0){const u=M(e,"image","cropAndResize"),o=M(t,"boxes","cropAndResize","float32"),r=M(n,"boxInd","cropAndResize","int32"),l=o.shape[0];P(u.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${u.rank}.`),P(o.rank===2&&o.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${o.shape}.`),P(r.rank===1&&r.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${o.shape}.`),P(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),P(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),P(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const h={image:u,boxes:o,boxInd:r},c={method:i,extrapolationValue:a,cropSize:s};return tt.runKernel(zd,h,c)}const yD=et({cropAndResize_:vD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(e){const t=M(e,"image","flipLeftRight","float32");P(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return tt.runKernel(Xd,n,{})}const CD=et({flipLeftRight_:wD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(e){const t=M(e,"image","grayscaleToRGB"),n=t.rank-1,s=t.shape[n];P(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),P(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,hs(t,i)}const kD=et({grayscaleToRGB_:SD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ID(e,t,n=0,s=.5){const i=M(e,"image","rotateWithOffset","float32");P(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const a={image:i},u={radians:t,fillValue:n,center:s};return tt.runKernel(bp,a,u)}const TD=et({rotateWithOffset_:ID});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yo(e,t,n,s,i,a){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),a==null&&(a=0);const u=e.shape[0];return n=Math.min(n,u),P(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),P(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),P(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),P(t.rank===1,()=>"scores must be a 1D tensor"),P(t.shape[0]===u,()=>`scores has incompatible shape with boxes. Expected ${u}, but was ${t.shape[0]}`),P(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY){const a=M(e,"boxes","nonMaxSuppression","float32"),u=M(t,"scores","nonMaxSuppression","float32"),o=yo(a,u,n,s,i);n=o.maxOutputSize,s=o.iouThreshold,i=o.scoreThreshold;const r={maxOutputSize:n,iouThreshold:s,scoreThreshold:i};return tt.runKernel(Qd,{boxes:a,scores:u},r)}const $D=et({nonMaxSuppression_:_D});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(e,t,n){const s=ND(e,t,n),i=s<0?-(s+1):s;e.splice(i,0,t)}function ND(e,t,n){return AD(e,t,n||DD)}function DD(e,t){return e>t?1:e<t?-1:0}function AD(e,t,n){let s=0,i=e.length,a=0,u=!1;for(;s<i;){a=s+(i-s>>>1);const o=n(t,e[a]);o>0?s=a+1:(i=a,u=!o)}return u?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eg(e,t,n,s,i){return ig(e,t,n,s,i,0)}function ng(e,t,n,s,i,a){return ig(e,t,n,s,i,0,!1,a,!0)}function sg(e,t,n,s,i,a){return ig(e,t,n,s,i,a,!0)}function ig(e,t,n,s,i,a,u=!1,o=!1,r=!1){const l=[];for(let g=0;g<t.length;g++)t[g]>i&&l.push({score:t[g],boxIndex:g,suppressBeginIndex:0});l.sort(mx);const h=a>0?-.5/a:0,c=[],f=[];for(;c.length<n&&l.length>0;){const g=l.pop(),{score:x,boxIndex:b,suppressBeginIndex:y}=g;if(x<i)break;let v=!1;for(let w=c.length-1;w>=y;--w){const C=RD(e,b,c[w]);if(C>=s){v=!0;break}if(g.score=g.score*OD(s,h,C),g.score<=i)break}g.suppressBeginIndex=c.length,v||(g.score===x?(c.push(b),f.push(g.score)):g.score>i&&ED(l,g,mx))}const d=c.length,p=n-d;o&&p>0&&(c.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const m={selectedIndices:c};return u&&(m.selectedScores=f),r&&(m.validOutputs=d),m}function RD(e,t,n){const s=e.subarray(t*4,t*4+4),i=e.subarray(n*4,n*4+4),a=Math.min(s[0],s[2]),u=Math.min(s[1],s[3]),o=Math.max(s[0],s[2]),r=Math.max(s[1],s[3]),l=Math.min(i[0],i[2]),h=Math.min(i[1],i[3]),c=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(o-a)*(r-u),p=(c-l)*(f-h);if(d<=0||p<=0)return 0;const m=Math.max(a,l),g=Math.max(u,h),x=Math.min(o,c),b=Math.min(r,f),y=Math.max(x-m,0)*Math.max(b-g,0);return y/(d+p-y)}function OD(e,t,n){const s=Math.exp(t*n*n);return n<=e?s:0}function mx(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function FD(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY){const a=M(e,"boxes","nonMaxSuppressionAsync"),u=M(t,"scores","nonMaxSuppressionAsync"),o=yo(a,u,n,s,i);n=o.maxOutputSize,s=o.iouThreshold,i=o.scoreThreshold;const r=await Promise.all([a.data(),u.data()]),l=r[0],h=r[1],{selectedIndices:c}=eg(l,h,n,s,i);return a!==e&&a.dispose(),u!==t&&u.dispose(),wn(c,"int32")}const PD=FD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY,a=0){const u=M(e,"boxes","nonMaxSuppression"),o=M(t,"scores","nonMaxSuppression"),r=yo(u,o,n,s,i,a);n=r.maxOutputSize,s=r.iouThreshold,i=r.scoreThreshold,a=r.softNmsSigma;const l={boxes:u,scores:o},h={maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:a},c=tt.runKernel(ep,l,h);return{selectedIndices:c[0],selectedScores:c[1]}}const LD=et({nonMaxSuppressionWithScore_:MD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function BD(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY,a=0){const u=M(e,"boxes","nonMaxSuppressionAsync"),o=M(t,"scores","nonMaxSuppressionAsync"),r=yo(u,o,n,s,i,a);n=r.maxOutputSize,s=r.iouThreshold,i=r.scoreThreshold,a=r.softNmsSigma;const l=await Promise.all([u.data(),o.data()]),h=l[0],c=l[1],{selectedIndices:f,selectedScores:d}=sg(h,c,n,s,i,a);return u!==e&&u.dispose(),o!==t&&o.dispose(),{selectedIndices:wn(f,"int32"),selectedScores:wn(d)}}const zD=BD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WD(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY,a=!1){const u=M(e,"boxes","nonMaxSuppression"),o=M(t,"scores","nonMaxSuppression"),r=yo(u,o,n,s,i,null),l=r.maxOutputSize,h=r.iouThreshold,c=r.scoreThreshold,f={boxes:u,scores:o},d={maxOutputSize:l,iouThreshold:h,scoreThreshold:c,padToMaxOutputSize:a},p=tt.runKernel(tp,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}const VD=et({nonMaxSuppressionPadded_:WD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function UD(e,t,n,s=.5,i=Number.NEGATIVE_INFINITY,a=!1){const u=M(e,"boxes","nonMaxSuppressionAsync"),o=M(t,"scores","nonMaxSuppressionAsync"),r=yo(u,o,n,s,i,null),l=r.maxOutputSize,h=r.iouThreshold,c=r.scoreThreshold,[f,d]=await Promise.all([u.data(),o.data()]),{selectedIndices:p,validOutputs:m}=ng(f,d,l,h,c,a);return u!==e&&u.dispose(),o!==t&&o.dispose(),{selectedIndices:wn(p,"int32"),validOutputs:Pt(m,"int32")}}const GD=UD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(e,t,n=!1,s=!1){const i=M(e,"images","resizeBilinear");P(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),P(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),P(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=i,u=!1;i.rank===3&&(u=!0,a=it(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const o={images:a},r={alignCorners:n,halfPixelCenters:s,size:t},l=tt.runKernel(Ou,o,r);return u?it(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const ly=et({resizeBilinear_:HD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jD(e,t,n=!1,s=!1){const i=M(e,"images","resizeNearestNeighbor");P(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),P(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),P(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),P(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=i,u=!1;i.rank===3&&(u=!0,a=it(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const o={images:a},r={alignCorners:n,halfPixelCenters:s,size:t},l=tt.runKernel(Ru,o,r);return u?it(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const cy=et({resizeNearestNeighbor_:jD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(e,t="binary",n=!1,s=.5){const i=M(e,"image","threshold"),a=.2989,u=.587,o=.114,r=i.shape[0]*i.shape[1];let l=Z(wn([s]),255),h,c,f,d;if(P(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),P(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),P(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),P(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),i.shape[2]===3){[h,c,f]=An(i,[1,1,1],-1);const g=Z(h,a),x=Z(c,u),b=Z(f,o);d=yt(yt(g,x),b)}else d=e;if(t==="otsu"){const g=r$(St(qv(d),"int32"),b_([]),256);l=YD(g,r)}const p=n?vo(d,l):Qn(d,l);return St(Z(p,255),"int32")}function YD(e,t){let n=wn([-1]),s=wn([0]),i=wn([0]),a,u,o,r,l,h;for(let c=0;c<e.size-1;c++){a=ne(e,0,c+1),u=ne(e,c+1),l=Nt(Et(a),t),h=Nt(Et(u),t);const f=Et(Z(a,no(0,a.size)));o=Nt(f,Et(a));const d=Ju(u.shape,a.size),p=yt(no(0,u.size),d),m=Z(u,p);r=Nt(Et(m),Et(u));const g=Tt(o,r),x=Tt(o,r),b=Z(l,h);i=Z(Z(b,g),x);const y=Qn(i,s);s=kn(y,i,s),n=kn(y,wn([c]),n)}return n}const qD=et({threshold_:XD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(e,t,n="nearest",s="constant",i=0,a){const u=M(e,"image","transform","float32"),o=M(t,"transforms","transform","float32");P(u.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${u.rank}.`),P(o.rank===2&&(o.shape[0]===u.shape[0]||o.shape[0]===1)&&o.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),P(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const r={image:u,transforms:o},l={interpolation:n,fillMode:s,fillValue:i,outputShape:a};return tt.runKernel(mp,r,l)}const JD=et({transform_:KD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZD(e,t,n){P(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),P(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const s=M(e,"a","bandPart");P(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[a,u]=s.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=u))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${u}).`);t<0&&(t=a),n<0&&(n=u);const o=it(no(0,a,1,"int32"),[-1,1]),r=no(0,u,1,"int32"),l=Tt(o,r),h=Xs(vo(l,Pt(+t,"int32")),bo(l,Pt(-n,"int32"))),c=ae([a,u],s.dtype);return it(hr(so(it(s,[-1,a,u])).map(f=>kn(h,f,c))),i)}const QD=et({bandPart_:ZD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(e){let t;if(Array.isArray(e)){t=!1,P(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=e[0].shape[0];for(let a=1;a<e.length;++a)P(e[a].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[a].shape[0]} vs. ${i})`)}else t=!0,e=An(e,e.shape[0],0).map(i=>ul(i,[0]));P(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],s=e;for(let i=0;i<e.length;++i)n.push(tt.tidy(()=>{let a=s[i];if(i>0)for(let u=0;u<i;++u){const o=Z(Et(Z(n[u],a)),n[u]);a=Tt(a,o)}return Nt(a,Ku(a,"euclidean"))}));return t?hr(n,0):n}const eA=et({gramSchmidt_:tA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(e,t=!1){if(P(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return xx(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((r,l)=>r*l),s=so(it(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];s.forEach(r=>{const[l,h]=xx(r,t);i.push(l),a.push(h)});const u=it(hr(i,0),e.shape),o=it(hr(a,0),e.shape);return[u,o]}}function xx(e,t=!1){return tt.tidy(()=>{P(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],s=e.shape[1];let i=Ov(n),a=Zi(e);const u=Ql([[1]],[1,1]);let o=Zi(u);const r=n>=s?s:n;for(let l=0;l<r;++l){const h=a,c=o,f=i;[o,a,i]=tt.tidy(()=>{const d=ne(a,[l,l],[n-l,1]),p=Ku(d),m=ne(a,[l,l],[1,1]),g=kn(Qn(m,0),Ql([[-1]]),Ql([[1]])),x=Tt(m,Z(g,p)),b=Nt(d,x);b.shape[0]===1?o=Zi(u):o=we([u,ne(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const y=xe(Nt(jt(g,x),p)),v=ne(a,[l,0],[n-l,s]),w=Z(y,o),C=Xt(o);if(l===0)a=Tt(v,jt(w,jt(C,v)));else{const T=Tt(v,jt(w,jt(C,v)));a=we([ne(a,[0,0],[l,s]),T],0)}const S=Xt(w),k=ne(i,[0,l],[n,i.shape[1]-l]);if(l===0)i=Tt(k,jt(jt(k,o),S));else{const T=Tt(k,jt(jt(k,o),S));i=we([ne(i,[0,0],[n,l]),T],1)}return[o,a,i]}),Lt([h,c,f])}return!t&&n>s&&(i=ne(i,[0,0],[n,s]),a=ne(a,[0,0],[s,s])),[i,a]})}const sA=et({qr_:nA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hn;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(hn||(hn={}));function iA(e,t,n=hn.SUM_BY_NONZERO_WEIGHTS){const s=M(e,"losses","computeWeightedLoss");let i=null;t!=null&&(i=M(t,"weights","computeWeightedLoss"));const a=i==null?s:Z(s,i);if(n===hn.NONE)return a;if(n===hn.SUM)return Et(a);if(n===hn.MEAN){if(i==null)return ye(a);{const u=s.size/i.size,o=Nt(Et(a),Et(i));return u>1?Nt(o,Pt(u)):o}}if(n===hn.SUM_BY_NONZERO_WEIGHTS){if(i==null)return Nt(Et(a),Pt(s.size));{const u=Z(i,yn(s.shape)),o=St(Et(Zo(u,Pt(0))),"float32");return Nt(Et(a),o)}}throw Error(`Unknown reduction: ${n}`)}const Ti=et({computeWeightedLoss_:iA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(e,t,n,s=hn.SUM_BY_NONZERO_WEIGHTS){const i=M(e,"labels","absoluteDifference"),a=M(t,"predictions","absoluteDifference");let u=null;n!=null&&(u=M(n,"weights","absoluteDifference")),Jn(i.shape,a.shape,"Error in absoluteDifference: ");const o=Le(Tt(i,a));return Ti(o,u,s)}const x8=et({absoluteDifference_:rA});function oA(e,t,n,s,i=hn.SUM_BY_NONZERO_WEIGHTS){const a=M(e,"labels","cosineDistance"),u=M(t,"predictions","cosineDistance");let o=null;s!=null&&(o=M(s,"weights","cosineDistance")),Jn(a.shape,u.shape,"Error in cosineDistance: ");const r=Pt(1),l=Tt(r,Et(Z(a,u),n,!0));return Ti(l,o,i)}const b8=et({cosineDistance_:oA});function aA(e,t,n,s=hn.SUM_BY_NONZERO_WEIGHTS){let i=M(e,"labels","hingeLoss");const a=M(t,"predictions","hingeLoss");let u=null;n!=null&&(u=M(n,"weights","hingeLoss")),Jn(i.shape,a.shape,"Error in hingeLoss: ");const o=Pt(1);i=Tt(Z(Pt(2),i),o);const r=Zs(Tt(o,Z(i,a)));return Ti(r,u,s)}const v8=et({hingeLoss_:aA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(e,t,n,s=1,i=hn.SUM_BY_NONZERO_WEIGHTS){const a=M(e,"labels","huberLoss"),u=M(t,"predictions","huberLoss");let o=null;n!=null&&(o=M(n,"weights","huberLoss")),Jn(a.shape,u.shape,"Error in huberLoss: ");const r=Pt(s),l=Le(Tt(u,a)),h=tr(l,r),c=Tt(l,h),f=yt(Z(Pt(.5),le(h)),Z(r,c));return Ti(f,o,i)}const y8=et({huberLoss_:lA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(e,t,n,s=1e-7,i=hn.SUM_BY_NONZERO_WEIGHTS){const a=M(e,"labels","logLoss"),u=M(t,"predictions","logLoss");let o=null;n!=null&&(o=M(n,"weights","logLoss")),Jn(a.shape,u.shape,"Error in logLoss: ");const r=Pt(1),l=Pt(s),h=xe(Z(a,qn(yt(u,l)))),c=Z(Tt(r,a),qn(yt(Tt(r,u),l))),f=Tt(h,c);return Ti(f,o,i)}const w8=et({logLoss_:cA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(e,t,n,s=hn.SUM_BY_NONZERO_WEIGHTS){const i=M(e,"labels","meanSquaredError"),a=M(t,"predictions","meanSquaredError");let u=null;n!=null&&(u=M(n,"weights","meanSquaredError")),Jn(i.shape,a.shape,"Error in meanSquaredError: ");const o=sy(i,a);return Ti(o,u,s)}const C8=et({meanSquaredError_:uA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA(e,t){const n=M(e,"labels","sigmoidCrossEntropyWithLogits"),s=M(t,"logits","sigmoidCrossEntropyWithLogits");Jn(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Zs(s),a=Z(s,n),u=Bp(Yn(xe(Le(s))));return yt(Tt(i,a),u)}function fA(e,t,n,s=0,i=hn.SUM_BY_NONZERO_WEIGHTS){let a=M(e,"multiClassLabels","sigmoidCrossEntropy");const u=M(t,"logits","sigmoidCrossEntropy");let o=null;if(n!=null&&(o=M(n,"weights","sigmoidCrossEntropy")),Jn(a.shape,u.shape,"Error in sigmoidCrossEntropy: "),s>0){const l=Pt(s),h=Pt(1),c=Pt(.5);a=yt(Z(a,Tt(h,l)),Z(c,l))}const r=hA(a,u);return Ti(r,o,i)}const S8=et({sigmoidCrossEntropy_:fA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return cr((i,a,u)=>{const r=Mv(a,[n],!0),l=Tt(St(a,"float32"),r);u([i,l]);const h=xe(Z(l,i));return{value:Et(h,[n]),gradFunc:(d,p)=>{const[m,g]=p,x=Se(d.shape,[n]);return[Z(it(d,x),Tt(St(m,"float32"),Yn(g))),Z(it(d,x),Tt(Yn(g),St(m,"float32")))]}}})(e,t)}function pA(e,t,n,s=0,i=hn.SUM_BY_NONZERO_WEIGHTS){let a=M(e,"onehotLabels","softmaxCrossEntropy");const u=M(t,"logits","softmaxCrossEntropy");let o=null;if(n!=null&&(o=M(n,"weights","softmaxCrossEntropy")),Jn(a.shape,u.shape,"Error in softmaxCrossEntropy: "),s>0){const l=Pt(s),h=Pt(1),c=Pt(a.shape[1]);a=yt(Z(a,Tt(h,l)),Nt(l,c))}const r=dA(a,u);return Ti(r,o,i)}const k8=et({softmaxCrossEntropy_:pA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(e,t,n,s){const i=M(e,"indices","sparseFillEmptyRows","int32"),a=M(t,"values","sparseFillEmptyRows"),u=M(n,"denseShape","sparseFillEmptyRows","int32"),o=M(s,"defaultValue","sparseFillEmptyRows",a.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(a.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(u.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${u.shape}`);if(o.rank!==0)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const r={indices:i,values:a,denseShape:u,defaultValue:o},l=tt.runKernel(op,r);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const I8=et({sparseFillEmptyRows_:gA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(e,t,n){const s=M(e,"inputIndices","sparseReshape","int32"),i=M(t,"inputShape","sparseReshape","int32"),a=M(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(a.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const u={inputIndices:s,inputShape:i,newShape:a},o=tt.runKernel(ap,u);return{outputIndices:o[0],outputShape:o[1]}}const T8=et({sparseReshape_:mA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(e,t,n){const s=M(e,"data","sparseSegmentMean"),i=M(t,"indices","sparseSegmentMean","int32"),a=M(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${a.shape}`);const u={data:s,indices:i,segmentIds:a};return tt.runKernel(lp,u)}const _8=et({sparseSegmentMean_:xA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(e,t,n){const s=M(e,"data","sparseSegmentSum"),i=M(t,"indices","sparseSegmentSum","int32"),a=M(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${a.shape}`);const u={data:s,indices:i,segmentIds:a};return tt.runKernel(cp,u)}const $8=et({sparseSegmentSum_:bA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vA(e,t,n,s,i,a,u,o){const r=M(e,"data","stringNGrams","string");if(r.dtype!=="string")throw new Error("Data must be of datatype string");if(r.shape.length!==1)throw new Error(`Data must be a vector, saw: ${r.shape}`);const l=M(t,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const h={separator:n,nGramWidths:s,leftPad:i,rightPad:a,padWidth:u,preserveShortSequences:o},c={data:r,dataSplits:l},f=tt.runKernel(fp,c,h);return{nGrams:f[0],nGramsSplits:f[1]}}const E8=et({stringNGrams_:vA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(e,t,n=!0){const s=M(e,"input","stringSplit","string"),i=M(t,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const a={skipEmpty:n},u={input:s,delimiter:i},o=tt.runKernel(dp,u,a);return{indices:o[0],values:o[1],shape:o[2]}}const N8=et({stringSplit_:yA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(e,t){const n=M(e,"input","stringToHashBucketFast","string"),s={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return tt.runKernel(pp,i,s)}const D8=et({stringToHashBucketFast_:wA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pl={flipLeftRight:CD,grayscaleToRGB:kD,resizeNearestNeighbor:cy,resizeBilinear:ly,rotateWithOffset:TD,cropAndResize:yD,nonMaxSuppression:$D,nonMaxSuppressionAsync:PD,nonMaxSuppressionWithScore:LD,nonMaxSuppressionWithScoreAsync:zD,nonMaxSuppressionPadded:VD,nonMaxSuppressionPaddedAsync:GD,threshold:qD,transform:JD},CA={bandPart:QD,gramSchmidt:eA,qr:sA};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _i extends mo{minimize(t,n=!1,s){const{value:i,grads:a}=this.computeGradients(t,s);if(s!=null){const u=s.map(o=>({name:o.name,tensor:a[o.name]}));this.applyGradients(u)}else this.applyGradients(a);return Lt(a),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return kE(t,n)}dispose(){this.iterations_!=null&&Lt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Pt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(_i,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rg extends _i{constructor(t,n,s=null){super(),this.learningRate=t,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=tt.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const a=tt.registeredVariables[s],u=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accum_grad`,variable:lt(()=>Yt(a).variable(u))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${s}/accum_var`,variable:lt(()=>Yt(a).variable(u))});const o=Array.isArray(t)?t[i].tensor:t[s];if(o==null)return;const r=this.accumulatedGrads[i].variable,l=this.accumulatedUpdates[i].variable;lt(()=>{const h=yt(Z(r,this.rho),Z(le(o),1-this.rho)),c=Z(Nt(rn(yt(l,this.epsilon)),rn(yt(r,this.epsilon))),o),f=yt(Z(l,this.rho),Z(le(c),1-this.rho));r.assign(h),l.assign(f);const d=yt(Z(c,-this.learningRate),a);a.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Lt(this.accumulatedGrads.map(t=>t.variable)),Lt(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedUpdates=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}rg.className="Adadelta";bt(rg);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class og extends _i{constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const a=tt.registeredVariables[s];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accumulator`,variable:lt(()=>Ju(a.shape,this.initialAccumulatorValue).variable(!1))});const u=Array.isArray(t)?t[i].tensor:t[s];if(u==null)return;const o=this.accumulatedGrads[i].variable;lt(()=>{const r=yt(o,le(u));o.assign(r);const l=yt(Z(Nt(u,rn(yt(r,tt.backend.epsilon()))),-this.learningRate),a);a.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Lt(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}og.className="Adagrad";bt(og);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ag extends _i{constructor(t,n,s,i=null){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],lt(()=>{this.accBeta1=Pt(n).variable(),this.accBeta2=Pt(s).variable()}),i==null&&(this.epsilon=tt.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);lt(()=>{const s=Tt(1,this.accBeta1),i=Tt(1,this.accBeta2);n.forEach((a,u)=>{const o=tt.registeredVariables[a],r=!1;this.accumulatedFirstMoment[u]==null&&(this.accumulatedFirstMoment[u]={originalName:`${a}/m`,variable:lt(()=>Yt(o).variable(r))}),this.accumulatedSecondMoment[u]==null&&(this.accumulatedSecondMoment[u]={originalName:`${a}/v`,variable:lt(()=>Yt(o).variable(r))});const l=Array.isArray(t)?t[u].tensor:t[a];if(l==null)return;const h=this.accumulatedFirstMoment[u].variable,c=this.accumulatedSecondMoment[u].variable,f=yt(Z(h,this.beta1),Z(l,1-this.beta1)),d=yt(Z(c,this.beta2),Z(le(l),1-this.beta2)),p=Nt(f,s),m=Nt(d,i);h.assign(f),c.assign(d);const g=yt(Z(Nt(p,yt(rn(m),this.epsilon)),-this.learningRate),o);o.assign(g)}),this.accBeta1.assign(Z(this.accBeta1,this.beta1)),this.accBeta2.assign(Z(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Lt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&Lt(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),lt(()=>{this.accBeta1.assign(eo(this.beta1,this.iterations_+1)),this.accBeta2.assign(eo(this.beta2,this.iterations_+1))});const n=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}ag.className="Adam";bt(ag);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lg extends _i{constructor(t,n,s,i=null,a=0){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=i,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],lt(()=>{this.iteration=Pt(0).variable(),this.accBeta1=Pt(n).variable()}),i==null&&(this.epsilon=tt.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);lt(()=>{const s=Tt(1,this.accBeta1),i=Nt(-this.learningRate,yt(Z(this.iteration,this.decay),1));n.forEach((a,u)=>{const o=tt.registeredVariables[a],r=!1;this.accumulatedFirstMoment[u]==null&&(this.accumulatedFirstMoment[u]={originalName:`${a}/m`,variable:Yt(o).variable(r)}),this.accumulatedWeightedInfNorm[u]==null&&(this.accumulatedWeightedInfNorm[u]={originalName:`${a}/v`,variable:Yt(o).variable(r)});const l=Array.isArray(t)?t[u].tensor:t[a];if(l==null)return;const h=this.accumulatedFirstMoment[u].variable,c=this.accumulatedWeightedInfNorm[u].variable,f=yt(Z(h,this.beta1),Z(l,1-this.beta1)),d=Z(c,this.beta2),p=Le(l),m=Ii(d,p);h.assign(f),c.assign(m);const g=yt(Z(Nt(i,s),Nt(f,yt(m,this.epsilon))),o);o.assign(g)}),this.iteration.assign(yt(this.iteration,1)),this.accBeta1.assign(Z(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Lt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&Lt(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}lg.className="Adamax";bt(lg);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class th extends _i{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const a=Array.isArray(t)?t[i].tensor:t[s];if(a==null)return;const u=tt.registeredVariables[s];lt(()=>{const o=yt(Z(this.c,a),u);u.assign(o)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=ms(Pt(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}th.className="SGD";bt(th);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cg extends th{constructor(t,n,s=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Pt(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const a=tt.registeredVariables[s];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${s}/momentum`,variable:lt(()=>Yt(a).variable(!1))});const u=this.accumulations[i].variable,o=Array.isArray(t)?t[i].tensor:t[s];o!=null&&lt(()=>{let r;const l=yt(Z(this.m,u),o);this.useNesterov?r=yt(Z(this.c,yt(o,Z(l,this.m))),a):r=yt(Z(this.c,l),a),u.assign(l),a.assign(r)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Lt(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}cg.className="Momentum";bt(cg);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ug extends _i{constructor(t,n=.9,s=0,i=null,a=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=s,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,i==null&&(this.epsilon=tt.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const a=tt.registeredVariables[s],u=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${s}/rms`,variable:lt(()=>Yt(a).variable(u))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${s}/momentum`,variable:lt(()=>Yt(a).variable(u))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${s}/mg`,variable:lt(()=>Yt(a).variable(u))});const o=Array.isArray(t)?t[i].tensor:t[s];if(o==null)return;const r=this.accumulatedMeanSquares[i].variable,l=this.accumulatedMoments[i].variable;lt(()=>{const h=yt(Z(r,this.decay),Z(le(o),1-this.decay));if(this.centered){const c=this.accumulatedMeanGrads[i].variable,f=yt(Z(c,this.decay),Z(o,1-this.decay)),d=Nt(Z(o,this.learningRate),rn(Tt(h,yt(le(f),this.epsilon)))),p=yt(Z(l,this.momentum),d);r.assign(h),c.assign(f),l.assign(p);const m=Tt(a,p);a.assign(m)}else{const c=yt(Z(r,this.decay),Z(le(o),1-this.decay)),f=yt(Z(l,this.momentum),Nt(Z(o,this.learningRate),rn(yt(c,this.epsilon))));r.assign(c),l.assign(f);const d=Tt(a,f);a.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Lt(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Lt(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&Lt(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedMoments=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}ug.className="RMSProp";bt(ug);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oi{static sgd(t){return new th(t)}static momentum(t,n,s=!1){return new cg(t,n,s)}static rmsprop(t,n=.9,s=0,i=null,a=!1){return new ug(t,n,s,i,a)}static adam(t=.001,n=.9,s=.999,i=null){return new ag(t,n,s,i)}static adadelta(t=.001,n=.95,s=null){return new rg(t,n,s)}static adamax(t=.002,n=.9,s=.999,i=null,a=0){return new lg(t,n,s,i,a)}static adagrad(t,n=.1){return new og(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tr={sgd:Oi.sgd,momentum:Oi.momentum,adadelta:Oi.adadelta,adagrad:Oi.adagrad,rmsprop:Oi.rmsprop,adamax:Oi.adamax,adam:Oi.adam};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SA=(()=>typeof requestAnimationFrame!="undefined"?requestAnimationFrame:typeof setImmediate!="undefined"?setImmediate:e=>e())();function uy(){return new Promise(e=>SA(()=>e()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hg(e,t){const n=e[0].length;e.forEach((i,a)=>{P(i.length===n,()=>`Error in concat${n}D: rank of tensors[${a}] must be the same as the rank of the rest (${n})`)}),P(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=e[0];e.forEach((i,a)=>{for(let u=0;u<n;u++)P(u===t||i[u]===s[u],()=>`Error in concat${n}D: Shape of tensors[${a}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${a}.`)})}function Fs(e,t){const n=e[0].slice();for(let s=1;s<e.length;s++)n[t]+=e[s][t];return n}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fg=30;function eh(e){return e<=fg?e:vf(e,Math.floor(Math.sqrt(e)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dg(e,t,n){const s=n*(typeof e=="number"?e:e[0]),i=t*(typeof e=="number"?e:e[1]);return[s,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fl(e,t,n,s=!0){let i=[];if(s)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const a=t.length;for(let u=0;u<a;++u)i=i.concat([e[u+1]/t[u],t[u]]);i=i.concat(e.slice(a+1))}return i}function dl(e,t,n=!0){const s=[];if(n){s.push(t);for(let i=t+1;i<e;++i)i<=2*t?(s.push(i),s.push(i-(t+1))):s.push(i)}else{const i=[],a=[];for(let u=1;u<e;++u)u>=t*2+1||u%2===1?a.push(u):i.push(u);s.push(...i),s.push(0),s.push(...a)}return s}function pl(e,t,n,s=!0){const i=[];s?i.push(e[0]/n):i.push(e[0]*n);for(let a=1;a<e.length;++a)a<=t.length?s?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function pg(e,t){const n=[0];for(let s=0;s<t;++s)n.push(e[s][0]);return n}function gg(e,t,n){const s=e.slice(0,1);for(let i=0;i<n;++i)s.push(e[i+1]-t[i][0]-t[i][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nh=1.7580993408473768,sh=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mg=.3275911,xg=.254829592,bg=-.284496736,vg=1.421413741,yg=-1.453152027,wg=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ys(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(e.length*2);for(let s=0;s<n.length;s+=2)n[s]=e[s/2],n[s+1]=t[s/2];return n}function hy(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s/2]=e[s],n[s/2]=e[s+1];return{real:t,imag:n}}function fy(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],s[Math.floor(i/4)]=e[i+1];return{real:n,imag:s}}function dy(e){const t=Math.floor(e.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],s[Math.floor(i/4)]=e[i+1];return{real:n,imag:s}}function Cg(e,t){const n=e[t*2],s=e[t*2+1];return{real:n,imag:s}}function py(e,t,n,s){e[s*2]=t,e[s*2+1]=n}function gy(e,t){const n=new Float32Array(e/2),s=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),s[i]=Math.sin(a)}return{real:n,imag:s}}function my(e,t,n){const s=(n?2:-2)*Math.PI*(e/t),i=Math.cos(s),a=Math.sin(s);return{real:i,imag:a}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mh="->",kA=/->/g,bx=",",vx="...";function Sg(e,t){e=e.replace(/\s/g,"");const n=(e.length-e.replace(kA,"").length)/Mh.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Mh}").`);const[s,i]=e.split(Mh);P(s.indexOf(vx)===-1,()=>`The ellipsis notation ("${vx}") is not supported yet.`);const a=s.split(bx),u=a.length;if(t!==u)throw new Error(`Expected ${u} input tensors, received ${t}`);if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let f=0;f<i.length;++f){const d=i[f];if(!a.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);o.indexOf(d)===-1&&o.push(d)}for(let f=0;f<s.length;++f){const d=s[f];o.indexOf(d)===-1&&d!==bx&&o.push(d)}const r=new Array(a.length);for(let f=0;f<u;++f){if(new Set(a[f].split("")).size!==a[f].length)throw new Error(`Found duplicate axes in input component ${a[f]}. Support for duplicate axes in input is not implemented yet.`);r[f]=[];for(let d=0;d<a[f].length;++d)r[f].push(o.indexOf(a[f][d]))}const l=o.length,h=i.length,c=[];for(let f=h;f<l;++f)c.push(f);return{allDims:o,summedDims:c,idDims:r}}function kg(e,t){let n=new Array(e);n.fill(-1);for(let i=0;i<t.length;++i)n[t[i]]=i;const s=[];for(let i=0;i<e;++i)n[i]===-1&&s.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:s}}function Ig(e,t,n){const s=new Array(e);for(let i=0;i<n.length;++i){const a=n[i].shape;for(let u=0;u<t[i].length;++u)s[t[i][u]]===void 0?s[t[i][u]]=a[u]:P(s[t[i][u]]===a[u],()=>`Expected dimension ${s[t[i][u]]} at axis ${u} of input shaped ${JSON.stringify(a)}, but got dimension ${a[u]}`)}}function Tg(e,t){const n=e,s=[];let i=0;e.length===0&&n.push(-1),i=e.length+1;for(let u=0;u<i;++u)s.push([]);const a=[];for(let u=0;u<n.length;++u){const o=n[u],r=IA(t,o);for(const l of r)a.indexOf(l)===-1&&(s[u].push(l),a.push(l))}return{path:n,steps:s}}function _g(e){return e.every((t,n)=>t===n)}function IA(e,t){const n=[];for(let s=0;s<e.length;++s)(e[s].length===0||e[s].indexOf(t)!==-1||t===-1)&&n.push(s);return n}function $g(e,t,n=0){let s=[];if(typeof t=="number")P(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce((u,o)=>(o===-1&&(u+=1),u),0);P(i<=1,()=>"There should be only one negative value in split array.");const a=t.indexOf(-1);if(a!==-1){const u=t.reduce((o,r)=>r>0?o+r:o);t[a]=e.shape[n]-u}P(e.shape[n]===t.reduce((u,o)=>u+o),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xy(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function by(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function vy(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yy(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function wy(e,t){return`size ${e} must be non-negative, not ${t}`}function Cy(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Sy(e,t){const n=pt(e),s=pt(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${e} outputShape= ${t}`}function ky(e,t){const n=pt(e),s=pt(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${e} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vf(){return"segment ids must be >= 0"}function Iy(){return"segment ids are not increasing"}function Ty(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function _y(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $y(e,t){let n=!1,s;for(e<=fg?(s=e,n=!0):s=vf(e,Math.floor(Math.sqrt(e)));!n;)s>t||s===e?n=!0:s=vf(e,s+1);return s}function Ey(e,t,n){const s=[],i=e.length;for(let a=0;a<i;a++)a!==t?s.push(e[a]):s.push(n);return s}function Eg(e,t,n,s){const i=t.shape.length,a=e.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>a)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${a}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let c=0;c<s;++c)if(e.shape[c]!==t.shape[c])throw new Error(`x.shape[${c}]: ${e.shape[c]} should be equal to indices.shape[${c}]: ${t.shape[c]}.`);const u=e.shape[n],o=[];let r=1,l=1,h=1;for(let c=0;c<s;++c)o.push(e.shape[c]),r*=e.shape[c];for(let c=s;c<n;c++)o.push(e.shape[c]),l*=e.shape[c];for(let c=s;c<i;c++)o.push(t.shape[c]);for(let c=n+1;c<a;c++)o.push(e.shape[c]),h*=e.shape[c];return{batchSize:r,sliceSize:h,outerSize:l,dimSize:u,outputShape:o}}var TA=Object.freeze(Object.defineProperty({__proto__:null,segOpComputeOptimalWindowSize:$y,computeOutShape:Ey,collectGatherOpShapeInfo:Eg},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fr(e){try{return e.map(t=>gi(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Ny(e){return e.map(t=>ui(t))}var _A=Object.freeze(Object.defineProperty({__proto__:null,slice_util:f2,segment_util:TA,fromUint8ToStringArray:fr,fromStringArrayToUint8:Ny,upcastType:Cn,axesAreInnerMostDims:Pp,combineLocations:Av,computeOutAndReduceShapes:We,expandShapeToKeepDim:Se,assertAxesAreInnerMostDims:Ye,getAxesPermutation:be,getUndoAxesPermutation:ki,getInnerMostAxes:ke,getBroadcastDims:to,getReductionAxes:Oe,assertAndGetBroadcastShape:Bt,assertParamsConsistent:hg,computeOutShape:Fs,computeDilation2DInfo:ll,computePool2DInfo:Zn,computePool3DInfo:Ks,computeConv2DInfo:Xe,computeConv3DInfo:Si,computeDefaultPad:Np,tupleValuesAreOne:ar,eitherStridesOrDilationsAreOne:Qe,convertConv2DDataFormat:Js,checkPadOnDimRoundingMode:pn,getFusedDyActivation:Jp,getFusedBiasGradient:Zp,applyActivation:Qp,shouldFuse:tg,PARALLELIZE_THRESHOLD:fg,computeOptimalWindowSize:eh,getImageCenter:dg,getReshaped:fl,getPermuted:dl,getReshapedPermuted:pl,getSliceBeginCoords:pg,getSliceSize:gg,prepareAndValidate:kp,validateUpdateShape:mv,validateInput:a2,calculateShapes:al,SELU_SCALEALPHA:nh,SELU_SCALE:sh,ERF_P:mg,ERF_A1:xg,ERF_A2:bg,ERF_A3:vg,ERF_A4:yg,ERF_A5:wg,warn:Nn,log:HT,mergeRealAndImagArrays:Ys,splitRealAndImagArrays:hy,complexWithEvenIndex:fy,complexWithOddIndex:dy,getComplexWithIndex:Cg,assignToTypedArray:py,exponents:gy,exponent:my,decodeEinsumEquation:Sg,getEinsumPermutation:kg,checkEinsumDimSizes:Ig,getEinsumComputePath:Tg,isIdentityPermutation:_g,prepareSplitSize:$g,getSparseFillEmptyRowsIndicesDenseShapeMismatch:xy,getSparseFillEmptyRowsNegativeIndexErrorMessage:by,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:vy,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:yy,getSparseReshapeNegativeOutputDimErrorMessage:wy,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Cy,getSparseReshapeInputOutputMultipleErrorMessage:Sy,getSparseReshapeInputOutputMismatchErrorMessage:ky,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Vf,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Iy,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Ty,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:_y},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dy={kernelName:Hc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,hl(St(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $A={kernelName:ua,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=le(St(n,"float32")),i=rn(Tt(Pt(1),s));return xe(Nt(e,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EA={kernelName:ha,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=rn(Tt(le(St(n,"float32")),1));return Nt(e,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NA={kernelName:go,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{let o=e;const r=Oe(n.shape,i);return r.length>0&&(o=Et(o,r)),it(o,n.shape)},b:()=>{let o=e;const r=Oe(s.shape,i);return r.length>0&&(o=Et(o,r)),it(o,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DA={kernelName:Ed,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((s,i)=>{n[i]=()=>e.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA={kernelName:jc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RA={kernelName:Xc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OA={kernelName:fa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,rn(Tt(Pt(1),le(St(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA={kernelName:da,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=rn(yt(Pt(1),le(St(n,"float32"))));return Nt(e,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PA={kernelName:ma,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{const o=yt(le(n),le(s));let r=Z(e,Nt(s,o));const l=Oe(n.shape,i);return l.length>0&&(r=Et(r,l)),it(r,n.shape)},b:()=>{const o=yt(le(n),le(s));let r=xe(Z(e,Nt(n,o)));const l=Oe(s.shape,i);return l.length>0&&(r=Et(r,l)),it(r,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MA={kernelName:pa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,yt(le(St(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LA={kernelName:ga,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,Tt(Pt(1),le(St(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BA(e,t,n,s,i,a){const u=M(e,"dy","avgPool3dGrad"),o=M(t,"input","avgPool3dGrad");let r=u,l=o,h=!1;o.rank===4&&(h=!0,r=it(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),l=it(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),P(r.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${r.rank}.`),P(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),pn("avgPool3dGrad",i,a);const c={dy:r,input:l},f={filterSize:n,strides:s,pad:i,dimRoundingMode:a},d=tt.runKernel(Rd,c,f);return h?it(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const zA=et({avgPool3dGrad_:BA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WA={kernelName:qc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{filterSize:i,strides:a,pad:u,dimRoundingMode:o}=n;return{x:()=>zA(e,s,i,a,u,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(e,t,n,s,i){const a=M(e,"dy","avgPoolGrad"),u=M(t,"input","avgPoolGrad");P(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`);let o=u,r=a,l=!1;u.rank===3&&(l=!0,o=it(u,[1,u.shape[0],u.shape[1],u.shape[2]]),r=it(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(r.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${r.rank}.`),P(o.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`);const h={dy:r,input:o},c={filterSize:n,strides:s,pad:i},f=tt.runKernel(Ad,h,c);return l?it(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const UA=et({avgPoolGrad_:VA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GA={kernelName:Yc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{filterSize:i,strides:a,pad:u}=n;return{x:()=>UA(e,s,i,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA={kernelName:Kc,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[s,i]=t,{transposeA:a,transposeB:u}=n;return!a&&!u?{a:()=>jt(e,i,!1,!0),b:()=>jt(s,e,!0,!1)}:!a&&u?{a:()=>jt(e,i,!1,!1),b:()=>jt(e,s,!0,!1)}:a&&!u?{a:()=>jt(i,e,!1,!0),b:()=>jt(s,e,!1,!1)}:{a:()=>jt(i,e,!0,!0),b:()=>jt(e,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jA={kernelName:Jc,gradFunc:(e,t,n)=>{const{blockShape:s,crops:i}=n;return{x:()=>Gp(e,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XA={kernelName:UT,gradFunc:(e,t,n)=>{const s=n,i=s.inputShape,a=s.shape,u=Array.from(a);for(let r=i.length-1;r>=0;r--)if(i[r]===a[r])u[r]=1;else if(i[r]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${a}].`);const o=[];for(let r=0;r<u.length;r++)u[r]>1&&o.push(r);return{x:()=>Et(e,o,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YA={kernelName:xa,gradFunc:e=>({x:()=>e.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qA={kernelName:ba,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KA={kernelName:va,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{clipValueMin:i,clipValueMax:a}=n;return{x:()=>kn(Xs(bo(s,i),vo(s,a)),e,Yt(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JA={kernelName:Zc,inputsToSave:["x"],gradFunc:Dy.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZA={kernelName:Qc,saveAllInputs:!0,gradFunc:(e,t,n)=>{const s=t.map(r=>r.shape),{axis:i}=n,a=Ut(i,t[0].shape)[0],u=s.map(r=>r[a]);return An(e,u,a).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QA={kernelName:tu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[s,i]=t,{dilations:a,strides:u,pad:o,dataFormat:r}=n;return P(ar(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>Op(s.shape,e,i,u,o,r),filter:()=>Kp(s,e,i.shape,u,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tR={kernelName:eu,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[s,i]=t,{strides:a,pad:u,dataFormat:o,dimRoundingMode:r}=n;return{dy:()=>lr(e,i,a,u,o,1,r),filter:()=>Kp(e,s,i.shape,a,u,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(e,t,n,s,i){let a=e;e.rank===4&&(a=it(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let u=t;u.rank===4&&(u=it(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),P(a.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`),P(u.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${u.shape}.`),P(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),P(a.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`),P(u.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${u.shape[4]}) must match output depth for filter (${n[4]}).`);const o={x:a,dy:u},r={strides:s,pad:i,filterShape:n};return tt.runKernel(Md,o,r)}const nR=et({conv3DBackpropFilter_:eR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sR={kernelName:nu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:s,strides:i,pad:a}=n;P(ar(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[u,o]=t;return{x:()=>Ev(u.shape,e,o,i,a),filter:()=>nR(u,e,o.shape,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iR={kernelName:ya,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(xe(jp(St(n,"float32"))),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rR={kernelName:wa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(Qv(St(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oR={kernelName:su,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:i,exclusive:a,reverse:u}=n;return{x:()=>{const o=be([i],s.rank);let r=Dv(e,i,a,!u);return o!=null&&(r=Xt(r,o)),r}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aR={kernelName:iu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:s,strides:i,pad:a,dimRoundingMode:u}=n,o=s==null?[1,1]:s;P(ar(o),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[r,l]=t;return P(r.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${r.rank}.`),P(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),P(r.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${r.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),P(Qe(i,o),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${o}'.`),pn("depthwiseConv2d",a,u),{x:()=>hD(r.shape,e,l,i,a,o,u),filter:()=>cD(r,e,l.shape,i,a,o,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lR={kernelName:ru,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[s,i]=t,a={x:s,filter:i,dy:e},u={x:s,filter:i,dy:e};return{x:()=>tt.runKernel(yf,a,n),filter:()=>tt.runKernel(wf,u,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cR={kernelName:Sa,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,s={dy:e,y:n};return{x:()=>tt.runKernel(Gd,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uR={kernelName:ka,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,s=Z(Yn(xe(le(n))),2/Math.sqrt(Math.PI));return{x:()=>Z(e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hR={kernelName:Ia,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fR={kernelName:au,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>it(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dR={kernelName:Ta,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,Yn(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pR={kernelName:_a,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gR={kernelName:$a,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{const o=Nt(e,St(s,"float32")),r=Oe(n.shape,i);return r.length>0?it(Et(o,r),n.shape):o},b:()=>{let o=Z(e,St(n,"float32"));const r=Oe(s.shape,i);r.length>0&&(o=it(Et(o,r),s.shape));const l=le(s);return xe(Nt(o,St(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mR={kernelName:lu,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:s}=n,[i,a,u,o]=t,r=o==null?Pt(1):o,l=Oe(a.shape,i.shape),h=[];if(a.rank===1){for(let v=0;v<i.shape.length-1;++v)h.push(i.shape[v]);h.push(1)}const c=Tt(i,a),f=Z(e,r),d=Kv(yt(u,Pt(s))),p=Z(Z(Z(d,d),d),Pt(-.5));return{x:()=>a.rank===1?it(Z(Z(e,hs(it(d,[1,1,1,a.shape[0]]),h)),r),i.shape):it(Z(Z(e,d),r),i.shape),mean:()=>{let v=Z(Z(d,Pt(-1)),f);return a.rank===1&&(v=Et(v,l)),it(v,a.shape)},variance:()=>{let v=Z(Z(p,c),f);return a.rank===1&&(v=Et(v,l)),it(v,a.shape)},scale:()=>{const v=Z(c,d);let w=Z(e,v);return a.rank===1&&(w=Et(w,l)),it(w,a.shape)},offset:()=>{let v=e;return a.rank===1&&(v=Et(v,l)),it(v,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xR={kernelName:cu,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[s,i]=t,{axis:a}=n,u=Ut(a,s.shape)[0];return{x:()=>{const r=s.shape,l=i.size,h=r.slice(0,u),c=h.length,f=r.slice(a,r.length).slice(1),d=f.length,p=yx(0,c),m=yx(c+1,c+1+d),g=wx([h,[l],f]),x=it(e,g),b=it(i,[l]),y=wx([[c],p,m]),v=Xt(x,y);let w=ry(v,b,s.shape[u]);const C=ki(y);return w=Xt(w,C),w},indices:()=>i}}};function yx(e,t){const n=[];for(let s=e;s<t;++s)n.push(s);return n}function wx(e){const t=[];for(let n=0;n<e.length;++n)for(let s=0;s<e[n].length;++s)t.push(e[n][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bR={kernelName:Ea,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>Yt(n),b:()=>Yt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vR={kernelName:Na,gradFunc:e=>({x:()=>St(e,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yR={kernelName:Da,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wR={kernelName:Aa,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CR={kernelName:Ra,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SR={kernelName:hu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{alpha:i}=n,a=Qn(s,0);return{x:()=>kn(a,e,Z(e,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kR={kernelName:Fa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,yt(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IR={kernelName:Oa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,St(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TR={kernelName:GT,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s]=t,{axis:i}=n;return{logits:()=>{const u=Yn(s);return Tt(e,Z(Et(e,i,!0),u))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(e,t,n,s=5,i=1,a=1,u=.5){const o={x:e,y:t,dy:n},r={depthRadius:s,bias:i,alpha:a,beta:u};return tt.runKernel(Kd,o,r)}const $R=et({localResponseNormalizationBackprop_:_R});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ER={kernelName:xu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,i]=t,{depthRadius:a,bias:u,alpha:o,beta:r}=n;return{x:()=>$R(s,i,e,a,u,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ay(e,t,n,s){return t.rank<n.rank&&(t=it(t,Se(t.shape,s))),e.rank<n.rank&&(e=it(e,Se(e.shape,s))),{x:()=>Z(e,St(Ls(n,t),e.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cx={kernelName:bu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const s=n,{reductionIndices:i}=s,a=t[0],u=t[1],o=Ut(i,a.shape),r=Ay(e,u,a,o);return{x:()=>r.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NR={kernelName:Pa,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>Z(e,St(bo(n,s),"float32")),b:()=>Z(e,St(Fv(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(e,t,n,s,i,a,u){const o=M(e,"dy","maxPool3dGrad"),r=M(t,"input","maxPool3dGrad"),l=M(n,"output","maxPool3dGrad");let h=o,c=r,f=l,d=!1;r.rank===4&&(d=!0,h=it(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=it(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]),f=it(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),P(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),P(c.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),P(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),pn("maxPool3dGrad",a,u);const p={dy:h,input:c,output:f},m={filterSize:s,strides:i,pad:a,dimRoundingMode:u},g=tt.runKernel(Zd,p,m);return d?it(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const AR=et({maxPool3dGrad_:DR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR={kernelName:yu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,i]=t,{filterSize:a,strides:u,pad:o,dimRoundingMode:r}=n;return{x:()=>AR(e,s,i,a,u,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(e,t,n,s,i,a,u){const o=M(e,"dy","maxPoolGrad"),r=M(t,"input","maxPoolGrad"),l=M(n,"output","maxPoolGrad");P(r.rank===o.rank,()=>`Rank of input (${r.rank}) does not match rank of dy (${o.rank})`),P(o.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`),P(r.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${r.rank}.`),pn("maxPoolGrad",a,u);const h={dy:o,input:r,output:l},c={filterSize:s,strides:i,pad:a,dimRoundingMode:u};return tt.runKernel(Jd,h,c)}const FR=et({maxPoolGrad_:OR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PR={kernelName:vu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,i]=t,{filterSize:a,strides:u,pad:o}=n;return{x:()=>FR(e,s,i,a,u,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MR={kernelName:wu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:i}=n,a=Ut(i,s.shape),o=We(s.shape,a)[1],r=pt(o);return{x:()=>{const h=s.shape.slice();a.forEach(d=>{h[d]=1});const c=it(e,h);return Nt(Z(c,yn(s.shape,"float32")),r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LR={kernelName:Cu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const s=n,{axis:i}=s,[a,u]=t,o=Ut(i,a.shape),r=Ay(e,u,a,o);return{x:()=>r.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BR={kernelName:Ma,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>Z(e,St(vo(n,s),"float32")),b:()=>Z(e,St(Qn(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zR={kernelName:Su,inputsToSave:["x"],gradFunc:(e,t,n)=>{const s=t[0],{paddings:i}=n,a=i.map(u=>u[0]);return{x:()=>ne(e,a,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WR={kernelName:La,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{const o=Oe(n.shape,i);return o.length>0?it(Et(e,o),n.shape):e},b:()=>{const o=Z(e,xe(Zu(Nt(n,s)))),r=Oe(s.shape,i);return r.length>0?it(Et(o,r),s.shape):o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VR={kernelName:Ba,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{const o=Z(e,St(s,"float32")),r=Oe(n.shape,i);return r.length>0?it(Et(o,r),n.shape):o},b:()=>{const o=Z(e,St(n,"float32")),r=Oe(s.shape,i);return r.length>0?it(Et(o,r),s.shape):o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UR={kernelName:ku,gradFunc:e=>({x:()=>xe(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GR={kernelName:_u,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>ae(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR={kernelName:Tu,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jR={kernelName:$u,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:s}=n;return so(e,s).map(a=>()=>a)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sx={kernelName:Eu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const s=t[0],{paddings:i}=n,a=i.map(u=>u[0]);return{x:()=>ne(e,a,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XR={kernelName:za,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,s,i]=t,a=n,u=s,o=Bt(a.shape,u.shape);return{a:()=>{const h=St(u,"float32");let c=Z(e,Z(h,eo(a,Tt(h,Pt(1)))));const f=Oe(a.shape,o);return f.length>0&&(c=Et(c,f)),it(c,a.shape)},b:()=>{const h=Qn(a,0),c=kn(h,qn(a),Yt(a));let f=Z(e,Z(i,c));const d=Oe(u.shape,o);return d.length>0&&(f=Et(f,d)),it(f,u.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR={kernelName:Nu,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,s]=t,i=Qn(n,0);return{x:()=>kn(i,e,Z(e,s)),alpha:()=>{let a=kn(i,Yt(e),Z(e,n));const u=Oe(s.shape,e.shape);return u.length>0&&(a=Et(a,u)),it(a,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(e,t,n){const s=e.shape.slice();s[n]=1;const i=it(t,s),a=Bf(e,n,!0,!1),u=Bf(e,n,!0,!0),o=Z(a,u);return Z(i,o)}function KR(e,t,n){const s=e.shape.length,i=s-n.length,a=be(n,s);let u=e;a!=null&&(u=Xt(e,a));const o=u.shape.slice(),l=o.splice(s-n.length,n.length).reduce((f,d)=>f*d,1);o.push(l);const h=u.reshape(o);let c=qR(h,t,i);if(c=c.reshape(u.shape),a!=null){const f=ki(a);c=Xt(c,f)}return c}const JR={kernelName:Du,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:i}=n;let a=[];return i==null?a=s.shape.map((u,o)=>o):typeof i=="number"?a=[i]:a=i,{x:()=>KR(s,e,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR={kernelName:Ca,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{const o=Nt(e,St(s,"float32")),r=Oe(n.shape,i);return r.length>0?it(Et(o,r),n.shape):o},b:()=>{let o=Z(e,St(n,"float32"));const r=Oe(s.shape,i);r.length>0&&(o=it(Et(o,r),s.shape));const l=le(s);return xe(Nt(o,St(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR={kernelName:Wa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,xe(le(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tO={kernelName:Ua,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,s=Z(vo(n,6),hl(n));return{x:()=>Z(e,St(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eO={kernelName:Va,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,St(hl(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nO={kernelName:Au,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>it(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sO={kernelName:Ou,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[s]=t,i={dy:e,images:s};return{images:()=>tt.runKernel(rp,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iO={kernelName:Ru,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[s]=t,i={dy:e,images:s};return{images:()=>tt.runKernel(ip,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rO={kernelName:Fu,gradFunc:(e,t,n)=>{const{dims:s}=n,i=Ut(s,e.shape);return{x:()=>ur(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oO={kernelName:Ga,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aO={kernelName:Ha,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>xe(Nt(e,Z(eo(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lO={kernelName:Pu,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>St(Yt(n),"float32"),t:()=>Z(e,St(n,e.dtype)),e:()=>Z(e,St(zp(n),e.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cO={kernelName:ja,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=Qn(n,Pt(0)),i=Pt(nh),a=Pt(sh),u=Z(e,a),o=Z(Z(e,i),Yn(St(n,"float32")));return kn(s,u,o)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uO={kernelName:Ka,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,Z(n,Tt(Pt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hO={kernelName:qa,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fO={kernelName:Xa,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(Jo(St(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dO={kernelName:Ya,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(Nv(St(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pO={kernelName:Mu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{begin:i,size:a}=n,u=s.shape,[o,r]=Xu(s,i,a),l=[];for(let h=0;h<e.rank;h++)l.push([o[h],u[h]-o[h]-r[h]]);return{x:()=>Up(e,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gO={kernelName:Wu,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s]=t,{dim:i}=n,a=!0,u=Z(e,s);return{logits:()=>Tt(u,Z(Et(u,[i],a),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO={kernelName:Ja,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,xo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kx={kernelName:Bu,gradFunc:(e,t,n)=>{const{blockShape:s,paddings:i}=n;return{x:()=>Rp(e,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ix={kernelName:zu,gradFunc:(e,t,n)=>{const{axis:s}=n;return{x:()=>we(e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xO={kernelName:Za,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,Z(rn(St(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bO={kernelName:up,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(e,Z(St(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vO={kernelName:Qa,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Pt(2);return{a:()=>Z(e,Z(i,Tt(n,s))),b:()=>Z(e,Z(i,Tt(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yO={kernelName:il,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wO={kernelName:tl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,i=Bt(n.shape,s.shape);return{a:()=>{let o=e;const r=Oe(n.shape,i);return r.length>0&&(o=Et(o,r)),it(o,n.shape)},b:()=>{let o=e;const r=Oe(s.shape,i);return r.length>0&&(o=Et(o,r)),it(xe(o),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CO={kernelName:Lu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,i=s.shape.slice(),{axis:a}=n;Ut(a,s.shape).forEach(l=>{i[l]=1});const o=it(e,i),r=Z(o,yn(s.shape,"float32"));return{x:()=>r}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SO={kernelName:el,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Nt(e,le(Jo(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kO={kernelName:nl,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Z(Tt(Pt(1),le(n)),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IO={kernelName:sl,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{reps:i}=n;return{x:()=>{let u=Yt(s);if(s.rank===1)for(let o=0;o<i[0];++o)u=yt(u,ne(e,[o*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let o=0;o<i[0];++o)for(let r=0;r<i[1];++r)u=yt(u,ne(e,[o*s.shape[0],r*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let o=0;o<i[0];++o)for(let r=0;r<i[1];++r)for(let l=0;l<i[2];++l)u=yt(u,ne(e,[o*s.shape[0],r*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let o=0;o<i[0];++o)for(let r=0;r<i[1];++r)for(let l=0;l<i[2];++l)for(let h=0;h<i[3];++h)u=yt(u,ne(e,[o*s.shape[0],r*s.shape[1],l*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TO={kernelName:Vr,gradFunc:(e,t,n)=>{const s=n,{perm:i}=s,a=ki(i);return{x:()=>Xt(e,a)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _O={kernelName:Vu,gradFunc:(e,t,n)=>{const s=n,{axis:i}=s;return{value:()=>hr(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $O={kernelName:Uu,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>EO(e,n)}}};function EO(e,t){const n=Ii(t,Yt(t)),s=Mp(e,n);let i=bo(t,Pt(0,"int32"));const a=s.rank-i.rank;for(let o=0;o<a;++o)i=Bn(i,o+1);i=Xs(i,yn(s.shape,"bool"));const u=Yt(s);return kn(i,s,u)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NO={kernelName:Gu,gradFunc:e=>({x:()=>Yt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DO=[Dy,$A,EA,NA,DA,AA,RA,OA,FA,PA,MA,LA,WA,GA,HA,jA,XA,YA,qA,KA,JA,ZA,tR,QA,sR,iR,rR,oR,aR,lR,ZR,cR,uR,hR,fR,dR,gR,pR,mR,xR,bR,vR,yR,wR,CR,SR,kR,IR,TR,ER,Cx,Cx,NR,RR,PR,MR,LR,BR,zR,WR,VR,UR,GR,HR,jR,Sx,Sx,XR,YR,JR,QR,tO,eO,nO,sO,iO,rO,oO,aO,lO,cO,uO,hO,fO,dO,pO,gO,mO,kx,kx,Ix,Ix,xO,vO,bO,yO,wO,CO,SO,kO,IO,TO,_O,$O,NO];for(const e of DO)jT(e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.abs=function(){return this.throwIfDisposed(),Le(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.acos=function(){return this.throwIfDisposed(),v2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.acosh=function(){return this.throwIfDisposed(),w2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.add=function(e){return this.throwIfDisposed(),yt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.all=function(e,t){return this.throwIfDisposed(),Tv(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.any=function(e,t){return this.throwIfDisposed(),Mf(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.argMax=function(e){return this.throwIfDisposed(),Ko(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.argMin=function(e){return this.throwIfDisposed(),T2(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.asScalar=function(){return this.throwIfDisposed(),P(this.size===1,()=>"The array must have only 1 element."),it(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.asType=function(e){return this.throwIfDisposed(),St(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.as1D=function(){return this.throwIfDisposed(),it(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.as2D=function(e,t){return this.throwIfDisposed(),it(this,[e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),it(this,[e,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.as4D=function(e,t,n,s){return this.throwIfDisposed(),it(this,[e,t,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.as5D=function(e,t,n,s,i){return this.throwIfDisposed(),it(this,[e,t,n,s,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.asin=function(){return this.throwIfDisposed(),$2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.asinh=function(){return this.throwIfDisposed(),N2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.atan=function(){return this.throwIfDisposed(),A2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.atan2=function(e){return this.throwIfDisposed(),O2(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.atanh=function(){return this.throwIfDisposed(),P2(this)};ft().prototype.avgPool=function(e,t,n,s){return this.throwIfDisposed(),Dp(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Rp(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.batchNorm=function(e,t,n,s,i){return this.throwIfDisposed(),Yu(this,e,t,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Zl(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.cast=function(e){return this.throwIfDisposed(),St(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.ceil=function(){return this.throwIfDisposed(),l$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Sn(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof ge&&(e=[e]),we([this,...e],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.conv1d=function(e,t,n,s,i,a){return this.throwIfDisposed(),_v(this,e,t,n,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.conv2dTranspose=function(e,t,n,s,i){return this.throwIfDisposed(),$v(this,e,t,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.conv2d=function(e,t,n,s,i,a){return this.throwIfDisposed(),lr(this,e,t,n,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.cos=function(){return this.throwIfDisposed(),Jo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.cosh=function(){return this.throwIfDisposed(),Nv(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Bf(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Dv(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),A$(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.depthwiseConv2d=function(e,t,n,s,i,a){return this.throwIfDisposed(),Fp(this,e,t,n,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.dilation2d=function(e,t,n,s,i){return this.throwIfDisposed(),F$(this,e,t,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.divNoNan=function(e){return this.throwIfDisposed(),z$(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.div=function(e){return this.throwIfDisposed(),Nt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.dot=function(e){return this.throwIfDisposed(),V$(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.elu=function(){return this.throwIfDisposed(),qu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.equal=function(e){return this.throwIfDisposed(),Ls(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.erf=function(){return this.throwIfDisposed(),H$(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),tE(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.exp=function(){return this.throwIfDisposed(),Yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.expandDims=function(e){return this.throwIfDisposed(),Bn(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.expm1=function(){return this.throwIfDisposed(),iE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.fft=function(){return this.throwIfDisposed(),ey(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.flatten=function(){return this.throwIfDisposed(),it(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.floor=function(){return this.throwIfDisposed(),Zu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.floorDiv=function(e){return this.throwIfDisposed(),Iv(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.gather=function(e,t){return this.throwIfDisposed(),Mp(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.greaterEqual=function(e){return this.throwIfDisposed(),bo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.greater=function(e){return this.throwIfDisposed(),Qn(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.ifft=function(){return this.throwIfDisposed(),Wf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.irfft=function(){return this.throwIfDisposed(),PN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.isFinite=function(){return this.throwIfDisposed(),fE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.isInf=function(){return this.throwIfDisposed(),pE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.isNaN=function(){return this.throwIfDisposed(),mE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Lp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.lessEqual=function(e){return this.throwIfDisposed(),vo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.less=function(e){return this.throwIfDisposed(),Fv(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.localResponseNormalization=function(e,t,n,s){return this.throwIfDisposed(),wE(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logSigmoid=function(){return this.throwIfDisposed(),_E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Pv(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Mv(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.log=function(){return this.throwIfDisposed(),qn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.log1p=function(){return this.throwIfDisposed(),Bp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Xs(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logicalNot=function(){return this.throwIfDisposed(),zp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logicalOr=function(e){return this.throwIfDisposed(),Lv(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.logicalXor=function(e){return this.throwIfDisposed(),FE(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),jt(this,e,t,n)};ft().prototype.maxPool=function(e,t,n,s){return this.throwIfDisposed(),Wp(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.max=function(e,t){return this.throwIfDisposed(),Os(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.maximum=function(e){return this.throwIfDisposed(),Ii(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.mean=function(e,t){return this.throwIfDisposed(),ye(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.min=function(e,t){return this.throwIfDisposed(),zf(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.minimum=function(e){return this.throwIfDisposed(),tr(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),GE(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.mod=function(e){return this.throwIfDisposed(),jE(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.mul=function(e){return this.throwIfDisposed(),Z(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.neg=function(){return this.throwIfDisposed(),xe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Ku(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.notEqual=function(e){return this.throwIfDisposed(),Zo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),pv(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.onesLike=function(){return this.throwIfDisposed(),Kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.pad=function(e,t){return this.throwIfDisposed(),Up(this,e,t)};ft().prototype.pool=function(e,t,n,s,i,a){return this.throwIfDisposed(),eN(this,e,t,n,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.pow=function(e){return this.throwIfDisposed(),eo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.prelu=function(e){return this.throwIfDisposed(),Hp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.prod=function(e,t){return this.throwIfDisposed(),iN(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.reciprocal=function(){return this.throwIfDisposed(),mN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.relu=function(){return this.throwIfDisposed(),Zs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.relu6=function(){return this.throwIfDisposed(),Yv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.reshapeAs=function(e){return this.throwIfDisposed(),it(this,e.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.reshape=function(e){return this.throwIfDisposed(),it(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),ly(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),cy(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.reverse=function(e){return this.throwIfDisposed(),ur(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.rfft=function(){return this.throwIfDisposed(),ny(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.round=function(){return this.throwIfDisposed(),qv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.rsqrt=function(){return this.throwIfDisposed(),Kv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.selu=function(){return this.throwIfDisposed(),Jv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.separableConv2d=function(e,t,n,s,i,a){return this.throwIfDisposed(),Zv(this,e,t,n,s,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sigmoid=function(){return this.throwIfDisposed(),xo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sign=function(){return this.throwIfDisposed(),IN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sin=function(){return this.throwIfDisposed(),jp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sinh=function(){return this.throwIfDisposed(),Qv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.slice=function(e,t){return this.throwIfDisposed(),ne(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.softmax=function(e){return this.throwIfDisposed(),qp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.softplus=function(){return this.throwIfDisposed(),cl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Gp(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.split=function(e,t){return this.throwIfDisposed(),An(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sqrt=function(){return this.throwIfDisposed(),rn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.square=function(){return this.throwIfDisposed(),le(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.squaredDifference=function(e){return this.throwIfDisposed(),sy(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.squeeze=function(e){return this.throwIfDisposed(),ul(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof ge?[this,e]:[this,...e];return hr(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.step=function(e){return this.throwIfDisposed(),hl(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.stridedSlice=function(e,t,n,s,i,a,u,o){return this.throwIfDisposed(),GN(this,e,t,n,s,i,a,u,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sub=function(e){return this.throwIfDisposed(),Tt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.sum=function(e,t){return this.throwIfDisposed(),Et(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.tan=function(){return this.throwIfDisposed(),jN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.tanh=function(){return this.throwIfDisposed(),Ap(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.tile=function(e){return this.throwIfDisposed(),hs(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.toBool=function(){return this.throwIfDisposed(),St(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.toFloat=function(){return this.throwIfDisposed(),St(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.toInt=function(){return this.throwIfDisposed(),St(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.topk=function(e,t){return this.throwIfDisposed(),YN(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.transpose=function(e){return this.throwIfDisposed(),Xt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.unique=function(e){return this.throwIfDisposed(),JN(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ry(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.unstack=function(e){return this.throwIfDisposed(),so(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.where=function(e,t){return this.throwIfDisposed(),kn(e,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ft().prototype.zerosLike=function(){return this.throwIfDisposed(),Yt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $s extends Error{constructor(t){super(t),Object.setPrototypeOf(this,$s.prototype)}}class Gn extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Gn.prototype)}}class nt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,nt.prototype)}}class zt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,zt.prototype)}}class Ng extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ng.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ry{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dr(e,t){if(Array.isArray(e)){let n=[];for(let s=0;s<t;s++)n=n.concat(e);return n}else{const n=new Array(t);return n.fill(e),n}}function Es(e,t){if(!e)throw new Ng(t)}function Tx(e,t){let n=0;for(const s of e)s===t&&n++;return n}function un(e){return e.length===1?e[0]:e}function ue(e){return Array.isArray(e)?e:[e]}function Ws(e){const n=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Gi(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let Mn={};function Dg(e){if(e==null)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Uf(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>Uf(t));else{const t=Object.keys(e);for(const n of t){const s=e[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?e[n]=s.value:Uf(s))}}}function gl(e,t={},n={},s="object",i=!1){if(typeof e=="string"){const a=e;let u;if(a in n)u=n[a];else if(a in Mn)u=Mn[a];else if(u=t[a],u==null)throw new nt(`Unknown ${s}: ${e}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return u}else{const a=e;if(a.className==null||a.config==null)throw new nt(`${s}: Improper config format: ${JSON.stringify(a)}.
'className' and 'config' must set.`);const u=a.className;let o,r;if(u in n?[o,r]=n[u]:u in Mn?[o,r]=Mn.className:u in t&&([o,r]=t[u]),o==null)throw new nt(`Unknown ${s}: ${u}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(r!=null){const l={};for(const d of Object.keys(Mn))l[d]=Mn[d];for(const d of Object.keys(n))l[d]=n[d];const h=a.config;h.customObjects=l;const c=Object.assign({},Mn);for(const d of Object.keys(n))Mn[d]=n[d];Uf(a.config);const f=r(o,a.config,n,i);return Mn=Object.assign({},c),f}else{const l=Object.assign({},Mn);for(const c of Object.keys(n))Mn[c]=n[c];const h=new o(a.config);return Mn=Object.assign({},l),h}}}function AO(e,t){return e<t?-1:e>t?1:0}function Ml(e,t){return-1*AO(e,t)}function hi(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)===-1&&t.push(n);return t}function RO(e){if(e==null)throw new nt(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function vr(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new nt(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function Ag(e,t,n=0,s=1/0){return Es(n>=0),Es(s>=n),Array.isArray(e)&&e.length>=n&&e.length<=s&&e.every(i=>typeof i===t)}function ze(e,t){Array.isArray(e)?(P(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,s)=>ze(n,`element ${s+1} of ${t}`))):P(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${Oy(e)}.`)}function Oy(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>Oy(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function OO(e,t,n){let s=n!=null?n():cn(),i;return(...u)=>{const o=n!=null?n():cn();return o-s<t||(s=o,i=e(...u)),i}}function Fy(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let FO=0;function Py(){return FO++}const Ll={};function ih(e=""){return e in Ll||(Ll[e]=0),Ll[e]+=1,e+Ll[e].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const PO=["channelsFirst","channelsLast"],MO=["nearest","bilinear"],LO=["valid","same","causal"],BO=["max","avg"],zO=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _r=new Map;function Ie(e){vr(PO,"DataFormat",e)}function WO(e){vr(MO,"InterpolationFormat",e)}function On(e){vr(LO,"PaddingMode",e)}function My(e){vr(BO,"PoolMode",e)}const Go=[],_x="/";function er(e,t){Go.push(e);try{const n=t();return Go.pop(),n}catch(n){throw Go.pop(),n}}function VO(){return Go.length===0?"":Go.join(_x)+_x}function Ly(e){if(!zy(e))throw new Error("Not a valid tensor name: '"+e+"'");return VO()+e}function By(e){if(!zy(e))throw new Error("Not a valid tensor name: '"+e+"'");_r.has(e)||_r.set(e,0);const t=_r.get(e);if(_r.set(e,_r.get(e)+1),t>0){const n=`${e}_${t}`;return _r.set(n,1),n}else return e}const UO=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function zy(e){return!!e.match(UO)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GO(e){return e===parseInt(e.toString(),10)}function fi(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let s=1;for(let i=t;i<n;++i)s*=e[i];return s}function io(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n];s<t&&(t=s)}return t}function mi(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n];s>t&&(t=s)}return t}function xs(e,t){if(t<e)throw new nt(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let s=e;s<t;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Lh;function Ee(){return Lh==null&&(Lh=t2().epsilon()),Lh}function bs(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rh(e,t){return St(e,t)}function ml(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),it(e,n)}function HO(e,t){return lt(()=>{if(e.shape.length!==2)throw new nt(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);const n=ml(e,1);return Gf(n,[1,t,1])})}function jO(e){const t=[fi(e.shape)];return it(e,t)}function XO(e){if(e.rank<=1)throw new nt(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],fi(e.shape,1)];return it(e,t)}function nr(e,t,n){return lt(()=>{switch(e.rank){case 1:return Xp(e,t,n);case 2:return ty(e,[t,0],[n,e.shape[1]]);case 3:return Yp(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return gc(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return ne(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return ne(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new nt(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Bh(e,t,n){return lt(()=>{switch(e.rank){case 1:return Xp(e,t,n);case 2:return ty(e,[0,t],[e.shape[0],n]);case 3:return Yp(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return gc(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new nt(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Bl(e,t,n,s){return lt(()=>{switch(e.rank){case 1:return Xp(e,t,n);case 2:switch(s){case 1:return nr(e,t,n);case 2:return Bh(e,t,n);default:throw new nt(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return nr(e,t,n);case 2:return Yp(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Bh(e,t,n);default:throw new nt(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return nr(e,t,n);case 2:return gc(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return gc(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Bh(e,t,n);default:throw new nt(`The axis is not within the rank of the tensor ${s}`)}default:throw new nt(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Rg(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),we(e,t)}function $x(e,t){switch(e.rank){case 1:return h$([e,t]);case 2:return d$([e,t],0);case 3:return g$([e,t],0);case 4:return x$([e,t],0);default:throw new nt(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function Gf(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new nt(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return hs(e,t)}function oh(e,t=0,n=1,s,i){return dN(e,t,n,s,i)}function Ps(e,t,n,s){if(e.rank<2||t.rank<2)throw new zt(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=e.shape.slice(-1)[0],a=t.shape.slice(-2)[0];if(i!==a)throw new zt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return gx({a:e,b:t,transposeA:!1,transposeB:!1,bias:s?Hf(e.rank,s,bs()):null,activation:n});{const i=e.shape.slice(),a=i.pop();e=it(e,[-1,a]);const u=t.shape.slice(),o=u.pop(),r=u.pop(),l=[...u,o],h=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=it(Xt(t,h),[r,-1]);const c=[...i,...l];return it(gx({a:e,b:t,transposeA:!1,transposeB:!1,bias:s?Hf(e.rank,s,bs()):null,activation:n}),c)}}function Wy(e,t,n){return lt(()=>(Array.isArray(t)?t=wn(t,"int32"):t=St(t,"int32"),Mp(e,t,n)))}function xl(e){return Z(e,e)}function Hf(e,t,n){const s=t.shape;if(t.rank!==1&&t.rank!==e)throw new nt(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return s.length===1?it(t,[1,s[0],1,1,1]):it(t,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?it(t,[1,1,1,1,s[0]]):it(t,[1].concat(s))}else if(e===4){if(n==="channelsFirst")return s.length===1?it(t,[1,s[0],1,1]):it(t,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?it(t,[1,1,1,s[0]]):it(t,[1].concat(s))}else if(e===3){if(n==="channelsFirst")return s.length===1?it(t,[1,s[0],1]):it(t,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?it(t,[1,1,s[0]]):it(t,[1].concat(s))}else if(e<3)return t;throw new nt(`Unsupported input rank by biasAdd: ${t.rank}`)}function ws(e,t,n){return lt(()=>(n==null&&(n=bs()),Ie(n),yt(e,Hf(e.rank,t,n))))}function YO(e,t=1){if(t!==1)throw new zt(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return qu(e)}function qO(e){return lt(()=>Nt(e,yt(Le(e),1)))}function Vy(e,t,n,s){return lt(()=>sD(e,t,n,s))}function KO(e){return lt(()=>{const t=yt(.5,Z(.2,e));return Sn(t,0,1)})}function bl(e,t,n=!1){return n?e():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const JO=["fanIn","fanOut","fanAvg"],ZO=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QO(e){vr(JO,"FanMode",e)}function tF(e){vr(ZO,"Distribution",e)}class ts extends mo{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Uy extends ts{apply(t,n){return ae(t,n)}}Uy.className="Zeros";bt(Uy);class Og extends ts{apply(t,n){return yn(t,n)}}Og.className="Ones";bt(Og);class Gy extends ts{constructor(t){if(super(),typeof t!="object")throw new nt(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new nt(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return lt(()=>Z(Pt(this.value),yn(t,n)))}getConfig(){return{value:this.value}}}Gy.className="Constant";bt(Gy);class Hy extends ts{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return Qu(t,this.minval,this.maxval,n)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Hy.className="RandomUniform";bt(Hy);class jy extends ts{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new zt(`randomNormal does not support dType ${n}.`);return oh(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}jy.className="RandomNormal";bt(jy);class Xy extends ts{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new zt(`truncatedNormal does not support dType ${n}.`);return iy(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Xy.className="TruncatedNormal";bt(Xy);class Yy extends ts{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return lt(()=>{if(t.length!==2||t[0]!==t[1])throw new nt("Identity matrix initializer can only be used for 2D square matrices.");return Z(this.gain,Ov(t[0]))})}getConfig(){return{gain:this.gain}}}Yy.className="Identity";bt(Yy);function eF(e,t="channelsLast"){let n,s;if(Ie(t),e.length===2)n=e[0],s=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){const i=fi(e,2);n=e[1]*i,s=e[0]*i}else if(t==="channelsLast"){const i=fi(e,0,e.length-2);n=e[e.length-2]*i,s=e[e.length-1]*i}}else{const i=fi(e);n=Math.sqrt(i),s=Math.sqrt(i)}return[n,s]}class In extends ts{constructor(t){if(super(),t.scale<0)throw new nt(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,QO(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,tF(this.distribution),this.seed=t.seed}apply(t,n){const s=eF(t),i=s[0],a=s[1];let u=this.scale;if(this.mode==="fanIn"?u/=Math.max(1,i):this.mode==="fanOut"?u/=Math.max(1,a):u/=Math.max(1,(i+a)/2),this.distribution==="normal"){const o=Math.sqrt(u);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new zt(`${this.getClassName()} does not support dType ${n}.`);return iy(t,0,o,n,this.seed)}else{const o=Math.sqrt(3*u);return Qu(t,-o,o,n)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}In.className="VarianceScaling";bt(In);class Fg extends In{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return In.className}}Fg.className="GlorotUniform";bt(Fg);class Pg extends In{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return In.className}}Pg.className="GlorotNormal";bt(Pg);class Mg extends In{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return In.className}}Mg.className="HeNormal";bt(Mg);class Lg extends In{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return In.className}}Lg.className="HeUniform";bt(Lg);class Bg extends In{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return In.className}}Bg.className="LeCunNormal";bt(Bg);class zg extends In{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return In.className}}zg.className="LeCunNormal";bt(zg);class qy extends ts{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,this.seed!=null)throw new zt("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,n){return lt(()=>{if(t.length<2)throw new zt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const s=t[0]>t[1]?[t[1],t[0]]:t,i=oh(s,0,1,"float32");let a=CA.gramSchmidt(i);return t[0]>t[1]&&(a=Xt(a)),Z(this.gain,a)})}getConfig(){return{gain:this.gain,seed:this.seed}}}qy.className="Orthogonal";bt(qy);const Ex={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Nx(e,t={}){return gl(e,zn.getMap().classNameMap,t,"initializer")}function me(e){return Dg(e)}function de(e){if(typeof e=="string"){const t=e in Ex?Ex[e]:e;if(t==="GlorotNormal")return new Pg;if(t==="GlorotUniform")return new Fg;if(t==="HeNormal")return new Mg;if(t==="HeUniform")return new Lg;if(t==="LeCunNormal")return new Bg;if(t==="LeCunUniform")return new zg;{const n={};return n.className=t,n.config={},Nx(n)}}else return e instanceof ts?e:Nx(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jf(e){return Array.isArray(e)&&Array.isArray(e[0])}function mc(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Wt(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new nt(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function te(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new nt(`Expected exactly 1 Shape; got ${e.length}`)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xc(e){let t=0;for(const n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((s,i)=>s*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Dx="Variable";class nF{constructor(t,n="float32",s=Dx,i=!0,a=null){this.dtype=n==null?"float32":n,this.shape=t.shape,this.id=Py(),s=s==null?Dx:s,this.originalName=Ly(s),this.name=By(this.originalName),this.trainable_=i,this.constraint=a,this.val=tD(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),sF(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function sF(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function Xf(e){return e.map(t=>t.read())}function Wg(e){e.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ne{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Ds{constructor(t,n,s,i,a,u,o){this.dtype=t,this.shape=n,this.sourceLayer=s,this.inputs=i,this.callArgs=a,this.outputTensorIndex=o,this.id=Py(),u!=null&&(this.originalName=Ly(u),this.name=By(this.originalName)),this.rank=n.length}}let iF=0;class ah{constructor(t,n){this.callArgs=n,this.id=iF++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let rF=0;class qt extends mo{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=rF++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const s=this.getClassName();n=Ws(s)+"_"+ih(s)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let a=null;t.batchSize!=null&&(a=t.batchSize),s=[a].concat(t.inputShape)}this.batchInputShape=s;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new Gn(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new nt(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return un(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return un(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new $s(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new $s(`Layer ${this.name} is not connected, no input to return.`);return un(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new $s(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new $s(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return un(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=ue(t),this.inputSpec==null||this.inputSpec.length===0)return;const n=ue(this.inputSpec);if(t.length!==n.length)throw new nt(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let s=0;s<t.length;s++){const i=t[s],a=n[s];if(a==null)continue;const u=i.rank;if(a.ndim!=null&&u!==a.ndim)throw new nt(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${a.ndim}, found ndim=${u}`);if(a.maxNDim!=null&&u>a.maxNDim)throw new nt(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${a.maxNDim}, found ndim=${u}`);if(a.minNDim!=null&&u<a.minNDim)throw new nt(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${a.minNDim}, found ndim=${u}.`);if(a.dtype!=null&&i.dtype!==a.dtype)throw new nt(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${a.dtype}, found dtype=${i.dtype}.`);if(a.axes){const o=i.shape;for(const r in a.axes){const l=Number(r),h=a.axes[r],c=l>=0?o[l]:o[o.length+l];if(h!=null&&[h,null].indexOf(c)===-1)throw new nt(`Input ${s} is incompatible with layer ${this.name}: expected axis ${l} of input shape to have value ${h} but got shape ${o}.`)}}if(a.shape!=null)for(let o=0;o<a.shape.length;++o){const r=a.shape[o],l=i.shape[o];if(r!=null&&l!=null&&r!==l)throw new nt(`Input ${s} is incompatible with layer ${this.name}: expected shape=${a.shape}, found shape=${i.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const s=ue(t);let i=!0;for(const u of s)if(!(u instanceof Ds)){i=!1;break}let a=!0;for(const u of s)if(u instanceof Ds){a=!1;break}if(i===a)throw new nt("Arguments to apply() must be all SymbolicTensors or all Tensors");return er(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const u=[];for(const o of ue(t))u.push(o.shape);this.build(un(u)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(t),a){let u=this.call(t,n);const o=ue(u),r=[];for(let l of o)s.indexOf(l)!==-1&&(l=l.clone()),r.push(l);if(u=un(r),this.activityRegularizer!=null)throw new zt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}else{const u=oF(t),o=this.computeOutputShape(u);let r;const l=aF(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?u[0]:u),o!=null&&o.length>0&&Array.isArray(o[0])?r=o.map((h,c)=>new Ds(l,h,this,ue(t),n,this.name,c)):r=new Ds(l,o,this,ue(t),n,this.name),this.addInboundNode(t,r,null,null,u,o,n),this._refCount++,this.activityRegularizer!=null)throw new zt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&t[i]!=null&&t[i]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new $s(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new $s(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Gn(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return xc(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Xf(t?this.trainableWeights:this.weights)}setWeights(t){lt(()=>{const n=this.weights;if(n.length!==t.length)throw new nt(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const s=[],i=Xf(n);for(let a=0;a<i.length;++a){const u=i[a],o=n[a],r=t[a];if(!Qt(u.shape,r.shape))throw new nt(`Layer weight shape ${u.shape} not compatible with provided weight shape ${r.shape}`);s.push([o,r])}Wg(s)})}addWeight(t,n,s,i,a,u,o,r){if(this._addedWeightNames.indexOf(t)!==-1)throw new nt(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=r!=null?r():de("zeros"));const l=i.apply(n,s),h=new nF(l,s,t,u,o);return l.dispose(),a!=null&&this.addLoss(()=>a.apply(h.read())),u==null&&(u=!0),u?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=ue(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}addInboundNode(t,n,s,i,a,u,o=null){const r=ue(t);n=ue(n),s=ue(s),i=ue(i),a=mc(a),u=mc(u);const l=[],h=[],c=[];for(const f of r)l.push(f.sourceLayer),h.push(f.nodeIndex),c.push(f.tensorIndex);new ah({outboundLayer:this,inboundLayers:l,nodeIndices:h,tensorIndices:c,inputTensors:r,outputTensors:n,inputMasks:s,outputMasks:i,inputShapes:a,outputShapes:u},o);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function oF(e){e=ue(e);const t=[];for(const n of e)t.push(n.shape);return un(t)}function aF(e){return"float32"}function Ky(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{const s=t.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let a=0;a<s.inboundLayers.length;a++){const u=s.inputTensors[a],o=s.inboundLayers[a],r=s.nodeIndices[a],l=Ky(u,o,r);for(const h of l)i.indexOf(h)===-1&&i.push(h)}return i}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vl extends qt{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:ih("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new nt("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new nt("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new nt("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const i=new Ds(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new ah({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new nt(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}vl.className="InputLayer";bt(vl);function lF(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new nt("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new vl({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cF(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return St(t,e.dtype)}catch{throw new nt(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}class oi{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof oi)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=cF(t,n),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new nt(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Ds){if(this.id2Value[t.id]==null)throw new nt(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new nt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof Ds){if(this.id2Value[t.id]==null)throw new nt(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new nt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Lt(this.id2Mask)}}const bc=new Ry,vc=new Ry;function uF(e){bc!=null&&bc.setMaxEntries(e),vc!=null&&vc.setMaxEntries(e)}function Mo(e,t,n,s){const i=n==null?!1:n.training,a=Array.isArray(e),u=a?e:[e],o=u.map(p=>p.name),r=[],l=t.names();for(const p of o)l.indexOf(p)!==-1?r.push(t.getValue(p)):r.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const h=o.join(",")+"|"+t.names().sort().join(",");let c=bc.get(h),f;if(c==null){const p=hF(u,t);c=p.sorted,f=p.recipientCounts,bc.put(h,c),vc.put(h,f)}f={},i||Object.assign(f,vc.get(h));const d=new oi(t);for(let p=0;p<c.length;++p){if(s!=null){const T=Ff().numTensors;T>s.maxNumTensors&&(s.maxNumTensors=T),T<s.minNumTensors&&(s.minNumTensors=T)}const m=c[p],g=m.sourceLayer;if(g instanceof vl)continue;const x=[],b=[],y=[];let v=!1;for(const T of m.inputs){const N=d.getValue(T),R=d.getMask(T);x.push(N),b.push(R),R!=null&&(v=!0),i||(f[T.name]--,f[T.name]===0&&!t.hasKey(T)&&o.indexOf(T.name)===-1&&!N.isDisposed&&T.sourceLayer.stateful!==!0&&y.push(N))}v&&(n=n||{},n.mask=b[0]);const w=ue(g.apply(x,n));let C=null;g.supportsMasking&&(C=g.computeMask(x,b));const S=dF(m),k=Array.isArray(S)?S:[S];for(let T=0;T<k.length;++T){d.hasKey(k[T])||d.add(k[T],w[T],Array.isArray(C)?C[0]:C);const N=o.indexOf(k[T].name);N!==-1&&(r[N]=w[T])}i||Lt(y)}return d.disposeMasks(),a?r:r[0]}function hF(e,t){P(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(e.length===1){const i=Ax(e[0],t);n=i.sorted,s=i.recipientMap}else{const i=new Set;for(const a of e){const{sorted:u,recipientMap:o}=Ax(a,t);for(const r of u)i.has(r.name)||(n.push(r),i.add(r.name));for(const r in o)s[r]==null&&(s[r]=new Set),o[r].forEach(l=>s[r].add(l))}}return{sorted:n,recipientCounts:fF(s)}}function fF(e){const t={};for(const n in e)t[n]=e[n].size;return t}function Ax(e,t){const n=new Set,s=[],i={};for(const o of t.names())n.add(o);const a=[],u=[];for(a.push(e);a.length>0;){const o=a[a.length-1];if(n.has(o.name)){a.pop();continue}const r=u[u.length-1]===a.length-1;if(o.inputs.length===0||r)a.pop(),s.push(o),n.add(o.name),r&&u.pop();else{u.push(a.length-1);for(const l of o.inputs)i[l.name]==null&&(i[l.name]=new Set),i[l.name].add(o.name),!n.has(l.name)&&a.push(l)}}return{sorted:s,recipientMap:i}}function dF(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let s=0;s<e.sourceLayer.inboundNodes.length;++s)for(const i of e.sourceLayer.inboundNodes[s].outputTensors)if(i.id===e.id){n=s;break}t=e.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pF=dt();pF.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,uF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vg(e,t){return lt(()=>rn(Et(Z(e,e),t,!0)))}class yl extends mo{getConfig(){return{}}}class Jy extends yl{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return lt(()=>{const n=Vg(t,this.axis),s=Sn(n,0,this.maxValue);return Z(t,Nt(s,yt(Ee(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Jy.className="MaxNorm";bt(Jy);class Zy extends yl{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return lt(()=>Nt(t,yt(Ee(),Vg(t,this.axis))))}getConfig(){return{axis:this.axis}}}Zy.className="UnitNorm";bt(Zy);class Qy extends yl{apply(t){return Zs(t)}}Qy.className="NonNeg";bt(Qy);class t1 extends yl{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return lt(()=>{const n=Vg(t,this.axis),s=yt(Z(this.rate,Sn(n,this.minValue,this.maxValue)),Z(1-this.rate,n));return Z(t,Nt(s,yt(Ee(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}t1.className="MinMaxNorm";bt(t1);const Rx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function De(e){return Dg(e)}function Ox(e,t={}){return gl(e,zn.getMap().classNameMap,t,"constraint")}function Ae(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in Rx?Rx[e]:e,config:{}};return Ox(n)}else return e instanceof yl?e:Ox(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Fi(e){if(e==null)return;const t=[],n=[],s=[];for(const i in e){const a=e[i];if(typeof a!="number"){const u=a;t.push(u.data()),n.push(i),s.push(u)}}if(t.length>0){const i=await Promise.all(t);for(let a=0;a<i.length;++a)e[n[a]]=i[a][0];Lt(s)}}function e1(e){if(e!=null)for(const t in e){const n=e[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Fx;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(Fx||(Fx={}));const gF=125;class Qo{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class mF{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class xF extends Qo{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const i in n){const a=n[i];if(typeof a=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+a*s;else{let u;i in this.totals?u=this.totals[i]:this.totals[i]=0;const o=lt(()=>yt(this.totals[i],Z(a,s)));this.totals[i]=o,u!=null&&u.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:lt(()=>{const i=Z(Nt(1,this.seen),this.totals[s]);n[s]=i,this.totals[s].dispose(),ms(n[s])}))}}class bF extends Qo{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const t=[],n=[],s=[];for(const a in this.history){const u=this.history[a];for(let o=0;o<u.length;++o)if(typeof u[o]!="number"){const r=u[o];t.push(r.data()),n.push(a),s.push(o)}}const i=await Promise.all(t);for(let a=0;a<i.length;++a)this.history[n[a]][s[a]].dispose(),this.history[n[a]][s[a]]=i[a][0]}}class vF extends Qo{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||uy,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=gF),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");xf(this.yieldEvery)&&(this.maybeWait=OO(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,s){const i=[];this.yield!=null&&(await Fi(s),i.push(this.yield(t,n,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await Fi(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const s=[];this.epochEnd!=null&&(await Fi(n),s.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,n){this.batchBegin!=null&&(await Fi(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const s=[];this.batchEnd!=null&&(await Fi(n),s.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):xf(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await Fi(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await Fi(t),await this.trainEnd(t))}}function n1(e,t){return e==null&&(e={}),e instanceof Qo?[e]:Array.isArray(e)&&e[0]instanceof Qo?e:ue(e).map(s=>new vF(s,t))}class Ln{constructor(){}static registerCallbackConstructor(t,n){P(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Ln.checkForDuplicate(n),Ln.constructors[t]==null&&(Ln.constructors[t]=[]),Ln.constructors[t].push(n)}static checkForDuplicate(t){for(const n in Ln.constructors)Ln.constructors[+n].forEach(i=>{if(i===t)throw new nt("Duplicate callback constructor.")})}static clear(){Ln.constructors={}}static createCallbacks(t){const n=[];for(const s in Ln.constructors){const i=+s;t>=i&&n.push(...Ln.constructors[i])}return n.map(s=>new s)}}Ln.constructors={};function s1(e,t,n,s,i,a,u,o,r){const l=new bF,h=[new xF,...Ln.createCallbacks(t)];e!=null&&h.push(...e),h.push(l);const c=new mF(h);return c.setParams({epochs:n,initialEpoch:s,samples:i,steps:a,batchSize:u,verbose:t,doValidation:o,metrics:r}),{callbackList:c,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hs(e,t={},n=!1){return gl(e,zn.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yc(e,t){return lt(()=>{e.dtype!=="float32"&&(e=St(e,"float32"));const n=Et(xl(e),t,!0),s=Ju(n.shape,Ee()),i=rn(Ii(n,s));return Nt(e,i)})}function lh(e,t){return lt(()=>ye(xl(Tt(t,e)),-1))}function Ug(e,t){return lt(()=>ye(Le(Tt(t,e)),-1))}function Gg(e,t){return lt(()=>{const n=Tt(e,t),s=Sn(Le(e),Ee(),Number.MAX_VALUE),i=Le(Nt(n,s));return Z(100,ye(i,-1))})}function yF(e,t){return lt(()=>{const n=Sn(t,Ee(),Number.MAX_VALUE),s=qn(yt(1,n)),i=Sn(e,Ee(),Number.MAX_VALUE),a=qn(yt(1,i));return ye(xl(Tt(s,a)),-1)})}function wF(e,t){return lt(()=>{const n=Ii(0,Tt(1,Z(e,t)));return ye(xl(n),-1)})}function CF(e,t){return lt(()=>{const n=Ii(0,Tt(1,Z(e,t)));return ye(n,-1)})}function SF(e,t){return lt(()=>{const n=Et(Z(e,t),-1),s=Os(Z(Tt(1,e),t),-1);return Ii(0,yt(1,Tt(s,n)))})}function kF(e,t){return lt(()=>{const n=Math.log(2),s=Tt(t,e),i=Tt(yt(s,cl(Z(-2,s))),n);return ye(i,-1)})}function ta(e,t,n=!1){return lt(()=>{if(n)t=qp(t);else{const s=Et(t,t.shape.length-1,!0);t=Nt(t,s)}return t=Sn(t,Ee(),1-Ee()),xe(Et(Z(St(e,"float32"),qn(t)),t.shape.length-1))})}function wc(e,t,n=!1){return lt(()=>{const s=St(Zu(jO(e)),"int32");t=Sn(t,Ee(),1-Ee());const i=t.shape,a=it(pv(s,i[i.length-1]),i);return ta(a,t,n)})}function IF(e,t){if(!Qt(e.shape,t.shape))throw new nt(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return lt(()=>{const n=Zs(t),s=xe(Le(t));return yt(Tt(n,Z(t,e)),Bp(Yn(s)))})}function ch(e,t){return lt(()=>{let n;return n=Sn(t,Ee(),1-Ee()),n=qn(Nt(n,Tt(1,n))),ye(IF(e,n),-1)})}function TF(e,t){return lt(()=>{const n=Sn(e,Ee(),1),s=Sn(t,Ee(),1);return Et(Z(e,qn(Nt(n,s))),-1)})}function _F(e,t){return lt(()=>{const n=qn(yt(Ee(),t));return ye(Tt(t,Z(e,n)),-1)})}function i1(e,t){return lt(()=>{const n=yc(e,-1),s=yc(t,-1),i=Z(n,s);return xe(Et(i,-1))})}const Cc={meanSquaredError:lh,meanAbsoluteError:Ug,meanAbsolutePercentageError:Gg,meanSquaredLogarithmicError:yF,squaredHinge:wF,hinge:CF,categoricalHinge:SF,logcosh:kF,categoricalCrossentropy:ta,sparseCategoricalCrossentropy:wc,binaryCrossentropy:ch,kullbackLeiblerDivergence:TF,poisson:_F,cosineProximity:i1};function zh(e){if(typeof e=="string"){if(e in Cc)return Cc[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new nt(t)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function r1(e,t){return lt(()=>{const n=Z(.5,Kn(t)),s=rh(Qn(t,n),e.dtype);return ye(Ls(e,s),-1)})}function o1(e,t){return lt(()=>rh(Ls(Ko(e,-1),Ko(t,-1)),"float32"))}function $F(e,t){return lt(()=>St(Et(Xs(Ls(e,1),Ls(t,1))),"float32"))}function EF(e,t){return lt(()=>St(Et(Xs(Ls(e,0),Ls(t,1))),"float32"))}function NF(e,t){return lt(()=>{const n=$F(e,t),s=EF(e,t),i=yt(n,s);return St(kn(Qn(i,0),Nt(n,i),0),"float32")})}function DF(e,t){return ch(e,t)}function AF(e,t){return e.rank===t.rank&&(e=ul(e,[e.rank-1])),t=Ko(t,-1),t.dtype!==e.dtype&&(t=St(t,e.dtype)),St(Ls(e,t),"float32")}const RF=lh,OF=lh,FF=Ug,PF=Ug,MF=Gg,LF=Gg,a1=ta,BF=i1,l1=wc,Sc={binaryAccuracy:r1,categoricalAccuracy:o1,precision:NF,categoricalCrossentropy:a1,sparseCategoricalCrossentropy:l1,mse:RF,MSE:OF,mae:FF,MAE:PF,mape:MF,MAPE:LF,cosine:BF};function zF(e){if(typeof e=="string"&&e in Sc)return Sc[e];if(typeof e!="string"&&e!=null)return e;throw new nt(`Unknown metric ${e}`)}function zl(e){if(Es(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(const n of Object.keys(Cc))if(Cc[n]===e){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(Sc))if(Sc[n]===e){t=n;break}return t!==void 0?t:e.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WF(e){const t={Adagrad:()=>Tr.adagrad(.01),Adadelta:()=>Tr.adadelta(1,.95,Ee()),Adam:()=>Tr.adam(.001,.9,.999,Ee()),Adamax:()=>Tr.adamax(.002,.9,.999,Ee(),0),RMSProp:()=>Tr.rmsprop(.001,.9,0,Ee()),SGD:()=>Tr.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new nt(`Unknown Optimizer ${e}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Px=1*1024*1024;function Mx(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!Yf(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(e);s.length>Px&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Px}.`)}}function Yf(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if(typeof n!="string"||!Yf(e[n]))return!1;return!0}else if(Array.isArray(e)){for(const t of e)if(!Yf(t))return!1;return!0}else return!1;else{const t=typeof e;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VF(e,t,n,s=console.log){const i=GF(e),a=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(h=>Math.floor(t*h)));let u;if(!i){a.push("Receives inputs"),u=[];for(const h in e.nodesByDepth)u.push(...e.nodesByDepth[h])}s("_".repeat(t)),kc(a,n,s),s("=".repeat(t));const o=e.layers;for(let h=0;h<o.length;++h)i?HF(o[h],n,s):jF(o[h],n,u,s),s((h===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const r=UF(e),l=xc(e.nonTrainableWeights);s(`Total params: ${r+l}`),s(`Trainable params: ${r}`),s(`Non-trainable params: ${l}`),s("_".repeat(t))}function UF(e){let t;return e.collectedTrainableWeights!=null?t=xc(e.collectedTrainableWeights):t=xc(e.trainableWeights),t}function GF(e){let t=!0;const n=[],s=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}s.push(...i)}if(t)for(const i of e.layers){let a=!1;for(const u of i.inboundNodes)if(s.indexOf(u)!==-1)if(a){t=!1;break}else a=!0;if(!t)break}return t}function kc(e,t,n=console.log){let s="";for(let i=0;i<e.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=e[i],s=s.slice(0,t[i]),s+=" ".repeat(t[i]-s.length);n(s)}function HF(e,t,n){let s,i;try{i=e.inboundNodes.map(r=>JSON.stringify(r.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(e.outputShape)}catch{s="multiple"}const a=e.name,u=e.getClassName(),o=[`${a} (${u})`,i,s,e.countParams().toString()];kc(o,t,n)}function jF(e,t,n,s){let i,a;try{a=e.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{a="multiple"}try{i=JSON.stringify(e.outputShape)}catch{i="multiple"}const u=[];for(const c of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(c)===-1))for(let f=0;f<c.inboundLayers.length;++f){const d=c.inboundLayers[f].name,p=c.nodeIndices[f],m=c.tensorIndices[f];u.push(`${d}[${p}][${m}]`)}const o=e.name,r=e.getClassName(),l=u.length===0?"":u[0],h=[`${o} (${r})`,a,i,e.countParams().toString(),l];kc(h,t,s);for(let c=1;c<u.length;++c)kc(["","","","",u[c]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function c1(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function qf(e,t){if(e===null)return null;if(typeof e=="string")return Gi(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],s=e.length;for(let i=0;i<s;++i){const a=e[i];c1(t,i,a)?n.push(a):n.push(qf(a,t))}return n}else{const n={};for(const s of Object.keys(e)){const i=e[s];if(s==="name"&&typeof i=="string")n[s]=i;else{const a=Gi(s);n[a]=qf(i,a)}}return n}}function Kf(e,t){if(e==null)return null;if(typeof e=="string")return Ws(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],s=e.length;for(let i=0;i<s;++i){const a=e[i];c1(t,i,a)?n.push(a):n.push(Kf(a,t))}return n}else{const n={};for(const s of Object.keys(e)){const i=e[s],a=Ws(s);(s==="name"||s==="className")&&typeof i=="string"?n[a]=i:n[a]=Kf(i,s)}return n}}/** @license See the LICENSE file. */const u1="3.18.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class is extends qt{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=ih(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],hi(this.inputs).length!==this.inputs.length)throw new nt(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);hi(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const y=b.sourceLayer,v=b.nodeIndex,w=b.tensorIndex;this.outputLayers.push(y),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(w)}for(const b of this.inputs){const y=b.sourceLayer,v=b.nodeIndex,w=b.tensorIndex;Es(v===0,"input layer has >1 nodes"),Es(w===0,"input layer has >1 tensors"),this.inputLayers.push(y),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const y=this.inputLayers[b];if(!(y instanceof vl))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${y.getClassName()}.`);this.inputNames.push(y.name),this.feedInputShapes.push(y.batchInputShape),this.feedInputNames.push(y.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},s={},i={},a={},u={},o=[],r=(b,y,v,w,C,S)=>{(w==null||C==null||S==null)&&(w=b.sourceLayer,C=b.nodeIndex,S=b.tensorIndex);const k=w.inboundNodes[C];if(v.indexOf(k)!==-1)throw new Gn(`The tensor ${b.name} at layer "${w.name}" is part of a cycle.`);if(y.indexOf(k)!==-1)return;this.containerNodes.add(is.nodeKey(w,C)),w.id in u||(u[w.id]=Object.keys(u).length),v.indexOf(k)===-1&&v.push(k);const T=k.inboundLayers.length;for(let N=0;N<T;N++){const R=k.inputTensors[N],L=k.inboundLayers[N],z=k.nodeIndices[N],U=k.tensorIndices[N];r(R,y,v,L,z,U)}for(y.push(k);v.indexOf(k)>=0;)v.splice(v.indexOf(k),1);o.push(k)},l=[],h=[];for(const b of this.outputs)r(b,l,h);const c=o.slice().reverse();for(const b of c){s[b.id]=b,b.id in n||(n[b.id]=0);let y=n[b.id];const v=i[b.outboundLayer.id]==null?0:i[b.outboundLayer.id];y=Math.max(y,v),i[b.outboundLayer.id]=y,a[b.outboundLayer.id]=b.outboundLayer,n[b.id]=y;for(let w=0;w<b.inboundLayers.length;w++){const C=b.inboundLayers[w],S=b.nodeIndices[w],k=C.inboundNodes[S],T=n[k.id]==null?0:n[k.id];n[k.id]=Math.max(y+1,T),s[k.id]=k}}const f={};for(const b in n){const y=n[b];y in f||(f[y]=[]),f[y].push(s[b])}const d={};for(const b in i){const y=i[b];y in d||(d[y]=[]),d[y].push(a[b])}let p=Object.keys(d).map(b=>parseInt(b,10)).sort(Ml);this.layers=[];for(const b of p){const y=d[b];y.sort((v,w)=>{const C=u[v.id],S=u[w.id];return C<S?-1:C>S?1:0});for(const v of y)v instanceof is&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=d,p=Object.keys(f).map(b=>parseInt(b,10)).sort(Ml);const m=this.inputs.slice(),g=[];for(const b of p)for(const y of f[b]){const v=y.outboundLayer;if(v!=null){for(const w of y.inputTensors)if(m.indexOf(w)===-1)throw new Gn(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(const w of y.outputTensors)m.push(w);g.push(v.name)}}this.nodesByDepth=f;const x=this.layers.map(b=>b.name);for(const b of x){const y=x.filter(v=>v===b).length;if(y!==1)throw new Gn(`The name "${b}" is used ${y} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new ah({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new nt("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const s={};let i=0;for(const u of this.layers)for(const o of u.weights){if(s[o.originalName]!=null)throw new nt(`Duplicate weight name: ${o.originalName}`);s[o.originalName]=o,i++}const a=[];for(const u in t){let o=u;if(s[u]==null){const r=u.split("/");o=r.slice(0,-2).concat([r[r.length-1]]).join("/")}if(s[o]!=null)a.push([s[o],t[u]]);else if(n)throw new nt(`Provided weight data has no target variable: ${u}`);delete s[o]}if(n){const u=[];for(const o in s)u.push(o);if(u.length>0)throw new nt(`${u.length} of ${i} weights are not set: ${u}`)}Wg(a)}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${u1}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const s=Kf(this.updatedConfig());return n?JSON.stringify(s):s}call(t,n){return lt(()=>{t=ue(t);const s=new oi;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],t[i]);return Mo(this.outputs,s,n)})}computeMask(t,n){return lt(()=>{t=ue(t);let s;return n==null?s=dr(null,t.length):s=ue(n),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const n=mc(t);if(n.length!==this.inputLayers.length)throw new nt(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let o=0;o<n.length;o++){const r=this.inputLayers[o],l=n[o],h=r.name+"_0_0";s[h]=l}const i=Object.keys(this.nodesByDepth).map(o=>parseInt(o,10)).sort(Ml);if(i.length>1)for(const o of i){const r=this.nodesByDepth[o];for(const l of r){const h=l.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(h.id)!==-1)continue;const c=[];for(let m=0;m<l.inboundLayers.length;m++){const g=l.inboundLayers[m],x=l.nodeIndices[m],b=l.tensorIndices[m],y=`${g.name}_${x}_${b}`,v=s[y];c.push(v)}const f=h.computeOutputShape(un(c)),d=mc(f),p=h.inboundNodes.indexOf(l);for(let m=0;m<d.length;m++){const g=`${h.name}_${p}_${m}`;s[g]=d[m]}}}const a=[],u=[];for(let o=0;o<this.outputLayers.length;o++){const r=this.outputLayers[o],l=this.outputLayersNodeIndices[o],h=this.outputLayersTensorIndices[o],c=`${r.name}_${l}_${h}`;u.push(c)}for(let o=0;o<u.length;o++){const r=u[o];Es(r in s),a.push(s[r])}return un(a)}runInternalGraph(t,n){n==null&&(n=dr(null,t.length));const s={};for(let r=0;r<this.inputs.length;++r){const l=this.inputs[r],h=t[r],c=n[r];s[l.id]=[h,c]}const i=Object.keys(this.nodesByDepth).map(r=>parseInt(r,10)).sort(Ml);for(const r of i){const l=this.nodesByDepth[r];for(const h of l){const c=h.outboundLayer,f=h.inputTensors,d=h.outputTensors,p=new Array;for(const m of f)m.id in s&&p.push(s[m.id]);if(p.length===f.length){let m={},g,x,b,y;if(h.callArgs!=null&&(m=h.callArgs),p.length===1){const[v,w]=p[0];m.mask==null&&(m.mask=w),b=ue(c.call(v,m)),y=ue(c.computeMask(v,w)),g=[v],x=[w]}else g=p.map(v=>v[0]),x=p.map(v=>v[1]),m.mask==null&&(m.mask=x),b=ue(c.call(g,m)),y=ue(c.computeMask(g,x));if(c.activityRegularizer)throw new zt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<d.length;++v){const w=d[v],C=b[v],S=y[v];s[w.id]=[C,S]}}}}const a=[],u=[],o=[];for(const r of this.outputs){Es(r.id in s,`Could not compute output ${r.name} : ${r.id}`);const[l,h]=s[r.id];o.push(l.shape),a.push(l),u.push(h)}return[a,u,o]}buildNodeConversionMap(t){const n={};let s;for(const i of this.layers){s=i instanceof is?1:0;for(let a=0;a<i.inboundNodes.length;a++){const u=is.nodeKey(i,a);this.containerNodes.has(u)&&(n[u]=s,s+=1)}}return n}getLayer(t,n){if(n!=null){if(this.layers.length<=n)throw new nt(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}else if(t==null)throw new nt("Provide either a layer name or layer index");for(const s of this.layers)if(s.name===t)return s;throw new nt(`No such layer: ${t}`)}calculateLosses(){return lt(()=>{const t=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const i=is.nodeKey(n,s);this.containerNodes.has(i)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const u of this.layers){const o=u.getClassName(),r=u.getConfig(),l=[];for(let c=0;c<u.inboundNodes.length;c++){const f=u.inboundNodes[c],d=is.nodeKey(u,c);let p={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${u.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const m=[];for(let g=0;g<f.inboundLayers.length;g++){const x=f.inboundLayers[g],b=f.nodeIndices[g],y=f.tensorIndices[g],v=is.nodeKey(x,b);let w=n[v];w==null&&(w=0),m.push([x.name,w,y,p])}l.push(m)}}}const h={};h.name=u.name,h.className=o,h.config=r,h.inboundNodes=l,s.push(h)}t.layers=s;const i=[];for(let u=0;u<this.inputLayers.length;u++){const o=this.inputLayers[u],r=this.inputLayersNodeIndices[u],l=is.nodeKey(o,r);if(!this.containerNodes.has(l))continue;let h=n[l];h==null&&(h=0);const c=this.inputLayersTensorIndices[u];i.push([o.name,h,c])}t.inputLayers=i;const a=[];for(let u=0;u<this.outputLayers.length;u++){const o=this.outputLayers[u],r=this.outputLayersNodeIndices[u],l=is.nodeKey(o,r);if(!this.containerNodes.has(l))continue;let h=n[l];h==null&&(h=0);const c=this.outputLayersTensorIndices[u];a.push([o.name,h,c])}return t.outputLayers=a,t}static fromConfig(t,n,s={},i=!1){const a={},u={};function o(g,x){g.name in u?u[g.name].push(x):u[g.name]=[x]}function r(g,x){const b=[];let y;for(const v of x){const w=v[0],C=v[1],S=v[2];if(y=v[3]==null?{}:v[3],!(w in a)){o(g,x);return}const k=a[w];if(k.inboundNodes.length<=C){o(g,x);return}const T=k.inboundNodes[C];b.push(T.outputTensors[S])}b.length>0&&g.apply(un(b),y)}function l(g){const x=g.name,b=Hs(g,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(i),a[x]=b,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new nt(`Corrupted configuration, expected array for nodeData: ${v}`);o(b,v)})}const h=n.name,c=n.layers;for(const g of c)l(g);for(;!RO(u);)for(const g of c){const x=a[g.name];if(x.name in u){const b=u[x.name];delete u[x.name];for(const y of b)r(x,y)}}const f=[],d=[],p=n.inputLayers;for(const g of p){const x=g[0],b=g[1],y=g[2];Es(x in a);const w=a[x].inboundNodes[b].outputTensors;f.push(w[y])}const m=n.outputLayers;for(const g of m){const x=g[0],b=g[1],y=g[2];Es(x in a);const w=a[x].inboundNodes[b].outputTensors;d.push(w[y])}return new t({inputs:f,outputs:d,name:h})}get stateful(){if(this._stateful)throw new nt("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){lt(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XF(e,t,n){const s=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(i=>null);if(s===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==s)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){const i=[];return t.forEach(a=>{a in e?i.push(e[a]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function h1(e,t){return XF(e,t,"classWeight")}async function f1(e,t,n,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const i=lt(()=>{if(e.shape.length===1)return Zi(e);if(e.shape.length===2){if(e.shape[1]>1)return Ko(e,1);if(e.shape[1]===1)return it(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),a=Array.from(await i.data());Lt(i);const u=[];return a.forEach(o=>{if(n[o]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${o} exists in the data but not in classWeight`);u.push(n[o])}),wn(u,"float32")}else return null}function YF(e,t){return Z(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qF=32;function d1(e,t){let n,s;const i=t;n=i.xs,s=i.ys,P(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const a=Lx("input",e.inputNames,n),u=Lx("output",e.outputNames,s),o=a[0].shape[0];P(a.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),P(u.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${u.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let r=0;r<a.length;r++)P(a[r].shape[0]===o,()=>`Batch size mismatch: input ${e.inputNames[r]} has ${a[r].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);for(let r=0;r<u.length;r++)P(u[r].shape[0]===o,()=>`Batch size mismatch: output ${e.outputNames[r]} has ${u[r].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);return{xs:a,ys:u}}function Lx(e,t,n){if(n instanceof ge)return[n];if(Array.isArray(n))return P(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const s=[];for(const i of t){if(n[i]==null)throw new nt(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);s.push(n[i])}return s}}function KF(e){if(e.length===3)throw new zt("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function JF(e,t,n){const s=n.batchesPerEpoch!=null;if(P(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),P(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),P(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),P(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),P(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=n.validationData!=null;let a,u;if(i)if(Bx(n.validationData))P(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=KF(n.validationData);a=g.xs,u=g.ys}const o=e.makeTrainFunction(),r=e.getDedupedMetricsNames();let l;i?l=r.slice().concat(r.map(g=>"val_"+g)):l=r.slice();const h=n1(n.callbacks,n.yieldEvery),c=n.verbose==null?1:n.verbose,{callbackList:f,history:d}=s1(h,c,n.epochs,null,null,ZF(t,n),null,i,l);f.setModel(e),e.history=d,await f.onTrainBegin(),e.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await t.iterator();for(;p<n.epochs;){const g={};await f.onEpochBegin(p);let x=0,b=0;for(s||(m=await t.iterator());!s||x<n.batchesPerEpoch;){const y=await m.next();if(s&&y.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(y.value!=null){const{xs:v,ys:w}=d1(e,y.value),C={};C.batch=b,C.size=v[0].shape[0],await f.onBatchBegin(b,C);const S=[];if(n.classWeight!=null){const N=h1(n.classWeight,e.outputNames);for(let R=0;R<N.length;++R)S.push(await f1(w[R],null,N[R]))}const k=v.concat(w).concat(S),T=o(k);Lt(k);for(let N=0;N<r.length;++N){const R=r[N],L=T[N];C[R]=L,ms(L)}await f.onBatchEnd(b,C),e1(C),b++,x++}if(s?x>=n.batchesPerEpoch:y.done){if(i){let v;Bx(n.validationData)?v=ue(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):v=ue(e.evaluate(a,u,{batchSize:n.validationBatchSize==null?qF:n.validationBatchSize,verbose:0}));for(let w=0;w<e.metricsNames.length;++w)g[`val_${e.metricsNames[w]}`]=v[w]}break}if(e.stopTraining_)break}if(await f.onEpochEnd(p,g),p++,e.stopTraining_)break}return await f.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function ZF(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function Bx(e){return typeof e.iterator=="function"}function QF(e){return typeof e.next=="function"}async function tP(e,t,n){n=n||{};const s=n.batches!=null,i=e.testFunction;let a=[];if(n.verbose>0)throw new zt("Verbose mode is not implemented yet.");P(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const u=QF(t)?t:await t.iterator();let o=0,r=0;for(;!s||r<n.batches;){const l=await u.next();if(a=lt(()=>{if(l.value){const{xs:h,ys:c}=d1(e,l.value),f=h.concat(c),d=lt(()=>i(f));if(Lt(f),r===0)for(let m=0;m<d.length;++m)a.push(Pt(0));const p=f[0].shape[0];for(let m=0;m<d.length;++m){const g=d[m],x=a[m];a[m]=lt(()=>yt(a[m],Z(p,g))),r>0&&Lt(x)}Lt(d),o+=p,++r}return a}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<a.length;++l){const h=a[l];a[l]=Nt(a[l],o),Lt(h)}return un(a)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jf(e){P(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function Lo(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(s=>nr(s,t,n-t)):nr(e,t,n-t)}function Hg(e,t){return lt(()=>e==null?null:Array.isArray(e)?e.map(n=>Hg(n,t)):Wy(e,t.dtype==="int32"?t:St(t,"int32")))}function Zf(e,t){const n=[];let s=0,i=null;for(;s<e;)i=s+t,i>=e&&(i=e),n.push([s,i]),s=i;return n}async function eP(e,t,n,s,i,a,u,o,r,l,h,c,f,d,p){i==null&&(i=32),a==null&&(a=1),h==null&&(h=!0),f==null&&(f=0);let m=!1;if(r!=null&&l!=null&&(m=!0),p!=null&&(m=!0,d==null))throw new nt("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=e.checkNumSamples(n,i,d,"steps_per_epoch");let x;g!=null&&(x=xs(0,g)),u==null&&(u=1);const{callbackList:b,history:y}=s1(o,u,a,f,g,d,i,m,c);b.setModel(e),e.history=y,await b.onTrainBegin(),e.stopTraining_=!1;for(let v=f;v<a;++v){await b.onEpochBegin(v);const w={};if(d!=null)throw new zt("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new zt("batch shuffling is not implemneted yet");h&&DT(x);const C=wn(x),S=Zf(g,i);for(let k=0;k<S.length;++k){const T={};if(await b.onBatchBegin(k,T),lt(()=>{const N=S[k][0],R=S[k][1],L=nr(C,N,R-N);T.batch=k,T.size=R-N;const z=Hg(n,L),U=t(z);for(let H=0;H<s.length;++H){const Y=s[H],Q=U[H];T[Y]=Q,ms(Q)}if(k===S.length-1&&m){const H=e.testLoop(r,l,i);for(let Y=0;Y<s.length;++Y){const Q=s[Y],K=H[Y];ms(K),w["val_"+Q]=K}}}),await b.onBatchEnd(k,T),e1(T),e.stopTraining_)break}C.dispose()}if(await b.onEpochEnd(v,w),e.stopTraining_)break}return await b.onTrainEnd(),await e.history.syncData(),e.history}async function nP(e,t,n,s={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;let i,a,u,o,r,l,h,c,f;try{const d=s.batchSize==null?32:s.batchSize;Jf(d);const p=!1,m=await e.standardizeUserData(t,n,s.sampleWeight,s.classWeight,p,d);i=m[0],a=m[1],f=m[2];let g=!1,x;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)r=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new zt("validationData including sample weights is not supported yet."):new nt(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const T=!0,N=await e.standardizeUserData(r,l,null,null,T,d);h=N[0],c=N[1],x=h.concat(c)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const T=Math.floor(i[0].shape[0]*(1-s.validationSplit)),N=i[0].shape[0];h=Lo(i,T,N),u=i,i=Lo(i,0,T),c=Lo(a,T,N),o=a,a=Lo(a,0,T),x=h.concat(c)}else s.validationSteps!=null&&(g=!0);const b=i.concat(a).concat(f);e.checkTrainableWeightsConsistency();const y=e.makeTrainFunction(),v=e.getDedupedMetricsNames();let w,C;g?(e.makeTestFunction(),w=e.testFunction,C=v.slice().concat(v.map(T=>"val_"+T))):(w=null,x=[],C=v.slice());const S=n1(s.callbacks,s.yieldEvery);return await eP(e,y,b,v,d,s.epochs,s.verbose,S,w,x,s.shuffle,C,s.initialEpoch,null,null)}finally{e.isTraining=!1,as(i,t),as(a,n),as(u,t),as(o,n),as(h,r),as(c,l),f!=null&&Lt(f)}}function p1(e){const t=[];e instanceof ge&&(e=[e]);for(let n=0;n<e.length;++n){const s=e[n];if(s.rank===1)t.push(ml(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function as(e,t){if(e==null)return;const n=[];if(t instanceof ge)n.push(t.id);else if(Array.isArray(t))t.forEach(i=>n.push(i.id));else if(t!=null)for(const i in t){const a=t[i];n.push(a.id)}const s=[];if(e instanceof ge)n.indexOf(e.id)===-1&&s.push(e);else if(Array.isArray(e))e.forEach(i=>{n.indexOf(i.id)===-1&&s.push(i)});else if(e!=null)for(const i in e){const a=e[i];n.indexOf(a.id)===-1&&s.push(a)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sP(e){return e instanceof ge}function Qf(e){return Array.isArray(e)}function zx(e){return!sP(e)&&!Qf(e)}function Wx(e,t,n,s=!0,i=""){if(t==null||t.length===0){if(e!=null){let u=!1;if(Qf(e)&&e.length>0)u=!0;else if(zx(e)){for(const o in e)if(e.hasOwnProperty(o)){u=!0;break}}else u=!0;if(u)throw new nt(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(u=>null);let a;if(zx(e)){e=e,a=[];for(const u of t){if(e[u]==null)throw new nt(`No data provided for "${u}". Need data for each key in: ${t}`);a.push(e[u])}}else if(Qf(e)){if(e=e,e.length!==t.length)throw new nt(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);a=e}else{if(e=e,t.length>1)throw new nt(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);a=[e]}if(a=p1(a),n!=null)for(let u=0;u<t.length;++u){if(n[u]==null)continue;const o=a[u];if(o.shape.length!==n[u].length)throw new nt(`Error when checking ${i}: expected ${t[u]} to have ${n[u].length} dimension(s). but got array with shape ${o.shape}`);for(let r=0;r<n[u].length;++r){if(r===0&&!s)continue;const l=o.shape[r],h=n[u][r];if(h!=null&&h>=0&&l!==h)throw new nt(`${i} expected a batch of elements where each example has shape [${n[u].slice(1,n[u].length)}] (i.e.,tensor shape [*,${n[u].slice(1,n[u].length)}]) but the ${i} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return a}function iP(e,t,n){const s=hi(e.map(a=>a.shape[0]));s.sort();const i=hi(t.map(a=>a.shape[0]));if(i.sort(),s.length>1)throw new nt(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(a=>a.shape))}`);if(i.length>1)throw new nt(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(a=>a.shape))}`);if(s.length>0&&i.length>0&&!Qt(s,i))throw new nt(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function rP(e,t,n){const s=[lh,ch,ta];for(let i=0;i<e.length;++i){const a=e[i],u=t[i],o=n[i];if(u!=null){if(u===ta&&a.shape[a.shape.length-1]===1)throw new nt(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(u)!==-1){const r=a.shape.slice(1),l=o.slice(1);for(let h=0;h<r.length;++h){const c=r[h],f=l[h];if(f!=null&&c!==f)throw new nt(`A target Tensor with shape ${a.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Vx(e,t,n,s=!0,i=""){let a;if(Array.isArray(e)){if(e.length!==t.length)throw new nt(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);a=e}else{if(t.length>1)throw new nt(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);a=[e]}if(n!=null)for(let u=0;u<t.length;++u){if(n[u]==null)continue;const o=a[u];if(o.shape.length!==n[u].length)throw new nt(`Error when checking ${i}: expected ${t[u]} to have ${n[u].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let r=0;r<n[u].length;++r){if(r===0&&!s)continue;const l=o.shape[r],h=n[u][r];if(h!=null&&h!==l)throw new nt(`Error when checking ${i}: expected ${t[u]} to have shape ${JSON.stringify(n[u])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}function oP(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(s=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(s=>n);{const s=[];for(const i of t){let a=n.hasOwnProperty(i)?n[i]:[];Array.isArray(a)||(a=[a]),s.push(a)}return s}}const aP="layers-model";class Gr extends is{constructor(t){super(t),this.isTraining=!1}summary(t,n,s=console.log){if(!this.built)throw new nt("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");VF(this,t,n,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=WF(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof _i))throw new nt("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const u in t.loss)if(this.outputNames.indexOf(u)===-1)throw new nt(`Unknown entry in loss dictionary: "${u}". Only expected the following keys: ${this.outputNames}`);for(const u of this.outputNames)t.loss[u]==null&&console.warn(`Output "${u}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${u} during training`),n.push(zh(t.loss[u]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new nt(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(o=>zh(o))}else{const u=zh(t.loss);this.outputs.forEach(o=>{n.push(u)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let u=0;u<this.outputs.length;++u){const o=this.internalOutputShapes[u],r=this.outputNames[u];this.feedOutputNames.push(r),this.feedOutputShapes.push(o),this.feedLossFns.push(this.lossFunctions[u])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],er("loss",()=>{for(let u=0;u<this.outputs.length;++u){if(s.indexOf(u)!==-1)continue;const o=this.lossFunctions[u];this.outputs.length>1&&(this.metricsTensors.push([o,u]),this.metricsNames.push(this.outputNames[u]+"_loss"))}});const i=oP(t.metrics,this.outputNames),a=(u,o,r)=>{this.outputNames.length>1&&(o=this.outputNames[u]+"_"+o),this.metricsNames.push(o),this.metricsTensors.push([r,u])};er("metric",()=>{for(let u=0;u<this.outputs.length;++u){if(s.indexOf(u)!==-1)continue;const o=i[u];(l=>{const h="";let c,f,d;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[u];g[g.length-1]===1||this.lossFunctions[u]===ch?["accuracy","acc"].indexOf(p)!==-1?f=r1:["crossentropy","ce"].indexOf(p)!==-1&&(f=DF):this.lossFunctions[u]===wc?["accuracy","acc"].indexOf(p)!==-1?f=AF:["crossentropy","ce"].indexOf(p)!==-1&&(f=l1):["accuracy","acc"].indexOf(p)!==-1?f=o1:["crossentropy","ce"].indexOf(p)!==-1&&(f=a1);let x;["accuracy","acc"].indexOf(p)!==-1?x="acc":["crossentropy","ce"].indexOf(p)!==-1&&(x="ce"),d=f,c=h+x}else d=zF(p),c=h+zl(p);let m;er(c,()=>{m=d}),a(u,c,m)}})(o)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,s={}){const i=s.batchSize==null?32:s.batchSize;Jf(i);const a=!0,u=this.standardizeUserDataXY(t,n,a,i);try{const o=u[0].concat(u[1]);this.makeTestFunction();const r=this.testFunction,l=this.testLoop(r,o,i,s.verbose,s.steps);return un(l)}finally{as(u[0],t),as(u[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),tP(this,t,n)}checkNumSamples(t,n,s,i="steps"){let a;if(s!=null){if(a=null,n!=null)throw new nt(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?a=t[0].shape[0]:a=t.shape[0];else throw new nt(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return a}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new nt("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),i=s?n:[n],a=this.retrieveSymbolicTensors(i),u=new oi;if(t instanceof ge&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new nt(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let r=0;r<this.inputs.length;++r)u.add(this.inputs[r],t[r])}else for(const r of this.inputs){const l=t[r.name];if(l==null)throw new nt(`No value is provided for the model's input ${r.name}`);u.add(r,l)}const o=Mo(a,u);return s?o:o[0]}retrieveSymbolicTensors(t){const n=dr(null,t.length);let s=t.length;for(const i of this.layers){const a=Array.isArray(i.output)?i.output:[i.output],u=a.map(o=>o.name);for(let o=0;o<t.length;++o){const r=u.indexOf(t[o]);if(r!==-1&&(n[o]=a[r],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw n.forEach((a,u)=>{a==null&&i.push(t[u])}),new nt(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(t,n=32,s=!1){return lt(()=>{const i=this.checkNumSamples(t);if(s)throw new zt("Verbose predictLoop() is not implemented yet.");const a=Zf(i,n),u=this.outputs.map(o=>[]);for(let o=0;o<a.length;++o)lt(()=>{const l=a[o][0],h=a[o][1],c=Lo(t,l,h),f=[];if(Array.isArray(c))for(let p=0;p<c.length;++p)f.push({key:this.inputs[p],value:c[p]});else f.push({key:this.inputs[0],value:c});const d=new oi(f);return Mo(this.outputs,d)}).forEach((l,h)=>u[h].push(l));return un(u.map(o=>we(o,0)))})}predict(t,n={}){const s=p1(t);Vx(s,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return Jf(i),this.predictLoop(s,i)}finally{as(s,t)}}predictOnBatch(t){Vx(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,s=!0,i){if(this.optimizer_==null)throw new Gn("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let u=0;u<this.feedOutputShapes.length;++u){const o=this.feedOutputShapes[u];this.feedLossFns[u]===wc?a.push(o.slice(0,o.length-1).concat([1])):a.push(o)}if(t=Wx(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=Wx(n,this.feedOutputNames,a,!1,"target"),iP(t,n),rP(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new nt(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,s,i,a=!0,u){const[o,r]=this.standardizeUserDataXY(t,n,a,u);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(i!=null){const h=h1(i,this.outputNames);l=[];for(let c=0;c<h.length;++c)l.push(await f1(r[c],null,h[c]))}return[o,r,l]}testLoop(t,n,s,i=0,a){return lt(()=>{const u=this.checkNumSamples(n,s,a,"steps"),o=[];if(i>0)throw new zt("Verbose mode is not implemented yet.");if(a!=null)throw new zt("steps mode in testLoop() is not implemented yet");{const r=Zf(u,s),l=wn(xs(0,u));for(let h=0;h<r.length;++h){const c=r[h][0],f=r[h][1],d=nr(l,c,f-c),p=Hg(n,d),m=t(p);if(h===0)for(let g=0;g<m.length;++g)o.push(Pt(0));for(let g=0;g<m.length;++g){const x=m[g];o[g]=yt(o[g],Z(f-c,x))}}for(let h=0;h<o.length;++h)o[h]=Nt(o[h],u)}return o})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let s=0;s<t.length;++s){const i=t[s];let a=i;Tx(t,i)>1&&(a+=`_${Tx(t.slice(0,s),i)}`),n.push(a)}return n}makeTrainFunction(){return t=>{const n=[],s=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),u=[],o=()=>{const c=[];for(let m=0;m<this.inputs.length;++m)c.push({key:this.inputs[m],value:s[m]});const f=new oi(c),d=Mo(this.outputs,f,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){let x=this.lossFunctions[m](i[m],d[m]);a[m]!=null&&(x=YF(x,a[m]));const b=ye(x);n.push(b),m===0?p=x:p=yt(p,x)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const x=this.metricsTensors[m][0],b=this.metricsTensors[m][1];g=ye(x(i[b],d[b]))}ms(g),u.push(g)}return p=ye(p),this.calculateLosses().forEach(m=>{p=yt(p,m)}),p},r=this.collectedTrainableWeights.map(c=>c.read()),l=!0;return[this.optimizer_.minimize(o,l,r)].concat(u)}}makeTestFunction(){this.testFunction=t=>lt(()=>{const n=[];let s;const i=t.slice(0,this.inputs.length),a=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),u=[];for(let l=0;l<this.inputs.length;++l)u.push({key:this.inputs[l],value:i[l]});const o=new oi(u),r=Mo(this.outputs,o);for(let l=0;l<this.lossFunctions.length;++l){const h=this.lossFunctions[l],c=ye(h(a[l],r[l]));l===0?s=c:s=yt(s,c),n.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const h=this.metricsTensors[l][0],c=this.metricsTensors[l][1],f=ye(h(a[c],r[c]));n.push(f)}return n})}async fit(t,n,s={}){return nP(this,t,n,s)}async fitDataset(t,n){return JF(this,t,n)}async trainOnBatch(t,n){const s=await this.standardizeUserData(t,n),i=s[0],a=s[1],o=this.makeTrainFunction()(i.concat(a)),r=[];for(const l of o){const h=await l.data();r.push(h[0])}return Lt(o),as(s[0],t),as(s[1],n),un(r)}getNamedWeights(t){const n=[],s=t!=null&&t.trainableOnly,i=s?this.trainableWeights:this.weights,a=this.getWeights(s);for(let u=0;u<i.length;++u)s&&!i[u].trainable||n.push({name:i[u].originalName,tensor:a[u]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=Ff().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-Ff().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Ws(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Ws(n))}else{const n=Object.keys(this.loss);t={};const s=this.loss;for(const i of n)if(typeof s[i]=="string")t[i]=Ws(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ws(zl(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Ws(zl(t)));{const t={};for(const n in this.metrics)t[n]=Ws(zl(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=qf(t.optimizer_config),s=Hs(n);let i;if(typeof t.loss=="string")i=Gi(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(u=>Gi(u));else if(t.loss!=null){i={};for(const u in t.loss)i[u]=Gi(t.loss[u])}let a;if(Array.isArray(t.metrics))a=t.metrics.map(u=>Gi(u));else if(t.metrics!=null){a={};for(const u in t.metrics)a[u]=Gi(t.metrics[u])}this.compile({loss:i,metrics:a,optimizer:s})}async save(t,n){if(typeof t=="string"){const l=S_(t);if(l.length===0)throw new nt(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new nt(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new nt("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await ax(this.getNamedWeights(n)),i=!1,a=null,o={modelTopology:this.toJSON(a,i),format:aP,generatedBy:`TensorFlow.js tfjs-layers v${u1}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){o.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:h,specs:c}=await ax(await this.optimizer.getWeights(),l);s.specs.push(...c),s.data=rv([s.data,h])}return this.userDefinedMetadata!=null&&(Mx(this.userDefinedMetadata,this.name,!0),o.userDefinedMetadata=this.userDefinedMetadata),o.weightData=s.data,o.weightSpecs=s.specs,t.save(o)}setUserDefinedMetadata(t){Mx(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Gr.className="Model";bt(Gr);class g1 extends Gr{}g1.className="Functional";bt(g1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ea extends Gr{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:ih("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new nt(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof ea||t instanceof Gr;let s;if(n){if(s=t,s.outputs.length!==1)throw new nt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new nt("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new nt("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=lF({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new nt(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new nt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Ky(this.outputs[0])}this.inboundNodes=[],new ah({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:dr(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(te(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Gr({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,s=console.log){this.built||this.build(),super.summary(t,n,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,s={}){if(!this.built)throw new Gn("The model needs to be compiled before being used.");return this.model.evaluate(t,n,s)}async evaluateDataset(t,n){if(!this.built)throw new Gn("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,s={}){if(!this.built)throw new Gn("The model needs to be compiled before being used.");return this.model.fit(t,n,s)}async fitDataset(t,n){if(!this.built)throw new Gn("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,s={},i=!1){let a,u={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new nt("Legacy serialization format not supported yet.");a=n}else P(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=n.layers,delete n.layers,u=n;const o=new t(u);if(!(o instanceof ea))throw new zt(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const r of a){const h=Hs(r,void 0,i);i&&h.setFastWeightInitDuringBuild(!0),o.add(h)}return o}set stopTraining(t){if(this.model==null)throw new nt("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new nt("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),t.push(s)}return{name:this.name,layers:t}}}ea.className="Sequential";bt(ea);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gn extends mo{getConfig(){return{}}}class m1 extends gn{apply(t,n=1){return YO(t,n)}}m1.className="elu";bt(m1);class x1 extends gn{apply(t){return Jv(t)}}x1.className="selu";bt(x1);class b1 extends gn{apply(t){return Zs(t)}}b1.className="relu";bt(b1);class v1 extends gn{apply(t){return lt(()=>tr(6,Zs(t)))}}v1.className="relu6";bt(v1);class y1 extends gn{apply(t){return t}}y1.className="linear";bt(y1);class w1 extends gn{apply(t){return xo(t)}}w1.className="sigmoid";bt(w1);class C1 extends gn{apply(t){return KO(t)}}C1.className="hardSigmoid";bt(C1);class S1 extends gn{apply(t){return cl(t)}}S1.className="softplus";bt(S1);class k1 extends gn{apply(t){return qO(t)}}k1.className="softsign";bt(k1);class I1 extends gn{apply(t){return Ap(t)}}I1.className="tanh";bt(I1);class jg extends gn{apply(t,n=-1){return qp(t,n)}}jg.className="softmax";bt(jg);class T1 extends gn{apply(t,n=-1){return Pv(t,n)}}T1.className="logSoftmax";bt(T1);class _1 extends gn{apply(t,n=1){return lt(()=>Z(xo(Z(t,n)),t))}}_1.className="swish";bt(_1);class $1 extends gn{apply(t){return lt(()=>Z(t,Ap(cl(t))))}}$1.className="mish";bt($1);function xi(e){return e.getClassName()}function Wh(e,t={}){return gl(e,zn.getMap().classNameMap,t,"activation")}function bi(e){if(e==null){const t={};return t.className="linear",t.config={},Wh(t)}if(typeof e=="string"){const t={};return t.className=e,t.config={},Wh(t)}else return e instanceof gn?e:Wh(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lP(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}class E1 extends mo{}class N1 extends E1{constructor(t){super(),lP(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return lt(()=>{let n=ae([1]);return this.hasL1&&(n=yt(n,Et(Z(this.l1,Le(t))))),this.hasL2&&(n=yt(n,Et(Z(this.l2,xl(t))))),it(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}N1.className="L1L2";bt(N1);const Ux={l1l2:"L1L2"};function se(e){return Dg(e)}function Gx(e,t={}){return gl(e,zn.getMap().classNameMap,t,"regularizer")}function pe(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in Ux?Ux[e]:e,config:{}};return Gx(n)}else return e instanceof E1?e:Gx(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class D1 extends qt{constructor(t){super(t==null?{}:t),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=Wt(t);let s=Zs(t);return this.maxValue!=null&&(s=Sn(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}D1.className="ReLU";bt(D1);class A1 extends qt{constructor(t){super(t==null?{}:t),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const s=Wt(t);return Lp(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}A1.className="LeakyReLU";bt(A1);class R1 extends qt{constructor(t){if(super(t==null?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=de(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=pe(t.alphaRegularizer),this.alphaConstraint=Ae(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new nt(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=te(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)s[i]=t[i];this.inputSpec=[new Ne({ndim:t.length,axes:s})],this.built=!0}call(t,n){return t=Wt(t),Hp(t,this.alpha.read())}getConfig(){const t={alphaInitializer:me(this.alphaInitializer),alphaRegularizer:se(this.alphaRegularizer),alphaConstraint:De(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}R1.className="PReLU";bt(R1);class O1 extends qt{constructor(t){if(super(t==null?{}:t),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new zt(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const s=Wt(t);return qu(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}O1.className="ELU";bt(O1);class F1 extends qt{constructor(t){super(t==null?{}:t),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const s=Wt(t);return Z(s,St(Qn(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}F1.className="ThresholdedReLU";bt(F1);class P1 extends qt{constructor(t){super(t==null?{}:t),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new jg().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){const s=Wt(t);return this.softmax(s,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}P1.className="Softmax";bt(P1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hr(e,t,n){if(typeof e=="number")return dr(e,t);if(e.length!==t)throw new nt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let s=0;s<t;++s){const i=e[s];if(!GO(i))throw new nt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${i}`)}return e}function gs(e,t,n,s,i=1){if(e==null)return e;const a=t+(t-1)*(i-1);let u;return n==="same"?u=e:u=e-a+1,Math.floor((u+s-1)/s)}function Ns(e,t,n,s){if(e==null)return null;if(s==="valid")e=e*t+mi([n-t,0]);else if(s==="same")e=e*t;else throw new nt(`Unsupport padding mode: ${s}.`);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xg(e,t){return lt(()=>(Ie(t),t==="channelsFirst"?Xt(e,[0,2,3,1]):e))}function M1(e,t){return lt(()=>(Ie(t),t==="channelsFirst"?Xt(e,[0,2,3,4,1]):e))}function cP(e,t,n,s=1,i="valid",a,u=1){return lt(()=>{if(a==null&&(a=bs()),Ie(a),e.shape.length!==3)throw new nt(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new nt(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new nt(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(a==="channelsFirst"&&(e=Xt(e,[0,2,1])),i==="causal")throw new zt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=_v(e,t,s,i==="same"?"same":"valid","NWC",u);return n!=null&&(o=ws(o,n)),o})}function Hx(e,t,n,s=[1,1],i="valid",a,u,o=null){return lt(()=>{if(a==null&&(a=bs()),Ie(a),e.rank!==3&&e.rank!==4)throw new nt(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new nt(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let r=Xg(e,a);if(i==="causal")throw new zt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return r=aD({x:r,filter:t,strides:s,pad:i==="same"?"same":"valid",dilations:u,dataFormat:"NHWC",bias:n,activation:o}),a==="channelsFirst"&&(r=Xt(r,[0,3,1,2])),r})}function uP(e,t,n,s=[1,1,1],i="valid",a,u){return lt(()=>{if(a==null&&(a=bs()),Ie(a),e.rank!==4&&e.rank!==5)throw new nt(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new nt(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=M1(e,a);if(i==="causal")throw new zt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=S$(o,t,s,i==="same"?"same":"valid","NDHWC",u),n!=null&&(o=ws(o,n)),a==="channelsFirst"&&(o=Xt(o,[0,4,1,2,3])),o})}class uh extends qt{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",uh.verifyArgs(n),this.rank=t,ze(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new zt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Hr(n.kernelSize,t,"kernelSize"),this.strides=Hr(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,On(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Ie(this.dataFormat),this.activation=bi(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=de(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ae(n.biasConstraint),this.biasRegularizer=pe(n.biasRegularizer),this.activityRegularizer=pe(n.activityRegularizer),this.dilationRate=Hr(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new nt(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new nt(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new nt(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Es("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Ag(t.kernelSize,"number",1,3))throw new nt(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xi(this.activation),useBias:this.useBias,biasInitializer:me(this.biasInitializer),biasRegularizer:se(this.biasRegularizer),activityRegularizer:se(this.activityRegularizer),biasConstraint:De(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class wo extends uh{constructor(t,n){super(t,n),this.kernel=null,wo.verifyArgs(n),this.filters=n.filters,ze(this.filters,"filters"),this.kernelInitializer=de(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ae(n.kernelConstraint),this.kernelRegularizer=pe(n.kernelRegularizer)}build(t){t=te(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new nt(`The channel dimension of the input should be defined. Found ${t[n]}`);const s=t[n],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(t,n){return lt(()=>{t=Wt(t);let s;const i=this.bias==null?null:this.bias.read(),a=Fy(this.activation.getClassName());if(a!=null&&this.rank===2)s=Hx(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(this.rank===1)s=cP(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Hx(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=uP(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new zt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=te(t);const n=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let a=0;a<s.length;++a){const u=gs(s[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);n.push(u)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const t={filters:this.filters,kernelInitializer:me(this.kernelInitializer),kernelRegularizer:se(this.kernelRegularizer),kernelConstraint:De(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new nt(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class wl extends wo{constructor(t){super(2,t),wl.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!Ag(t.kernelSize,"number",1,2))throw new nt(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}wl.className="Conv2D";bt(wl);class Cl extends wo{constructor(t){super(3,t),Cl.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new nt(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Cl.className="Conv3D";bt(Cl);class L1 extends wl{constructor(t){if(super(t),this.inputSpec=[new Ne({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new nt(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=te(t),t.length!==4)throw new nt("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new nt("The channel dimension of the inputs should be defined. Found `None`.");const s=t[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ne({ndim:4,axes:{[n]:s}})],this.built=!0}call(t,n){return lt(()=>{let s=Wt(t);if(s.shape.length!==4)throw new nt(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,a=i[0];let u,o;this.dataFormat==="channelsFirst"?(u=2,o=3):(u=1,o=2);const r=i[u],l=i[o],h=this.kernelSize[0],c=this.kernelSize[1],f=this.strides[0],d=this.strides[1],p=Ns(r,f,h,this.padding),m=Ns(l,d,c,this.padding),g=[a,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=Xt(s,[0,2,3,1]));let x=$v(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Xt(x,[0,3,1,2])),this.bias!=null&&(x=ws(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(t){t=te(t);const n=t.slice();let s,i,a;this.dataFormat==="channelsFirst"?(s=1,i=2,a=3):(s=3,i=1,a=2);const u=this.kernelSize[0],o=this.kernelSize[1],r=this.strides[0],l=this.strides[1];return n[s]=this.filters,n[i]=Ns(n[i],r,u,this.padding),n[a]=Ns(n[a],l,o,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}L1.className="Conv2DTranspose";bt(L1);class B1 extends Cl{constructor(t){if(super(t),this.inputSpec=[new Ne({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new nt(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=te(t),t.length!==5)throw new nt("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new nt("The channel dimension of the inputs should be defined. Found `None`.");const s=t[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ne({ndim:5,axes:{[n]:s}})],this.built=!0}call(t,n){return lt(()=>{let s=Wt(t);if(s.shape.length!==5)throw new nt(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,a=i[0];let u,o,r;this.dataFormat==="channelsFirst"?(r=2,u=3,o=4):(r=1,u=2,o=3);const l=i[r],h=i[u],c=i[o],f=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],x=this.strides[2],b=Ns(l,m,f,this.padding),y=Ns(h,g,d,this.padding),v=Ns(c,x,p,this.padding),w=[a,b,y,v,this.filters];this.dataFormat!=="channelsLast"&&(s=Xt(s,[0,2,3,4,1]));let C=T$(s,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Xt(C,[0,4,1,2,3])),this.bias!==null&&(C=ws(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(t){t=te(t);const n=t.slice();let s,i,a,u;this.dataFormat==="channelsFirst"?(s=1,i=2,a=3,u=4):(s=4,i=1,a=2,u=3);const o=this.kernelSize[0],r=this.kernelSize[1],l=this.kernelSize[2],h=this.strides[0],c=this.strides[1],f=this.strides[2];return n[s]=this.filters,n[i]=Ns(n[i],h,o,this.padding),n[a]=Ns(n[a],c,r,this.padding),n[u]=Ns(n[u],f,l,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}B1.className="Conv3DTranspose";bt(B1);class z1 extends wo{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new nt("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new nt("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new nt(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=de(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=pe(n.depthwiseRegularizer),this.depthwiseConstraint=Ae(n.depthwiseConstraint),this.pointwiseInitializer=de(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=pe(n.pointwiseRegularizer),this.pointwiseConstraint=Ae(n.pointwiseConstraint)}build(t){if(t=te(t),t.length<this.rank+2)throw new nt(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new nt(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const s=t[n],i=this.kernelSize.concat([s,this.depthMultiplier]),a=[];for(let o=0;o<this.rank;++o)a.push(1);a.push(s*this.depthMultiplier,this.filters);const u=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,u,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,u,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,u,this.biasConstraint):this.bias=null,this.inputSpec=[new Ne({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(t,n){return lt(()=>{t=Wt(t);let s;if(this.rank===1)throw new zt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Xt(t,[0,2,3,1])),s=Zv(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=ws(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Xt(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=me(this.depthwiseInitializer),t.pointwiseInitializer=me(this.pointwiseInitializer),t.depthwiseRegularizer=se(this.depthwiseRegularizer),t.pointwiseRegularizer=se(this.pointwiseRegularizer),t.depthwiseConstraint=De(this.depthwiseConstraint),t.pointwiseConstraint=De(this.pointwiseConstraint),t}}z1.className="SeparableConv";class W1 extends z1{constructor(t){super(2,t)}}W1.className="SeparableConv2D";bt(W1);class hh extends wo{constructor(t){super(1,t),hh.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!Ag(t.kernelSize,"number",1,1))throw new nt(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}hh.className="Conv1D";bt(hh);class V1 extends qt{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return lt(()=>{if(t=Wt(t),this.dataFormat==="channelsLast"){const s=Bl(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Bl(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Bl(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Bl(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}V1.className="Cropping2D";bt(V1);class U1 extends qt{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ie(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,WO(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,s]}else{const n=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],n,s,t[3]]}}call(t,n){return lt(()=>{let s=Wt(t);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=Xt(s,[0,2,3,1]);const a=this.size[0]*i[2],u=this.size[1]*i[3],o=this.interpolation==="nearest"?Pl.resizeNearestNeighbor(s,[a,u]):Pl.resizeBilinear(s,[a,u]);return Xt(o,[0,3,1,2])}else{const a=this.size[0]*i[1],u=this.size[1]*i[2];return this.interpolation==="nearest"?Pl.resizeNearestNeighbor(s,[a,u]):Pl.resizeBilinear(s,[a,u])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}U1.className="UpSampling2D";bt(U1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hP(e,t,n=[1,1],s="valid",i,a){return lt(()=>{i==null&&(i=bs()),Ie(i);let u=Xg(e,i);if(e.rank!==4)throw new nt(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new nt(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return u=Fp(u,t,n,s==="same"?"same":"valid","NHWC",a),i==="channelsFirst"&&(u=Xt(u,[0,3,1,2])),u})}class G1 extends uh{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=de(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ae(t.depthwiseConstraint),this.depthwiseRegularizer=pe(t.depthwiseRegularizer)}build(t){if(t=te(t),t.length<4)throw new nt(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new nt(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const s=t[n],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return lt(()=>{t=Wt(t);let s=hP(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=ws(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=te(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,a=gs(n,this.kernelSize[0],this.padding,this.strides[0]),u=gs(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,a,u]:[t[0],a,u,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=me(this.depthwiseInitializer),t.depthwiseRegularizer=se(this.depthwiseRegularizer),t.depthwiseConstraint=De(this.depthwiseRegularizer),t}}G1.className="DepthwiseConv2D";bt(G1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function H1(e,t,n,s){if(Array.isArray(e)){if(t!=null||n!=null)throw new nt("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=e.slice(e.length-s,e.length),e=e.slice(0,e.length-s)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(a){return a==null||Array.isArray(a)?a:[a]}return t=i(t),n=i(n),{inputs:e,initialState:t,constants:n}}function j1(e,t,n,s=!1,i,a,u=!1,o=!1){return lt(()=>{const r=t.shape.length;if(r<3)throw new nt(`Input should be at least 3D, but is ${r}D.`);const l=[1,0].concat(xs(2,r));if(t=Xt(t,l),a!=null)throw new zt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");u&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=St(St(i,"bool"),"float32"),i.rank===r-1&&(i=Bn(i,-1)),i=Xt(i,l)),s&&(t=ur(t,0),i!=null&&(i=ur(i,0)));const h=[];let c,f=n;const d=t.shape[0],p=so(t);let m;i!=null&&(m=so(i));for(let x=0;x<d;++x){const b=p[x],y=lt(()=>e(b,f));if(i==null)c=y[0],f=y[1];else{const v=lt(()=>{const w=m[x],C=Tt(Kn(w),w),S=yt(Z(y[0],w),Z(f[0],C)),k=f.map((T,N)=>yt(Z(y[1][N],w),Z(T,C)));return{output:S,newStates:k}});c=v.output,f=v.newStates}o&&h.push(c)}let g;return o&&(g=hr(h,1)),[c,g,f]})}class $i extends qt{constructor(t){super(t);let n;if(t.cell==null)throw new nt("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new Kg({cells:t.cell}):n=t.cell,n.stateSize==null)throw new nt("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Ne({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return xs(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){jf(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let i;if(this.returnSequences?i=[t[0],t[1],s]:i=[t[0],s],this.returnState){const a=[];for(const u of n)a.push([t[0],u]);return[i].concat(a)}else return i}computeMask(t,n){return lt(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(a=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<t;++s)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new zt("Constants support is not implemented in RNN yet.");jf(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new Ne({shape:[n,null,...s]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!Qt(this.stateSpec.map(u=>u.shape[u.shape.length-1]),a))throw new nt(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(u=>new Ne({shape:[null,u]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){lt(()=>{if(!this.stateful)throw new $s("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new nt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>ae([s,i])):this.states_=[ae([s,this.cell.stateSize])];else if(t==null)Lt(this.states_),this.keptStates!=null&&(Lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>ae([s,i])):this.states_[0]=ae([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new nt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):Lt(this.states_);for(let i=0;i<this.states_.length;++i){const a=t[i],u=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,o=[s,u];if(!Qt(a.shape,o))throw new nt(`State ${i} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${a.shape}`);this.states_[i]=a}}this.states_=this.states_.map(i=>ms(i.clone()))})}apply(t,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const a=H1(t,s,i,this.numConstants);t=a.inputs,s=a.initialState,i=a.constants;let u=[],o=[];if(s!=null){n.initialState=s,u=u.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new Ne({shape:l.shape}));o=o.concat(this.stateSpec)}if(i!=null&&(n.constants=i,u=u.concat(i),this.numConstants=i.length),u[0]instanceof Ds){const l=[t].concat(u),h=this.inputSpec.concat(o),c=this.inputSpec;this.inputSpec=h;const f=super.apply(l,n);return this.inputSpec=c,f}else return super.apply(t,n)}call(t,n){return lt(()=>{const s=n==null?null:n.mask,i=n==null?null:n.training;let a=n==null?null:n.initialState;t=Wt(t),a==null&&(this.stateful?a=this.states_:a=this.getInitialState(t));const u=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==u)throw new nt(`RNN Layer has ${u} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:i},l=j1((p,m)=>{const g=this.cell.call([p].concat(m),o);return[g[0],g.slice(1)]},t,a,this.goBackwards,s,null,this.unroll,this.returnSequences),h=l[0],c=l[1],f=l[2];this.stateful&&this.resetStates(f,i);const d=this.returnSequences?c:h;return this.returnState?[d].concat(f):d})}getInitialState(t){return lt(()=>{let n=ae(t.shape);return n=Et(n,[1,2]),n=ml(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Gf(n,[1,s]):n):this.cell.stateSize>1?[Gf(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===$i.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign({},s,t,n)}static fromConfig(t,n,s={}){const i=n.cell,a=Hs(i,s);return new t(Object.assign(n,{cell:a}))}}$i.className="RNN";bt($i);class fh extends qt{}class Yg extends fh{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,ze(this.units,"units"),this.activation=bi(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=de(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=de(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=de(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=pe(t.kernelRegularizer),this.recurrentRegularizer=pe(t.recurrentRegularizer),this.biasRegularizer=pe(t.biasRegularizer),this.kernelConstraint=Ae(t.kernelConstraint),this.recurrentConstraint=Ae(t.recurrentConstraint),this.biasConstraint=Ae(t.biasConstraint),this.dropout=io([1,mi([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=io([1,mi([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=te(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return lt(()=>{if(t=t,t.length!==2)throw new nt(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vi({ones:()=>Kn(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vi({ones:()=>Kn(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let a;const u=this.dropoutMask,o=this.recurrentDropoutMask;u!=null?a=Ps(Z(t,u),this.kernel.read()):a=Ps(t,this.kernel.read()),this.bias!=null&&(a=ws(a,this.bias.read())),o!=null&&(s=Z(s,o));let r=yt(a,Ps(s,this.recurrentKernel.read()));return this.activation!=null&&(r=this.activation.apply(r)),[r,r]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:xi(this.activation),useBias:this.useBias,kernelInitializer:me(this.kernelInitializer),recurrentInitializer:me(this.recurrentInitializer),biasInitializer:me(this.biasInitializer),kernelRegularizer:se(this.kernelRegularizer),recurrentRegularizer:se(this.recurrentRegularizer),biasRegularizer:se(this.biasRegularizer),activityRegularizer:se(this.activityRegularizer),kernelConstraint:De(this.kernelConstraint),recurrentConstraint:De(this.recurrentConstraint),biasConstraint:De(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,n)}}Yg.className="SimpleRNNCell";bt(Yg);class X1 extends $i{constructor(t){t.cell=new Yg(t),super(t)}call(t,n){return lt(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:s,training:i,initialState:a})})}static fromConfig(t,n){return new t(n)}}X1.className="SimpleRNN";bt(X1);class qg extends fh{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new nt("GRUCell does not support reset_after parameter set to true.");this.units=t.units,ze(this.units,"units"),this.activation=bi(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=bi(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=de(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=de(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=de(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=pe(t.kernelRegularizer),this.recurrentRegularizer=pe(t.recurrentRegularizer),this.biasRegularizer=pe(t.biasRegularizer),this.kernelConstraint=Ae(t.kernelConstraint),this.recurrentConstraint=Ae(t.recurrentConstraint),this.biasConstraint=Ae(t.biasConstraint),this.dropout=io([1,mi([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=io([1,mi([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=te(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return lt(()=>{if(t=t,t.length!==2)throw new nt(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=n.training==null?!1:n.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vi({ones:()=>Kn(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vi({ones:()=>Kn(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,u=this.recurrentDropoutMask;let o,r,l;0<this.dropout&&this.dropout<1&&(t=Z(t,a[0]));let h=Ps(t,this.kernel.read());this.useBias&&(h=ws(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Z(i,u[0]));const c=this.recurrentKernel.read(),[f,d]=An(c,[2*this.units,this.units],c.rank-1),p=Ps(i,f),[m,g,x]=An(h,3,h.rank-1),[b,y]=An(p,2,p.rank-1);o=this.recurrentActivation.apply(yt(m,b)),r=this.recurrentActivation.apply(yt(g,y));const v=Ps(Z(r,i),d);l=this.activation.apply(yt(x,v));const w=yt(Z(o,i),Z(yt(1,xe(o)),l));return[w,w]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:me(this.kernelInitializer),recurrentInitializer:me(this.recurrentInitializer),biasInitializer:me(this.biasInitializer),kernelRegularizer:se(this.kernelRegularizer),recurrentRegularizer:se(this.recurrentRegularizer),biasRegularizer:se(this.biasRegularizer),activityRegularizer:se(this.activityRegularizer),kernelConstraint:De(this.kernelConstraint),recurrentConstraint:De(this.recurrentConstraint),biasConstraint:De(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,n)}}qg.className="GRUCell";bt(qg);class Y1 extends $i{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new qg(t),super(t)}call(t,n){return lt(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:s,training:i,initialState:a})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}Y1.className="GRU";bt(Y1);class dh extends fh{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,ze(this.units,"units"),this.activation=bi(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=bi(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=de(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=de(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=de(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=pe(t.kernelRegularizer),this.recurrentRegularizer=pe(t.recurrentRegularizer),this.biasRegularizer=pe(t.biasRegularizer),this.kernelConstraint=Ae(t.kernelConstraint),this.recurrentConstraint=Ae(t.recurrentConstraint),this.biasConstraint=Ae(t.biasConstraint),this.dropout=io([1,mi([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=io([1,mi([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=te(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const a=this.biasInitializer,u=this.units;i=new(n=class extends ts{apply(r,l){const h=a.apply([u]),c=new Og().apply([u]),f=a.apply([u*2]);return $x($x(h,c),f)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return lt(()=>{const s=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new nt(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const a=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vi({ones:()=>Kn(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vi({ones:()=>Kn(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,o=this.recurrentDropoutMask;let r,l,h,c;0<this.dropout&&this.dropout<1&&(t=Z(t,u[0]));let f=Ps(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Z(i,o[0])),f=yt(f,Ps(i,this.recurrentKernel.read())),this.useBias&&(f=ws(f,this.bias.read()));const[d,p,m,g]=An(f,4,f.rank-1);r=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),h=yt(Z(l,a),Z(r,this.activation.apply(m))),c=this.recurrentActivation.apply(g);const x=Z(c,this.activation.apply(h));return[x,x,h]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:me(this.kernelInitializer),recurrentInitializer:me(this.recurrentInitializer),biasInitializer:me(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:se(this.kernelRegularizer),recurrentRegularizer:se(this.recurrentRegularizer),biasRegularizer:se(this.biasRegularizer),activityRegularizer:se(this.activityRegularizer),kernelConstraint:De(this.kernelConstraint),recurrentConstraint:De(this.recurrentConstraint),biasConstraint:De(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,n)}}dh.className="LSTMCell";bt(dh);class q1 extends $i{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new dh(t),super(t)}call(t,n){return lt(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:s,training:i,initialState:a})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}q1.className="LSTM";bt(q1);class Kg extends fh{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return lt(()=>{t=t;let s=t.slice(1);const i=[];for(const o of this.cells.slice().reverse())Array.isArray(o.stateSize)?i.push(s.splice(0,o.stateSize.length)):i.push(s.splice(0,1));i.reverse();const a=[];let u;for(let o=0;o<this.cells.length;++o){const r=this.cells[o];s=i[o],o===0?u=[t[0]].concat(s):u=[u[0]].concat(s),u=r.call(u,n),a.push(u.slice(1))}s=[];for(const o of a.slice().reverse())s.push(...o);return[u[0]].concat(s)})}build(t){jf(t)&&(t=t[0]),t=t;let n;this.cells.forEach((s,i)=>{er(`RNNCell_${i}`,()=>{s.build(t),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=a=>({className:a.getClassName(),config:a.getConfig()}),i={cells:this.cells.map(n)};return Object.assign({},t,i)}static fromConfig(t,n,s={}){const i=[];for(const a of n.cells)i.push(Hs(a,s));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return Xf(t)}setWeights(t){const n=[];for(const s of this.cells){const i=s.weights.length,a=t.splice(i);for(let u=0;u<s.weights.length;++u)n.push([s.weights[u],a[u]])}Wg(n)}}Kg.className="StackedRNNCells";bt(Kg);function vi(e){const{ones:t,rate:n,training:s=!1,count:i=1,dropoutFunc:a}=e,u=()=>a!=null?a(t(),n):Vy(t(),n),o=()=>bl(u,t,s);return!i||i<=1?ms(o().clone()):Array(i).fill(void 0).map(o).map(l=>ms(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var fP=globalThis&&globalThis.__rest||function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n};class K1 extends $i{constructor(t){if(t.unroll)throw new zt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new zt("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Ne({ndim:5})]}call(t,n){return lt(()=>{if(this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new nt("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,i=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:s,training:i,initialState:a})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return lt(()=>{const{stateSize:n}=this.cell,s=t.shape,i=this.computeSingleOutputShape(s),a=[i[0],...i.slice(2)],u=ae(a);return Array.isArray(n)?Array(n.length).fill(u):[u]})}resetStates(t,n=!1){lt(()=>{if(!this.stateful)throw new $s("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),a=[i[0],...i.slice(2)];if(s[0]==null)throw new nt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ae(a)):this.states_=[ae(a)];else if(t==null)Lt(this.states_),this.keptStates!=null&&(Lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ae(a)):this.states_[0]=ae(a);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new nt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):Lt(this.states_);for(let o=0;o<this.states_.length;++o){const r=t[o],l=a;if(!Qt(r.shape,l))throw new nt(`State ${o} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${r.shape}`);this.states_[o]=r}}this.states_=this.states_.map(o=>ms(o.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:s,kernelSize:i,padding:a,strides:u,dilationRate:o}=this.cell,r=n==="channelsFirst",l=t[r?3:2],h=t[r?4:3],c=gs(l,i[0],a,u[0],o[0]),f=gs(h,i[1],a,u[1],o[1]);return[...t.slice(0,2),...r?[s,c,f]:[c,f,s]]}}K1.className="ConvRNN2D";class Jg extends dh{constructor(t){const{filters:n,kernelSize:s,strides:i,padding:a,dataFormat:u,dilationRate:o}=t;super(Object.assign({},t,{units:n})),this.filters=n,ze(this.filters,"filters"),this.kernelSize=Hr(s,2,"kernelSize"),this.kernelSize.forEach(r=>ze(r,"kernelSize")),this.strides=Hr(i||1,2,"strides"),this.strides.forEach(r=>ze(r,"strides")),this.padding=a||"valid",On(this.padding),this.dataFormat=u||"channelsLast",Ie(this.dataFormat),this.dilationRate=Hr(o||1,2,"dilationRate"),this.dilationRate.forEach(r=>ze(r,"dilationRate"))}build(t){var n;t=te(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new nt(`The channel dimension of the input should be defined. Found ${t[s]}`);const i=t[s],a=4,u=this.kernelSize.concat([i,this.filters*a]);this.kernel=this.addWeight("kernel",u,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const o=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let r;if(this.unitForgetBias){const l=this.biasInitializer,h=this.filters;r=new(n=class extends ts{apply(f,d){const p=l.apply([h]),m=yn([h]),g=l.apply([h*2]);return Rg([p,m,g])}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,r,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return lt(()=>{if(t.length!==3)throw new nt(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=n.training||!1,i=t[0],a=t[1],u=t[2],o=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vi({ones:()=>Kn(i),rate:this.dropout,training:s,count:o,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,l=(A,D,F)=>!D||!D[F]?A:Z(D[F],A);let h=l(i,r,0),c=l(i,r,1),f=l(i,r,2),d=l(i,r,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vi({ones:()=>Kn(a),rate:this.recurrentDropout,training:s,count:o,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=l(a,p,0),g=l(a,p,1),x=l(a,p,2),b=l(a,p,3);const y=3,[v,w,C,S]=An(this.kernel.read(),o,y),[k,T,N,R]=this.useBias?An(this.bias.read(),o):[null,null,null,null];h=this.inputConv(h,v,k,this.padding),c=this.inputConv(c,w,T,this.padding),f=this.inputConv(f,C,N,this.padding),d=this.inputConv(d,S,R,this.padding);const[L,z,U,H]=An(this.recurrentKernel.read(),o,y);m=this.recurrentConv(m,L),g=this.recurrentConv(g,z),x=this.recurrentConv(x,U),b=this.recurrentConv(b,H);const Y=this.recurrentActivation.apply(yt(h,m)),Q=this.recurrentActivation.apply(yt(c,g)),K=yt(Z(Q,u),Z(Y,this.activation.apply(yt(f,x)))),I=Z(this.recurrentActivation.apply(yt(d,b)),this.activation.apply(K));return[I,I,K]})}getConfig(){const t=super.getConfig(),n=fP(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,s)}inputConv(t,n,s,i){const a=lr(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?ws(a,s,this.dataFormat):a}recurrentConv(t,n){return lr(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Jg.className="ConvLSTM2DCell";bt(Jg);class J1 extends K1{constructor(t){const n=new Jg(t);super(Object.assign({},t,{cell:n}))}static fromConfig(t,n){return new t(n)}}J1.className="ConvLSTM2D";bt(J1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zg extends qt{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return s}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,a=this.getNoiseShape(s);return bl(()=>Vy(s,this.rate,a,this.seed),()=>s,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}Zg.className="Dropout";bt(Zg);class Z1 extends Zg{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}Z1.className="SpatialDropout1D";bt(Z1);class Q1 extends qt{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,ze(this.units,"units"),this.activation=bi(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=de(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=de(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ae(t.kernelConstraint),this.biasConstraint=Ae(t.biasConstraint),this.kernelRegularizer=pe(t.kernelRegularizer),this.biasRegularizer=pe(t.biasRegularizer),this.activityRegularizer=pe(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=te(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=te(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t),i=Fy(this.activation.getClassName());let a;return i!=null?a=Ps(s,this.kernel.read(),i,this.bias?this.bias.read():null):(a=Ps(s,this.kernel.read()),this.bias!=null&&(a=ws(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){const t={units:this.units,activation:xi(this.activation),useBias:this.useBias,kernelInitializer:me(this.kernelInitializer),biasInitializer:me(this.biasInitializer),kernelRegularizer:se(this.kernelRegularizer),biasRegularizer:se(this.biasRegularizer),activityRegularizer:se(this.activityRegularizer),kernelConstraint:De(this.kernelConstraint),biasConstraint:De(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}Q1.className="Dense";bt(Q1);class tw extends qt{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=te(t);for(const n of t.slice(1))if(n==null)throw new nt(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],fi(t,1)]}call(t,n){return lt(()=>{this.invokeCallHook(t,n);let s=Wt(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let a=2;a<s.rank;++a)i.push(a);i.push(1),s=Xt(s,i)}return XO(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}}tw.className="Flatten";bt(tw);class ew extends qt{constructor(t){super(t),this.supportsMasking=!0,this.activation=bi(t.activation)}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t);return this.activation.apply(s)})}getConfig(){const t={activation:xi(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}ew.className="Activation";bt(ew);class nw extends qt{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return lt(()=>(t=Wt(t),HO(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}nw.className="RepeatVector";bt(nw);class sw extends qt{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const s="Total size of new array must be unchanged.",i=n.slice();let a=1,u=null;for(let r=0;r<i.length;++r){const l=i[r];if(this.isUnknown(l))if(u===null)u=r;else throw new nt("Can only specifiy one unknown dimension.");else a*=l}const o=fi(t);if(u!==null){if(a===0||o%a!==0)throw new nt(s);i[u]=o/a}else if(o!==a)throw new nt(s);return i}computeOutputShape(t){let n=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t),i=s.shape,a=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return it(s,a)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}sw.className="Reshape";bt(sw);class iw extends qt{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=xs(1,t.dims.length+1);if(!Qt(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ne({ndim:this.dims.length+1})]}computeOutputShape(t){t=te(t);const n=t.slice();return this.dims.forEach((s,i)=>{n[i+1]=t[s]}),n}call(t,n){return Xt(Wt(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}iw.className="Permute";bt(iw);class rw extends qt{constructor(t){super(t==null?{}:t),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const s=Wt(t),i=-1;return Mf(Zo(s,this.maskValue),i)}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t),i=-1,a=!0,u=Mf(Zo(s,this.maskValue),i,a);return Z(s,St(u,s.dtype))})}}rw.className="Masking";bt(rw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ow extends qt{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(ue(t.inputLength))}this.inputDim=t.inputDim,ze(this.inputDim,"inputDim"),this.outputDim=t.outputDim,ze(this.outputDim,"outputDim"),this.embeddingsInitializer=de(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=pe(t.embeddingsRegularizer),this.activityRegularizer=pe(t.activityRegularizer),this.embeddingsConstraint=Ae(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return lt(()=>this.maskZero?(t=Wt(t),Zo(t,Yt(t))):null)}computeOutputShape(t){if(t=te(t),this.inputLength==null)return[...t,this.outputDim];const n=ue(this.inputLength);if(n.length!==t.length-1)throw new nt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let i=0;i<n.length;++i){const a=n[i],u=t[i+1];if(a!=null&&u!=null&&a!==u)throw new nt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);a==null&&(n[s]=u),s++}}return[t[0],...n,this.outputDim]}call(t,n){return lt(()=>{this.invokeCallHook(t,n);let s=Wt(t);s.dtype!=="int32"&&(s=rh(s,"int32"));const i=Wy(this.embeddings.read(),it(s,[s.size]));return it(i,te(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:me(this.embeddingsInitializer),embeddingsRegularizer:se(this.embeddingsRegularizer),activityRegularizer:se(this.activityRegularizer),embeddingsConstraint:De(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}ow.className="Embedding";bt(ow);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yr extends qt{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new zt}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const s=t.slice(0,t.length-n.length);for(let i=0;i<n.length;++i){const a=t[t.length-n.length+i],u=n[i];if(a==null||u==null||a<0||u<0)s.push(null);else if(a===1)s.push(u);else if(u===1)s.push(a);else{if(a!==u)throw new nt("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));s.push(a)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[te(t)]),t=t,t.length<2)throw new nt(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const a of t)a!=null&&a[0]!==null&&n.push(a[0]);if(n=hi(n),n.length>1)throw new nt(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let a=1;a<t.length;++a){const u=t[a]==null?null:t[a].slice(1);s=this.computeElementwiseOpOutputShape(s,u)}const i=t.map(a=>a.length);t.indexOf(null)===-1&&hi(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return lt(()=>{if(t=t,this.reshapeRequired){const s=[],i=t.map(a=>a.rank);if(i.indexOf(null)===-1){const a=mi(i);for(let u of t){const o=u.rank;for(let r=0;r<a-o;++r)u=ml(u,1);s.push(u)}return this.mergeFunction(s)}else{let a=!1;for(const r of t){const l=r.rank;if(l==null){const h=r.shape,c=h[0],f=h.slice(1).concat([c]);let d=it(r,[c].concat(fi(h.slice(1))));d=Xt(d,[1,0]),d=it(d,f),s.push(d),a=!0}else if(l>1){const h=xs(1,l).concat([0]);s.push(Xt(r,h)),a=!0}else s.push(r)}let u=this.mergeFunction(s);const o=u.rank;if(a){if(o==null){const r=u.shape,l=r.length,h=r[l-1],c=[h].concat(r.slice(0,r.length-1));u=it(Xt(it(u,[-1,h]),[1,0]),c)}else if(o>1){const r=[o-1].concat(xs(0,o-1));u=Xt(u,r)}}return u}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let i=1;i<t.length;++i){const a=t[i]==null?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,a)}let s=[];for(const i of t)i!=null&&i[0]!==null&&s.push(i[0]);return s=hi(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(t,n){return lt(()=>{if(n==null)return null;if(!Array.isArray(n))throw new nt("`mask` should be an Array");if(!Array.isArray(t))throw new nt("`inputs` should be an Array");if(n.length!==t.length)throw new nt(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:Bn(i,0));let s=n[0];for(let i=1;i<n.length-1;++i)s=Xs(s,n[i]);return s})}}class aw extends yr{constructor(t){super(t)}mergeFunction(t){return lt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=yt(n,t[s]);return n})}}aw.className="Add";bt(aw);class lw extends yr{constructor(t){super(t)}mergeFunction(t){return lt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=Z(n,t[s]);return n})}}lw.className="Multiply";bt(lw);class cw extends yr{constructor(t){super(t)}mergeFunction(t){return lt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=yt(n,t[s]);return Z(1/t.length,n)})}}cw.className="Average";bt(cw);class uw extends yr{constructor(t){super(t)}mergeFunction(t){return lt(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=Ii(n,t[s]);return n})}}uw.className="Maximum";bt(uw);class hw extends yr{constructor(t){super(t)}mergeFunction(t){return lt(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=tr(n,t[s]);return n})}}hw.className="Minimum";bt(hw);class fw extends yr{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new nt("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const i of t)if(i!=null){n=!1;break}if(n)return;const s=[];for(let i=0;i<t.length;++i){const a=t[i].slice();a.splice(this.axis,1);let u=!1;for(const o of s)if(Qt(o,a)){u=!0;break}u||s.push(a)}if(s.length>1)throw new nt("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return lt(()=>Rg(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new nt("A `Concatenate` layer should be called on a list of inputs.");const n=t,s=n[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const a of n.slice(1)){if(s[i]==null||a[i]==null){s[i]=null;break}s[i]+=a[i]}return s}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new nt("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new nt("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new nt(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return lt(()=>{let s=!0;if(n.forEach(u=>{if(u!=null){s=!1;return}}),s)return null;const i=[];for(let u=0;u<t.length;++u)n[u]==null?i.push(St(Kn(t[u]),"bool")):n[u].rank<t[u].rank?i.push(Bn(n[u],-1)):i.push(n[u]);const a=we(i,this.axis);return Tv(a,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}fw.className="Concatenate";bt(fw);function Ao(e,t){for(;e<0;)e+=t;return e}function dP(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new zt("batchDot is not implemented for tensors of 4D or higher rank yet");if(P(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),P(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new zt("batchDot is not implemented for complex64-type Tensors yet.");const s=e.shape.length,i=t.shape.length;n==null&&(n=[s-1,i-2]);const a=n;return lt(()=>{let u;if(s>i){u=s-i;const r=[];for(let l=0;l<u;++l)r.push(1);t=it(t,t.shape.concat(r))}else if(i>s){u=i-s;const r=[];for(let l=0;l<u;++l)r.push(1);e=it(e,e.shape.concat(r))}else u=0;let o;if(e.shape.length===2&&t.shape.length===2)a[0]===a[1]?o=Et(Z(e,t),a[0]):o=Et(Z(Xt(e,[1,0]),t),a[1]);else{const r=a[0]!==e.shape.length-1,l=a[1]===t.shape.length-1;o=jt(e,t,r,l)}if(u>0){let r;s>i?r=s+i-3:r=s-1;const l=[];for(let h=r;h<r+u;++h)l.push(h);o=ul(o,l)}return o.shape.length===1&&(o=Bn(o,1)),o})}class dw extends yr{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){P(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],s=t[1];if(n.length>3||s.length>3)throw new zt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);if(n[i[0]]!==s[i[1]])throw new nt(`Dimension incompatibility: ${n[i[0]]} !== ${s[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new nt(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],s=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((a,u)=>Ao(a,t[u].shape.length)):i=[Ao(this.axes,n.shape.length),Ao(this.axes,s.shape.length)],this.normalize&&(n=yc(n,i[0]),s=yc(s,i[1])),dP(n,s,i)}interpretAxes(t,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[Ao(this.axes,t.length),Ao(this.axes,n.length)],s}computeOutputShape(t){P(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),s=t[1].slice();if(n.length>3||s.length>3)throw new zt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);n.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const a=n.concat(s);return a.length===1&&a.push(1),a}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}dw.className="Dot";bt(dw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pw extends qt{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t);return bl(()=>yt(oh(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}pw.className="GaussianNoise";bt(pw);class gw extends qt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return lt(()=>{this.invokeCallHook(t,n);const s=Wt(t);return this.rate>0&&this.rate<1?bl(()=>{const a=Math.sqrt(this.rate/(1-this.rate));return Z(s,oh(s.shape,1,a))},()=>s,n.training||!1):s})}}gw.className="GaussianDropout";bt(gw);class mw extends qt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Wt(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return lt(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return bl(()=>{const a=Wt(t),u=1.6732632423543772,o=1.0507009873554805,r=-u*o;let l=bo(Qu(s),this.rate);l=rh(l,"float32");const h=((1-this.rate)*(1+this.rate*r**2))**-.5,c=-h*r*this.rate,f=yt(Z(a,l),Z(yt(l,-1),r));return yt(Z(f,h),c)},()=>Wt(t),n.training||!1)}return t})}}mw.className="AlphaDropout";bt(mw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function na(e,t,n,s,i,a=.001){let u;if(e.rank===2)u=Q2(e,t,n,s,i,a);else if(e.rank===3)u=e$(e,t,n,s,i,a);else if(e.rank===4)u=s$(e,t,n,s,i,a);else throw new zt(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return u}function pP(e,t,n,s,i=.001){return lt(()=>{const a=Vp(e,s),u=a.mean,o=a.variance;return[na(e,u,o,n,t,i),u,o]})}function gP(e,t,n,s,i=.001){return lt(()=>{const a=Vp(e,s),u=a.mean,o=a.variance,r=[];for(const p of xs(0,e.rank))s.indexOf(p)!==-1?r.push(1):r.push(e.shape[p]);const l=it(u,r),h=it(o,r),c=t==null?null:it(t,r),f=n==null?null:it(n,r);return[na(e,l,h,f,c,i),u,o]})}function mP(e,t,n,s,i=.001){return Qt(s.slice().sort(),xs(0,e.rank-1))?pP(e,t,n,s,i):gP(e,t,n,s,i)}class xw extends qt{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=de(t.betaInitializer||"zeros"),this.gammaInitializer=de(t.gammaInitializer||"ones"),this.movingMeanInitializer=de(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=de(t.movingVarianceInitializer||"ones"),this.betaConstraint=Ae(t.betaConstraint),this.gammaConstraint=Ae(t.gammaConstraint),this.betaRegularizer=pe(t.betaRegularizer),this.gammaRegularizer=pe(t.gammaRegularizer)}build(t){t=te(t);const n=this.axis>=0?this.axis:this.axis+t.length,s=t[n];if(s==null)throw new nt(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Ne({ndim:t.length,axes:{[n]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return lt(()=>{const s=n.training==null?!1:n.training,i=Wt(t),a=i.shape,u=a.length,o=xs(0,u),r=this.axis>=0?this.axis:this.axis+u;o.splice(r,1);const l=dr(1,u);l[r]=a[r];const h=o.slice();h.sort();const c=!Qt(h,xs(0,u).slice(0,u-1)),f=()=>{if(c){const b=it(this.movingMean.read(),l),y=it(this.movingVariance.read(),l),v=this.center?it(this.beta.read(),l):null,w=this.scale?it(this.gamma.read(),l):null;return na(i,b,y,v,w,this.epsilon)}else return na(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[d,p,m]=mP(i,this.gamma.read(),this.beta.read(),o,this.epsilon),g=(b,y,v)=>{lt(()=>{const w=1-v,C=b.read(),S=Z(Tt(C,y),w);b.write(Tt(C,S))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:me(this.betaInitializer),gammaInitializer:me(this.gammaInitializer),movingMeanInitializer:me(this.movingMeanInitializer),movingVarianceInitializer:me(this.movingVarianceInitializer),betaRegularizer:se(this.betaRegularizer),gammaRegularizer:se(this.gammaRegularizer),betaConstraint:De(this.betaConstraint),gammaConstraint:De(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}xw.className="BatchNormalization";bt(xw);class bw extends qt{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=de(t.betaInitializer||"zeros"),this.gammaInitializer=de(t.gammaInitializer||"ones"),this.betaRegularizer=pe(t.betaRegularizer),this.gammaRegularizer=pe(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=te(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=n);for(const a of this.axis)if(a<0||a>=n)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==hi(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(a=>t[a]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,n){const s=Wt(t),i=s.shape,a=i.length;return lt(()=>{let{mean:o,variance:r}=Vp(s,this.axis,!0);const l=dr(1,a);for(const m of this.axis)l[m]=i[m];const h=m=>m!=null&&m.shape.length!==a?it(m,l):m;let c=this.scale?h(this.gamma.read()):null,f=this.center?h(this.beta.read()):null;const d=[],p=[];for(let m=0;m<a;++m)this.axis.indexOf(m)!==-1?(d.push(i[m]),p.push(1)):(d.push(1),p.push(i[m]));return o=hs(o,d),r=hs(r,d),c!=null&&(c=hs(c,p)),f!=null&&(f=hs(f,p)),na(s,o,r,f,c,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:me(this.betaInitializer),gammaInitializer:me(this.gammaInitializer),betaRegularizer:se(this.betaRegularizer),gammaRegularizer:se(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}bw.className="LayerNormalization";bt(bw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xP(e,t,n){return lt(()=>{if(e.rank!==4)throw new nt(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new nt("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=bs()),n!=="channelsLast"&&n!=="channelsFirst")throw new nt(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],Up(e,s)})}class vw extends qt{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?bs():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new nt(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,s;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new nt(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new nt(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[n,s]}this.inputSpec=[new Ne({ndim:4})]}computeOutputShape(t){t=te(t);let n,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],n,s]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],n,s,t[3]])}call(t,n){return lt(()=>xP(Wt(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}vw.className="ZeroPadding2D";bt(vw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ph(e,t,n,s,i,a){return lt(()=>{Ie(i),My(a),On(s),n==null&&(n=[1,1]),s==null&&(s="valid"),i==null&&(i=bs()),a==null&&(a="max"),e=Xg(e,i);let u;const o=s==="same"?"same":"valid";return a==="max"?u=Wp(e,t,n,o):u=Dp(e,t,n,o),i==="channelsFirst"&&(u=Xt(u,[0,3,1,2])),u})}function yw(e,t,n,s,i,a){return lt(()=>{Ie(i),My(a),On(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),i==null&&(i=bs()),a==null&&(a="max"),e=M1(e,i);let u;const o=s==="same"?"same":"valid";return a==="max"?u=LE(e,t,n,o):u=G2(e,t,n,o),i==="channelsFirst"&&(u=Xt(u,[0,4,1,2,3])),u})}class ww extends qt{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new nt(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(ze(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new nt(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);ze(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,On(this.padding),this.inputSpec=[new Ne({ndim:3})]}computeOutputShape(t){t=te(t);const n=gs(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return lt(()=>{this.invokeCallHook(t,n),t=ml(Wt(t),2);const s=this.poolingFunction(Wt(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ul(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class Cw extends ww{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),ph(t,n,s,i,a,"max")}}Cw.className="MaxPooling1D";bt(Cw);class Sw extends ww{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),ph(t,n,s,i,a,"avg")}}Sw.className="AveragePooling1D";bt(Sw);class kw extends qt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new nt(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];ze(this.poolSize,"poolSize"),ze(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ie(this.dataFormat),On(this.padding),this.inputSpec=[new Ne({ndim:4})]}computeOutputShape(t){t=te(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=gs(n,this.poolSize[0],this.padding,this.strides[0]),s=gs(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s]:[t[0],n,s,t[3]]}call(t,n){return lt(()=>(this.invokeCallHook(t,n),this.poolingFunction(Wt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Iw extends kw{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),ph(t,n,s,i,a,"max")}}Iw.className="MaxPooling2D";bt(Iw);class Tw extends kw{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),ph(t,n,s,i,a,"avg")}}Tw.className="AveragePooling2D";bt(Tw);class _w extends qt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new nt(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];ze(this.poolSize,"poolSize"),ze(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ie(this.dataFormat),On(this.padding),this.inputSpec=[new Ne({ndim:5})]}computeOutputShape(t){t=te(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=gs(n,this.poolSize[0],this.padding,this.strides[0]),s=gs(s,this.poolSize[1],this.padding,this.strides[1]),i=gs(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s,i]:[t[0],n,s,i,t[4]]}call(t,n){return lt(()=>(this.invokeCallHook(t,n),this.poolingFunction(Wt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class $w extends _w{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),yw(t,n,s,i,a,"max")}}$w.className="MaxPooling3D";bt($w);class Ew extends _w{constructor(t){super(t)}poolingFunction(t,n,s,i,a){return Ie(a),On(i),yw(t,n,s,i,a,"avg")}}Ew.className="AveragePooling3D";bt(Ew);class Nw extends qt{constructor(t){super(t),this.inputSpec=[new Ne({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new zt}}class Dw extends Nw{constructor(t){super(t||{})}call(t,n){return lt(()=>{const s=Wt(t);return ye(s,1)})}}Dw.className="GlobalAveragePooling1D";bt(Dw);class Aw extends Nw{constructor(t){super(t||{})}call(t,n){return lt(()=>{const s=Wt(t);return Os(s,1)})}}Aw.className="GlobalMaxPooling1D";bt(Aw);class Rw extends qt{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ie(this.dataFormat),this.inputSpec=[new Ne({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new zt}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Ow extends Rw{call(t,n){return lt(()=>{const s=Wt(t);return this.dataFormat==="channelsLast"?ye(s,[1,2]):ye(s,[2,3])})}}Ow.className="GlobalAveragePooling2D";bt(Ow);class Fw extends Rw{call(t,n){return lt(()=>{const s=Wt(t);return this.dataFormat==="channelsLast"?Os(s,[1,2]):Os(s,[2,3])})}}Fw.className="GlobalMaxPooling2D";bt(Fw);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pw extends qt{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,s={}){const i=n.layer,a=Hs(i,s);delete n.layer;const u={layer:a};return Object.assign(u,n),new t(u)}}class Mw extends Pw{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=te(t),t.length<3)throw new nt(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=te(t);const n=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(n),i=t[1];return[s[0],i].concat(s.slice(1))}call(t,n){return lt(()=>(t=Wt(t),j1((u,o)=>[Wt(this.layer.call(u,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}Mw.className="TimeDistributed";bt(Mw);function bP(e){vr(zO,"BidirectionalMergeMode",e)}const vP="concat";class Lw extends Pw{constructor(t){super(t);const n=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=n,this.forwardLayer=Hs(s),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=n,this.backwardLayer=Hs(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?vP:t.mergeMode,bP(this.mergeMode),t.weights)throw new zt("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,s=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,i,a;return this.returnState&&(a=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(a).concat(a.slice()):[s].concat(a).concat(a.slice()):un(i)}apply(t,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const a=H1(t,s,i,this.numConstants);if(t=a.inputs,s=a.initialState,i=a.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&i==null)return super.apply(t,n);const u=[],o=[];if(s!=null){const l=s.length;if(l%2>0)throw new nt("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,u.push(...s);const h=s.map(c=>new Ne({shape:c.shape}));this.forwardLayer.stateSpec=h.slice(0,l/2),this.backwardLayer.stateSpec=h.slice(l/2),o.push(...h)}if(i!=null)throw new zt("Support for constants in Bidirectional layers is not implemented yet.");const r=u[0]instanceof Ds;for(const l of u)if(l instanceof Ds!==r)throw new nt("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(r){const l=[t].concat(u),h=this.inputSpec.concat(o),c=this.inputSpec;this.inputSpec=h;const f=super.apply(l,n);return this.inputSpec=c,f}else return super.apply(t,n)}call(t,n){return lt(()=>{const s=n.initialState;let i,a;if(s==null)i=this.forwardLayer.call(t,n),a=this.backwardLayer.call(t,n);else{const r=s.slice(0,s.length/2),l=s.slice(s.length/2);i=this.forwardLayer.call(t,Object.assign(n,{initialState:r})),a=this.backwardLayer.call(t,Object.assign(n,{initialState:l}))}let u;this.returnState&&(Array.isArray(i)&&(u=i.slice(1).concat(a.slice(1))),i=i[0],a=a[0]),this.returnSequences&&(a=ur(a,1));let o;return this.mergeMode==="concat"?o=Rg([i,a]):this.mergeMode==="sum"?o=yt(i,a):this.mergeMode==="ave"?o=Z(.5,yt(i,a)):this.mergeMode==="mul"?o=Z(i,a):this.mergeMode==null&&(o=[i,a]),this.returnState?this.mergeMode==null?o.concat(u):[o].concat(u):o})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){er(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),er(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const a=this.forwardLayer.states.map(u=>null);return Array.isArray(s)?s.concat(a).concat(a):[s].concat(a).concat(a)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const s=Hs(n.layer);if(delete n.layer,n.numConstants!=null)throw new zt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=s,new t(i)}}Lw.className="Bidirectional";bt(Lw);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP=dt();yP.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var jx;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(jx||(jx={}));var Xx;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(Xx||(Xx={}));/** @license See the LICENSE file. */var Bw={exports:{}};(function(e){(function(t,n,s){function i(r){var l=this,h=o();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=h(" "),l.s1=h(" "),l.s2=h(" "),l.s0-=h(r),l.s0<0&&(l.s0+=1),l.s1-=h(r),l.s1<0&&(l.s1+=1),l.s2-=h(r),l.s2<0&&(l.s2+=1),h=null}function a(r,l){return l.c=r.c,l.s0=r.s0,l.s1=r.s1,l.s2=r.s2,l}function u(r,l){var h=new i(r),c=l&&l.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,c&&(typeof c=="object"&&a(c,h),f.state=function(){return a(h,{})}),f}function o(){var r=4022871197,l=function(h){h=h.toString();for(var c=0;c<h.length;c++){r+=h.charCodeAt(c);var f=.02519603282416938*r;r=f>>>0,f-=r,f*=r,r=f>>>0,f-=r,r+=f*4294967296}return(r>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.alea=u})(je,e,!1)})(Bw);var zw={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var c=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^c^c>>>8},o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor128=u})(je,e,!1)})(zw);var Ww={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(c^c<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,h==l.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r.v=o.v,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorwow=u})(je,e,!1)})(Ww);var Vw={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.x,c=r.i,f,d;return f=h[c],f^=f>>>7,d=f^f<<24,f=h[c+1&7],d^=f^f>>>10,f=h[c+3&7],d^=f^f>>>3,f=h[c+4&7],d^=f^f<<7,f=h[c+7&7],f=f^f<<13,d^=f^f<<9,h[c]=d,r.i=c+1&7,d};function l(h,c){var f,d=[];if(c===(c|0))d[0]=c;else for(c=""+c,f=0;f<c.length;++f)d[f&7]=d[f&7]<<15^c.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],h.x=d,h.i=0,f=256;f>0;--f)h.next()}l(r,o)}function a(o,r){return r.x=o.x.slice(),r.i=o.i,r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.x&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorshift7=u})(je,e,!1)})(Vw);var Uw={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.w,c=r.X,f=r.i,d,p;return r.w=h=h+1640531527|0,p=c[f+34&127],d=c[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=c[f]=p^d,r.i=f,p+(h^h>>>16)|0};function l(h,c){var f,d,p,m,g,x=[],b=128;for(c===(c|0)?(d=c,c=null):(c=c+"\0",d=0,b=Math.max(b,c.length)),p=0,m=-32;m<b;++m)c&&(d^=c.charCodeAt((m+32)%c.length)),m===0&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(g=g+1640531527|0,f=x[m&127]^=d+g,p=f==0?p+1:0);for(p>=128&&(x[(c&&c.length||0)&127]=-1),p=127,m=4*128;m>0;--m)d=x[p+34&127],f=x[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,x[p]=d^f;h.w=g,h.X=x,h.i=p}l(r,o)}function a(o,r){return r.i=o.i,r.w=o.w,r.X=o.X.slice(),r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.X&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor4096=u})(je,e,!1)})(Uw);var Gw={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.b,f=r.c,d=r.d,p=r.a;return c=c<<25^c>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-c|0,r.b=c=c<<20^c>>>12^f,r.c=f=f-d|0,r.d=d<<16^f>>>16^p,r.a=p-c|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,o===Math.floor(o)?(r.a=o/4294967296|0,r.b=o|0):l+=o;for(var h=0;h<l.length+20;h++)r.b^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.a=o.a,r.b=o.b,r.c=o.c,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.tychei=u})(je,e,!1)})(Gw);var Hw={exports:{}};(function(e){(function(t,n){var s=(0,eval)("this"),i=256,a=6,u=52,o="random",r=n.pow(i,a),l=n.pow(2,u),h=l*2,c=i-1,f;function d(v,w,C){var S=[];w=w==!0?{entropy:!0}:w||{};var k=x(g(w.entropy?[v,y(t)]:v==null?b():v,3),S),T=new p(S),N=function(){for(var R=T.g(a),L=r,z=0;R<l;)R=(R+z)*i,L*=i,z=T.g(1);for(;R>=h;)R/=2,L/=2,z>>>=1;return(R+z)/L};return N.int32=function(){return T.g(4)|0},N.quick=function(){return T.g(4)/4294967296},N.double=N,x(y(T.S),t),(w.pass||C||function(R,L,z,U){return U&&(U.S&&m(U,T),R.state=function(){return m(T,{})}),z?(n[o]=R,L):R})(N,k,"global"in w?w.global:this==n,w.state)}n["seed"+o]=d;function p(v){var w,C=v.length,S=this,k=0,T=S.i=S.j=0,N=S.S=[];for(C||(v=[C++]);k<i;)N[k]=k++;for(k=0;k<i;k++)N[k]=N[T=c&T+v[k%C]+(w=N[k])],N[T]=w;(S.g=function(R){for(var L,z=0,U=S.i,H=S.j,Y=S.S;R--;)L=Y[U=c&U+1],z=z*i+Y[c&(Y[U]=Y[H=c&H+L])+(Y[H]=L)];return S.i=U,S.j=H,z})(i)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function g(v,w){var C=[],S=typeof v,k;if(w&&S=="object")for(k in v)try{C.push(g(v[k],w-1))}catch{}return C.length?C:S=="string"?v:v+"\0"}function x(v,w){for(var C=v+"",S,k=0;k<C.length;)w[c&k]=c&(S^=w[c&k]*19)+C.charCodeAt(k++);return y(w)}function b(){try{var v;return f&&(v=f.randomBytes)?v=v(i):(v=new Uint8Array(i),(s.crypto||s.msCrypto).getRandomValues(v)),y(v)}catch{var w=s.navigator,C=w&&w.plugins;return[+new Date,s,C,s.screen,y(t)]}}function y(v){return String.fromCharCode.apply(0,v)}if(x(n.random(),t),e.exports){e.exports=d;try{f=require("crypto")}catch{}}})([],Math)})(Hw);var wP=Bw.exports,CP=zw.exports,SP=Ww.exports,kP=Vw.exports,IP=Uw.exports,TP=Gw.exports,Co=Hw.exports;Co.alea=wP;Co.xor128=CP;Co.xorwow=SP;Co.xorshift7=kP;Co.xor4096=IP;Co.tychei=TP;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Yx;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(Yx||(Yx={}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _t(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&P(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _P=oy;class gh extends Id{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new wb(this,_s())}nextDataId(){return gh.nextDataId++}write(t,n,s){this.firstUse&&(this.firstUse=!1,dt().get("IS_NODE")&&Nn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:s,refCount:1}),i}makeTensorInfo(t,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&aa(s[0])){const a=s.map(u=>ui(u));i=this.write(a,t,n)}else i=this.write(s,t,n);return{dataId:i,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,s,i,a){this.data.set(t,{values:n,dtype:i,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:s}=this.data.get(t);if(n==="complex64"){const i=this.readSync(s.real.dataId),a=this.readSync(s.imag.dataId);return Ys(i,a)}return this.data.get(t).values}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const s=n.map(i=>gi(i));return Vt(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Vt(t.shape,t.dtype,n)}makeOutput(t,n,s){return _s().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=cn();return t(),{kernelMs:cn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){_t([t],"where");const n=this.readSync(t.dataId);return _P(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}gh.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jw(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const $P=e=>{const{x:t}=e.inputs,n=e.backend;_t(t,"abs");let s=new Float32Array(pt(t.shape));const i=n.data.get(t.dataId).values;return s=jw(i),n.makeOutput(s,t.shape,t.dtype)},EP={kernelName:Hc,backendName:"cpu",kernelFunc:$P};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(e){return(t,n,s,i,a)=>{const u=Bt(t,n),o=u.length,r=Dt(u),l=pt(u),h=He(a,l),c=t.length,f=n.length,d=Dt(t),p=Dt(n),m=to(t,u),g=to(n,u);if(m.length+g.length===0)for(let x=0;x<h.length;++x)h[x]=e(s[x%s.length],i[x%i.length]);else for(let x=0;x<h.length;++x){const b=ca(x,o,r),y=b.slice(-c);m.forEach(S=>y[S]=0);const v=Rs(y,c,d),w=b.slice(-f);g.forEach(S=>w[S]=0);const C=Rs(w,f,p);h[x]=e(s[v],i[C])}return[h,u]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bn(e){const{inputs:t,backend:n}=e,{real:s,imag:i}=t,a=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,o=n.makeTensorInfo(s.shape,"complex64"),r=n.data.get(o.dataId);return r.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",a),imag:n.makeTensorInfo(i.shape,"float32",u)},o}const NP={kernelName:Fd,backendName:"cpu",kernelFunc:bn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ic(e,t,n="float32"){if(n==="complex64"){const i=Ic(e,t,"float32"),a=Ic(e,t,"float32");return bn({inputs:{real:i,imag:a},backend:e})}const s=Ze(pt(t),n);return e.makeTensorInfo(t,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(e){const{inputs:t,backend:n}=e,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const DP={kernelName:Na,backendName:"cpu",kernelFunc:Bs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pr(e){const{inputs:t,backend:n}=e,{input:s}=t,i=n.data.get(s.dataId).complexTensorInfos.real,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const AP={kernelName:sp,backendName:"cpu",kernelFunc:pr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yi(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{dtype:a}=s;if(a==="complex64"){if(i.dtype==="complex64")return Bs({inputs:{x:i},backend:n});const u=Ic(n,i.shape,i.dtype),o=yi({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=bn({inputs:{real:o,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(o),r}if(i.dtype==="complex64"){const u=pr({inputs:{input:i},backend:n}),o=yi({inputs:{x:u},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(u),o}if(!kb(i.dtype,a)){const u=Bs({inputs:{x:i},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:a}}if(a==="int32"){const u=n.data.get(i.dataId).values,o=Int32Array.from(u);return n.makeTensorInfo(i.shape,"int32",o)}if(a==="bool"){const u=n.data.get(i.dataId).values,o=xr([0],i.dtype),[r,l]=$e((h,c)=>h!==c?1:0)(i.shape,[],u,o,"bool");return n.makeTensorInfo(l,"bool",r)}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${a}`)}const RP={kernelName:xa,backendName:"cpu",kernelFunc:yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(e,t,n,s){return n==null?({inputs:i,backend:a})=>{const{a:u,b:o}=i,r=a;_t([u,o],e);const l=r.data.get(u.dataId).values,h=r.data.get(o.dataId).values,c=u.dtype==="string"?fr(l):l,f=u.dtype==="string"?fr(h):h,d=s||u.dtype,[p,m]=t(u.shape,o.shape,c,f,d);return r.makeTensorInfo(m,d,p)}:({inputs:i,backend:a})=>{const{a:u,b:o}=i,r=a;if(u.dtype==="complex64"||o.dtype==="complex64"){const l=yi({inputs:{x:u},backend:r,attrs:{dtype:"complex64"}}),h=r.data.get(l.dataId),c=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,d=r.data.get(c.dataId).values,p=r.data.get(f.dataId).values,m=yi({inputs:{x:o},backend:r,attrs:{dtype:"complex64"}}),g=r.data.get(m.dataId),x=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,y=r.data.get(x.dataId).values,v=r.data.get(b.dataId).values,[w,C,S]=n(u.shape,o.shape,d,p,y,v),k=r.makeTensorInfo(S,"float32",w),T=r.makeTensorInfo(S,"float32",C),N=bn({inputs:{real:k,imag:T},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(T),N}else{const l=r.data.get(u.dataId).values,h=r.data.get(o.dataId).values,c=s||u.dtype,[f,d]=t(u.shape,o.shape,l,h,c);return r.makeTensorInfo(d,c,f)}}}function Qg(e){return(t,n,s,i,a,u)=>{const o=Bt(t,n),r=pt(o),l=o.length,h=Dt(o),c=He("float32",r),f=He("float32",r),d=to(t,o),p=to(n,o),m=Ys(s,i),g=Ys(a,u),x=t.length,b=Dt(t),y=n.length,v=Dt(n);if(d.length+p.length===0)for(let w=0;w<c.length;w++){const C=w%m.length,S=w%g.length,k=e(m[C*2],m[C*2+1],g[S*2],g[S*2+1]);c[w]=k.real,f[w]=k.imag}else for(let w=0;w<c.length;w++){const C=ca(w,l,h),S=C.slice(-x);d.forEach(L=>S[L]=0);const k=Rs(S,x,b),T=C.slice(-y);p.forEach(L=>T[L]=0);const N=Rs(T,y,v),R=e(m[k*2],m[k*2+1],g[N*2],g[N*2+1]);c[w]=R.real,f[w]=R.imag}return[c,f,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xw=$e((e,t)=>e+t),OP=Qg((e,t,n,s)=>({real:e+n,imag:t+s})),ro=Ve(go,Xw,OP),FP={kernelName:go,backendName:"cpu",kernelFunc:ro};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tm(e,t,n,s,i){const a=pt(s),u=Ze(i,n);for(let o=0;o<e.length;o++){const r=e[o];if(r<0)throw new Error("Input x must be non-negative!");r>=i||(a>0?u[r]+=t[o]:u[r]+=1)}return u}function Yw(e,t,n,s=!1){const i=e.shape[0],a=e.shape[1],u=Vt([i,n],t.dtype);for(let o=0;o<i;o++)for(let r=0;r<a;r++){const l=e.get(o,r);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(s?u.set(1,o,l):t.size>0?u.set(u.get(o,l)+t.get(o,r),o,l):u.set(u.get(o,l)+1,o,l))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ei(e){return(t,n,s)=>{const i=He(n,t.length);for(let a=0;a<t.length;++a)i[a]=e(t[a],s);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ee(e,t,n){return({inputs:s,attrs:i,backend:a})=>{const{x:u}=s;if(_t(u,e),u.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const o=a,r=o.data.get(u.dataId).values,l=pt(u.shape),h=n||u.dtype,c=nn(h,l);for(let f=0;f<l;++f)c[f]=t(r[f],i);return o.makeTensorInfo(u.shape,h,c)}}function So(e,t,n){return({inputs:s,attrs:i,backend:a})=>{const{x:u}=s;if(_t(u,e),u.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const o=a,r=o.data.get(u.dataId).values,l=n||u.dtype,h=t(r,l,i);return o.makeTensorInfo(u.shape,l,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw=Ei(e=>Math.ceil(e)),PP=So(ba,qw),MP={kernelName:ba,backendName:"cpu",kernelFunc:PP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kw(e,t,n,s){const i=nn(n,pt(t));if(s&&n!=="string"){let a=0;e.forEach(u=>{const o=pt(u.shape);i.set(u.vals,a),a+=o})}else{let a=0;e.forEach(u=>{const o=n==="string"?fr(u.vals):u.vals;let r=0;for(let l=0;l<u.shape[0];++l){const h=l*t[1]+a;for(let c=0;c<u.shape[1];++c)i[h+c]=o[r++]}a+=u.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jw=$e((e,t)=>e===t?1:0),Zw=Ve(ou,Jw,null,"bool"),LP={kernelName:ou,backendName:"cpu",kernelFunc:Zw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qw=Ei(e=>Math.exp(e)),tC=So(Ia,Qw,"float32"),BP={kernelName:Ia,backendName:"cpu",kernelFunc:tC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC=Ei(e=>Math.expm1(e)),zP=So(Ta,eC),WP={kernelName:Ta,backendName:"cpu",kernelFunc:zP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nC=Ei(e=>Math.floor(e)),VP=So(_a,nC),UP={kernelName:_a,backendName:"cpu",kernelFunc:VP};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sC(e,t,n,s,i,a,u,o,r){const l=Vt([s,a],n);for(let h=0;h<s;h++){const c=[];let f=0;for(let d=0;d<i;d++){const p=e[h*i+d];f+=p*u[d],c.push(p)}if(f<0||f>=r/a)throw new Error(`Invalid indices: ${c} does not index into ${o}`);for(let d=0;d<a;d++)l.values[h*a+d]=t.get(...t.indexToLoc(f*a+d))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iC(e,t,n){const s=Vt(n,e.dtype);for(let i=0;i<s.size;++i){const u=s.indexToLoc(i).slice(),o=u[0],r=u[2],l=t.locToIndex([o,r]);u[2]=t.values[l];const h=e.locToIndex(u);0<=h&&h<e.values.length&&(s.values[i]=e.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC=$e((e,t)=>e>t?1:0),GP=Ve(uu,rC,null,"bool"),HP={kernelName:uu,backendName:"cpu",kernelFunc:GP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oC=$e((e,t)=>e>=t?1:0),jP=Ve(Ea,oC,null,"bool"),XP={kernelName:Ea,backendName:"cpu",kernelFunc:jP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC=$e((e,t)=>e<t?1:0),YP=Ve(fu,aC,null,"bool"),qP={kernelName:fu,backendName:"cpu",kernelFunc:YP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC=$e((e,t)=>e<=t?1:0),KP=Ve(du,lC,null,"bool"),JP={kernelName:du,backendName:"cpu",kernelFunc:KP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cC(e,t,n){const s=(t-e)/(n-1),i=Ze(n,"float32");i[0]=e;for(let a=1;a<i.length;a++)i[a]=i[a-1]+s;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC=Ei(e=>Math.log(e)),ZP=So(Oa,uC),QP={kernelName:Oa,backendName:"cpu",kernelFunc:ZP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hC(e,t,n,s){const i=He(s,pt(n));for(let a=0;a<i.length;++a){const u=a*t;let o=e[u];for(let r=0;r<t;++r){const l=e[u+r];(Number.isNaN(l)||l>o)&&(o=l)}i[a]=o}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fC=$e((e,t)=>Math.max(e,t)),tM=Ve(Pa,fC),eM={kernelName:Pa,backendName:"cpu",kernelFunc:tM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dC=$e((e,t)=>Math.min(e,t)),nM=Ve(Ma,dC),sM={kernelName:Ma,backendName:"cpu",kernelFunc:nM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const em=$e((e,t)=>e*t),iM=Qg((e,t,n,s)=>({real:e*n-t*s,imag:e*s+t*n})),mh=Ve(Ba,em,iM),rM={kernelName:Ba,backendName:"cpu",kernelFunc:mh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pC(e,t,n){const s=Ci(-1,n);return em([],t,s,e,n)}function oM(e){const{inputs:t,backend:n}=e,{x:s}=t;_t(s,"neg");const i=n.data.get(s.dataId).values,[a,u]=pC(i,s.shape,s.dtype);return n.makeTensorInfo(u,s.dtype,a)}const aM={kernelName:ku,backendName:"cpu",kernelFunc:oM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gC=$e((e,t)=>e!==t?1:0),lM=Ve(Iu,gC,null,"bool"),cM={kernelName:Iu,backendName:"cpu",kernelFunc:lM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nm(e,t,n,s,i){const a=t.length,u=pt(t),o=Dt(t),r=Dt(i),l=He(n,pt(i));for(let h=0;h<u;++h){const c=ca(h,a,o),f=new Array(c.length);for(let p=0;p<f.length;p++)f[p]=c[s[p]];const d=Rs(f,a,r);l[d]=e[h]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dn(e){const{inputs:t,attrs:n,backend:s}=e,{x:i}=t,{perm:a}=n;_t(i,"transpose");const u=i.shape.length,o=new Array(u);for(let c=0;c<o.length;c++)o[c]=i.shape[a[c]];const r=s.data.get(i.dataId).values,l=nm(r,i.shape,i.dtype,a,o);return{dataId:s.write(l,o,i.dtype),shape:o,dtype:i.dtype}}const uM={kernelName:Vr,backendName:"cpu",kernelFunc:dn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mC(e,t,n,s){const[i,a]=We(e,s),u=Cn(t,"int32"),o=Ze(pt(i),u),r=pt(a);for(let l=0;l<o.length;++l){const h=l*r;let c=1;for(let f=0;f<r;++f)c*=n[h+f];o[l]=c}return{outVals:o,outShape:i,outDtype:u}}function hM(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;_t(i,"prod");const o=i.shape.length,r=Ut(a,i.shape),l=be(r,o);let h=r,c=i;const f=[];l!=null&&(c=dn({inputs:{x:i},backend:n,attrs:{perm:l}}),f.push(c),h=ke(h.length,o));const d=n.data.get(c.dataId).values,{outVals:p,outShape:m,outDtype:g}=mC(c.shape,c.dtype,d,h);let x=m;return u&&(x=Se(m,r)),f.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(x,g,p)}const fM={kernelName:Du,backendName:"cpu",kernelFunc:hM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xC(e,t,n,s){const i=e===t,a=e<t&&n<0,u=t<e&&n>1;if(i||a||u)return Ze(0,s);const o=Math.abs(Math.ceil((t-e)/n)),r=Ze(o,s);t<e&&n===1&&(n=-1),r[0]=e;for(let l=1;l<r.length;l++)r[l]=r[l-1]+n;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bC=Ei(e=>1/Math.sqrt(e)),dM=So(Ha,bC),pM={kernelName:Ha,backendName:"cpu",kernelFunc:dM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mr(e,t,n,s,i,a,u,o,r,l){const h=[s/i,i],c=e.values,f=t.values;if(s===0)return Vt(n,t.dtype);const d=Vt(h,t.dtype);typeof r=="string"||typeof r=="number"?d.values.fill(r):typeof r=="boolean"&&d.values.fill(+r);for(let p=0;p<a;p++){const m=[];let g=0;for(let x=0;x<u;x++){const b=c[p*u+x];m.push(b),g+=b*o[x]}if(g<0||g>=s/i)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let x=0;x<i;x++)l?d.values[g*i+x]+=f[p*i+x]:d.values[g*i+x]=t.rank===0?f[0]:f[p*i+x]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gM=Ei(e=>1/(1+Math.exp(-e))),vC=ee(Ka,e=>1/(1+Math.exp(-e))),mM={kernelName:Ka,backendName:"cpu",kernelFunc:vC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yC(e,t,n,s,i){const a=_p(s,t,n),u=pt(n),o=Dt(s);if(a){const c=$p(t,o);return i==="string"?e.slice(c,c+u):e.subarray(c,c+u)}const r=i==="string"?fr(e):e,l=Vt(s,i,r),h=Vt(n,i);for(let c=0;c<h.size;++c){const f=h.indexToLoc(c),d=f.map((p,m)=>p+t[m]);h.set(l.get(...d),...f)}return i==="string"?Ny(h.values):h.values}function gr(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{begin:a,size:u}=s;_t(i,"slice");const[o,r]=Xu(i,a,u);Ip(i,o,r);const l=n.data.get(i.dataId).values,h=yC(l,o,r,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,h)}const xM={kernelName:Mu,backendName:"cpu",kernelFunc:gr};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wC(e,t,n,s,i,a,u){const o=t[0],r=a[0],l=new Array(r),h=new Array(o),c=t[1];if(r===0){if(o!==0)throw new Error(xy(o));const g=nn(n,0),x=nn(i,0);return[g,[0,c],x,l,h]}let f=!0,d=0;const p=new Array(r).fill(0);for(let g=0;g<o;++g){const x=e[g*c];if(x<0)throw new Error(by(g,x));if(x>=r)throw new Error(vy(g,x,r));++p[x],f=f&&x>=d,d=x}let m=!0;for(let g=0;g<r;++g){const x=p[g]===0;l[g]=x,m=m&&!x,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&f){const g=e,x=s;for(let b=0;b<o;++b)h[b]=b;return[g,[o,c],x,l,h]}else{const g=p[r-1],x=nn(n,g*c),b=nn(i,g),y=new Array(r).fill(0);for(let v=0;v<o;++v){const w=e[v*c],C=y[w],S=(w===0?0:p[w-1])+C;y[w]++;for(let k=0;k<c;++k)x[S*c+k]=e[v*c+k];b[S]=s[v],h[v]=S}for(let v=0;v<r;++v)if(y[v]===0){const C=v===0?0:p[v-1];x[C*c+0]=v;for(let S=1;S<c;++S)x[C*c+S]=0;b[C]=u}return[x,[g,c],b,l,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CC(e,t,n,s,i){const a=pt(s),u=t[0],o=i.length,r=[];let l=1,h=-1;for(let g=0;g<o;++g){const x=i[g];if(x===-1){if(h!==-1)throw new Error(yy(h,g));h=g,r.push(1)}else{if(x<0)throw new Error(wy(g,x));l*=x,r.push(x)}}if(h!==-1){if(l<=0)throw new Error(Cy());const g=Math.trunc(a/l);if(l*g!==a)throw new Error(Sy(s,r));r[h]=g}if(pt(r)!==a)throw new Error(ky(s,r));const f=s.length,d=[];if(f>0){d[f-1]=1;for(let g=f-2;g>=0;--g)d[g]=d[g+1]*s[g+1]}const p=[];if(o>0){p[o-1]=1;for(let g=o-2;g>=0;--g)p[g]=p[g+1]*r[g+1]}const m=nn(n,u*o);for(let g=0;g<u;++g){let x=0;for(let b=0;b<f;++b)x+=e[g*f+b]*d[b];for(let b=0;b<o;++b)m[g*o+b]=Math.trunc(x/p[b]),x%=p[b]}return[m,[u,o],r]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sm(e,t,n,s,i,a=!1,u=0){const o=s.length,r=[t[0],e.length/t[0]],l=r[1],c=o>0?i[o-1]+1:0;if(c<0)throw new Error(Vf());const f=t.slice();f[0]=c;const d=f.reduce((y,v)=>y*v,1),p=nn(n,d);if(o===0)return c>0&&p.fill(u),[p,f];if(c<=0)throw new Error(Vf());let m=0,g=1,x=0,b=i[m];for(;;){let y=0;if(g<o){if(y=i[g],b===y){++g;continue}if(b>=y)throw new Error(Iy())}if(b<0||b>=c)throw new Error(Ty(b,c));b>x&&p.fill(u,x*l,b*l);for(let v=m;v<g;++v){const w=s[v];if(w<0||w>=r[0])throw new Error(_y(v,s[v],r[0]));for(let C=0;C<l;C++)p[b*l+C]+=e[w*l+C]}if(a)for(let v=0;v<l;v++)p[b*l+v]/=g-m;if(m=g,++g,x=b+1,b=y,g>o)break}return x<c&&p.fill(u,x*l,c*l),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bM=Ei(e=>Math.sqrt(e)),vM=ee(Za,e=>Math.sqrt(e)),yM={kernelName:Za,backendName:"cpu",kernelFunc:vM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SC=$e((e,t)=>{const n=e-t;return n*n}),wM=Ve(Qa,SC),CM={kernelName:Qa,backendName:"cpu",kernelFunc:wM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kC(e,t,n,s){const i=Vt(e,t.dtype);for(let a=0;a<i.size;a++){const u=i.indexToLoc(a),o=new Array(u.length);for(let r=0;r<o.length;r++)o[r]=u[r]*n[r]+s[r];i.set(t.get(...o),...u)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SM{constructor(t,n,s,i,a,u){this.separator=ui(t),this.nGramWidths=n,this.leftPad=ui(s),this.rightPad=ui(i),this.padWidth=a,this.preserveShort=u}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const s=this.getPadWidth(n);return Math.max(0,t+2*s-n+1)}createNGrams(t,n,s,i,a,u){for(let o=0;o<a;++o){const r=this.getPadWidth(u),l=Math.max(0,r-o),h=Math.max(0,r-(a-(o+1))),c=u-(l+h),f=n+(l>0?0:o-r);let d=0;d+=l*this.leftPad.length;for(let b=0;b<c;++b)d+=t[f+b].length;d+=h*this.rightPad.length,d+=(l+h+c-1)*this.separator.length,s[i+o]=new Uint8Array(d);const m=s[i+o];let g=0;const x=b=>b.forEach(y=>m[g++]=y);for(let b=0;b<l;++b)x(this.leftPad),x(this.separator);for(let b=0;b<c-1;++b)x(t[f+b]),x(this.separator);if(c>0){x(t[f+c-1]);for(let b=0;b<h;++b)x(this.separator),x(this.rightPad)}else{for(let b=0;b<h-1;++b)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(t,n){const s=t.length,i=n.length;if(i>0){let r=n[0];if(r!==0)throw new Error(`First split value must be 0, got ${r}`);for(let l=1;l<i;++l){let h=n[l]>=r;if(h=h&&n[l]<=s,!h)throw new Error(`Invalid split value ${n[l]}, must be in [${r}, ${s}]`);r=n[l]}if(r!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${r}`)}const a=i-1,u=nn("int32",i);if(s===0||i===0){const r=new Array(s);for(let l=0;l<=a;++l)u[l]=0;return[r,u]}u[0]=0;for(let r=1;r<=a;++r){const l=n[r]-n[r-1];let h=0;this.nGramWidths.forEach(c=>{h+=this.getNumNGrams(l,c)}),this.preserveShort&&l>0&&h===0&&(h=1),u[r]=u[r-1]+h}const o=new Array(u[a]);for(let r=0;r<a;++r){const l=n[r];let h=u[r];if(this.nGramWidths.forEach(c=>{const f=n[r+1]-n[r],d=this.getNumNGrams(f,c);this.createNGrams(t,l,o,h,d,c),h+=d}),this.preserveShort&&h===u[r]){const c=n[r+1]-n[r];if(c===0)continue;const f=c+2*this.padWidth,d=1;this.createNGrams(t,l,o,h,d,f)}}return[o,u]}}function IC(e,t,n,s,i,a,u,o){return new SM(n,s,i,a,u,o).compute(e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kM(e,t,n,s){if(!e.length)return;if(t.length===0){for(let a=0;a<e.length;++a)s.push(e.subarray(a,a+1));return}if(t.length===1){const a=t[0];let u=e.indexOf(a);for(;u!==-1;){const o=e.subarray(0,u);(!n||o.length!==0)&&s.push(o),e=e.subarray(u+1),u=e.indexOf(a)}(!n||e.length!==0)&&s.push(e);return}let i=0;for(let a=0;a<e.length+1;a++)if(a===e.length||t.indexOf(e[a])!==-1){const u=e.subarray(i,a);(!n||u.length!==0)&&s.push(u),i=a+1}}function TC(e,t,n){const s=e.length,i=[];let a=0,u=0;const o=new Array(s);for(let f=0;f<s;++f){const d=i.length;kM(e[f],t,n,i);const p=i.length-d;o[f]=p,a+=p,u=Math.max(u,p)}const r=nn("int32",a*2),l=new Array(a),h=[s,u];let c=0;for(let f=0;f<s;++f)for(let d=0;d<o[f];++d)r[c*2]=f,r[c*2+1]=d,l[c]=i[c],++c;return[r,l,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(e,t){const n=nn("int32",e.length);for(let s=0;s<e.length;++s)n[s]=t_(e[s]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C=$e((e,t)=>e-t),IM=Qg((e,t,n,s)=>({real:e-n,imag:t-s})),im=Ve(tl,$C,IM),TM={kernelName:tl,backendName:"cpu",kernelFunc:im};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const s=Vt(n,e.dtype);for(let i=0;i<s.values.length;++i){const a=s.indexToLoc(i),u=new Array(e.rank);for(let r=0;r<u.length;r++)u[r]=a[r]%e.shape[r];const o=e.locToIndex(u);s.values[i]=e.values[o]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bo=(e,t)=>{const n=t.value-e.value;return n===0?e.index-t.index:n};function NC(e,t,n=0,s=e.length-1){for(;s>n;){if(s-n>600){const o=s-n+1,r=t-n+1,l=Math.log(o),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(o-h)/o)*Math.sign(r-o/2),f=Math.max(n,Math.floor(t-r*h/o+c)),d=Math.min(s,Math.floor(t+(o-r)*h/o+c));NC(e,t,f,d)}const i=e[t];let a=n,u=s;for(Ar(e,n,t),Bo(e[s],i)>0&&Ar(e,n,s);a<u;){for(Ar(e,a,u),a++,u--;Bo(e[a],i)<0;)a=a+1;for(;Bo(e[u],i)>0;)u=u-1}Bo(e[n],i)===0?Ar(e,n,u):(u=u+1,Ar(e,u,s)),u<=t&&(n=u+1),t<=u&&(s=u-1)}}function DC(e,t,n,s,i){const a=t[t.length-1],[u,o]=[e.length/a,a],r=He(n,u*s),l=He("int32",u*s);for(let c=0;c<u;c++){const f=c*o,d=e.subarray(f,f+o);let p=new Array(d.length);d.forEach((b,y)=>p[y]={value:b,index:y}),s<p.length&&(NC(p,s),p=p.slice(0,s)),i&&p.sort(Bo);const m=c*s,g=r.subarray(m,m+s),x=l.subarray(m,m+s);for(let b=0;b<s;b++)g[b]=p[b].value,x[b]=p[b].index}const h=t.slice();return h[h.length-1]=s,[Vt(h,n,r),Vt(h,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AC(e,t,n,s){const i=Ut(t,n)[0],a=[1,n[0],1];for(let p=0;p<i;p++)a[0]*=n[p];a[1]=n[i];for(let p=i+1;p<n.length;p++)a[2]*=n[p];const u={},o=new Int32Array(n[i]),r=new Je(a,s,e),l=[],h=a[0]===1&&a[2]===1;for(let p=0;p<n[i];p++){let m;if(h)m=e[p].toString();else{const g=[];for(let x=0;x<a[0];x++)for(let b=0;b<a[2];b++)g.push(r.get(x,p,b));m=g.join(",")}if(u[m]!==void 0)o[p]=u[m];else{const g=Object.keys(u).length;u[m]=g,o[p]=g,l.push(p)}}const c=a.slice();c[1]=Object.keys(u).length;const f=new Je(c,s);l.forEach((p,m)=>{for(let g=0;g<a[0];g++)for(let x=0;x<a[2];x++)f.set(r.get(g,p,x),g,m,x)});const d=n.slice();return d[i]=c[1],{outputValues:f.values,outputShape:d,indices:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _M=Object.freeze(Object.defineProperty({__proto__:null,simpleAbsImpl:jw,addImpl:Xw,bincountImpl:tm,bincountReduceImpl:Yw,ceilImpl:qw,concatImpl:Kw,equalImpl:Jw,expImpl:Qw,expm1Impl:eC,floorImpl:nC,gatherNdImpl:sC,gatherV2Impl:iC,greaterImpl:rC,greaterEqualImpl:oC,lessImpl:aC,lessEqualImpl:lC,linSpaceImpl:cC,logImpl:uC,maxImpl:hC,maximumImpl:fC,minimumImpl:dC,multiplyImpl:em,negImpl:pC,notEqualImpl:gC,prodImpl:mC,rangeImpl:xC,rsqrtImpl:bC,scatterImpl:Mr,sigmoidImpl:gM,sliceImpl:yC,sparseFillEmptyRowsImpl:wC,sparseReshapeImpl:CC,sparseSegmentReductionImpl:sm,sqrtImpl:bM,squaredDifferenceImpl:SC,stridedSliceImpl:kC,stringNGramsImpl:IC,stringSplitImpl:TC,stringToHashBucketFastImpl:_C,subImpl:$C,tileImpl:EC,topKImpl:DC,transposeImpl:nm,uniqueImpl:AC},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */gv("cpu",()=>new gh,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RC=ee(Sa,e=>e>=0?e:Math.exp(e)-1),$M={kernelName:Sa,backendName:"cpu",kernelFunc:RC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{alpha:a}=s;_t([i],"leakyRelu");const u=pt(i.shape),o=n.data.get(i.dataId).values,r=He("float32",u);for(let l=0;l<o.length;l++)r[l]=o[l]<0?a*o[l]:o[l];return n.makeTensorInfo(i.shape,"float32",r)}const EM={kernelName:hu,backendName:"cpu",kernelFunc:OC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM=$e((e,t)=>e<0?t*e:e);function FC(e){const{inputs:t,backend:n}=e,{x:s,alpha:i}=t;_t([s,i],"prelu");const a=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,[o,r]=NM(s.shape,i.shape,a,u,"float32");return n.makeTensorInfo(r,"float32",o)}const DM={kernelName:Nu,backendName:"cpu",kernelFunc:FC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PC=ee(Va,e=>Math.max(0,e)),AM={kernelName:Va,backendName:"cpu",kernelFunc:PC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC=ee(Ua,e=>Math.min(Math.max(0,e),6)),RM={kernelName:Ua,backendName:"cpu",kernelFunc:MC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tc(e,t,n,s,i){if(n==="linear")return Bs({inputs:{x:t},backend:e});if(n==="relu")return PC({inputs:{x:t},backend:e});if(n==="elu")return RC({inputs:{x:t},backend:e});if(n==="relu6")return MC({inputs:{x:t},backend:e});if(n==="prelu")return FC({inputs:{x:t,alpha:s},backend:e});if(n==="leakyrelu")return OC({inputs:{x:t},backend:e,attrs:{alpha:i}});if(n==="sigmoid")return vC({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ce(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{shape:a}=s,u=pt(i.shape),o=Sb(a,u),r=pt(o);P(u===r,()=>`The new shape (${o}) has ${r} elements and the old shape (${i.shape}) has ${u} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(l.complexTensorInfos!=null){const h=l.complexTensorInfos.real,c=l.complexTensorInfos.imag;h.shape=o,c.shape=o}return{dataId:i.dataId,shape:o,dtype:i.dtype}}const OM={kernelName:Au,backendName:"cpu",kernelFunc:ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LC(e){const{inputs:t,backend:n,attrs:s}=e,{a:i,b:a}=t,{transposeA:u,transposeB:o}=s;_t([i,a],"matMul");const r=i.shape.length,l=a.shape.length,h=u?i.shape[r-2]:i.shape[r-1],c=o?a.shape[l-1]:a.shape[l-2],f=u?i.shape[r-1]:i.shape[r-2],d=o?a.shape[l-2]:a.shape[l-1],p=i.shape.slice(0,-2),m=a.shape.slice(0,-2),g=pt(p),x=pt(m),y=Bt(i.shape.slice(0,-2),a.shape.slice(0,-2)).concat([f,d]);P(h===c,()=>`Error in matMul: inner shapes (${h}) and (${c}) of Tensors with shapes ${i.shape} and ${a.shape} and transposeA=${u} and transposeB=${o} must match.`);const v=u?[g,h,f]:[g,f,h],w=o?[x,d,c]:[x,c,d],C=ce({inputs:{x:i},backend:n,attrs:{shape:v}}),S=ce({inputs:{x:a},backend:n,attrs:{shape:w}}),k=u?C.shape[1]:C.shape[2],T=u?C.shape[2]:C.shape[1],N=o?S.shape[1]:S.shape[2],R=Math.max(g,x),L=n.data.get(C.dataId).values,z=n.data.get(S.dataId).values,U=Dt(C.shape),H=Dt(S.shape),[Y,Q,K]=u?[U[0],1,U[1]]:[U[0],U[1],1],[I,A,D]=o?[1,H[1],H[0]]:[H[1],1,H[0]],F=T*N,j=Vt([R,T,N],C.dtype),O=j.values,_=n.blockSize;for(let V=0;V<R;V++)for(let X=0;X<T;X+=_)for(let rt=0;rt<N;rt+=_)for(let st=0;st<k;st+=_){const ot=Math.min(X+_,T),ht=Math.min(rt+_,N),mt=Math.min(st+_,k);for(let $=X;$<ot;$++)for(let E=rt;E<ht;E++){let B=0;for(let G=st;G<mt;G++){const W=Math.min(V,g-1)*Y,J=Math.min(V,x-1)*D,at=L[W+$*Q+G*K],ct=z[G*I+E*A+J];B+=at*ct}O[V*F+($*N+E)]+=B}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(y,j.dtype,j.values)}const FM={kernelName:Kc,backendName:"cpu",kernelFunc:LC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PM(e){const{inputs:t,backend:n,attrs:s}=e,{a:i,b:a,bias:u,preluActivationWeights:o}=t,{transposeA:r,transposeB:l,activation:h,leakyreluAlpha:c}=s;let f,d,p;const m=[];f=LC({inputs:{a:i,b:a},attrs:{transposeA:r,transposeB:l},backend:n}),u&&(d=ro({inputs:{a:f,b:u},backend:n}),m.push(f),f=d),h&&(p=Tc(n,f,h,o,c),m.push(f),f=p);for(const x of m)n.disposeIntermediateTensorInfo(x);return f}const MM={kernelName:lc,backendName:"cpu",kernelFunc:PM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LM=ee(ua,e=>Math.acos(e)),BM={kernelName:ua,backendName:"cpu",kernelFunc:LM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zM=ee(ha,e=>Math.acosh(e)),WM={kernelName:ha,backendName:"cpu",kernelFunc:zM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VM(e){const{inputs:t,backend:n}=e,s=t;_t(t,"addN");const i=s.map(o=>n.data.get(o.dataId).values),a=Vt(s[0].shape,s[0].dtype),u=a.values;for(let o=0;o<s.length;o++){const r=i[o];for(let l=0;l<u.length;l++)u[l]+=r[l]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}const UM={kernelName:Ed,backendName:"cpu",kernelFunc:VM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;_t(i,"all");const o=Ut(a,i.shape);let r=o;const l=be(r,i.shape.length);let h=i;l!=null&&(h=dn({inputs:{x:i},backend:n,attrs:{perm:l}}),r=ke(r.length,i.shape.length)),Ye("all",r,h.shape.length);const[c,f]=We(h.shape,r),d=pt(f),p=Ze(pt(c),h.dtype),m=n.data.get(h.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let y=m[b];for(let v=0;v<d;++v){const w=m[b+v];y=y&&w}p[x]=y}l!=null&&n.disposeIntermediateTensorInfo(h);const g=n.makeTensorInfo(c,h.dtype,p);if(u){const x=Se(c,o),b=ce({inputs:{x:g},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(g),b}return g}const HM={kernelName:Nd,backendName:"cpu",kernelFunc:GM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jM(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;_t(i,"any");const o=Ut(a,i.shape);let r=o;const l=be(r,i.shape.length);let h=i;l!=null&&(h=dn({inputs:{x:i},backend:n,attrs:{perm:l}}),r=ke(r.length,i.shape.length)),Ye("any",r,h.shape.length);const[c,f]=We(h.shape,r),d=pt(f),p=Ze(pt(c),h.dtype),m=n.data.get(h.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let y=m[b];for(let v=0;v<d;++v){const w=m[b+v];y=y||w}p[x]=y}l!=null&&n.disposeIntermediateTensorInfo(h);const g=n.makeTensorInfo(c,h.dtype,p);if(u){const x=Se(c,o),b=ce({inputs:{x:g},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(g),b}return g}const XM={kernelName:Dd,backendName:"cpu",kernelFunc:jM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YM(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a}=s;_t(i,"argMax");let u=Ut(a,i.shape);const o=be(u,i.shape.length);let r=i;const l=[];o!=null&&(r=dn({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(r),u=ke(u.length,r.shape.length)),u=[u[0]],Ye("argMax",u,r.shape.length);const[h,c]=We(r.shape,u),f=pt(h),d=Ze(f,"int32"),p=pt(c),m=n.data.get(r.dataId).values;for(let g=0;g<d.length;++g){const x=g*p;let b=m[x],y=0;for(let v=0;v<p;++v){const w=m[x+v];w>b&&(b=w,y=v)}d[g]=y}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(h,"int32",d)}const qM={kernelName:jc,backendName:"cpu",kernelFunc:YM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KM(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a}=s;_t(i,"argMin");let u=Ut(a,i.shape);const o=be(u,i.shape.length);let r=i;const l=[];o!=null&&(r=dn({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(r),u=ke(u.length,r.shape.length)),u=[u[0]],Ye("argMin",u,r.shape.length);const[h,c]=We(r.shape,u),f=pt(h),d=Ze(f,"int32"),p=pt(c),m=n.data.get(r.dataId).values;for(let g=0;g<d.length;++g){const x=g*p;let b=m[x],y=0;for(let v=0;v<p;++v){const w=m[x+v];w<b&&(b=w,y=v)}d[g]=y}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(h,"int32",d)}const JM={kernelName:Xc,backendName:"cpu",kernelFunc:KM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZM=ee(fa,e=>Math.asin(e)),QM={kernelName:fa,backendName:"cpu",kernelFunc:ZM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL=ee(da,e=>Math.asinh(e)),eL={kernelName:da,backendName:"cpu",kernelFunc:tL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL=ee(pa,e=>Math.atan(e)),sL={kernelName:pa,backendName:"cpu",kernelFunc:nL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iL=$e((e,t)=>Math.atan2(e,t)),rL=Ve(ma,iL),oL={kernelName:ma,backendName:"cpu",kernelFunc:rL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aL=ee(ga,e=>Math.atanh(e)),lL={kernelName:ga,backendName:"cpu",kernelFunc:aL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rm(e,t,n,s,i,a){const u=i.strideHeight,o=i.strideWidth,r=i.dilationHeight,l=i.dilationWidth,h=i.effectiveFilterHeight,c=i.effectiveFilterWidth,f=i.padInfo.top,d=i.padInfo.left,p=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Vt(i.outShape,n),g=m.values,x=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],y=i.outShape[3];for(let v=0;v<i.batchSize;++v){const w=v*x,C=v*s[0];for(let S=0;S<i.inChannels;++S)for(let k=0;k<i.outHeight;++k){const T=k*u-f,N=Math.max(0,T),R=Math.min(i.inHeight,h+T),L=w+k*b;for(let z=0;z<i.outWidth;++z){const U=z*o-d,H=Math.max(0,U),Y=Math.min(i.inWidth,c+U);let Q=p,K=0,I=0;for(let D=N;D<R;D+=r){const F=C+D*s[1];for(let j=H;j<Y;j+=l){const O=F+j*s[2],_=e[O+S];a==="max"&&_>Q?Q=_:a==="avg"&&(K+=_,I++)}if(isNaN(Q))break}const A=L+z*y+S;g[A]=a==="avg"?K/I:Q}}}return m}function BC(e,t,n,s,i=!1,a=!1){const u=Vt(s.outShape,"int32"),o=s.strideHeight,r=s.strideWidth,l=s.dilationHeight,h=s.dilationWidth,c=s.effectiveFilterHeight,f=s.effectiveFilterWidth,d=s.padInfo.top,p=s.padInfo.left,m=Vt(t,n,e);for(let g=0;g<s.batchSize;++g)for(let x=0;x<s.inChannels;++x)for(let b=0;b<s.outHeight;++b){const y=b*o-d;let v=y;for(;v<0;)v+=l;const w=Math.min(s.inHeight,c+y);for(let C=0;C<s.outWidth;++C){const S=C*r-p;let k=S;for(;k<0;)k+=h;const T=Math.min(s.inWidth,f+S);let N=Number.NEGATIVE_INFINITY,R=-1;for(let L=v;L<w;L+=l){const z=L-y;for(let U=k;U<T;U+=h){const H=U-S,Y=m.get(g,L,U,x);Y>N&&(N=Y,i?R=a?((g*s.inHeight+L)*s.inWidth+U)*s.inChannels+x:(L*s.inWidth+U)*s.inChannels+x:R=z*f+H)}}u.set(R,g,b,C,x)}}return u}function zC(e,t,n,s,i,a){const u=i.strideDepth,o=i.strideHeight,r=i.strideWidth,l=i.dilationDepth,h=i.dilationHeight,c=i.dilationWidth,f=i.effectiveFilterDepth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,x=i.padInfo.left,b=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=Vt(i.outShape,n),v=y.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],C=i.outShape[2]*i.outShape[3]*i.outShape[4],S=i.outShape[3]*i.outShape[4],k=i.outShape[4];for(let T=0;T<i.batchSize;++T){const N=T*w,R=T*s[0];for(let L=0;L<i.inChannels;++L)for(let z=0;z<i.outDepth;++z){const U=z*u-m;let H=U;for(;H<0;)H+=l;const Y=Math.min(i.inDepth,f+U),Q=N+z*C;for(let K=0;K<i.outHeight;++K){const I=K*o-g;let A=I;for(;A<0;)A+=h;const D=Math.min(i.inHeight,d+I),F=Q+K*S;for(let j=0;j<i.outWidth;++j){const O=j*r-x;let _=O;for(;_<0;)_+=c;const V=Math.min(i.inWidth,p+O),X=F+j*k;let rt=b,st=0,ot=0;for(let mt=H;mt<Y;mt+=l){const $=R+mt*s[1];for(let E=A;E<D;E+=h){const B=$+E*s[2];for(let G=_;G<V;G+=c){const W=B+G*s[3],J=e[W+L];if(a==="max"&&J>rt?rt=J:a==="avg"&&(st+=J,ot++),isNaN(rt))break}if(isNaN(rt))break}if(isNaN(rt))break}const ht=X+L;v[ht]=a==="avg"?st/ot:rt}}}}return y}function cL(e,t){const n=Vt(t.outShape,"int32"),s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,o=t.dilationHeight,r=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,c=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let x=0;x<t.outDepth;++x){const b=x*s-f;let y=b;for(;y<0;)y+=u;const v=Math.min(t.inDepth,l+b);for(let w=0;w<t.outHeight;++w){const C=w*i-d;let S=C;for(;S<0;)S+=o;const k=Math.min(t.inHeight,h+C);for(let T=0;T<t.outWidth;++T){const N=T*a-p;let R=N;for(;R<0;)R+=r;const L=Math.min(t.inWidth,c+N);let z=Number.NEGATIVE_INFINITY,U=-1;for(let H=y;H<v;H+=u){const Y=H-b;for(let Q=S;Q<k;Q+=o){const K=Q-C;for(let I=R;I<L;I+=r){const A=I-N,D=e.get(m,H,Q,I,g);D>=z&&(z=D,U=Y*h*c+K*h+A)}}}n.set(U,m,x,w,T,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t;_t(i,"avgPool");const{filterSize:a,strides:u,pad:o,dimRoundingMode:r}=s,l=1;P(Qe(u,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${u} and dilations '${l}'`);const h=Zn(i.shape,a,u,l,o,r);let c;if(h.filterWidth===1&&h.filterHeight===1&&Qt(h.inShape,h.outShape))c=Bs({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,d=Dt(i.shape),p=rm(f,i.shape,i.dtype,d,h,"avg");c=n.makeTensorInfo(h.outShape,i.dtype,p.values)}return c}const hL={kernelName:Yc,backendName:"cpu",kernelFunc:uL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{filterSize:a,strides:u,pad:o,dimRoundingMode:r,dataFormat:l}=s;_t(i,"avgPool3d");const h=Ks(i.shape,a,u,1,o,r,l),c=n.data.get(i.dataId).values,f=zC(c,i.shape,i.dtype,Dt(i.shape),h,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const dL={kernelName:qc,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,{filterSize:u,strides:o,pad:r,dimRoundingMode:l}=s;_t([i,a],"avgPool3DGrad");const h=Ks(a.shape,u,o,1,r,l),c=h.strideDepth,f=h.strideHeight,d=h.strideWidth,p=h.filterDepth,m=h.filterHeight,g=h.filterWidth,x=h.dilationDepth,b=h.dilationHeight,y=h.dilationWidth,v=h.effectiveFilterDepth,w=h.effectiveFilterHeight,C=h.effectiveFilterWidth,S=v-1-h.padInfo.front,k=C-1-h.padInfo.left,T=w-1-h.padInfo.top,N=Vt(a.shape,"float32"),R=1/(p*m*g),L=n.bufferSync(i);for(let z=0;z<h.batchSize;++z)for(let U=0;U<h.inChannels;++U)for(let H=0;H<h.inDepth;++H)for(let Y=0;Y<h.inHeight;++Y)for(let Q=0;Q<h.inWidth;++Q){const K=H-S,I=Y-T,A=Q-k;let D=0;for(let F=0;F<v;F+=x){const j=(K+F)/c;if(!(j<0||j>=h.outDepth||Math.floor(j)!==j))for(let O=0;O<w;O+=b){const _=(I+O)/f;if(!(_<0||_>=h.outHeight||Math.floor(_)!==_))for(let V=0;V<C;V+=y){const X=(A+V)/d;if(X<0||X>=h.outWidth||Math.floor(X)!==X)continue;D+=L.get(z,j,_,X,U)}}}N.set(D*R,z,H,Y,Q,U)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const gL={kernelName:Rd,backendName:"cpu",kernelFunc:pL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,u=a;_t([i,a],"avgPoolGrad");const{filterSize:o,strides:r,pad:l}=s,h=Zn(u.shape,o,r,1,l),c=h.strideHeight,f=h.strideWidth,d=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,x=h.effectiveFilterHeight,b=h.effectiveFilterWidth,y=b-1-h.padInfo.left,v=x-1-h.padInfo.top,w=Vt(u.shape,"float32"),C=1/(d*p),S=n.data.get(i.dataId).values,k=Vt(i.shape,"float32",S);for(let T=0;T<h.batchSize;++T)for(let N=0;N<h.inChannels;++N)for(let R=0;R<h.inHeight;++R)for(let L=0;L<h.inWidth;++L){const z=R-v,U=L-y;let H=0;for(let Y=0;Y<x;Y+=m){const Q=(z+Y)/c;if(!(Q<0||Q>=h.outHeight||Math.floor(Q)!==Q))for(let K=0;K<b;K+=g){const I=(U+K)/f;if(I<0||I>=h.outWidth||Math.floor(I)!==I)continue;H+=k.get(T,Q,I,N)}}w.set(H*C,T,R,L,N)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const xL={kernelName:Ad,backendName:"cpu",kernelFunc:mL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,scale:a,offset:u,mean:o,variance:r}=t;P(o.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(u==null||o.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),_t([i,o,r,a,u],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const h=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,f=n.data.get(r.dataId).values,d=a?n.data.get(a.dataId).values:new Float32Array([1]),p=u?n.data.get(u.dataId).values:new Float32Array([0]),m=new Float32Array(h.length),g=p.length,x=d.length,b=f.length,y=c.length;let v=0,w=0,C=0,S=0;for(let k=0;k<h.length;++k)m[k]=p[v++]+(h[k]-c[w++])*d[C++]/Math.sqrt(f[S++]+l),v>=g&&(v=0),w>=y&&(w=0),C>=x&&(C=0),S>=b&&(S=0);return n.makeTensorInfo(i.shape,i.dtype,m)}const vL={kernelName:lu,backendName:"cpu",kernelFunc:bL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockShape:a,crops:u}=s;_t([i],"batchToSpaceND");const o=a.reduce((x,b)=>x*b),r=fl(i.shape,a,o),l=dl(r.length,a.length),h=pl(i.shape,a,o),c=pg(u,a.length),f=gg(h,u,a.length),d=ce({inputs:{x:i},backend:n,attrs:{shape:r}}),p=dn({inputs:{x:d},backend:n,attrs:{perm:l}}),m=ce({inputs:{x:p},backend:n,attrs:{shape:h}}),g=gr({inputs:{x:m},backend:n,attrs:{begin:c,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const wL={kernelName:Jc,backendName:"cpu",kernelFunc:yL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,weights:a}=t,{size:u}=s,o=n.data.get(i.dataId).values,r=n.data.get(a.dataId).values,l=tm(o,r,a.dtype,a.shape,u);return n.makeTensorInfo([u],a.dtype,l)}const SL={kernelName:Od,backendName:"cpu",kernelFunc:CL};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(e){const{inputs:t,backend:n}=e,{s0:s,s1:i}=t,a=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,o=Bt(Array.from(a),Array.from(u));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const IL={kernelName:Db,backendName:"cpu",kernelFunc:kL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=ee(va,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),_L={kernelName:va,backendName:"cpu",kernelFunc:TL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $L=e=>{const{x:t}=e.inputs,n=e.backend,s=new Float32Array(pt(t.shape)),i=n.data.get(t.dataId),a=i.complexTensorInfos.real,u=i.complexTensorInfos.imag,o=n.data.get(a.dataId).values,r=n.data.get(u.dataId).values;for(let l=0;l<o.length;l++){const h=o[l],c=r[l];s[l]=Math.hypot(h,c)}return n.makeOutput(s,t.shape,"float32")},EL={kernelName:Zc,backendName:"cpu",kernelFunc:$L};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(e){const{inputs:t,backend:n}=e,{input:s}=t,i=n.data.get(s.dataId).complexTensorInfos.imag,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const NL={kernelName:qd,backendName:"cpu",kernelFunc:oo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(e){const{inputs:t,backend:n,attrs:s}=e,{axis:i}=s,a=Ut(i,t[0].shape)[0];let u=Fs(t.map(m=>m.shape),a);if(pt(u)===0)return n.makeTensorInfo(u,t[0].dtype,[]);const o=t.filter(m=>pt(m.shape)>0);if(o.length===1)return Bs({inputs:{x:o[0]},backend:n});const r=o.map(m=>m.shape);if(hg(r,a),o[0].dtype==="complex64"){const m=o.map(v=>pr({inputs:{input:v},backend:n})),g=o.map(v=>oo({inputs:{input:v},backend:n})),x=ao({inputs:m,backend:n,attrs:{axis:a}}),b=ao({inputs:g,backend:n,attrs:{axis:a}}),y=bn({inputs:{real:x,imag:b},backend:n});return m.forEach(v=>n.disposeIntermediateTensorInfo(v)),g.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),y}const l=o.map(m=>{const g=pt(m.shape.slice(a));return ce({inputs:{x:m},backend:n,attrs:{shape:[-1,g]}})}),h=l.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));u=Fs(l.map(m=>m.shape),1);const c=l[0].shape[0]===1,f=Kw(h,u,t[0].dtype,c),d=Fs(o.map(m=>m.shape),a),p=n.makeTensorInfo(d,t[0].dtype,f);return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const DL={kernelName:Qc,backendName:"cpu",kernelFunc:ao};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WC(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dataFormat:r,dilations:l,dimRoundingMode:h}=s;_t([i,a],"conv2d");const c=Js(r),f=Xe(i.shape,a.shape,u,l,o,h,!1,c),d=f.filterHeight,p=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,x=f.padInfo.left,b=f.padInfo.top,y=f.dataFormat==="channelsLast",v=new Je(f.outShape,i.dtype),w=Dt(i.shape),C=Dt(a.shape),S=w[0],k=y?w[1]:w[2],T=y?w[2]:1,N=y?1:w[1],R=v.strides[0],L=y?v.strides[1]:v.strides[2],z=y?v.strides[2]:1,U=y?1:v.strides[1],H=n.data.get(i.dataId).values,Y=n.data.get(a.dataId).values,Q=v.values;for(let K=0;K<f.batchSize;++K){const I=K*S,A=K*R;for(let D=0;D<f.outHeight;++D){const F=A+D*L,j=D*f.strideHeight-b;for(let O=0;O<d;++O){const _=j+O*m;if(_<0||_>=f.inHeight)continue;const V=O*C[0],X=I+_*k;for(let rt=0;rt<f.outWidth;++rt){const st=F+rt*z,ot=rt*f.strideWidth-x;for(let ht=0;ht<p;++ht){const mt=ot+ht*g;if(mt<0||mt>=f.inWidth)continue;const $=V+ht*C[1],E=X+mt*T;let B=$;for(let G=0;G<f.inChannels;++G){const W=H[E+G*N];for(let J=0;J<f.outChannels;++J)Q[st+J*U]+=W*Y[B+J];B+=f.outChannels}}}}}}return n.makeTensorInfo(v.shape,v.dtype,Q)}const AL={kernelName:tu,backendName:"cpu",kernelFunc:WC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,pad:o,dataFormat:r,dimRoundingMode:l,filterShape:h}=s;_t([i,a],"conv2dBackpropFilter");const c=Js(r),f=Xe(i.shape,h,u,1,o,l,!1,c),{strideHeight:d,strideWidth:p,filterHeight:m,filterWidth:g}=f,x=f.dataFormat==="channelsLast",b=new Je(f.filterShape,"float32"),y=f.padInfo.left,v=f.padInfo.top,w=n.data.get(i.dataId).values,C=n.data.get(a.dataId).values,S=new Je(i.shape,i.dtype,w),k=new Je(a.shape,a.dtype,C);for(let T=0;T<m;++T){const N=Math.max(0,Math.ceil((v-T)/d)),R=Math.min(f.outHeight,(f.inHeight+v-T)/d);for(let L=0;L<g;++L){const z=Math.max(0,Math.ceil((y-L)/p)),U=Math.min(f.outWidth,(f.inWidth+y-L)/p);for(let H=0;H<f.inChannels;++H)for(let Y=0;Y<f.outChannels;++Y){let Q=0;for(let K=0;K<f.batchSize;++K)for(let I=N;I<R;++I){const A=T+I*d-v;for(let D=z;D<U;++D){const F=L+D*p-y;x?Q+=S.get(K,A,F,H)*k.get(K,I,D,Y):Q+=S.get(K,H,A,F)*k.get(K,Y,I,D)}}b.set(Q,T,L,H,Y)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const OL={kernelName:Pd,backendName:"cpu",kernelFunc:RL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{inputShape:u,strides:o,pad:r,dataFormat:l,dimRoundingMode:h}=s;_t([i,a],"conv2dBackpropInput");const c=Dt(a.shape),f=Dt(i.shape);let d=Js(l);const p=Xe(u,a.shape,o,1,r,h,!1,d),m=new Je(p.inShape,"float32"),g=m.values,x=n.data.get(i.dataId).values,b=n.data.get(a.dataId).values,[y,v,w]=c,{batchSize:C,filterHeight:S,filterWidth:k,inChannels:T,inHeight:N,inWidth:R,outChannels:L,outHeight:z,outWidth:U,strideHeight:H,strideWidth:Y}=p;d=p.dataFormat;const Q=S-1-p.padInfo.top,K=k-1-p.padInfo.left,I=d==="channelsLast",A=m.strides[0],D=I?m.strides[1]:m.strides[2],F=I?m.strides[2]:1,j=I?1:m.strides[1],O=f[0],_=I?f[1]:f[2],V=I?f[2]:1,X=I?1:f[1];for(let rt=0;rt<C;++rt)for(let st=0;st<T;++st)for(let ot=0;ot<N;++ot){const ht=ot-Q,mt=Math.max(0,Math.ceil(ht/H)),$=Math.min(z,(S+ht)/H);for(let E=0;E<R;++E){const B=E-K,G=Math.max(0,Math.ceil(B/Y)),W=Math.min(U,(k+B)/Y);let J=0;for(let ct=mt;ct<$;++ct){const ut=ct*H-ht;for(let q=G;q<W;++q){const gt=q*Y-B,xt=O*rt+_*ct+V*q,vt=y*(S-1-ut)+v*(k-1-gt)+w*st;for(let Ct=0;Ct<L;++Ct){const It=x[xt+X*Ct],Ft=b[vt+Ct];J+=It*Ft}}}const at=A*rt+D*ot+F*E+j*st;g[at]=J}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const PL={kernelName:eu,backendName:"cpu",kernelFunc:FL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dilations:r}=s;_t([i,a],"conv3d");const l=Si(i.shape,a.shape,u,r,o),{filterDepth:h,filterHeight:c,filterWidth:f,dilationDepth:d,dilationHeight:p,dilationWidth:m,padInfo:g}=l,x=g.front,b=g.left,y=g.top,v=new Je(l.outShape,i.dtype),w=n.data.get(i.dataId).values,C=n.data.get(a.dataId).values,S=v.values,k=Dt(i.shape),T=Dt(a.shape);for(let N=0;N<l.batchSize;++N){const R=N*k[0],L=N*v.strides[0];for(let z=0;z<l.outDepth;++z){const U=L+z*v.strides[1],H=z*l.strideDepth-x;for(let Y=0;Y<h;++Y){const Q=H+Y*d;if(Q<0||Q>=l.inDepth)continue;const K=Y*T[0],I=R+Q*k[1];for(let A=0;A<l.outHeight;++A){const D=U+A*v.strides[2],F=A*l.strideHeight-y;for(let j=0;j<c;++j){const O=F+j*p;if(O<0||O>=l.inHeight)continue;const _=K+j*T[1],V=I+O*k[2];for(let X=0;X<l.outWidth;++X){const rt=D+X*l.outChannels,st=X*l.strideWidth-b;for(let ot=0;ot<f;++ot){const ht=st+ot*m;if(ht<0||ht>=l.inWidth)continue;const mt=_+ot*T[2],$=V+ht*l.inChannels;let E=mt;for(let B=0;B<l.inChannels;++B){const G=w[$+B];for(let W=0;W<l.outChannels;++W)S[rt+W]+=G*C[E+W];E+=l.outChannels}}}}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const LL={kernelName:nu,backendName:"cpu",kernelFunc:ML};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,pad:o,filterShape:r}=s;_t([i,a],"conv3dBackpropFilterV2");const l=Dt(i.shape),h=Dt(a.shape),c=Si(i.shape,r,u,1,o),f=c.strideDepth,d=c.strideHeight,p=c.strideWidth,m=c.filterDepth,g=c.filterHeight,x=c.filterWidth,b=new Je(c.filterShape,"float32"),y=b.values,[v,w,C,S]=b.strides,k=n.data.get(a.dataId).values,[T,N,R,L]=h,z=n.data.get(i.dataId).values,[U,H,Y,Q]=l,K=c.padInfo.front,I=c.padInfo.left,A=c.padInfo.top;for(let D=0;D<m;++D){const F=Math.max(0,Math.ceil((K-D)/f)),j=Math.min(c.outDepth,(c.inDepth+K-D)/f),O=D*v;for(let _=0;_<g;++_){const V=Math.max(0,Math.ceil((A-_)/d)),X=Math.min(c.outHeight,(c.inHeight+A-_)/d),rt=_*w+O;for(let st=0;st<x;++st){const ot=Math.max(0,Math.ceil((I-st)/p)),ht=Math.min(c.outWidth,(c.inWidth+I-st)/p),mt=st*C+rt;for(let $=0;$<c.inChannels;++$){const E=$*S+mt;for(let B=0;B<c.outChannels;++B){let G=0;for(let W=0;W<c.batchSize;++W){const J=W*U,at=W*T;for(let ct=F;ct<j;++ct){const q=(D+ct*f-K)*H+J,gt=ct*N+at;for(let xt=V;xt<X;++xt){const Ct=(_+xt*d-A)*Y+q,It=xt*R+gt;for(let Ft=ot;Ft<ht;++Ft){const Ht=(st+Ft*p-I)*Q+Ct,Te=Ft*L+It;G+=z[Ht+$]*k[Te+B]}}}}y[E+B]=G}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const zL={kernelName:Md,backendName:"cpu",kernelFunc:BL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{pad:u,strides:o,inputShape:r}=s;_t([i],"conv3dBackpropInputV2");const l=Dt(i.shape),h=Dt(a.shape),c=Si(r,a.shape,o,1,u),f=new Je(c.inShape,"float32"),d=f.values,[p,m,g,x]=f.strides,b=n.data.get(i.dataId).values,[y,v,w,C]=l,S=n.data.get(a.dataId).values,[k,T,N,R]=h,{batchSize:L,filterDepth:z,filterHeight:U,filterWidth:H,inChannels:Y,inDepth:Q,inHeight:K,inWidth:I,outChannels:A,outDepth:D,outHeight:F,outWidth:j,strideDepth:O,strideHeight:_,strideWidth:V}=c,X=z-1-c.padInfo.front,rt=U-1-c.padInfo.top,st=H-1-c.padInfo.left;for(let ot=0;ot<L;++ot)for(let ht=0;ht<Y;++ht)for(let mt=0;mt<Q;++mt){const $=mt-X,E=Math.max(0,Math.ceil($/O)),B=Math.min(D,(z+$)/O);for(let G=0;G<K;++G){const W=G-rt,J=Math.max(0,Math.ceil(W/_)),at=Math.min(F,(U+W)/_);for(let ct=0;ct<I;++ct){const ut=ct-st,q=Math.max(0,Math.ceil(ut/V)),gt=Math.min(j,(H+ut)/V);let xt=0;for(let vt=E;vt<B;++vt){const Ct=vt*O-$;for(let It=J;It<at;++It){const Ft=It*_-W;for(let Ot=q;Ot<gt;++Ot){const Ht=Ot*V-ut,Te=y*ot+v*vt+w*It+C*Ot,Fe=k*(z-1-Ct)+T*(U-1-Ft)+N*(H-1-Ht)+R*ht;for(let zs=0;zs<A;++zs){const Cs=b[Te+zs],Ir=S[Fe+zs];xt+=Cs*Ir}}}}d[p*ot+m*mt+g*G+x*ct+ht]=xt}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const VL={kernelName:Ld,backendName:"cpu",kernelFunc:WL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL=ee(ya,e=>Math.cos(e)),GL={kernelName:ya,backendName:"cpu",kernelFunc:UL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL=ee(wa,e=>Math.cosh(e)),jL={kernelName:wa,backendName:"cpu",kernelFunc:HL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(e){const{inputs:t,backend:n,attrs:s}=e,{image:i,boxes:a,boxInd:u}=t,{cropSize:o,method:r,extrapolationValue:l}=s,[h,c,f,d]=i.shape,p=a.shape[0],[m,g]=o,x=Vt([p,m,g,d],"float32"),b=n.data.get(a.dataId).values,y=n.data.get(u.dataId).values,v=n.data.get(i.dataId).values,w=Dt(i.shape),C=Dt(x.shape);for(let S=0;S<p;S++){const k=S*4,T=b[k],N=b[k+1],R=b[k+2],L=b[k+3],z=y[S];if(z>=h)continue;const U=m>1?(R-T)*(c-1)/(m-1):0,H=g>1?(L-N)*(f-1)/(g-1):0;for(let Y=0;Y<m;Y++){const Q=m>1?T*(c-1)+Y*U:.5*(T+R)*(c-1);if(Q<0||Q>c-1){for(let K=0;K<g;K++)for(let I=0;I<d;I++){const A=I+K*C[2]+Y*C[1]+S*C[0];x.values[A]=l}continue}if(r==="bilinear"){const K=Math.floor(Q),I=Math.ceil(Q),A=Q-K;for(let D=0;D<g;D++){const F=g>1?N*(f-1)+D*H:.5*(N+L)*(f-1);if(F<0||F>f-1){for(let V=0;V<d;V++){const X=V+D*C[2]+Y*C[1]+S*C[0];x.values[X]=l}continue}const j=Math.floor(F),O=Math.ceil(F),_=F-j;for(let V=0;V<d;V++){let X=V+j*w[2]+K*w[1]+z*w[0];const rt=v[X];X=V+O*w[2]+K*w[1]+z*w[0];const st=v[X];X=V+j*w[2]+I*w[1]+z*w[0];const ot=v[X];X=V+O*w[2]+I*w[1]+z*w[0];const ht=v[X],mt=rt+(st-rt)*_,$=ot+(ht-ot)*_;X=V+D*C[2]+Y*C[1]+S*C[0],x.values[X]=mt+($-mt)*A}}}else for(let K=0;K<g;++K){const I=g>1?N*(f-1)+K*H:.5*(N+L)*(f-1);if(I<0||I>f-1){for(let F=0;F<d;F++){const j=F+K*C[2]+Y*C[1]+S*C[0];x.values[j]=l}continue}const A=Math.round(I),D=Math.round(Q);for(let F=0;F<d;F++){const j=F+A*w[2]+D*w[1]+z*w[0],O=F+K*C[2]+Y*C[1]+S*C[0];x.values[O]=v[j]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const YL={kernelName:zd,backendName:"cpu",kernelFunc:XL};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,exclusive:u,reverse:o}=s;_t(i,"cumprod");const r=be([a],i.shape.length);let l=i;r!=null&&(l=dn({inputs:{x:i},backend:n,attrs:{perm:r}}));const h=ke(1,i.shape.length)[0];if(h!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${h}`);const c=Cn(l.dtype,"int32"),f=_d(pt(l.shape),c),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=o?(x,b)=>x+p-b-1:(x,b)=>x+b;for(let x=0;x<d.length;x+=p)for(let b=0;b<p;b++){const y=m(x,b);if(b===0)f[y]=u?1:d[y];else{const v=m(x,b-1);f[y]=u?d[v]*f[v]:d[y]*f[v]}}const g=n.makeTensorInfo(l.shape,c,f);if(r!=null){const x=ki(r),b=dn({inputs:{x:g},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),b}return g}const KL={kernelName:Bd,backendName:"cpu",kernelFunc:qL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,exclusive:u,reverse:o}=s;_t(i,"cumsum");const r=be([a],i.shape.length);let l=i;r!=null&&(l=dn({inputs:{x:i},backend:n,attrs:{perm:r}}));const h=ke(1,i.shape.length)[0];if(h!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${h}`);const c=Cn(l.dtype,"int32"),f=Ze(pt(l.shape),c),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=o?(x,b)=>x+p-b-1:(x,b)=>x+b;for(let x=0;x<d.length;x+=p)for(let b=0;b<p;b++){const y=m(x,b);if(b===0)f[y]=u?0:d[y];else{const v=m(x,b-1);f[y]=u?d[v]+f[v]:d[y]+f[v]}}const g=n.makeTensorInfo(l.shape,c,f);if(r!=null){const x=ki(r),b=dn({inputs:{x:g},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),b}return g}const ZL={kernelName:su,backendName:"cpu",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,weights:a}=t,{size:u,binaryOutput:o}=s;if(i.shape.length===1){const r=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,h=tm(r,l,a.dtype,a.shape,u);return n.makeTensorInfo([u],a.dtype,h)}else if(i.shape.length===2){const r=n.bufferSync(i),l=n.bufferSync(a),h=Yw(r,l,u,o);return n.makeTensorInfo(h.shape,a.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const t3={kernelName:Ab,backendName:"cpu",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockSize:a,dataFormat:u}=s;P(u==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${u}`);const o=i.shape[0],r=i.shape[1],l=i.shape[2],h=i.shape[3],c=r*a,f=l*a,d=h/(a*a),p=n.data.get(i.dataId).values,m=new Float32Array(o*c*f*d);let g=0;for(let x=0;x<o;++x)for(let b=0;b<c;++b){const y=Math.floor(b/a),v=b%a;for(let w=0;w<f;++w){const C=Math.floor(w/a),S=w%a,k=(v*a+S)*d;for(let T=0;T<d;++T){const R=T+k+h*(C+l*(y+r*x));m[g++]=p[R]}}}return n.makeTensorInfo([o,c,f,d],i.dtype,m)}const n3={kernelName:Wd,backendName:"cpu",kernelFunc:e3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VC(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dilations:r,dimRoundingMode:l}=s;_t([i,a],"depthwiseConv2DNative");const h=Dt(i.shape),c=Dt(a.shape);let f=r;f==null&&(f=[1,1]),P(Qe(u,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${f}'`);const d=Xe(i.shape,a.shape,u,f,o,l,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:x,padInfo:b}=d,y=b.left,v=b.top,w=d.outChannels/d.inChannels,C=new Je(d.outShape,i.dtype),S=n.data.get(i.dataId).values,k=n.data.get(a.dataId).values,T=C.values;for(let N=0;N<d.batchSize;++N){const R=N*h[0],L=N*C.strides[0];for(let z=0;z<d.outHeight;++z){const U=L+z*C.strides[1],H=z*d.strideHeight-v;for(let Y=0;Y<p;++Y){const Q=H+Y*g;if(Q<0||Q>=d.inHeight)continue;const K=Y*c[0],I=R+Q*h[1];for(let A=0;A<d.outWidth;++A){const D=U+A*C.strides[2],F=A*d.strideWidth-y;for(let j=0;j<m;++j){const O=F+j*x;if(O<0||O>=d.inWidth)continue;const _=K+j*c[1],V=I+O*d.inChannels;let X=D,rt=_;for(let st=0;st<d.inChannels;++st){const ot=S[V+st];for(let ht=0;ht<w;++ht)T[X+ht]+=ot*k[rt+ht];X+=w,rt+=w}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const s3={kernelName:iu,backendName:"cpu",kernelFunc:VC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i3(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,dilations:o,pad:r,dimRoundingMode:l,filterShape:h}=s;_t([i,a],"depthwiseConv2dNativeBackpropFilter");const c=Xe(i.shape,h,u,o,r,l,!0),{strideHeight:f,strideWidth:d,filterHeight:p,filterWidth:m}=c,g=new Je(c.filterShape,"float32"),x=c.padInfo.left,b=c.padInfo.top,y=c.outChannels/c.inChannels,v=n.data.get(i.dataId).values,w=new Je(i.shape,i.dtype,v),C=n.data.get(a.dataId).values,S=new Je(a.shape,a.dtype,C);for(let k=0;k<p;++k){const T=Math.max(0,Math.ceil((b-k)/f)),N=Math.min(c.outHeight,(c.inHeight+b-k)/f);for(let R=0;R<m;++R){const L=Math.max(0,Math.ceil((x-R)/d)),z=Math.min(c.outWidth,(c.inWidth+x-R)/d);for(let U=0;U<c.outChannels;++U){const H=Math.trunc(U/y),Y=U%y;let Q=0;for(let K=0;K<c.batchSize;++K)for(let I=T;I<N;++I){const A=k+I*f-b;for(let D=L;D<z;++D){const F=R+D*d-x;Q+=w.get(K,A,F,H)*S.get(K,I,D,U)}}g.set(Q,k,R,H,Y)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const r3={kernelName:Vd,backendName:"cpu",kernelFunc:i3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{strides:u,dilations:o,pad:r,dimRoundingMode:l,inputShape:h}=s;_t([i,a],"depthwiseConv2DNativeBackpropInput");const c=Dt(i.shape),f=Dt(a.shape),d=Xe(h,a.shape,u,o,r,l,!0),p=new Je(d.inShape,"float32"),m=p.values,[g,x,b]=p.strides,y=n.data.get(i.dataId).values,[v,w,C]=c,S=n.data.get(a.dataId).values,[k,T,N]=f,{batchSize:R,filterHeight:L,filterWidth:z,inChannels:U,inHeight:H,inWidth:Y,outChannels:Q,outHeight:K,outWidth:I,strideHeight:A,strideWidth:D}=d,F=L-1-d.padInfo.top,j=z-1-d.padInfo.left,O=Q/U;for(let _=0;_<R;++_)for(let V=0;V<U;++V)for(let X=0;X<H;++X){const rt=X-F,st=Math.max(0,Math.ceil(rt/A)),ot=Math.min(K,(L+rt)/A);for(let ht=0;ht<Y;++ht){const mt=ht-j,$=Math.max(0,Math.ceil(mt/D)),E=Math.min(I,(z+mt)/D);let B=0;for(let G=st;G<ot;++G){const W=G*A-rt;for(let J=$;J<E;++J){const at=J*D-mt,ct=v*_+w*G+C*J,ut=k*(L-1-W)+T*(z-1-at)+N*V;for(let q=0;q<O;++q){const gt=V*O+q,xt=y[ct+gt],vt=S[ut+q];B+=xt*vt}}}m[g*_+x*X+b*ht+V]=B}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const a3={kernelName:Ud,backendName:"cpu",kernelFunc:o3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l3(e){const{inputs:t,backend:n}=e,{x:s}=t,i=pt(s.shape),a=n.data.get(s.dataId).values,u=Vt([i,i],s.dtype),o=u.values;for(let l=0;l<a.length;l++)o[l*i+l]=a[l];const r=[...s.shape,...s.shape];return n.makeTensorInfo(r,u.dtype,u.values)}const c3={kernelName:Rb,backendName:"cpu",kernelFunc:l3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3={kernelName:ru,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:i}=e,{strides:a,pad:u,dilations:o}=n,r=t,l=r.data.get(s.dataId).values,h=s.shape.length,c=r.data.get(i.dataId).values,f=i.shape.length,{batchSize:d,inHeight:p,inWidth:m,inChannels:g,outHeight:x,outWidth:b,padInfo:y,strideHeight:v,strideWidth:w,filterHeight:C,filterWidth:S,dilationHeight:k,dilationWidth:T,outShape:N}=ll(s.shape,i.shape,a,u,"NHWC",o),R=pt(N),L=N.length,z=nn(s.dtype,R);for(let H=0;H<d;++H)for(let Y=0;Y<x;++Y){const Q=Y*v-y.top;for(let K=0;K<b;++K){const I=K*w-y.left;for(let A=0;A<g;++A){let D=Number.MIN_SAFE_INTEGER;for(let j=0;j<C;++j){const O=Q+j*k;if(O>=0&&O<p)for(let _=0;_<S;++_){const V=I+_*T;if(V>=0&&V<m){const X=Rs([H,O,V,A],h,Dt(s.shape)),rt=Rs([j,_,A],f,Dt(i.shape)),st=l[X]+c[rt];st>D&&(D=st)}}}const F=Rs([H,Y,K,A],L,Dt(N));z[F]=D}}}return{dataId:r.write(xr(z,s.dtype),N,s.dtype),shape:N,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3={kernelName:wf,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:i,dy:a}=e,{strides:u,pad:o,dilations:r}=n,l=t,h=ps(s.shape,l.data.get(s.dataId).values),c=ps(i.shape,l.data.get(i.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:m,outHeight:g,outWidth:x,padInfo:b,strideHeight:y,strideWidth:v,filterHeight:w,filterWidth:C,dilationHeight:S,dilationWidth:k,outShape:T}=ll(s.shape,i.shape,u,o,"NHWC",r);P(a.rank===T.length,()=>`Error in ${wf}, dy must have the same rank as output ${T.length}, but got ${a.rank}`);const N=ps(T,l.data.get(a.dataId).values),R=Tb(i.shape,i.dtype);for(let z=0;z<f;++z)for(let U=0;U<g;++U){const H=U*y-b.top;for(let Y=0;Y<x;++Y){const Q=Y*v-b.left;for(let K=0;K<m;++K){let I=Number.MIN_SAFE_INTEGER,A=0,D=0;for(let F=0;F<w;++F){const j=H+F*S;if(j>=0&&j<d)for(let O=0;O<C;++O){const _=Q+O*k;if(_>=0&&_<p){const V=h[z][j][_][K]+c[F][O][K];V>I&&(I=V,A=F,D=O)}}}R[A][D][K]+=N[z][U][Y][K]}}}return{dataId:l.write(xr(R,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f3={kernelName:yf,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:i,dy:a}=e,{strides:u,pad:o,dilations:r}=n,l=t,h=ps(s.shape,l.data.get(s.dataId).values),c=ps(i.shape,l.data.get(i.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:m,outHeight:g,outWidth:x,padInfo:b,strideHeight:y,strideWidth:v,filterHeight:w,filterWidth:C,dilationHeight:S,dilationWidth:k,outShape:T}=ll(s.shape,i.shape,u,o,"NHWC",r);P(a.rank===T.length,()=>`Error in ${yf}, dy must have the same rank as output ${T.length}, but got ${a.rank}`);const N=ps(T,l.data.get(a.dataId).values),R=Tb(s.shape,s.dtype);for(let z=0;z<f;++z)for(let U=0;U<g;++U){const H=U*y-b.top;for(let Y=0;Y<x;++Y){const Q=Y*v-b.left;for(let K=0;K<m;++K){let I=Number.MIN_SAFE_INTEGER,A=H<0?0:H,D=Q<0?0:Q;for(let F=0;F<w;++F){const j=H+F*S;if(j>=0&&j<d)for(let O=0;O<C;++O){const _=Q+O*k;if(_>=0&&_<p){const V=h[z][j][_][K]+c[F][O][K];V>I&&(I=V,A=j,D=_)}}}R[z][A][D][K]+=N[z][U][Y][K]}}}return{dataId:l.write(xr(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;_t(i,"sum");let o;i.dtype==="bool"?o=yi({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):o=Bs({inputs:{x:i},backend:n});const r=o.shape.length,l=Ut(a,o.shape),h=be(l,r);let c=l,f=o;h!=null&&(f=dn({inputs:{x:o},backend:n,attrs:{perm:h}}),c=ke(c.length,r)),Ye("sum",c,f.shape.length);const[d,p]=We(f.shape,c),m=Cn(f.dtype,"int32");let g=Ic(n,d,m);const x=pt(p),b=n.data.get(g.dataId).values,y=n.data.get(f.dataId).values;for(let v=0;v<b.length;++v){const w=v*x;let C=0;for(let S=0;S<x;++S)C+=y[w+S];b[v]=C}if(u){const v=Se(g.shape,l),w=g;g=ce({inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(o),h!=null&&n.disposeIntermediateTensorInfo(f),g}const d3={kernelName:Lu,backendName:"cpu",kernelFunc:Sl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3(e){const{inputs:t,backend:n,attrs:s}=e,{equation:i}=s,a=t,{allDims:u,summedDims:o,idDims:r}=Sg(i,a.length);Ig(u.length,r,a);const{path:l,steps:h}=Tg(o,r),c=h.length;let f=null,d=u.length;const p=[];for(let m=0;m<c;++m){for(const g of h[m]){const{permutationIndices:x,expandDims:b}=kg(d,r[g]);let y;_g(x)?y=a[g]:(y=dn({inputs:{x:a[g]},backend:n,attrs:{perm:x}}),p.push(y));const v=y.shape.slice();for(let w=0;w<b.length;++w)v.splice(b[w],0,1);Qt(y.shape,v)||(y=ce({inputs:{x:y},backend:n,attrs:{shape:v}}),p.push(y)),f===null?f=y:(f=mh({inputs:{a:y,b:f},backend:n}),p.push(f))}m<c-1&&(l[m]>=0&&(f=Sl({inputs:{x:f},backend:n,attrs:{axis:l[m]-(u.length-d),keepDims:!1}}),p.push(f)),d--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const g3={kernelName:Ob,backendName:"cpu",kernelFunc:p3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(e){const{inputs:t,backend:n}=e,{dy:s,y:i}=t;_t([s,i],"eluGrad");const a=new Float32Array(pt(i.shape)),u=n.data.get(i.dataId).values,o=n.data.get(s.dataId).values;for(let r=0;r<u.length;++r){const l=u[r];l>=1?a[r]=o[r]:a[r]=o[r]*(l+1)}return n.makeTensorInfo(i.shape,"float32",a)}const x3={kernelName:Gd,backendName:"cpu",kernelFunc:m3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3=mg,v3=xg,y3=bg,w3=vg,C3=yg,S3=wg,k3=ee(ka,e=>{const t=Math.sign(e),n=Math.abs(e),s=1/(1+b3*n);return t*(1-((((S3*s+C3)*s+w3)*s+y3)*s+v3)*s*Math.exp(-n*n))}),I3={kernelName:ka,backendName:"cpu",kernelFunc:k3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _c(e){const{inputs:t,backend:n,attrs:s}=e,{input:i}=t,{dim:a}=s,u=i.shape.length,o=i.shape.slice();let r=a;return a<0&&(P(-(u+1)<=a,()=>`Axis must be in the interval [${-(u+1)}, ${u}]`),r=u+a+1),o.splice(r,0,1),ce({inputs:{x:i},backend:n,attrs:{shape:o}})}const T3={kernelName:au,backendName:"cpu",kernelFunc:_c};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _3=$e((e,t)=>e/t),om=Ve(Ca,_3),td={kernelName:Ca,backendName:"cpu",kernelFunc:om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UC(e,t,n){const s=e.shape,i=s[0],a=s[1],u=n.data.get(e.dataId),o=u.complexTensorInfos.real,r=u.complexTensorInfos.imag,l=[i,a],h=pt(l),c=He("float32",h),f=He("float32",h);for(let g=0;g<i;g++){const x=gr({inputs:{x:o},backend:n,attrs:{begin:[g,0],size:[1,a]}}),b=gr({inputs:{x:r},backend:n,attrs:{begin:[g,0],size:[1,a]}}),y=bn({inputs:{real:x,imag:b},backend:n}),{real:v,imag:w}=$3(y,t,n),C=Ys(v,w);for(let S=0;S<a;S++){const k=Cg(C,S);c[g*a+S]=k.real,f[g*a+S]=k.imag}n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(y)}const d=n.makeTensorInfo(l,"float32",c),p=n.makeTensorInfo(l,"float32",f),m=bn({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),m}function $3(e,t,n){const s=pt(e.shape),i=n.data.get(e.dataId),a=n.data.get(i.complexTensorInfos.real.dataId).values,u=n.data.get(i.complexTensorInfos.imag.dataId).values;if(E3(s)){const o=ed(a,u,s,t,n),r=[e.shape[0],e.shape[1]];if(t){const l=n.makeTensorInfo(r,"float32",o.real),h=n.makeTensorInfo(r,"float32",o.imag),c=n.makeTensorInfo([],"float32",Ci(s,"float32")),f=Bs({inputs:{x:c},backend:n}),d=td.kernelFunc({inputs:{a:l,b:c},backend:n}),p=td.kernelFunc({inputs:{a:h,b:f},backend:n}),m=n.data.get(d.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return o}else{const o=Ys(a,u),r=N3(o,s,t);return hy(r)}}function E3(e){return(e&e-1)===0}function ed(e,t,n,s,i){if(n===1)return{real:e,imag:t};const a=Ys(e,t),u=n/2,o=fy(a),r=o.real,l=o.imag,h=[r.length],c=i.makeTensorInfo(h,"float32",r),f=i.makeTensorInfo(h,"float32",l),d=bn({inputs:{real:c,imag:f},backend:i}),p=dy(a),m=p.real,g=p.imag,x=[m.length],b=i.makeTensorInfo(x,"float32",m),y=i.makeTensorInfo(x,"float32",g),v=bn({inputs:{real:b,imag:y},backend:i}),w=ed(r,l,u,s,i),C=w.real,S=w.imag,k=[C.length],T=i.makeTensorInfo(k,"float32",C),N=i.makeTensorInfo(k,"float32",S),R=bn({inputs:{real:T,imag:N},backend:i}),L=ed(m,g,u,s,i),z=L.real,U=L.imag,H=[z.length],Y=i.makeTensorInfo(H,"float32",z),Q=i.makeTensorInfo(H,"float32",U),K=bn({inputs:{real:Y,imag:Q},backend:i}),I=gy(n,s),A=[I.real.length],D=i.makeTensorInfo(A,"float32",I.real),F=i.makeTensorInfo(A,"float32",I.imag),j=bn({inputs:{real:D,imag:F},backend:i}),O=mh({inputs:{a:j,b:K},backend:i}),_=ro({inputs:{a:R,b:O},backend:i}),V=im({inputs:{a:R,b:O},backend:i}),X=pr({inputs:{input:_},backend:i}),rt=pr({inputs:{input:V},backend:i}),st=oo({inputs:{input:_},backend:i}),ot=oo({inputs:{input:V},backend:i}),ht=ao({inputs:[X,rt],backend:i,attrs:{axis:0}}),mt=ao({inputs:[st,ot],backend:i,attrs:{axis:0}}),$=i.data.get(ht.dataId).values,E=i.data.get(mt.dataId).values;return i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(y),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(Q),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(_),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(st),i.disposeIntermediateTensorInfo(rt),i.disposeIntermediateTensorInfo(ot),i.disposeIntermediateTensorInfo(ht),i.disposeIntermediateTensorInfo(mt),{real:$,imag:E}}function N3(e,t,n){const s=new Float32Array(t*2);for(let i=0;i<t;i++){let a=0,u=0;for(let o=0;o<t;o++){const r=my(i*o,t,n),l=Cg(e,o);a+=l.real*r.real-l.imag*r.imag,u+=l.real*r.imag+l.imag*r.real}n&&(a/=t,u/=t),py(s,a,u,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(e){const{inputs:t,backend:n}=e,{input:s}=t,i=pt(s.shape),a=s.shape[s.shape.length-1],u=i/a,o=ce({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),r=UC(o,!1,n),l=ce({inputs:{x:r},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),l}const A3={kernelName:Hd,backendName:"cpu",kernelFunc:D3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function am(e){const{backend:t,attrs:n}=e,{shape:s,value:i,dtype:a}=n,u=a||la(i),o=nn(u,pt(s));return O3(o,i,u),t.makeTensorInfo(s,u,o)}const R3={kernelName:jd,backendName:"cpu",kernelFunc:am};function O3(e,t,n){e.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3={kernelName:Xd,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,i=n,a=He(s.dtype,pt(s.shape)),[u,o,r,l]=s.shape,h=i.data.get(s.dataId).values;for(let f=0;f<u;f++){const d=f*r*o*l;for(let p=0;p<o;p++){const m=p*(r*l);for(let g=0;g<r;g++){const x=g*l;for(let b=0;b<l;b++){const y=Math.round(r-g-1),v=d+m+x+b;let w=h[v];if(y>=0&&y<r){const C=y*l,S=d+m+C+b;w=h[S]}a[v]=w}}}}return{dataId:i.write(a,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3=$e((e,t)=>Math.floor(e/t)),M3=Ve($a,P3,null,"int32"),L3={kernelName:$a,backendName:"cpu",kernelFunc:M3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B3(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a,bias:u,preluActivationWeights:o}=t,{strides:r,pad:l,dataFormat:h,dilations:c,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s;let m=WC({inputs:{x:i,filter:a},backend:n,attrs:{strides:r,pad:l,dataFormat:h,dilations:c,dimRoundingMode:f}});if(u){const g=m;if(h==="NCHW"&&u.shape.length===1&&u.shape[0]!==1){const x=ce({inputs:{x:u},backend:n,attrs:{shape:[u.shape[0],1,1]}});m=ro({inputs:{a:m,b:x},backend:n}),n.disposeIntermediateTensorInfo(x)}else m=ro({inputs:{a:m,b:u},backend:n});n.disposeIntermediateTensorInfo(g)}if(d){const g=m;if(h==="NCHW"&&d==="prelu"&&o.shape.length===1&&o.shape[0]!==1){const x=ce({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Tc(n,m,d,x,p),n.disposeIntermediateTensorInfo(x)}else m=Tc(n,m,d,o,p);n.disposeIntermediateTensorInfo(g)}return m}const z3={kernelName:cc,backendName:"cpu",kernelFunc:B3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W3(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a,bias:u,preluActivationWeights:o}=t,{strides:r,pad:l,dataFormat:h,dilations:c,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s;let m=VC({inputs:{x:i,filter:a},backend:n,attrs:{strides:r,pad:l,dataFormat:h,dilations:c,dimRoundingMode:f}});if(u){const g=m;m=ro({inputs:{a:m,b:u},backend:n}),n.disposeIntermediateTensorInfo(g)}if(d){const g=m;m=Tc(n,m,d,o,p),n.disposeIntermediateTensorInfo(g)}return m}const V3={kernelName:Vb,backendName:"cpu",kernelFunc:W3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3(e){const{inputs:t,backend:n}=e,{params:s,indices:i}=t,a=pt(s.shape),u=i.shape,o=u[u.length-1],[r,l,h,c]=kp(s,i);if(l===0)return n.makeTensorInfo(r,s.dtype,[]);const f=n.data.get(i.dataId).values,d=n.bufferSync(s),p=sC(f,d,s.dtype,l,o,h,c,s.shape,a);return n.makeTensorInfo(r,s.dtype,p.values)}const G3={kernelName:Fb,backendName:"cpu",kernelFunc:U3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H3(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,indices:a}=t,{axis:u,batchDims:o}=s;_t([i,a],"gatherV2");const r=Ut(u,i.shape)[0],l=n.data.get(a.dataId).values,h=i.shape[r];for(let v=0;v<l.length;++v){const w=l[v];P(w<=h-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${h-1}]`)}let c=o;o==null&&(c=0);const f=pt(a.shape),d=Eg(i,a,r,c),p=ce({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=ce({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}}),g=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],x=n.bufferSync(m),b=n.bufferSync(p),y=iC(b,x,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(d.outputShape,y.dtype,y.values)}const j3={kernelName:cu,backendName:"cpu",kernelFunc:H3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3(e){const{inputs:t,backend:n}=e,{input:s}=t,i=pt(s.shape),a=s.shape[s.shape.length-1],u=i/a,o=ce({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),r=UC(o,!0,n),l=ce({inputs:{x:r},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),l}const Y3={kernelName:Yd,backendName:"cpu",kernelFunc:X3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3=ee(Da,e=>Number.isFinite(e)?1:0,"bool"),K3={kernelName:Da,backendName:"cpu",kernelFunc:q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3=ee(Aa,e=>Math.abs(e)===1/0?1:0,"bool"),Z3={kernelName:Aa,backendName:"cpu",kernelFunc:J3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3=ee(Ra,e=>Number.isNaN(e)?1:0,"bool"),tB={kernelName:Ra,backendName:"cpu",kernelFunc:Q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(e){const{backend:t,attrs:n}=e,{start:s,stop:i,num:a}=n,u=cC(s,i,a);return t.makeTensorInfo([u.length],"float32",u)}const nB={kernelName:Pb,backendName:"cpu",kernelFunc:eB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sB=ee(Fa,e=>Math.log1p(e)),iB={kernelName:Fa,backendName:"cpu",kernelFunc:sB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rB=$e((e,t)=>e&&t),oB=Ve(pu,rB,null,"bool"),aB={kernelName:pu,backendName:"cpu",kernelFunc:oB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lB=ee(gu,e=>e?0:1,"bool"),cB={kernelName:gu,backendName:"cpu",kernelFunc:lB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uB=$e((e,t)=>e||t),hB=Ve(mu,uB,null,"bool"),fB={kernelName:mu,backendName:"cpu",kernelFunc:hB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{depthRadius:a,bias:u,alpha:o,beta:r}=s;_t(i,"LRN");const l=i.shape[3],h=l-1,c=n.data.get(i.dataId).values,f=pt(i.shape),d=new Float32Array(f);function p(m){const g=m%l;let x=m-g+Math.max(0,g-a);const b=m-g+Math.min(g+a,h);let y=0;for(;x<=b;x++){const v=c[x];y+=v*v}return y}for(let m=0;m<f;m++){const g=p(m),x=c[m]*Math.pow(u+o*g,-r);d[m]=x}return n.makeTensorInfo(i.shape,i.dtype,d)}const pB={kernelName:xu,backendName:"cpu",kernelFunc:dB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,y:a,dy:u}=t,{depthRadius:o,bias:r,alpha:l,beta:h}=s;_t(u,"LRNGrad");const c=pt(u.shape),f=u.shape[3],d=n.data.get(u.dataId).values,p=n.data.get(i.dataId).values,m=n.data.get(a.dataId).values,g=new Float32Array(c),x=c;for(let b=0;b<x;b++){const y=b%f,v=b-y+Math.max(0,y-o),w=b-y+Math.min(f,y+o+1);let C=0;for(let S=v;S<w;S++)C+=Math.pow(p[S],2);C=l*C+r;for(let S=v;S<w;S++){let k=-2*l*h*p[S]*m[b]/C;b===S&&(k+=Math.pow(C,-h)),k*=d[b],g[S]+=k}}return n.makeTensorInfo(u.shape,i.dtype,g)}const mB={kernelName:Kd,backendName:"cpu",kernelFunc:gB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GC(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{reductionIndices:a,keepDims:u}=s,o=n;let r=i.shape;const l=r.length,h=Ut(a,r);let c=h;const f=be(c,l);let d=o.data.get(i.dataId).values;if(f!=null){const v=new Array(l);for(let w=0;w<v.length;w++)v[w]=r[f[w]];d=nm(d,r,i.dtype,f,v),c=ke(c.length,l),r=v}_t(i,"max"),Ye("max",c,l);const[p,m]=We(r,c),g=pt(m),x=hC(d,g,p,i.dtype),b=o.write(x,p,i.dtype);let y=p;return u&&(y=Se(p,h)),{dataId:b,shape:y,dtype:i.dtype}}const xB={kernelName:bu,backendName:"cpu",kernelFunc:GC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t;_t(i,"maxPool");const{filterSize:a,strides:u,pad:o,dimRoundingMode:r}=s,l=1;P(Qe(u,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${u} and dilations '${l}'`);const h=Zn(i.shape,a,u,l,o,r);let c;if(h.filterWidth===1&&h.filterHeight===1&&Qt(h.inShape,h.outShape))c=Bs({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,d=Dt(i.shape),p=rm(f,i.shape,i.dtype,d,h,"max");c=n.makeTensorInfo(h.outShape,i.dtype,p.values)}return c}const vB={kernelName:vu,backendName:"cpu",kernelFunc:bB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{filterSize:a,strides:u,pad:o,dimRoundingMode:r,dataFormat:l}=s;_t(i,"maxPool3d");const h=Ks(i.shape,a,u,1,o,r,l),c=n.data.get(i.dataId).values,f=zC(c,i.shape,i.dtype,Dt(i.shape),h,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const wB={kernelName:yu,backendName:"cpu",kernelFunc:yB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,{filterSize:u,strides:o,pad:r,dimRoundingMode:l}=s;_t([i,a],"maxPool3DGrad");const h=Ks(a.shape,u,o,1,r,l),c=n.bufferSync(a),f=cL(c,h),d=h.strideDepth,p=h.strideHeight,m=h.strideWidth,g=h.dilationDepth,x=h.dilationHeight,b=h.dilationWidth,y=h.effectiveFilterDepth,v=h.effectiveFilterHeight,w=h.effectiveFilterWidth,C=y-1-h.padInfo.front,S=w-1-h.padInfo.left,k=v-1-h.padInfo.top,T=Vt(a.shape,"float32"),N=n.bufferSync(i);for(let R=0;R<h.batchSize;++R)for(let L=0;L<h.inChannels;++L)for(let z=0;z<h.inDepth;++z)for(let U=0;U<h.inHeight;++U)for(let H=0;H<h.inWidth;++H){const Y=z-C,Q=U-k,K=H-S;let I=0;for(let A=0;A<y;A+=g){const D=(Y+A)/d;if(!(D<0||D>=h.outDepth||Math.floor(D)!==D))for(let F=0;F<v;F+=x){const j=(Q+F)/p;if(!(j<0||j>=h.outHeight||Math.floor(j)!==j))for(let O=0;O<w;O+=b){const _=(K+O)/m;if(_<0||_>=h.outWidth||Math.floor(_)!==_)continue;const V=y*v*w-1-f.get(R,D,j,_,L),X=A*v*w+F*w+O,rt=V===X?1:0;if(rt===0)continue;I+=N.get(R,D,j,_,L)*rt}}}T.set(I,R,z,U,H,L)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const SB={kernelName:Zd,backendName:"cpu",kernelFunc:CB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a,output:u}=t,o=a;_t([a,u],"maxPoolGrad");const{filterSize:r,strides:l,pad:h,dimRoundingMode:c}=s,f=Zn(o.shape,r,l,1,h,c),d=n.data.get(o.dataId).values,p=Vt(f.outShape,o.dtype,BC(d,o.shape,o.dtype,f).values),m=f.strideHeight,g=f.strideWidth,x=f.dilationHeight,b=f.dilationWidth,y=f.effectiveFilterHeight,v=f.effectiveFilterWidth,w=v-1-f.padInfo.left,C=y-1-f.padInfo.top,S=Vt(o.shape,"float32"),k=n.data.get(i.dataId).values,T=Vt(i.shape,"float32",k);for(let N=0;N<f.batchSize;++N)for(let R=0;R<f.inChannels;++R)for(let L=0;L<f.inHeight;++L)for(let z=0;z<f.inWidth;++z){const U=L-C,H=z-w;let Y=0;for(let Q=0;Q<y;Q+=x){const K=(U+Q)/m;if(!(K<0||K>=f.outHeight||Math.floor(K)!==K))for(let I=0;I<v;I+=b){const A=(H+I)/g;if(A<0||A>=f.outWidth||Math.floor(A)!==A)continue;const D=y*v-1-p.get(N,K,A,R),F=Q*v+I,j=D===F?1:0;if(j===0)continue;Y+=T.get(N,K,A,R)*j}}S.set(Y,N,L,z,R)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const IB={kernelName:Jd,backendName:"cpu",kernelFunc:kB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(e,t,n,s,i){const a=Dt(t),u=rm(e,t,n,a,i,"max"),o=BC(e,t,n,i,!0,s);return[u.values,o.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _B={kernelName:Mb,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{filterSize:i,strides:a,pad:u,includeBatchInIndex:o}=t,r=n;_t(s,"MaxPoolWithArgmax");const l=r.data.get(s.dataId).values,h=Zn(s.shape,i,a,[1,1],u),[c,f]=TB(l,s.shape,s.dtype,o,h),d=r.write(c,h.outShape,s.dtype),p=r.write(f,h.outShape,s.dtype);return[{dataId:d,shape:h.outShape,dtype:s.dtype},{dataId:p,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s,o=Ut(a,i.shape),l=We(i.shape,o)[1],h=pt(l),c=[],f=n.makeTensorInfo([],"float32",new Float32Array([h]));c.push(f);const d=yi({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(d);const p=om({inputs:{a:d,b:f},backend:n});c.push(p);const m=Sl({inputs:{x:p},backend:n,attrs:{axis:a,keepDims:u}});return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const EB={kernelName:wu,backendName:"cpu",kernelFunc:$B};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;_t(i,"min");const o=Ut(a,i.shape);let r=o;const l=be(r,i.shape.length);let h=i;l!=null&&(h=dn({inputs:{x:i},backend:n,attrs:{perm:l}}),r=ke(r.length,i.shape.length)),Ye("min",r,h.shape.length);const[c,f]=We(h.shape,r),d=pt(f),p=Ze(pt(c),h.dtype),m=n.data.get(h.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let y=m[b];for(let v=0;v<d;++v){const w=m[b+v];(Number.isNaN(w)||w<y)&&(y=w)}p[x]=y}l!=null&&n.disposeIntermediateTensorInfo(h);const g=n.makeTensorInfo(c,h.dtype,p);if(u){const x=Se(c,o),b=ce({inputs:{x:g},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(g),b}return g}const DB={kernelName:Cu,backendName:"cpu",kernelFunc:NB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{paddings:a,mode:u}=s;_t(i,"mirrorPad");const o=a.map((y,v)=>y[0]+i.shape[v]+y[1]),r=a.map(y=>y[0]),l=a.map((y,v)=>y[0]+i.shape[v]),h=u==="reflect"?0:1,c=n.data.get(i.dataId).values,f=i.shape.length,d=Dt(i.shape),p=pt(o),m=o.length,g=Dt(o),x=He(i.dtype,p);for(let y=0;y<p;y++){let v=ca(y,m,g);for(let C=0;C<m;C++)v[C]<r[C]?v[C]=r[C]*2-v[C]-h:v[C]>=l[C]&&(v[C]=(l[C]-1)*2-v[C]+h);v=v.map((C,S)=>C-r[S]);const w=Rs(v,f,d);x[y]=c[w]}return{dataId:n.write(x,o,i.dtype),shape:o,dtype:i.dtype}}const RB={kernelName:Su,backendName:"cpu",kernelFunc:AB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OB=$e((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),FB=Ve(La,OB),PB={kernelName:La,backendName:"cpu",kernelFunc:FB};var HC={exports:{}};(function(e){(function(t,n,s){function i(r){var l=this,h=o();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=h(" "),l.s1=h(" "),l.s2=h(" "),l.s0-=h(r),l.s0<0&&(l.s0+=1),l.s1-=h(r),l.s1<0&&(l.s1+=1),l.s2-=h(r),l.s2<0&&(l.s2+=1),h=null}function a(r,l){return l.c=r.c,l.s0=r.s0,l.s1=r.s1,l.s2=r.s2,l}function u(r,l){var h=new i(r),c=l&&l.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,c&&(typeof c=="object"&&a(c,h),f.state=function(){return a(h,{})}),f}function o(){var r=4022871197,l=function(h){h=h.toString();for(var c=0;c<h.length;c++){r+=h.charCodeAt(c);var f=.02519603282416938*r;r=f>>>0,f-=r,f*=r,r=f>>>0,f-=r,r+=f*4294967296}return(r>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.alea=u})(je,e,!1)})(HC);var jC={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var c=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^c^c>>>8},o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor128=u})(je,e,!1)})(jC);var XC={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(c^c<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,o===(o|0)?r.x=o:l+=o;for(var h=0;h<l.length+64;h++)r.x^=l.charCodeAt(h)|0,h==l.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function a(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r.v=o.v,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorwow=u})(je,e,!1)})(XC);var YC={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.x,c=r.i,f,d;return f=h[c],f^=f>>>7,d=f^f<<24,f=h[c+1&7],d^=f^f>>>10,f=h[c+3&7],d^=f^f>>>3,f=h[c+4&7],d^=f^f<<7,f=h[c+7&7],f=f^f<<13,d^=f^f<<9,h[c]=d,r.i=c+1&7,d};function l(h,c){var f,d=[];if(c===(c|0))d[0]=c;else for(c=""+c,f=0;f<c.length;++f)d[f&7]=d[f&7]<<15^c.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],h.x=d,h.i=0,f=256;f>0;--f)h.next()}l(r,o)}function a(o,r){return r.x=o.x.slice(),r.i=o.i,r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.x&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xorshift7=u})(je,e,!1)})(YC);var qC={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this;r.next=function(){var h=r.w,c=r.X,f=r.i,d,p;return r.w=h=h+1640531527|0,p=c[f+34&127],d=c[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=c[f]=p^d,r.i=f,p+(h^h>>>16)|0};function l(h,c){var f,d,p,m,g,x=[],b=128;for(c===(c|0)?(d=c,c=null):(c=c+"\0",d=0,b=Math.max(b,c.length)),p=0,m=-32;m<b;++m)c&&(d^=c.charCodeAt((m+32)%c.length)),m===0&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(g=g+1640531527|0,f=x[m&127]^=d+g,p=f==0?p+1:0);for(p>=128&&(x[(c&&c.length||0)&127]=-1),p=127,m=4*128;m>0;--m)d=x[p+34&127],f=x[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,x[p]=d^f;h.w=g,h.X=x,h.i=p}l(r,o)}function a(o,r){return r.i=o.i,r.w=o.w,r.X=o.X.slice(),r}function u(o,r){o==null&&(o=+new Date);var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(h.X&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.xor4096=u})(je,e,!1)})(qC);var KC={exports:{}};(function(e){(function(t,n,s){function i(o){var r=this,l="";r.next=function(){var c=r.b,f=r.c,d=r.d,p=r.a;return c=c<<25^c>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-c|0,r.b=c=c<<20^c>>>12^f,r.c=f=f-d|0,r.d=d<<16^f>>>16^p,r.a=p-c|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,o===Math.floor(o)?(r.a=o/4294967296|0,r.b=o|0):l+=o;for(var h=0;h<l.length+20;h++)r.b^=l.charCodeAt(h)|0,r.next()}function a(o,r){return r.a=o.a,r.b=o.b,r.c=o.c,r.d=o.d,r}function u(o,r){var l=new i(o),h=r&&r.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,h&&(typeof h=="object"&&a(h,l),c.state=function(){return a(l,{})}),c}n&&n.exports?n.exports=u:s&&s.amd?s(function(){return u}):this.tychei=u})(je,e,!1)})(KC);var JC={exports:{}};(function(e){(function(t,n){var s=this,i=256,a=6,u=52,o="random",r=n.pow(i,a),l=n.pow(2,u),h=l*2,c=i-1,f;function d(v,w,C){var S=[];w=w==!0?{entropy:!0}:w||{};var k=x(g(w.entropy?[v,y(t)]:v==null?b():v,3),S),T=new p(S),N=function(){for(var R=T.g(a),L=r,z=0;R<l;)R=(R+z)*i,L*=i,z=T.g(1);for(;R>=h;)R/=2,L/=2,z>>>=1;return(R+z)/L};return N.int32=function(){return T.g(4)|0},N.quick=function(){return T.g(4)/4294967296},N.double=N,x(y(T.S),t),(w.pass||C||function(R,L,z,U){return U&&(U.S&&m(U,T),R.state=function(){return m(T,{})}),z?(n[o]=R,L):R})(N,k,"global"in w?w.global:this==n,w.state)}n["seed"+o]=d;function p(v){var w,C=v.length,S=this,k=0,T=S.i=S.j=0,N=S.S=[];for(C||(v=[C++]);k<i;)N[k]=k++;for(k=0;k<i;k++)N[k]=N[T=c&T+v[k%C]+(w=N[k])],N[T]=w;(S.g=function(R){for(var L,z=0,U=S.i,H=S.j,Y=S.S;R--;)L=Y[U=c&U+1],z=z*i+Y[c&(Y[U]=Y[H=c&H+L])+(Y[H]=L)];return S.i=U,S.j=H,z})(i)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function g(v,w){var C=[],S=typeof v,k;if(w&&S=="object")for(k in v)try{C.push(g(v[k],w-1))}catch{}return C.length?C:S=="string"?v:v+"\0"}function x(v,w){for(var C=v+"",S,k=0;k<C.length;)w[c&k]=c&(S^=w[c&k]*19)+C.charCodeAt(k++);return y(w)}function b(){try{var v;return f&&(v=f.randomBytes)?v=v(i):(v=new Uint8Array(i),(s.crypto||s.msCrypto).getRandomValues(v)),y(v)}catch{var w=s.navigator,C=w&&w.plugins;return[+new Date,s,C,s.screen,y(t)]}}function y(v){return String.fromCharCode.apply(0,v)}if(x(n.random(),t),e.exports){e.exports=d;try{f=require("crypto")}catch{}}})([],Math)})(JC);var MB=HC.exports,LB=jC.exports,BB=XC.exports,zB=YC.exports,WB=qC.exports,VB=KC.exports,wr=JC.exports;wr.alea=MB;wr.xor128=LB;wr.xorwow=BB;wr.xorshift7=zB;wr.xor4096=WB;wr.tychei=VB;var UB=wr;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZC(e){const{inputs:t,backend:n,attrs:s}=e,{logits:i}=t,{dim:a}=s,u=i.shape.length;let o=a;if(o===-1&&(o=u-1),o!==u-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${u} and dim was ${o}`);const r=Ut([o],i.shape),l=GC({inputs:{x:i},backend:n,attrs:{reductionIndices:r,keepDims:!1}}),h=Se(l.shape,r),c=ce({inputs:{x:l},backend:n,attrs:{shape:h}}),f=im({inputs:{a:i,b:c},backend:n}),d=tC({inputs:{x:f},backend:n}),p=Sl({inputs:{x:d},backend:n,attrs:{axis:r,keepDims:!1}}),m=ce({inputs:{x:p},backend:n,attrs:{shape:h}}),g=om({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const GB={kernelName:Wu,backendName:"cpu",kernelFunc:ZC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(e){const{inputs:t,backend:n,attrs:s}=e,{logits:i}=t,{numSamples:a,seed:u,normalized:o}=s;_t(i,"multinomial");const r=o?i:ZC({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=r.shape[0],h=r.shape[1],c=n.data.get(r.dataId).values,f=[l,a],d=Ze(pt(f),"int32");for(let p=0;p<l;++p){const m=p*h,g=new Float32Array(h-1);g[0]=c[m];for(let y=1;y<g.length;++y)g[y]=g[y-1]+c[m+y];const x=UB.alea(u.toString()),b=p*a;for(let y=0;y<a;++y){const v=x();d[b+y]=g.length;for(let w=0;w<g.length;w++)if(v<g[w]){d[b+y]=w;break}}}return o||n.disposeIntermediateTensorInfo(r),n.makeTensorInfo(f,"int32",d)}const jB={kernelName:Lb,backendName:"cpu",kernelFunc:HB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XB=eg;function YB(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r}=s;_t(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,{selectedIndices:c}=XB(l,h,u,o,r);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}const qB={kernelName:Qd,backendName:"cpu",kernelFunc:YB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KB=ng;function JB(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r,padToMaxOutputSize:l}=s;_t(i,"NonMaxSuppressionPadded");const h=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,{selectedIndices:f,validOutputs:d}=KB(h,c,u,o,r,l);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const ZB={kernelName:tp,backendName:"cpu",kernelFunc:JB};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QB=sg;function tz(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r,softNmsSigma:l}=s;_t(i,"NonMaxSuppressionWithScore");const h=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,f=u,d=o,p=r,m=l,{selectedIndices:g,selectedScores:x}=QB(h,c,f,d,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const ez={kernelName:ep,backendName:"cpu",kernelFunc:tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(e){const{inputs:t,backend:n,attrs:s}=e,{indices:i}=t,{depth:a,onValue:u,offValue:o}=s;_t(i,"oneHot");const r=pt(i.shape),l=new Float32Array(r*a);l.fill(o);const h=n.data.get(i.dataId).values;for(let c=0;c<r;++c)h[c]>=0&&h[c]<a&&(l[c*a+h[c]]=u);return n.makeTensorInfo([...i.shape,a],"int32",l)}const sz={kernelName:_u,backendName:"cpu",kernelFunc:nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $c(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=pr({inputs:{input:s},backend:n}),a=$c({inputs:{x:i},backend:n}),u=oo({inputs:{input:s},backend:n}),o=$c({inputs:{x:u},backend:n}),r=bn({inputs:{real:a,imag:o},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(o),r}else return am({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const iz={kernelName:Gu,backendName:"cpu",kernelFunc:$c};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QC(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=pr({inputs:{input:s},backend:n}),a=QC({inputs:{x:i},backend:n}),u=oo({inputs:{input:s},backend:n}),o=$c({inputs:{x:u},backend:n}),r=bn({inputs:{real:a,imag:o},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(o),r}else return am({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const rz={kernelName:Tu,backendName:"cpu",kernelFunc:QC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tS(e){const{inputs:t,backend:n,attrs:s}=e,{axis:i}=s;if(t.length===1)return _c({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,u=t[0].dtype;t.forEach(h=>{Jn(a,h.shape,"All tensors passed to stack must have matching shapes"),P(u===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],r=t.map(h=>{const c=_c({inputs:{input:h},backend:n,attrs:{dim:i}});return o.push(c),c}),l=ao({inputs:r,backend:n,attrs:{axis:i}});return o.forEach(h=>n.disposeIntermediateTensorInfo(h)),l}const oz={kernelName:$u,backendName:"cpu",kernelFunc:tS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{paddings:a,constantValue:u}=s;_t(i,"pad");const o=a.map((b,y)=>b[0]+i.shape[y]+b[1]),r=a.map(b=>b[0]),l=n.data.get(i.dataId).values,h=pt(i.shape),c=i.shape.length,f=Dt(i.shape),d=pt(o),p=o.length,m=Dt(o),g=He(i.dtype,d);u!==0&&g.fill(u);for(let b=0;b<h;b++){const v=ca(b,c,f).map((C,S)=>C+r[S]),w=Rs(v,p,m);g[w]=l[b]}return{dataId:n.write(g,o,i.dtype),shape:o,dtype:i.dtype}}const eS={kernelName:Eu,backendName:"cpu",kernelFunc:az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lz=$e((e,t)=>Math.pow(e,t)),cz=Ve(za,lz),uz={kernelName:za,backendName:"cpu",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(e){const{backend:t,attrs:n}=e,{start:s,stop:i,dtype:a,step:u}=n,o=xC(s,i,u,a);return t.makeTensorInfo([o.length],a,o)}const fz={kernelName:np,backendName:"cpu",kernelFunc:hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dz=ee(Wa,e=>1/e),pz={kernelName:Wa,backendName:"cpu",kernelFunc:dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(e){const{inputs:t,backend:n,attrs:s}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:u,size:o}=s;_t(i,"resizeBilinear");const r=Dt(i.shape),[l,h]=o,[c,f,d,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(pt([c,l,h,p])),x=[a&&l>1?f-1:f,a&&h>1?d-1:d],b=[a&&l>1?l-1:l,a&&h>1?h-1:h];let y=0;const v=x[0]/b[0],w=x[1]/b[1];for(let C=0;C<c;C++)for(let S=0;S<l;S++){let k;u?k=v*(S+.5)-.5:k=v*S;const T=Math.max(0,Math.floor(k)),N=k-T,R=Math.min(f-1,Math.ceil(k)),L=C*r[0]+T*r[1],z=C*r[0]+R*r[1];for(let U=0;U<h;U++){let H;u?H=w*(U+.5)-.5:H=w*U;const Y=Math.max(0,Math.floor(H)),Q=H-Y,K=Math.min(d-1,Math.ceil(H)),I=L+Y*r[2],A=z+Y*r[2],D=L+K*r[2],F=z+K*r[2];for(let j=0;j<p;j++){const O=m[I+j],_=m[A+j],V=m[D+j],X=m[F+j],rt=O+(V-O)*Q,st=_+(X-_)*Q,ot=rt+(st-rt)*N;g[y++]=ot}}}return n.makeTensorInfo([c,l,h,p],"float32",g)}const mz={kernelName:Ou,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(e){const{inputs:t,backend:n,attrs:s}=e,{images:i,dy:a}=t,{alignCorners:u}=s;_t([a,i],"resizeBilinearGrad");const o=Dt(i.shape),[r,l,h,c]=i.shape,[,f,d]=a.shape,p=new Float32Array(r*l*h*c),m=[u&&f>1?l-1:l,u&&d>1?h-1:h],g=[u&&f>1?f-1:f,u&&d>1?d-1:d],x=m[0]/g[0],b=m[1]/g[1],y=n.data.get(a.dataId).values;let v=0;for(let w=0;w<r;w++){const C=w*o[0];for(let S=0;S<f;S++){const k=S*x,T=Math.floor(k),N=Math.min(Math.ceil(k),l-1),R=C+T*o[1],L=C+N*o[1],z=k-T,U=1-z;for(let H=0;H<d;H++){const Y=H*b,Q=Math.floor(Y),K=Math.min(Math.ceil(Y),h-1),I=Y-Q,A=1-I,D=R+Q*o[2],F=R+K*o[2],j=L+Q*o[2],O=L+K*o[2],_=U*A,V=U*I,X=z*A,rt=z*I;for(let st=0;st<c;st++){const ot=y[v++];p[D+st]+=ot*_,p[F+st]+=ot*V,p[j+st]+=ot*X,p[O+st]+=ot*rt}}}}return n.makeTensorInfo([r,h,l,c],"float32",p)}const bz={kernelName:rp,backendName:"cpu",kernelFunc:xz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(e){const{inputs:t,backend:n,attrs:s}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:u,size:o}=s;_t(i,"resizeNearestNeighbor");const r=Dt(i.shape),[l,h]=o,[c,f,d,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(c*l*h*p),x=[a&&l>1?f-1:f,a&&h>1?d-1:d],b=[a&&l>1?l-1:l,a&&h>1?h-1:h],y=x[0]/b[0],v=x[1]/b[1];let w=0;for(let C=0;C<c;C++){const S=C*r[0];for(let k=0;k<l;k++){const T=u?y*(k+.5):y*k;let N=Math.min(f-1,a?Math.round(T):Math.floor(T));u&&(N=Math.max(0,N));const R=S+N*r[1];for(let L=0;L<h;L++){const z=u?v*(L+.5):v*L;let U=Math.min(d-1,a?Math.round(z):Math.floor(z));u&&(U=Math.max(0,U));const H=R+U*r[2];for(let Y=0;Y<p;Y++){const Q=m[H+Y];g[w++]=Q}}}}return n.makeTensorInfo([c,l,h,p],i.dtype,g)}const yz={kernelName:Ru,backendName:"cpu",kernelFunc:vz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(e){const{inputs:t,backend:n,attrs:s}=e,{images:i,dy:a}=t,{alignCorners:u}=s;_t([a,i],"resizeNearestNeighborGrad");const o=Dt(i.shape),r=Dt(a.shape),[l,h,c,f]=i.shape,[,d,p]=a.shape,m=new Float32Array(l*h*c*f),g=n.data.get(a.dataId).values,x=[u&&d>1?h-1:h,u&&p>1?c-1:c],b=[u&&d>1?d-1:d,u&&p>1?p-1:p],y=x[0]/b[0],v=x[1]/b[1],w=1/y,C=1/v,S=Math.ceil(w)*2+2,k=Math.ceil(C)*2+2;for(let T=0;T<l;T++){const N=T*o[0];for(let R=0;R<h;R++){const L=N+R*o[1],z=Math.floor(R*w),U=Math.floor(z-S/2);for(let H=0;H<c;H++){const Y=L+H*o[2],Q=Math.floor(H*C),K=Math.floor(Q-k/2);for(let I=0;I<f;I++){let A=0;for(let D=0;D<S;D++){const F=D+U;if(F<0||F>=d)continue;const j=N+F*r[1],O=F*y,_=Math.min(h-1,u?Math.round(O):Math.floor(O));if(R===_)for(let V=0;V<k;V++){const X=V+K;if(X<0||X>=p)continue;const rt=j+X*r[2],st=X*v,ot=Math.min(c-1,u?Math.round(st):Math.floor(st));H===ot&&(A+=g[rt+I])}}m[Y+I]=A}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}const Cz={kernelName:ip,backendName:"cpu",kernelFunc:wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{dims:a}=s;_t(i,"reverse");const u=i.shape.length,o=Ut(a,i.shape);if(u===0)return Bs({inputs:{x:i},backend:n});const r=new Je(i.shape,i.dtype),l=n.bufferSync(i);for(let h=0;h<r.size;h++){const c=r.indexToLoc(h),f=c.slice();o.forEach(d=>f[d]=i.shape[d]-1-f[d]),r.set(l.get(...f),...c)}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const kz={kernelName:Fu,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz={kernelName:bp,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,{radians:i,fillValue:a,center:u}=t,o=n,r=He(s.dtype,pt(s.shape)),[l,h,c,f]=s.shape,[d,p]=dg(u,h,c),m=255,g=Math.sin(i),x=Math.cos(i),b=o.data.get(s.dataId).values;for(let v=0;v<l;v++){const w=v*c*h*f;for(let C=0;C<h;C++){const S=C*(c*f);for(let k=0;k<c;k++){const T=k*f;for(let N=0;N<f;N++){const R=[l,C,k,N],L=R[2],z=R[1];let U=(L-d)*x-(z-p)*g,H=(L-d)*g+(z-p)*x;U=Math.round(U+d),H=Math.round(H+p);let Y=a;if(typeof a!="number"&&(N===3?Y=m:Y=a[N]),U>=0&&U<c&&H>=0&&H<h){const K=H*(c*f),I=U*f,A=w+K+I+N;Y=b[A]}const Q=w+S+T+N;r[Q]=Y}}}}return{dataId:o.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tz=ee(Ga,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),_z={kernelName:Ga,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(e){const{inputs:t,backend:n,attrs:s}=e,{indices:i,updates:a}=t,{shape:u}=s,{sliceRank:o,numUpdates:r,sliceSize:l,strides:h,outputSize:c}=al(a,i,u),f=!0,d=n.bufferSync(i),p=n.bufferSync(a),m=Mr(d,p,u,c,l,r,o,h,0,f);return n.makeTensorInfo(u,m.dtype,m.values)}const Ez={kernelName:Bb,backendName:"cpu",kernelFunc:$z};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(e,t){let n=0,s=e.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),e[i]<t?n=i+1:s=i;return s}function Dz(e,t){let n=0,s=e.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),e[i]<=t?n=i+1:s=i;return s}function Az(e,t,n,s,i,a){const u=nn("int32",n*i);for(let o=0;o<n;++o){const r=e.slice(o*s,(o+1)*s),l=o*i;for(let h=0;h<i;++h)u[l+h]=a==="left"?Nz(r,t[h+l]):Dz(r,t[h+l])}return u}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rz(e){const{inputs:t,backend:n,attrs:s}=e,{sortedSequence:i,values:a}=t,{side:u}=s,o=n.data.get(i.dataId).values,r=n.data.get(a.dataId).values,l=Az(o,r,i.shape[0],i.shape[1],a.shape[1],u);return n.makeTensorInfo(a.shape,"int32",l)}const Oz={kernelName:zb,backendName:"cpu",kernelFunc:Rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(e){const{inputs:t,backend:n}=e,{condition:s,t:i,e:a}=t;_t([s,i,a],"select");const u=s.shape.length,o=n.data.get(s.dataId).values,r=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,h=Cn(i.dtype,a.dtype),c=Ze(pt(i.shape),h);let f=0;const d=u===0||u>1||i.shape.length===1?1:pt(i.shape.slice(1));for(let p=0;p<o.length;p++)for(let m=0;m<d;m++)o[p]===1?c[f++]=r[p]:c[f++]=l[p];return n.makeTensorInfo(i.shape,h,c)}const Pz={kernelName:Pu,backendName:"cpu",kernelFunc:Fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mz=nh,Lz=sh,Bz=ee(ja,e=>e>=0?Lz*e:Mz*(Math.exp(e)-1)),zz={kernelName:ja,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wz=ee(qa,e=>e<0?-1:e>0?1:0),Vz={kernelName:qa,backendName:"cpu",kernelFunc:Wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uz=ee(Xa,e=>Math.sin(e)),Gz={kernelName:Xa,backendName:"cpu",kernelFunc:Uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hz=ee(Ya,e=>Math.sinh(e)),jz={kernelName:Ya,backendName:"cpu",kernelFunc:Hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xz=11920928955078125e-23,qx=Math.log(Xz)+2,Yz=ee(Ja,e=>{const t=e>-qx,n=e<qx,s=Math.exp(e);let i;return n?i=s:t?i=e:i=Math.log(1+s),i}),qz={kernelName:Ja,backendName:"cpu",kernelFunc:Yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockShape:a,paddings:u}=s;_t([i],"spaceToBatchND");const o=pt(a),r=[[0,0]];r.push(...u);for(let C=1+a.length;C<i.shape.length;++C)r.push([0,0]);const l=eS.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:r,constantValue:0}}),h=fl(l.shape,a,o,!1),c=dl(h.length,a.length,!1),f=pl(l.shape,a,o,!1),m=ce({inputs:{x:l},backend:n,attrs:{shape:h}}),b=dn({inputs:{x:m},backend:n,attrs:{perm:c}}),w=ce({inputs:{x:b},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(b),w}const Jz={kernelName:Bu,backendName:"cpu",kernelFunc:Kz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(e){const{inputs:t,backend:n}=e,{indices:s,values:i,denseShape:a,defaultValue:u}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${a.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(u.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${u.shape}`);const o=n.data.get(s.dataId).values,r=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,h=n.data.get(u.dataId).values[0],[c,f,d,p,m]=wC(o,s.shape,s.dtype,r,i.dtype,l,h);return[n.makeTensorInfo(f,s.dtype,c),n.makeTensorInfo([f[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const Qz={kernelName:op,backendName:"cpu",kernelFunc:Zz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(e){const{inputs:t,backend:n}=e,{inputIndices:s,inputShape:i,newShape:a}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const u=Array.from(n.data.get(i.dataId).values),o=n.data.get(s.dataId).values,r=Array.from(n.data.get(a.dataId).values),[l,h,c]=CC(o,s.shape,s.dtype,u,r);return[n.makeTensorInfo(h,s.dtype,l),n.makeTensorInfo([c.length],a.dtype,new Int32Array(c))]}const eW={kernelName:ap,backendName:"cpu",kernelFunc:tW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(e){const{inputs:t,backend:n}=e,{data:s,indices:i,segmentIds:a}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${a.shape}`);if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const u=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,r=n.data.get(a.dataId).values,[l,h]=sm(u,s.shape,s.dtype,o,r,!0);return n.makeTensorInfo(h,s.dtype,l)}const sW={kernelName:lp,backendName:"cpu",kernelFunc:nW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(e){const{inputs:t,backend:n}=e,{data:s,indices:i,segmentIds:a}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${a.shape}`);if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const u=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,r=n.data.get(a.dataId).values,[l,h]=sm(u,s.shape,s.dtype,o,r);return n.makeTensorInfo(h,s.dtype,l)}const rW={kernelName:cp,backendName:"cpu",kernelFunc:iW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(e){const{inputs:t,backend:n,attrs:s}=e,{sparseIndices:i,sparseValues:a,defaultValue:u}=t,{outputShape:o}=s,{sliceRank:r,numUpdates:l,sliceSize:h,strides:c,outputSize:f}=al(a,i,o),d=!1,p=n.bufferSync(i);let m;switch(a.dtype){case"bool":{const g=n.bufferSync(a),x=Boolean(n.data.get(u.dataId).values[0]);m=Mr(p,g,o,f,h,l,r,c,x,d);break}case"float32":{const g=n.bufferSync(a),x=n.data.get(u.dataId).values[0];m=Mr(p,g,o,f,h,l,r,c,x,d);break}case"int32":{const g=n.bufferSync(a),x=n.data.get(u.dataId).values[0];m=Mr(p,g,o,f,h,l,r,c,x,d);break}case"string":{const g=n.bufferSync(a),x=gi(n.data.get(u.dataId).values[0]);m=Mr(p,g,o,f,h,l,r,c,x,d);break}default:throw new Error(`Unsupported type ${a.dtype}`)}return n.makeTensorInfo(o,m.dtype,m.values)}const aW={kernelName:Wb,backendName:"cpu",kernelFunc:oW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{numOrSizeSplits:a,axis:u}=s,o=Ut(u,i.shape)[0],r=$g(i,a,o),l=new Array(i.shape.length).fill(0),h=i.shape.slice();return r.map(c=>{const f=[...h];f[o]=c;const d=gr({inputs:{x:i},backend:n,attrs:{begin:l,size:f}});return l[o]+=c,d})}const cW={kernelName:zu,backendName:"cpu",kernelFunc:lW};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uW={kernelName:up,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,s=t;_t(n,"square");const i=s.data.get(n.dataId).values,a=new Float32Array(i.length);for(let o=0;o<i.length;++o){const r=i[o];a[o]=r*r}return{dataId:s.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hW=ee(il,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),fW={kernelName:il,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{begin:a,end:u,strides:o,beginMask:r,endMask:l,ellipsisMask:h,newAxisMask:c,shrinkAxisMask:f}=s;_t(i,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:x,begin:b,end:y,strides:v}=Ep(i.shape,a,u,o,r,l,h,c,f);let w;if(m)w=ce({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||x){P(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const C=Tp(b,y,v),S=gr({inputs:{x:i},backend:n,attrs:{begin:b,size:C}});w=ce({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else{const C=n.bufferSync(i),S=kC(d,C,v,b);w=n.makeTensorInfo(p,S.dtype,S.values)}return w}const pW={kernelName:hp,backendName:"cpu",kernelFunc:dW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(e){const{inputs:t,backend:n,attrs:s}=e,{separator:i,nGramWidths:a,leftPad:u,rightPad:o,padWidth:r,preserveShortSequences:l}=s,{data:h,dataSplits:c}=t,f=n.data.get(h.dataId).values,d=n.data.get(c.dataId).values,[p,m]=IC(f,d,i,a,u,o,r,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(c.shape,"int32",m)]}const mW={kernelName:fp,backendName:"cpu",kernelFunc:gW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xW(e){const{inputs:t,backend:n,attrs:s}=e,{skipEmpty:i}=s,{input:a,delimiter:u}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(u.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${u.shape}`);const o=n.data.get(a.dataId).values,r=n.data.get(u.dataId).values[0],[l,h,c]=TC(o,r,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(c))]}const bW={kernelName:dp,backendName:"cpu",kernelFunc:xW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(e){const{inputs:t,backend:n,attrs:s}=e,{numBuckets:i}=s,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const u=n.data.get(a.dataId).values,o=_C(u,i);return n.makeTensorInfo(a.shape,"int32",o)}const yW={kernelName:pp,backendName:"cpu",kernelFunc:vW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wW=ee(el,e=>Math.tan(e)),CW={kernelName:el,backendName:"cpu",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SW=ee(nl,e=>Math.tanh(e)),kW={kernelName:nl,backendName:"cpu",kernelFunc:SW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{reps:a}=s;_t(i,"tile");const u=EC(n.bufferSync(i),a);return n.makeTensorInfo(u.shape,u.dtype,u.values)}const TW={kernelName:sl,backendName:"cpu",kernelFunc:IW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{k:a,sorted:u}=s;_t(i,"topk");const o=n.data.get(i.dataId).values,[r,l]=DC(o,i.shape,i.dtype,a,u);return[n.makeTensorInfo(r.shape,r.dtype,r.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}const $W={kernelName:gp,backendName:"cpu",kernelFunc:_W};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(e){const{inputs:t,attrs:n,backend:s}=e,{image:i,transforms:a}=t,{interpolation:u,fillMode:o,fillValue:r,outputShape:l}=n,[h,c,f,d]=i.shape,[p,m]=l!=null?l:[c,f],g=[h,p,m,d],x=Dt(i.shape),b=x[0],y=x[1],v=x[2],w=He(i.dtype,pt(g));w.fill(r);const C=s.data.get(i.dataId).values,S=s.data.get(a.dataId).values;for(let T=0;T<h;++T){const N=a.shape[0]===1?S:S.subarray(T*8,T*8+8);for(let R=0;R<p;++R)for(let L=0;L<m;++L)for(let z=0;z<d;++z){let U;const H=N[6]*L+N[7]*R+1;if(H===0)continue;const Y=(N[0]*L+N[1]*R+N[2])/H,Q=(N[3]*L+N[4]*R+N[5])/H,K=Kx(Y,f,o),I=Kx(Q,c,o);switch(u){case"nearest":U=FW(C,c,f,b,y,v,T,I,K,z,r);break;case"bilinear":U=PW(C,c,f,b,y,v,T,I,K,z,r);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${u}`)}const A=T*b+R*y+L*v+z;w[A]=U}return s.makeTensorInfo(g,i.dtype,w)}return{dataId:s.write(w,g,i.dtype),shape:i.shape,dtype:i.dtype}}const NW={kernelName:mp,backendName:"cpu",kernelFunc:EW};function Kx(e,t,n){switch(n){case"reflect":return DW(e,t);case"wrap":return AW(e,t);case"nearest":return OW(e,t);case"constant":default:return RW(e)}}function DW(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const s=2*t;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-t?n+s:-n-1}else if(n>t-1)if(t<=1)n=0;else{const s=2*t;n-=s*Math.trunc(n/s),n>=t&&(n=s-n-1)}return sr(0,n,t-1)}function AW(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const s=t-1;n+=t*(Math.trunc(-n/s)+1)}else if(n>t-1)if(t<=1)n=0;else{const s=t-1;n-=t*Math.trunc(n/s)}return sr(0,n,t-1)}function RW(e,t){return e}function OW(e,t){return sr(0,e,t-1)}function zo(e,t,n,s,i,a,u,o,r,l,h){const c=u*s+o*i+r*a+l;return 0<=o&&o<t&&0<=r&&r<n?e[c]:h}function FW(e,t,n,s,i,a,u,o,r,l,h){const c=Math.round(o),f=Math.round(r);return zo(e,t,n,s,i,a,u,c,f,l,h)}function PW(e,t,n,s,i,a,u,o,r,l,h){const c=Math.floor(o),f=Math.floor(r),d=c+1,p=f+1,m=(p-r)*zo(e,t,n,s,i,a,u,c,f,l,h)+(r-f)*zo(e,t,n,s,i,a,u,c,p,l,h),g=(p-r)*zo(e,t,n,s,i,a,u,d,f,l,h)+(r-f)*zo(e,t,n,s,i,a,u,d,p,l,h);return(d-o)*m+(o-c)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(e){const{inputs:t,attrs:n,backend:s}=e,{axis:i}=n,{x:a}=t;_t(a,"unique");const u=s.data.get(a.dataId).values,{outputValues:o,outputShape:r,indices:l}=AC(u,i,a.shape,a.dtype);return[s.makeTensorInfo(r,a.dtype,o),s.makeTensorInfo([l.length],"int32",l)]}const LW={kernelName:xp,backendName:"cpu",kernelFunc:MW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(e){const{inputs:t,backend:n,attrs:s}=e,{value:i}=t;let{axis:a}=s;a<0&&(a+=i.shape.length);const u=i.shape.length,o=i.shape[a],r=new Array(u-1);let l=0;for(let d=0;d<u;d++)d!==a&&(r[l++]=i.shape[d]);const h=new Array(u).fill(0),c=i.shape.slice();c[a]=1;const f=new Array(o);for(let d=0;d<f.length;d++){h[a]=d;const p=gr({inputs:{x:i},backend:n,attrs:{begin:h,size:c}});f[d]=ce({inputs:{x:p},backend:n,attrs:{shape:r}}),n.disposeIntermediateTensorInfo(p)}return f}const zW={kernelName:Vu,backendName:"cpu",kernelFunc:BW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,segmentIds:a}=t,{numSegments:u}=s;_t(i,"unsortedSegmentSum");const o=i.shape.length,r=a.shape.length,l=[],h=[],c=o-r;let f=a;for(let p=0;p<c;++p){const m=_c({inputs:{input:f},backend:n,attrs:{dim:p+1}});f=m,h.push(m)}for(let p=0;p<u;++p){const m=Ci(p,"int32"),g=n.makeTensorInfo([],"int32",m),x=Zw({inputs:{a:g,b:f},backend:n}),b=yi({inputs:{x},backend:n,attrs:{dtype:"float32"}}),y=mh({inputs:{a:b,b:i},backend:n}),v=Sl({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});l.push(v),h.push(g),h.push(x),h.push(b),h.push(y),h.push(v)}const d=tS({inputs:l,backend:n,attrs:{axis:0}});return h.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const VW={kernelName:Uu,backendName:"cpu",kernelFunc:WW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW=[MM,EP,BM,WM,FP,UM,HM,XM,qM,JM,QM,eL,sL,oL,lL,hL,dL,gL,xL,FM,vL,wL,SL,IL,RP,MP,_L,NP,EL,DL,AL,OL,PL,LL,zL,VL,GL,jL,YL,KL,ZL,t3,n3,s3,r3,a3,c3,u3,h3,f3,g3,$M,x3,LP,I3,BP,T3,WP,A3,R3,F3,UP,L3,z3,V3,G3,j3,HP,XP,DP,Y3,NL,K3,Z3,tB,EM,qP,JP,nB,QP,iB,aB,cB,fB,pB,mB,xB,eM,vB,wB,SB,IB,_B,EB,DB,sM,RB,PB,jB,rM,aM,qB,ZB,ez,cM,sz,rz,oz,eS,uz,DM,fM,fz,AP,td,pz,AM,RM,OM,mz,bz,yz,Cz,kz,Iz,_z,pM,Ez,Oz,Pz,zz,mM,Vz,Gz,jz,xM,GB,qz,Jz,Qz,eW,sW,rW,aW,cW,yM,uW,CM,fW,pW,mW,bW,yW,TM,d3,CW,kW,TW,$W,NW,uM,LW,zW,VW,iz];for(const e of UW)Ub(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hi={},Vh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function GW(e,t){Hi[e]=t}function vs(e,t){if(!(e in Hi)||t!=null){const s=jW(e,t);if(s!==null)Hi[e]=s;else return console.log("Could not get context for WebGL version",e),null}const n=Hi[e];return n==null||n.isContextLost()?(delete Hi[e],vs(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Hi[e])}function HW(e){if(typeof OffscreenCanvas!="undefined"&&e===2)return new OffscreenCanvas(300,150);if(typeof document!="undefined")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function jW(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t==null?HW(e):t;return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Hi[e]},!1),e===1?n.getContext("webgl",Vh)||n.getContext("experimental-webgl",Vh):n.getContext("webgl2",Vh)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sa;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(sa||(sa={}));var Dn;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Dn||(Dn={}));var Ue;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ue||(Ue={}));function kl(e,t){return[t,e]}function XW(e,t){return e*t}function Wl(e){const t=pt(e),n=Math.ceil(t/4);return gf(n)}function ko(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function YW(e,t){const[n,s]=ko(e,t);return n*s*4}function lm(e,t){const n=e;let s,i,a,u,o,r,l,h,c,f;return dt().getNumber("WEBGL_VERSION")===2?(s=n.R32F,i=n.R16F,a=n.RGBA16F,u=n.RGBA32F,o=n.RED,l=4,h=1,c=n.HALF_FLOAT,f=n.FLOAT,r=n.RGBA8):(s=e.RGBA,i=e.RGBA,a=e.RGBA,u=n.RGBA,o=e.RGBA,l=4,h=4,c=t!=null?t.HALF_FLOAT_OES:null,f=e.FLOAT,r=e.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:u,textureFormatFloat:o,downloadTextureFormat:r,downloadUnpackNumChannels:l,defaultNumChannels:h,textureTypeHalfFloat:c,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $t(e,t){const n=t();return dt().getBool("DEBUG")&&qW(e),n}function qW(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+QW(e,t))}const KW=596e-10,JW=65504;function ZW(e){return!!(dt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||KW<Math.abs(e)&&Math.abs(e)<JW)}function QW(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Vl(e,t){return Qs(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function tV(e,t){const n=Qs(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if($t(e,()=>e.shaderSource(n,t)),$t(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function eV(e,t){const n=Qs(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if($t(e,()=>e.shaderSource(n,t)),$t(e,()=>e.compileShader(n)),dt().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw nS(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const nV=/ERROR: [0-9]+:([0-9]+):/g;function nS(e,t){const n=nV.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}const s=+n[1],i=e.split(`
`),a=i.length.toString().length+2,u=i.map((c,f)=>Wr((f+1).toString(),a)+c);let o=0;for(let c=0;c<u.length;c++)o=Math.max(u[c].length,o);const r=u.slice(0,s-1),l=u.slice(s-1,s),h=u.slice(s);console.log(r.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Wr(l[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function sV(e){return Qs(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function iV(e,t){if($t(e,()=>e.linkProgram(t)),!dt().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Uh(e,t){if($t(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function rV(e,t){const n=Qs(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $t(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),$t(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function oV(e,t){const n=Qs(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $t(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),$t(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function aV(e){return Qs(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function lV(e,t){const n=dt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const s=`[${e}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(e>n||t>n){const s=`[${e}x${t}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function cV(e){return Qs(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Jx(e,t,n,s,i,a,u){const o=e.getAttribLocation(t,n);return o===-1?!1:($t(e,()=>e.bindBuffer(e.ARRAY_BUFFER,s)),$t(e,()=>e.vertexAttribPointer(o,i,e.FLOAT,!1,a,u)),$t(e,()=>e.enableVertexAttribArray(o)),!0)}function uV(e,t,n){gV(e,n),$t(e,()=>e.activeTexture(e.TEXTURE0+n)),$t(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function hV(e,t,n){return Qs(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function fV(e,t,n){return e.getUniformLocation(t,n)}function dV(e,t,n,s){$t(e,()=>uV(e,t,s)),$t(e,()=>e.uniform1i(n,s))}function Gh(e,t,n){$t(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),$t(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function Zx(e,t){$t(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),$t(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function Ul(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+pV(e,t))}function pV(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Qs(e,t,n){const s=$t(e,()=>t());if(s==null)throw new Error(n);return s}function gV(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+e.TEXTURE0;if(s<e.TEXTURE0||s>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function lo(e,t=2){return pt(e.slice(0,e.length-t))}function co(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Hh(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[lo(e),...co(e)]),t}function mV(e,t=!1){let n=dt().getNumber("WEBGL_MAX_TEXTURE_SIZE");t&&(n=n*2,e=e.map((i,a)=>a>=e.length-2?Cb(e[a]):e[a]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=wi(e).newShape);let s=pt(e);if(e.length<=1&&s<=n)return[1,s];if(e.length===2&&e[0]<=n&&e[1]<=n)return e;if(e.length===3&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const i=lo(e);let a=2,u=2;return e.length&&([a,u]=co(e)),s=i*(a/2)*(u/2),gf(s).map(o=>o*2)}return gf(s)}function Gl(e){return e%2===0}function Ec(e,t){if(e=e.slice(-2),t=t.slice(-2),Qt(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){const n=e.slice(-1)[0],s=t.slice(-1)[0];if(n===s||Gl(n)&&Gl(s)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Gl(e[0])&&Gl(t[0])}let jh,Xh;function xV(e){if(jh==null){const t=vs(e);jh=t.getParameter(t.MAX_TEXTURE_SIZE)}return jh}function bV(e){if(Xh==null){const t=vs(e);Xh=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Xh)}function vV(e){if(e===0)return 0;let t;const n=vs(e);return Hn(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:Hn(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function Hn(e,t){return e.getExtension(t)!=null}function Qx(e){try{if(vs(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function yV(e){if(e===0)return!1;const t=vs(e);if(e===1){if(!Hn(t,"OES_texture_float"))return!1}else if(!Hn(t,"EXT_color_buffer_float"))return!1;return nd(t)}function wV(e){if(e===0)return!1;const t=vs(e);if(e===1){if(!Hn(t,"OES_texture_float")||!Hn(t,"WEBGL_color_buffer_float"))return!1}else{if(Hn(t,"EXT_color_buffer_float"))return nd(t);const s="EXT_color_buffer_half_float";if(Hn(t,s)){const i=t.getExtension(s);return CV(t,i)}return!1}return nd(t)}function nd(e){const t=lm(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const s=1,i=1;e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,s,i,0,t.textureFormatFloat,t.textureTypeFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const u=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(a),u}function CV(e,t){const n=lm(e,t),s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const i=1,a=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,i,a,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const u=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(s),e.deleteFramebuffer(u),o}function SV(e){return e!==2?!1:vs(e).fenceSync!=null}function Il(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&P(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rt=dt();Rt.registerFlag("HAS_WEBGL",()=>Rt.getNumber("WEBGL_VERSION")>0);Rt.registerFlag("WEBGL_VERSION",()=>Qx(2)?2:Qx(1)?1:0);Rt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Rt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Rt.get("WEBGL_VERSION")===2);Rt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Rt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Rt.registerFlag("WEBGL_PACK",()=>Rt.getBool("HAS_WEBGL"));Rt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_CLIP",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_PACK_REDUCE",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_CONV_IM2COL",()=>Rt.getBool("WEBGL_PACK"));Rt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>xV(Rt.getNumber("WEBGL_VERSION")));Rt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>bV(Rt.getNumber("WEBGL_VERSION")));Rt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=Rt.getNumber("WEBGL_VERSION");return e===0?0:vV(e)});Rt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Rt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ev());Rt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>yV(Rt.getNumber("WEBGL_VERSION")));Rt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Rt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Rt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Rt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>wV(Rt.getNumber("WEBGL_VERSION")));Rt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>SV(Rt.getNumber("WEBGL_VERSION")));Rt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Rt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Rt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});Rt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ev()?1:-1,e=>{if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});Rt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Rt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Rt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Rt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(){let e,t,n,s,i,a,u,o,r,l;return dt().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",s="in",i="texture",a="outputColor",u="out vec4 outputColor;",o=`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,r="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",s="varying",i="texture2D",a="gl_FragColor",u="",o=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,r=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:s,texture2D:i,output:a,defineOutput:u,defineSpecialNaN:o,defineSpecialInf:r,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(e,t,n="index"){const s=Dt(t);return s.map((i,a)=>{const u=`int ${e[a]} = ${n} / ${i}`,o=a===s.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${i}`:`index -= ${e[a]} * ${i}`;return`${u}; ${o};`}).join("")}function xh(e,t,n="index"){const s=Dt(t);return s.map((i,a)=>{const u=`int ${e[a]} = ${n} / outShapeStrides[${a}]`,o=a===s.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * outShapeStrides[${a}]`:`index -= ${e[a]} * outShapeStrides[${a}]`;return`${u}; ${o};`}).join("")}function kV(e,t){const n=e.length,s=e.map(a=>`${t}[${a}]`),i=new Array(n-1);i[n-2]=s[n-1];for(let a=n-3;a>=0;--a)i[a]=`(${i[a+1]} * ${s[a+1]})`;return i}function IV(e,t,n="index"){const s=e.map((a,u)=>u),i=kV(s,t);return i.map((a,u)=>{const o=`int ${e[u]} = ${n} / ${i[u]}`,r=u===i.length-1?`int ${e[u+1]} = ${n} - ${e[u]} * ${i[u]}`:`index -= ${e[u]} * ${i[u]}`;return`${o}; ${r};`}).join("")}function cm(e){const t=Dt(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function um(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const sS=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:iS}=_A;function TV(e,t,n){const s=[];if(e.forEach(d=>{const p=pt(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?s.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${d.name};`),s.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:m}=hm(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${d.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${d.name}Shape;`);break}s.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{s.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const i=s.join(`
`),a=e.map(d=>_V(d,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),u=t.texShape,o=on(),r=NV(o);let l,h,c=RV(o);return t.isPacked?(l=$V(t.logicalShape,u,n.enableShapeUniforms),h=AV(o)):(l=EV(t.logicalShape,u,n.enableShapeUniforms),h=DV(o)),n.packedInputs&&(c+=MV),[c,r,h,i,l,a,n.userCode].join(`
`)}function Io(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return qV(e,t);case 1:return JV(e,t);case 2:return QV(e,t);case 3:return e4(e,t);case 4:return s4(e,t);case 5:return i4(e);case 6:return r4(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function rS(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return YV(e);case 1:return KV(e,t);case 2:return ZV(e,t);case 3:return t4(e,t);default:return n4(e,t)}}function _V(e,t,n=!1,s){let i="";n?i+=rS(e,s):i+=Io(e,s);const a=e.shapeInfo.logicalShape,u=t.logicalShape;return a.length<=u.length&&(n?i+=o4(e,t):i+=a4(e,t)),i}function $V(e,t,n){switch(e.length){case 0:return oS();case 1:return LV(e,t,n);case 2:return jV(e,t,n);case 3:return zV(e,t,n);default:return VV(e,t,n)}}function EV(e,t,n){switch(e.length){case 0:return oS();case 1:return BV(e,t,n);case 2:return XV(e,t,n);case 3:return WV(e,t,n);case 4:return UV(e,t,n);case 5:return GV(e,t);case 6:return HV(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function NV(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function DV(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function AV(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function RV(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${OV}
    ${FV}
    ${PV}
  `}const OV=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,FV=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,PV=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,MV=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function oS(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function LV(e,t,n){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function BV(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function zV(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),a=i*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function WV(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${xh(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;const s=Cr(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function VV(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),a=i*Math.ceil(e[e.length-2]/2);let u=a,o="",r="b, r, c";for(let l=2;l<e.length-1;l++)u*=e[e.length-l-1],o=`
      int b${l} = index / ${u};
      index -= b${l} * ${u};
    `+o,r=`b${l}, `+r;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${o}

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${e.length}(${r});
    }
  `}function UV(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${xh(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Cr(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function GV(e,t){const n=Cr(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function HV(e,t){const n=Cr(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function jV(e,t,n){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Qt(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function XV(e,t,n){return Qt(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function Sr(e){return`offset${e}`}function YV(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),s=on();return`
    vec4 ${n}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function qV(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[i,a]=e.shapeInfo.texShape;if(i===1&&a===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const u=Sr(n);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${u});
      return sampleTexture(${n}, uv);
    }
  `;const[o,r]=e.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${o}, ${r}, ${u});
      return sampleTexture(${n}, uv);
    }
  `}function KV(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=on();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${a.texture2D}(${n}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${u[0]}, ${u[1]}, index);
      return ${a.texture2D}(${n}, uv);
    }
  `}function JV(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${To(e)}
      }
    `;const i=e.shapeInfo.texShape,a=i[0],u=i[1];if(u===1&&a===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Sr(n);return u===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${a}.0);
        return sampleTexture(${n}, uv);
      }
    `:a===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${u}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${a}, ${u}, index + ${o});
      return sampleTexture(${n}, uv);
    }
  `}function ZV(e,t){const n=e.shapeInfo.logicalShape,s=e.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=e.shapeInfo.texShape,u=a[0],o=a[1],r=on();if(a!=null&&Qt(n,a))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${r.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${u}.0);

        return ${r.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${r.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],h=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${l[0]}, ${l[1]}, row, col);
      return ${r.texture2D}(${s}, uv);
    }
  `}function QV(e,t){const n=e.shapeInfo.logicalShape,s=e.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=e.shapeInfo.texShape;if(a!=null&&Qt(n,a)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=a[0],d=a[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:u,keptDims:o}=wi(n),r=u;if(r.length<n.length){const f=_o(e,r),d=["row","col"];return`
      ${Io(f,t)}
      float ${i}(int row, int col) {
        return ${i}(${$o(d,o)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${To(e)}
      }
    `;const l=a[0],h=a[1],c=Sr(s);return h===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${c}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${c}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${c};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${c};
    vec2 uv = uvFromFlat(${l}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function t4(e,t){const n=e.shapeInfo.logicalShape,s=e.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=e.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(n[0]===1){const f=n.slice(1),d=[1,2],p=_o(e,f),m=["b","row","col"];return`
        ${rS(p,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${$o(m,d)});
        }
      `}const o=on();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${o.texture2D}(${s}, uv);
    }
  `;const r=u[0],l=u[1],h=Math.ceil(n[2]/2),c=h*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${r}, ${l}, ${c}, ${h}, b, row, col);
      return ${o.texture2D}(${s}, uv);
    }
  `}function e4(e,t){const n=e.shapeInfo.logicalShape,s=e.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=n[1]*n[2],u=n[2],{newShape:o,keptDims:r}=wi(n),l=o;if(l.length<n.length){const m=_o(e,l),g=["row","col","depth"];return`
        ${Io(m,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${$o(g,r)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${a}, ${u}, 1)));
        ${To(e)}
      }
    `;const h=e.shapeInfo.texShape,c=h[0],f=h[1],d=e.shapeInfo.flatOffset;if(f===a&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${u}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${c}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===u&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=Sr(s);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * ${a} + col * ${u} + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${a} + col * ${u} + depth + ${p};
        vec2 uv = uvFromFlat(${c}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function n4(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=on();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const a=e.shapeInfo.logicalShape,u=a.length,o=e.shapeInfo.texShape,r=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=r[0],h=r[1],c=Math.ceil(a[u-1]/2);let f=c*Math.ceil(a[u-2]/2),d="int b, int row, int col",p=`b * ${f} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<u-1;m++)d=`int b${m}, `+d,f*=a[u-m-1],p=`b${m} * ${f} + `+p;return`
    vec4 ${s}(${d}) {
      int index = ${p};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${l});
      return ${i.texture2D}(${n}, uv);
    }
  `}function s4(e,t){const n=e.shapeInfo.logicalShape,s=e.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),a=n[3],u=n[2]*a,o=n[1]*u,{newShape:r,keptDims:l}=wi(n);if(r.length<n.length){const b=_o(e,r),y=["row","col","depth","depth2"];return`
      ${Io(b,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${$o(y,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${o}, ${u}, ${a}, 1)));
        ${To(e)}
      }
    `;const h=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,f=c[0],d=c[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(d===o&&h==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${u}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(d===a&&h==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const x=Sr(s);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${x});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${u} +
          depth * ${a} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${x});
      return sampleTexture(${s}, uv);
    }
  `}function i4(e){const t=e.shapeInfo.logicalShape,n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,u=t[2]*a,o=t[1]*u,{newShape:r,keptDims:l}=wi(t);if(r.length<t.length){const m=_o(e,r),g=["row","col","depth","depth2","depth3"];return`
      ${Io(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${$o(g,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${o}, ${u}, ${a}, ${i})) +
          depth3;
        ${To(e)}
      }
    `;const h=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,f=c[0],d=c[1];if(d===o&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${u}, ${a}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===i&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Sr(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${u} + depth * ${a} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function r4(e){const t=e.shapeInfo.logicalShape,n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:a}=wi(t);if(i.length<t.length){const g=_o(e,i),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${Io(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${$o(x,a)});
      }
    `}const u=t[5],o=t[4]*u,r=t[3]*o,l=t[2]*r,h=t[1]*l;if(e.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${l}, ${r}, ${o})) +
          dot(
            vec2(depth3, depth4),
            vec2(${u}, 1)));
        ${To(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],p=f[1];if(p===h&&c==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${r}, ${o}, ${u})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===u&&c==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Sr(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${l} + depth * ${r} +
          depth2 * ${o} + depth3 * ${u} + depth4 + ${m};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function To(e){const t=e.name,n=pt(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function o4(e,t){const n=e.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",a=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,o=iS(e.shapeInfo.logicalShape,t.logicalShape),r=ie(u),l=u-a;let h;const c=["x","y","z","w","u","v"];a===0?h="":u<2&&o.length>=1?h="coords = 0;":h=o.map(b=>`coords.${c[b+l]} = 0;`).join(`
`);let f="";u<2&&a>0?f="coords":f=e.shapeInfo.logicalShape.map((b,y)=>`coords.${c[y+l]}`).join(", ");let d="return outputValue;";const m=pt(e.shapeInfo.logicalShape)===1,x=pt(t.logicalShape)===1;if(a===1&&!m&&!x)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!x)u===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(o.length){const b=a-2,y=a-1;o.indexOf(b)>-1&&o.indexOf(y)>-1?d="return vec4(outputValue.x);":o.indexOf(b)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(y)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${r} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${f});
      ${d}
    }
  `}function a4(e,t){const n=e.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",a=t.texShape,u=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,r=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===r&&e.shapeInfo.flatOffset==null&&Qt(u,a))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=ie(r),h=iS(e.shapeInfo.logicalShape,t.logicalShape),c=r-o;let f;const d=["x","y","z","w","u","v"];o===0?f="":r<2&&h.length>=1?f="coords = 0;":f=h.map(m=>`coords.${d[m+c]} = 0;`).join(`
`);let p="";return r<2&&o>0?p="coords":p=e.shapeInfo.logicalShape.map((m,g)=>`coords.${d[g+c]}`).join(", "),`
    float ${i}() {
      ${l} coords = getOutputCoords();
      ${f}
      return get${s}(${p});
    }
  `}function ie(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function hm(e,t,n){const{newShape:s,keptDims:i}=wi(t),a=t.length,u=e&&a===3&&t[0]===1,o=u?t.slice(1):s,r=!e&&a>1&&!Qt(t,n)&&s.length<a||u;return{useSqueezeShape:r,uniformShape:r?o:t,keptDims:i}}function _o(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function $o(e,t){return t.map(n=>e[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l4(e,t,n,s){const i=n.map((h,c)=>{const f={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(f.flatOffset=h.texData.slice.flatOffset),{name:t.variableNames[c],shapeInfo:f}}),a=i.map(h=>h.shapeInfo),u={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},o=TV(i,u,t),r=eV(e.gl,o),l=e.createProgram(r);return dt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:r,source:o,webGLProgram:l,inShapeInfos:a,outShapeInfo:u,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:r,source:o,webGLProgram:l,inShapeInfos:a,outShapeInfo:u},aS(e,t,l))}function aS(e,t,n){const s={},i={},a={},u=[];let o,r,l,h=null,c=null;c=e.getUniformLocation(n,"NAN",!1),dt().getNumber("WEBGL_VERSION")===1&&(h=e.getUniformLocation(n,"INFINITY",!1));const f=!1;for(let d=0;d<t.variableNames.length;d++){const p=t.variableNames[d];s[p]=e.getUniformLocation(n,p,f),s[`offset${p}`]=e.getUniformLocation(n,`offset${p}`,f),t.enableShapeUniforms&&(i[`${p}Shape`]=e.getUniformLocation(n,`${p}Shape`,f),a[`${p}TexShape`]=e.getUniformLocation(n,`${p}TexShape`,f))}return t.enableShapeUniforms&&(o=e.getUniformLocation(n,"outShape",f),l=e.getUniformLocation(n,"outShapeStrides",f),r=e.getUniformLocation(n,"outTexShape",f)),t.customUniforms&&t.customUniforms.forEach((d,p)=>{u[p]=e.getUniformLocation(n,d.name,f)}),{uniformLocations:s,customUniformLocations:u,infLoc:h,nanLoc:c,inShapesLocations:i,inTexShapesLocations:a,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:r}}function t0(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,s)=>{const i=n.logicalShape,a=t[s],u=a.shape;if(!Qt(i,u))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${u} must match`);if(n.isUniform&&a.isUniform)return;const o=n.texShape,r=a.isUniform?null:a.texData.texShape;if(!Qt(o,r))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${r} must match`)})}function c4(e,t,n,s,i){t.program.enableShapeUniforms||(t0(t.inShapeInfos,n),t0([t.outShapeInfo],[s]));const a=s.texData.texture,u=s.texData.texShape;s.texData.isPacked?e.setOutputPackedMatrixTexture(a.texture,u[0],u[1]):e.setOutputMatrixTexture(a.texture,u[0],u[1]),e.setProgram(t.webGLProgram),dt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((r,l)=>{const h=t.program.variableNames[l],c=t.uniformLocations[h],f=t.uniformLocations[`offset${h}`],d=t.inShapesLocations[`${h}Shape`],p=t.inTexShapesLocations[`${h}TexShape`];if(d){const{uniformShape:m}=hm(t.program.packedInputs,r.shape,r.texData.texShape);switch(m.length){case 1:e.gl.uniform1iv(d,new Int32Array(m));break;case 2:e.gl.uniform2iv(d,new Int32Array(m));break;case 3:e.gl.uniform3iv(d,new Int32Array(m));break;case 4:e.gl.uniform4iv(d,new Int32Array(m));break}}if(p&&e.gl.uniform2i(p,r.texData.texShape[0],r.texData.texShape[1]),c!=null){if(r.isUniform){if(pt(r.shape)<2)e.gl.uniform1f(c,r.uniformValues[0]);else{let m=r.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),e.gl.uniform1fv(c,m)}return}r.texData.slice!=null&&f!=null&&e.gl.uniform1i(f,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,c,l)}});const o=t.outShapeLocation;if(o)switch(s.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(s.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(s.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(s.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const r=Dt(s.shape);switch(s.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(r));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(r));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(r));break}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&i&&t.program.customUniforms.forEach((r,l)=>{const h=t.customUniformLocations[l],c=i[l];if(r.type==="float")e.gl.uniform1fv(h,c);else if(r.type==="vec2")e.gl.uniform2fv(h,c);else if(r.type==="vec3")e.gl.uniform3fv(h,c);else if(r.type==="vec4")e.gl.uniform4fv(h,c);else if(r.type==="int")e.gl.uniform1iv(h,c);else if(r.type==="ivec2")e.gl.uniform2iv(h,c);else if(r.type==="ivec3")e.gl.uniform3iv(h,c);else if(r.type==="ivec4")e.gl.uniform4iv(h,c);else throw Error(`uniform type ${r.type} is not supported yet.`)}),e.executeProgram()}function u4(e,t,n){let s="";t.concat(n).forEach(u=>{const o=u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!u.isUniform){const r=u.texData.texShape,{useSqueezeShape:l,uniformShape:h,keptDims:c}=hm(e.packedInputs,u.shape,r);let f="",d="",p="";if(h.length===1&&e.packedInputs){const w=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];f=`${w[0]>1}_${w[1]>1}`}else if(h.length===2&&!e.packedInputs)d=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!e.packedInputs){const w=Dt(h);p=`${w[0]===r[1]}_${w[w.length-1]===r[1]}`}const m=u.shape.length,g=h.length===2&&Qt(u.shape,r),x=pt(u.shape)===1,b=to(u.shape,n.shape),y=!e.packedInputs&&m===n.shape.length&&Qt(r,n.texData.texShape),v=e.packedInputs||h.length>2?"":`${r[0]>1}_${r[1]>1}`;s+=`${m}_${y}_${l?c:""}_${h.length}_${x}_${b}_${g}_${f}_${d}_${p}_${v}_${o}`}else{const r=u.isUniform?"uniform":u.texData.texShape;s+=`${u.shape}_${r}_${o}`}});const i=e.userCode;let a=e.constructor.name;return a+="_"+s+"_"+i+`${dt().getNumber("WEBGL_VERSION")}`,a}function mn(e){return dt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h4{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=sa.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=on();this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xh(["r","c","d"],t):Cr(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f4{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=sa.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=on();this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xh(["r","c","d"],t):Cr(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d4{constructor(t){this.variableNames=["A"],this.outTexUsage=Dn.DOWNLOAD;const n=on();this.outputShape=t,this.userCode=`
      ${sS}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p4{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Dn.DOWNLOAD;const n=on();this.outputShape=t,this.userCode=`
      ${sS}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g4{constructor(t,n=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=on();this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?um():cm(t)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${s.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m4{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=on();this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length);let i="",a="result";n&&(a="floor(result * 255. + 0.5)");for(let u=0;u<=1;u++)for(let o=0;o<=1;o++){const r=u*2+o;i+=`
          localCoords = coords;
          if(localCoords[2] + ${o} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${o};
          if (localCoords[1] + ${u} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${u};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${r}] = values[0];
            } else if (offset == 1) {
              result[${r}] = values[1];
            } else if (offset == 2) {
              result[${r}] = values[2];
            } else {
              result[${r}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?um():cm(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${a};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4(e){const t=on(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return tV(e,n)}function b4(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return rV(e,t)}function v4(e){const t=new Uint16Array([0,1,2,2,1,3]);return oV(e,t)}function Tl(e,t,n,s,i,a){lV(t,n);const u=aV(e),o=e.TEXTURE_2D;return $t(e,()=>e.bindTexture(o,u)),$t(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),$t(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),$t(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),$t(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),dt().getNumber("WEBGL_VERSION")===1?$t(e,()=>e.texImage2D(o,0,s,t,n,0,i,a,null)):$t(e,()=>e.texStorage2D(o,1,s,t,n)),$t(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:u,texShape:[n,t]}}function lS(e){return e.internalFormatFloat}function y4(e,t,n,s){const[i,a]=kl(t,n);return Tl(e,i,a,lS(s),s.textureFormatFloat,e.FLOAT)}function cS(e){return e.internalFormatHalfFloat}function w4(e,t,n,s){const[i,a]=kl(t,n);return Tl(e,i,a,cS(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function uS(e){return e.downloadTextureFormat}function C4(e,t,n,s){const[i,a]=kl(t,n);return Tl(e,i,a,uS(s),e.RGBA,e.UNSIGNED_BYTE)}function hS(e){return e.internalFormatPackedFloat}function S4(e,t,n,s){const[i,a]=ko(t,n);return Tl(e,i,a,hS(s),e.RGBA,e.FLOAT)}function fS(e){return e.internalFormatPackedHalfFloat}function k4(e,t,n,s){const[i,a]=ko(t,n);return Tl(e,i,a,fS(s),e.RGBA,s.textureTypeHalfFloat)}function I4(e,t,n){return $t(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),Jx(e,t,"clipSpacePos",n,3,20,0)&&Jx(e,t,"uv",n,2,20,12)}function T4(e,t,n,s,i,a){$t(e,()=>e.bindTexture(e.TEXTURE_2D,t));let u,o,r;i instanceof Uint8Array?(u=new Uint8Array(n*s*4),o=e.UNSIGNED_BYTE,r=e.RGBA):(u=new Float32Array(n*s*4),o=e.FLOAT,r=a.internalFormatPackedFloat),u.set(i),dt().getNumber("WEBGL_VERSION")===2?$t(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,s,e.RGBA,o,u)):$t(e,()=>e.texImage2D(e.TEXTURE_2D,0,r,n,s,0,e.RGBA,o,u)),$t(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function _4(e,t,n){$t(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?dt().getNumber("WEBGL_VERSION")===2?$t(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):$t(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):dt().getNumber("WEBGL_VERSION")===2?$t(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):$t(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),$t(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function $4(e,t,n,s){const i=e.createBuffer();$t(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const o=4*4*t*n;return $t(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)),$t(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),$t(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}function E4(e,t,n){const s=e,i=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function N4(e,t,n,s){const[i,a]=kl(t,n),u=4,o=new Uint8Array(XW(t*n,u));return $t(e,()=>e.readPixels(0,0,i,a,s.downloadTextureFormat,e.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}function D4(e,t,n,s,i,a,u,o){const r=e,l=new Float32Array(YW(a,u));return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,l),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),l}function A4(e,t,n){const s=new Float32Array(t*n*4);return $t(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yh{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const n=dt().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,GW(n,t)):this.gl=vs(n);let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),dt().getNumber("WEBGL_VERSION")===1){const a="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=Vl(this.gl,a),Hn(this.gl,u))this.textureHalfFloatExtension=Vl(this.gl,u);else if(dt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Hn(this.gl,i))this.colorBufferHalfFloatExtension=Vl(this.gl,i);else if(dt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Hn(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Hn(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=b4(this.gl),this.indexBuffer=v4(this.gl),this.framebuffer=cV(this.gl),this.textureConfig=lm(this.gl,this.textureHalfFloatExtension)}get debug(){return dt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;$t(t,()=>t.finish()),$t(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),$t(t,()=>t.deleteFramebuffer(this.framebuffer)),$t(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),$t(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),$t(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),y4(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),w4(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),C4(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),_4(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,s,i){this.throwIfDisposed(),T4(this.gl,t,n,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),k4(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),S4(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(Zx(this.gl,this.framebuffer),this.outputTexture=null),$t(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,s){return this.downloadMatrixDriver(t,()=>N4(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,s,i,a,u){return D4(this.gl,t,n,s,i,a,u,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return E4(this.gl,t,n)}createBufferFromTexture(t,n,s){this.bindTextureToFrameBuffer(t);const i=$4(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,s;if(dt().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const u=i.clientWaitSync(a,0,0);return u===i.ALREADY_SIGNALED||u===i.CONDITION_SATISFIED},n=a}else dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(t,n,s){return this.downloadMatrixDriver(t,()=>A4(this.gl,n,s))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=x4(n));const s=sV(n);return $t(n,()=>n.attachShader(s,this.vertexShader)),$t(n,()=>n.attachShader(s,t)),iV(n,s),this.debug&&Uh(n,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=I4(n,this.program,this.vertexBuffer)),s}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&$t(this.gl,()=>this.gl.deleteProgram(t))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Uh(this.gl,this.program),$t(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,s=!0){return this.throwIfDisposed(),s?hV(this.gl,t,n):fV(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),$t(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),dV(this.gl,t,n,s)}setOutputMatrixTexture(t,n,s){this.setOutputMatrixTextureDriver(t,s,n)}setOutputPackedMatrixTexture(t,n,s){this.throwIfDisposed();const[i,a]=ko(n,s);this.setOutputMatrixTextureDriver(t,i,a)}setOutputMatrixWriteRegion(t,n,s,i){this.setOutputMatrixWriteRegionDriver(s,t,i,n)}setOutputPackedMatrixWriteRegion(t,n,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Uh(this.gl,this.program),Ul(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),$t(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),$t(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Vl(this.gl,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,a),a}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await jm(()=>this.disposed||this.isQueryAvailable(t,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=R4(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),!(this.itemsToPoll.length>1)&&jm(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),Gh(this.gl,t,this.framebuffer),this.debug&&Ul(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Gh(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ul(this.gl)):Zx(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,n,s){this.throwIfDisposed();const i=this.gl;Gh(i,t,this.framebuffer),this.debug&&Ul(i),this.outputTexture=t,$t(i,()=>i.viewport(0,0,n,s)),$t(i,()=>i.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(t,n,s,i){this.throwIfDisposed(),$t(this.gl,()=>this.gl.scissor(t,n,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function R4(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:O4,bincountImpl:dS,bincountReduceImpl:F4,ceilImpl:P4,concatImpl:M4,equalImpl:L4,expImpl:B4,expm1Impl:z4,floorImpl:W4,gatherNdImpl:V4,gatherV2Impl:U4,greaterImpl:G4,greaterEqualImpl:H4,lessImpl:j4,lessEqualImpl:X4,linSpaceImpl:Y4,logImpl:q4,maxImpl:K4,maximumImpl:J4,minimumImpl:Z4,multiplyImpl:Q4,negImpl:tU,notEqualImpl:eU,prodImpl:nU,rangeImpl:sU,rsqrtImpl:iU,scatterImpl:rU,sigmoidImpl:oU,simpleAbsImpl:pS,sliceImpl:aU,sparseFillEmptyRowsImpl:lU,sparseReshapeImpl:cU,sparseSegmentReductionImpl:gS,sqrtImpl:uU,stridedSliceImpl:hU,stringNGramsImpl:fU,stringSplitImpl:dU,stringToHashBucketFastImpl:pU,subImpl:gU,tileImpl:mU,topKImpl:xU,transposeImpl:fm,uniqueImpl:bU}=_M;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mS(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function en(e,t){return t===1?[e]:mS(e,t)}function vU(e,t){if(e===1)return"rc";let n="";for(let s=0;s<e;s++)n+=t[s],s<e-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yU{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=mn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=en("rc",this.rank),s=ie(this.rank),i=this.getOutOfBoundsCondition(n),a=this.getSetup(n),u=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${u}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let a=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let u=2;u<this.rank;u++)a=`${t[t.length-1-u]},`+a;n.push(a)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xS{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length);let s="";for(let i=0;i<4;i++){let a="thisRC = rc;";i%2===1&&(a+="thisRC.z += 1;"),i>1&&(a+="thisRC.y += 1;"),s+=`
        ${a}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${wU(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?um():cm(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function wU(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?IV(["r","c","d"],"inputShape"):Cr(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CU{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,n,s){const i=n0(n,s),a=s0(t,i,s);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const u=e0(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=u,this.log();const r=this.freeTextures[a].shift();return this.usedTextures[a].push(r),r}let o;return i===Ue.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Ue.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Ue.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Ue.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Ue.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=u,this.log(),o}releaseTexture(t,n,s,i){if(this.freeTextures==null)return;const a=n0(s,i),u=s0(n,a,i);u in this.freeTextures||(this.freeTextures[u]=[]);const o=e0(n,a,this.gpgpu.gl,this.gpgpu.textureConfig,i),r=dt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");r!==-1&&this._numBytesAllocated>r?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=o):(this.freeTextures[u].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[u],h=l.indexOf(t);if(h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(h,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function SU(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function e0(e,t,n,s,i){const a=kU(t,s);let u;if(i){const[r,l]=ko(e[0],e[1]);u=r*l}else{const[r,l]=kl(e[0],e[1]);u=r*l}const o=SU(n,a);return u*o}function kU(e,t){switch(e){case Ue.PACKED_2X2_FLOAT32:return hS(t);case Ue.PACKED_2X2_FLOAT16:return fS(t);case Ue.UNPACKED_FLOAT32:return lS(t);case Ue.UNPACKED_FLOAT16:return cS(t);case Ue.PACKED_4X1_UNSIGNED_BYTE:return uS(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function IU(e){return dt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Ue.PACKED_2X2_FLOAT32:Ue.UNPACKED_FLOAT32:e?Ue.PACKED_2X2_FLOAT16:Ue.UNPACKED_FLOAT16}function n0(e,t){if(e===Dn.UPLOAD)return Ue.PACKED_2X2_FLOAT32;if(e===Dn.RENDER||e==null)return IU(t);if(e===Dn.DOWNLOAD||e===Dn.PIXELS)return Ue.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function s0(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gs{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const es="if (isnan(x)) return x;",TU="return x;",i0="return abs(x);",_U="return (x >= 0.0) ? x : (exp(x) - 1.0);",$U=es+`
  return (x < 0.0) ? 0.0 : x;
`,EU=es+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,$r="return x;",NU="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU="return x;",AU=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,RU=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,OU=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FU="return 1.0 / (1.0 + exp(-1.0 * x));";class qi{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PU{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length);const n=t.length,s=en("rc",n),i=ie(n),a=vU(n,s),u=s.slice(-2),o=n<=1?"rc":`vec2(${u.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${o}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU=oy,LU=1e-7,BU=1e-4,Hl={};function zU(e){return e in Hl||(Hl[e]={}),Hl[e]}const WU=dt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),VU=600;function UU(){return dt().global.screen==null?1024:dt().global.screen.height*dt().global.screen.width*window.devicePixelRatio*VU/1024/1024}class bh extends Id{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!dt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof Yh)n=t;else{const s=vs(dt().getNumber("WEBGL_VERSION"),t);n=new Yh(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=vs(dt().getNumber("WEBGL_VERSION"));n=new Yh(s),this.binaryCache=zU(dt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new CU(this.gpgpu),this.numMBBeforeWarning=UU(),this.texData=new wb(this,_s())}nextDataId(){return bh.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,n,s){if((dt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||dt().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:s,values:t,usage:Dn.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,s,i,a){if(dt().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:i,values:n,usage:Dn.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:s,dtype:i,complexTensorInfos:a,slice:u,shape:o,isPacked:r}=n;if(u!=null){let f;r?f=new qi(o,$r):f=new Gs(o,$r);const d=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(s!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return s;const l=this.activeTimers!=null;let h;l&&(h=cn());let c;if(i==="complex64"){const f=this.readSync(a.real.dataId),d=this.readSync(a.imag.dataId);c=Ys(f,d)}else c=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=cn()-h),this.convertAndCacheOnCPU(t,c)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(m=>p.push(m))}const n=this.texData.get(t),{values:s,shape:i,slice:a,dtype:u,complexTensorInfos:o,isPacked:r}=n;if(a!=null){let p;r?p=new qi(i,$r):p=new Gs(i,$r);const m=this.runWebGLProgram(p,[{dataId:t,shape:i,dtype:u}],u),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(t);if(dt().getBool("DEBUG")&&!dt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&dt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,h;if(u!=="complex64"&&dt().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(t);const p=this.texData.get(h.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,...Wl(i))}this.pendingRead.set(t,[]),u!=="complex64"&&await this.gpgpu.createAndWaitForFence();let c;if(u==="complex64"){const p=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]),m=p[0],g=p[1];c=Ys(m,g)}else if(l==null)c=this.getValuesFromTexture(t);else{const p=pt(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(h!=null&&this.disposeIntermediateTensorInfo(h),l!=null){const p=this.gpgpu.gl;$t(p,()=>p.deleteBuffer(l))}const f=this.convertAndCacheOnCPU(t,c),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(f)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&_s().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,n={}){const s=this.texData.get(t),{values:i,shape:a,slice:u,dtype:o,isPacked:r,texture:l}=s;if(o==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(u!=null){let d;r?d=new qi(a,$r):d=new Gs(a,$r);const p=this.runWebGLProgram(d,[{dataId:t,shape:a,dtype:o}],o),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(t,n.customTexShape),c=_s().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:c},f.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const s=n.map(i=>gi(i));return Vt(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Vt(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const s=t[n];if(!ZW(s))throw dt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:s,isPacked:i}=this.texData.get(t),a=pt(n);if(dt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(t),d=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...Wl(n)).subarray(0,a);return this.disposeIntermediateTensorInfo(f),p}const u=dt().getBool("WEBGL_PACK")&&i===!0,o=u?Hh(n):n,r=u?new p4(o):new d4(o),l=this.runWebGLProgram(r,[{shape:o,dtype:s,dataId:t}],"float32"),h=this.texData.get(l.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),c}timerAvailable(){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,t();const a=qr(this.activeTimers.map(r=>r.query)).filter(r=>r!=null),u=qr(this.activeTimers.map(r=>r.name)).filter(r=>r!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const r=await Promise.all(a);o.kernelMs=AT(r),o.getExtraProfileInfo=()=>r.map((l,h)=>({name:u[h],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:cn(),endMs:null}}endTimer(t){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=cn(),t)}async getQueryTime(t){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:s,texShape:i,usage:a,isPacked:u,slice:o}=this.texData.get(t),r=o&&o.origDataId||t,l=this.dataRefCount.get(r);l>1?this.dataRefCount.set(r,l-1):(this.dataRefCount.delete(r),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(n,i,a,u)));const h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=WU){return dt().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&pt(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){Nn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return MU(t.shape,n)}packedUnaryOp(t,n,s){const i=new qi(t.shape,n),a=this.compileAndRun(i,[t],s);return _s().makeTensorFromTensorInfo(a)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const i=pS(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,i)}if(dt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,i0,t.dtype);const n=new Gs(t.shape,i0),s=this.compileAndRun(n,[t]);return _s().makeTensorFromTensorInfo(s)}makeTensorInfo(t,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&aa(s[0])){const a=s.map(u=>ui(u));i=this.write(a,t,n)}else i=this.write(s,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}}makeOutput(t,n,s){return _s().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,s),this)}unpackTensor(t){const n=new PU(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new yU(t.shape),s=!0;return this.runWebGLProgram(n,[t],t.dtype,null,s)}packedReshape(t,n){const s=[lo(t.shape),...co(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},a=[lo(n),...co(n)],u=new xS(a,s),o=!0,r=[s],l=this.runWebGLProgram(u,[i],t.dtype,r,o);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(t,n){const s=this.texData.get(t),{isPacked:i,shape:a,dtype:u}=s;if(n!=null){const f=pt(a),d=n[0]*n[1]*4;P(f<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const o=Hh(a);let r;i?r=new f4(o):r=new h4(o);const l=!0,h=[n!=null?n:Wl(o)],c=this.runWebGLProgram(r,[{shape:o,dtype:u,dataId:t}],u,h,l,n);return{dtype:u,shape:a,dataId:c.dataId}}runWebGLProgram(t,n,s,i,a=!1,u){const o=this.makeTensorInfo(t.outputShape,s),r=this.texData.get(o.dataId);if(t.packedOutput&&(r.isPacked=!0),t.outPackingScheme===sa.DENSE){const x=u!=null?u:Wl(t.outputShape);r.texShape=x.map(b=>b*2)}if(t.outTexUsage!=null&&(r.usage=t.outTexUsage),pt(o.shape)===0)return r.values=He(o.dtype,0),o;const l=[],h=n.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&pt(x.shape)<=dt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!b.isPacked!=!!t.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),l.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!Ec(b.shape,x.shape)){const y=x,v=x.shape;x.shape=b.shape,x=this.packedReshape(x,v),l.push(x),b=this.texData.get(x.dataId),y.shape=v}return{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(o.dataId);const c={shape:o.shape,texData:r,isUniform:!1},f=u4(t,h,c),d=this.getAndSaveBinary(f,()=>l4(this.gpgpu,t,h,c)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),dt().get("ENGINE_COMPILE_ONLY")||c4(this.gpgpu,d,h,c,i),l.forEach(x=>this.disposeIntermediateTensorInfo(x)),p&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)}));const g=dt().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const x=cn();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!dt().getBool("WEBGL_LAZILY_UNPACK")&&r.isPacked&&a===!1){const x=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),x}return o}compileAndRun(t,n,s,i,a=!1){return s=s||n[0].dtype,this.runWebGLProgram(t,n,s,i,a)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(dt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement!="undefined"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=lt(()=>{if(!dt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=dt().getBool("DEBUG");dt().set("DEBUG",!1);const n=this.abs(Pt(1e-8)).dataSync()[0];if(dt().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?LU:BU}uploadToGPU(t){const n=this.texData.get(t),{shape:s,dtype:i,values:a,texture:u,usage:o,isPacked:r}=n;if(u!=null)return;const l=this.activeTimers!=null;let h;l&&(h=cn());let c=n.texShape;if(c==null&&(c=mV(s,r),n.texShape=c),a!=null){const f=Hh(s);let d,p=c[1],m=c[0];const g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(r||!g)&&([p,m]=ko(c[0],c[1])),r?d=new m4(f,g):d=new g4(f,g);const x=g?[m,p]:c,b=this.makeTensorInfo(x,i),y=this.texData.get(b.dataId);g?y.usage=Dn.PIXELS:y.usage=Dn.UPLOAD,y.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,m,a);const v=[[m,p]],w=!0,C=this.runWebGLProgram(d,[b],i,v,w),S=this.texData.get(C.dataId);n.texShape=S.texShape,n.isPacked=S.isPacked,n.usage=S.usage,dt().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=S.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=cn()-h)}else{const f=this.acquireTexture(c,o,i,r);n.texture=f}}convertAndCacheOnCPU(t,n){const s=this.texData.get(t),{dtype:i}=s;return this.releaseGPUData(t),n!=null&&(s.values=GU(n,i)),s.values}acquireTexture(t,n,s,i){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${a} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,i)}computeBytes(t,n){return t[0]*t[1]*mf(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(a){throw a}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await uy(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(nS(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:n,customUniformLocations:s,infLoc:i,nanLoc:a,inShapesLocations:u,inTexShapesLocations:o,outShapeLocation:r,outShapeStridesLocation:l,outTexShapeLocation:h}=aS(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=n,t.customUniformLocations=s,t.infLoc=i,t.nanLoc=a,t.inShapesLocations=u,t.inTexShapesLocations=o,t.outShapeLocation=r,t.outShapeStridesLocation=l,t.outTexShapeLocation=h}}}bh.nextDataId=0;function GU(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let s=0;s<n.length;++s)n[s]=Math.round(e[s]);return n}else throw new Error(`Unknown dtype ${t}`)}/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nv()&&gv("webgl",()=>new bh,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bS=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class uo{constructor(t,n,s){this.variableNames=["A","B"],this.outputShape=Bt(n,s),this.enableShapeUniforms=mn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vh=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;class _l{constructor(t,n,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Bt(n,s);const a=this.outputShape.length;this.enableShapeUniforms=mn(a);let u="";if(i)if(a===0||pt(this.outputShape)===1)u=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(u=`
          ${ie(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?u+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:u+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const r=en("coords",a);this.enableShapeUniforms?u+=`
            bool nextRowOutOfBounds =
              (${r[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${r[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:u+=`
            bool nextRowOutOfBounds =
              (${r[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${r[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${u}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn(e){const{inputs:t,backend:n}=e,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const HU={kernelName:Na,backendName:"webgl",kernelFunc:Tn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(e){const{inputs:t,backend:n}=e,{real:s,imag:i}=t,a=n.makeTensorInfo(s.shape,"complex64"),u=n.texData.get(a.dataId),o=Tn({inputs:{x:s},backend:n}),r=Tn({inputs:{x:i},backend:n});return u.complexTensorInfos={real:o,imag:r},a}const jU={kernelName:Fd,backendName:"webgl",kernelFunc:Ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vS="return (a < 0.) ? b * a : a;",yS=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function XU(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{alpha:a}=s,u=n.makeTensorInfo([],"float32",Ci(a,"float32")),o=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _l(yS,i.shape,u.shape):new uo(vS,i.shape,u.shape),r=n.runWebGLProgram(o,[i,u],"float32");return n.disposeIntermediateTensorInfo(u),r}const YU={kernelName:hu,backendName:"webgl",kernelFunc:XU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wS="return (a < 0.) ? b * a : a;",CS=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function qU(e){const{inputs:t,backend:n}=e,{x:s,alpha:i}=t,a=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _l(CS,s.shape,i.shape):new uo(wS,s.shape,i.shape);return n.runWebGLProgram(a,[s,i],"float32")}const KU={kernelName:Nu,backendName:"webgl",kernelFunc:qU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eo="if (isnan(x)) return x;",JU=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,ZU=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function Kt({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:s}){return({inputs:i,backend:a})=>{const{x:u}=i,o=a,r=s||u.dtype;if(o.shouldExecuteOnCPU([u])&&n!=null){const c=o.texData.get(u.dataId),f=n(c.values,r);return o.makeTensorInfo(u.shape,r,f)}const l=dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let h;return l?h=new qi(u.shape,t):h=new Gs(u.shape,e),o.runWebGLProgram(h,[u],r)}}function qe({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:a}){return({inputs:u,backend:o})=>{const{a:r,b:l}=u,h=o;if(s&&r.dtype==="complex64"){const p=h.texData.get(r.dataId),m=h.texData.get(l.dataId),[g,x]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(y=>{const[v,w]=y,C={dataId:v.dataId,dtype:v.dtype,shape:r.shape},S={dataId:w.dataId,dtype:w.dtype,shape:l.shape},k=new uo(e,r.shape,l.shape);return h.runWebGLProgram(k,[C,S],Cn(v.dtype,w.dtype))}),b=Ni({inputs:{real:g,imag:x},backend:h});return h.disposeIntermediateTensorInfo(g),h.disposeIntermediateTensorInfo(x),b}const c=a||Cn(r.dtype,l.dtype);if((r.dtype==="string"||l.dtype==="string"||h.shouldExecuteOnCPU([r,l]))&&i!=null){const p=h.texData.get(r.dataId).values,m=h.texData.get(l.dataId).values,g=r.dtype==="string"?fr(p):p,x=r.dtype==="string"?fr(m):m,[b,y]=i(r.shape,l.shape,g,x,c),v=h.makeTensorInfo(y,c),w=h.texData.get(v.dataId);return w.values=b,v}const f=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let d;return f?d=new _l(t,r.shape,l.shape,n):d=new uo(e,r.shape,l.shape),h.runWebGLProgram(d,[r,l],c)}}function yh(e,t=!1){if(e==="linear")return t?DU:TU;if(e==="relu")return t?RU:$U;if(e==="elu")return t?AU:_U;if(e==="relu6")return t?OU:EU;if(e==="prelu")return t?CS:wS;if(e==="leakyrelu")return t?yS:vS;if(e==="sigmoid")return t?FU:NU;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SS{constructor(t,n,s,i=!1,a=!1,u=!1,o=null,r=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=mn(this.outputShape.length);const h=i?t[1]:t[2],c=Math.ceil(h/2),f=i?"i * 2, rc.y":"rc.y, i * 2",d=a?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",x="";o&&(r?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${o}
        }`:l?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${o}
        }`:g=`vec4 activation(vec4 x) {
          ${o}
        }`,x="result = activation(result);");const b=u?"result += getBiasAtOutCoords();":"";u&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let y="rc.x",v="rc.x";t[0]<n[0]?y=`int(min(float(rc.x), ${t[0]-1}.))`:n[0]<t[0]&&(v=`int(min(float(rc.x), ${n[0]-1}.))`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${c}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${c}; i++) {
          int batchA = ${y};
          int batchB = ${v};
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class o0{constructor(t,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Bt(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a0="return a * b;";function dm(e){const{inputs:t,backend:n}=e,{a:s,b:i}=t,a=Cn(s.dtype,i.dtype);if(s.dtype==="complex64"){const o=n.texData.get(s.dataId),r=n.texData.get(i.dataId),l=new o0(r0.REAL,s.shape,i.shape),h=new o0(r0.IMAG,s.shape,i.shape),c=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:s.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:i.shape},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:i.shape}],f=n.runWebGLProgram(l,c,"float32"),d=n.runWebGLProgram(h,c,"float32"),p=Ni({inputs:{real:f,imag:d},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([s,i])){const o=n.texData.get(s.dataId),r=n.texData.get(i.dataId),[l,h]=Q4(s.shape,i.shape,o.values,r.values,a),c=n.makeTensorInfo(h,a),f=n.texData.get(c.dataId);return f.values=l,c}let u;return dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?u=new _l(a0,s.shape,i.shape):u=new uo(a0,s.shape,i.shape),n.runWebGLProgram(u,[s,i],a)}const QU={kernelName:Ba,backendName:"webgl",kernelFunc:dm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(e,t,n){const s=[lo(e.shape),...co(e.shape)],i={dtype:e.dtype,shape:s,dataId:e.dataId},a=[lo(t),...co(t)],u=new xS(a,s),o=!0,r=[s],l=n.runWebGLProgram(u,[i],e.dtype,r,o);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kt(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{shape:a}=s,u=n,o=pt(i.shape),r=Sb(a,o),l=pt(r);P(o===l,()=>`The new shape (${r}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`);const h=u.texData.get(i.dataId);return h.isPacked&&!Ec(i.shape,r)&&!(h.texture!==null&&Ec(h.shape,r))?tG(i,r,u):(u.incRef(i.dataId),{dataId:i.dataId,shape:r,dtype:i.dtype})}const eG={kernelName:Au,backendName:"webgl",kernelFunc:kt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l0{constructor(t,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:a,outSize:u}=t;this.outputShape=[i,u];const o=Math.floor(s/4)*4,r=s%4;let l="sumValue += dot(values, ones);";if(n!=null){const c=1/n;l=`sumValue += dot(values * ${Kr(c)?c.toPrecision(2):c}, ones);`}let h="";a%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${o}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${o};
        if (${r===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${r===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${r===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nG{constructor(t,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:a,outSize:u}=t;this.outputShape=[i,u];let o="0.0",r="";n==="prod"?o="1.0":n==="min"?(o="1.0 / 1e-20",r="min"):n==="max"&&(o="-1.0 / 1e-20",r="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const h=Math.floor(s/4)*4,c=s%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${r}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${r}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(o="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(o="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";a%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${o};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${o});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${c===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${c===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${c===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(e){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:e[1],s=eh(n);t.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return t}function kr(e,t,n,s){const i=sG(e.shape);let a=e;for(let u=0;u<i.length;u++){const{inSize:o,windowSize:r,outSize:l}=i[u];let h,c;n==="mean"?h=u===0?new l0({windowSize:r,inSize:o,batchSize:e.shape[0],outSize:l},o):new l0({windowSize:r,inSize:o,batchSize:e.shape[0],outSize:l}):h=new nG({windowSize:r,inSize:o,batchSize:e.shape[0],outSize:l},n),c=a,a=s.runWebGLProgram(h,[a],t),c.dataId!==e.dataId&&s.disposeIntermediateTensorInfo(c)}return a}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iG{constructor(t,n){this.variableNames=["A"];const s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[n[u]];this.outputShape=s,this.rank=s.length;const i=ie(this.rank),a=rG(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}}function rG(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let i=0;i<e.length;i++)s[e[i]]=n[i];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oG{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let h=0;h<s.length;h++)s[h]=t[n[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=ie(this.rank),a=mS("rc",this.rank),u=new Array(this.rank);for(let h=0;h<n.length;h++)u[n[h]]=a[h];const o=`vec2(${u.slice(-2).join()})`,r=`++${a[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${u.join()}), ${o})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${r}) {
        result[1] = ${l};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${r}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wh(e,t,n){const s=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oG(e.shape,t):new iG(e.shape,t);return n.runWebGLProgram(s,[e],e.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aG(e,t,n,s){const i=t,a=e.shape.length,u=Ut(i,e.shape);let o=u;const r=be(o,a),l=r!=null;let h=e;l&&(h=wh(e,r,s),o=ke(o.length,a)),Ye("sum",o,a);const[c,f]=We(h.shape,o);let d=c;n&&(d=Se(c,u));const p=pt(f),g=pt(e.shape)/p,x=kt({inputs:{x:h},attrs:{shape:[g,p]},backend:s}),b=yp(e.dtype),y=kr(x,b,"sum",s),v=kt({inputs:{x:y},attrs:{shape:d},backend:s});return s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(y),l&&s.disposeIntermediateTensorInfo(h),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ch(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s;return aG(i,a,u,n)}const lG={kernelName:Lu,backendName:"webgl",kernelFunc:Ch};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _e(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{perm:a}=s,u=n,o=i.shape.length,r=new Array(o);for(let h=0;h<r.length;h++)r[h]=i.shape[a[h]];let l;if(u.shouldExecuteOnCPU([i])){const c=u.texData.get(i.dataId).values,f=fm(c,i.shape,i.dtype,a,r);l=u.makeTensorInfo(r,i.dtype);const d=u.texData.get(l.dataId);d.values=f}else l=wh(i,a,u);return l}const cG={kernelName:Vr,backendName:"webgl",kernelFunc:_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kS=1e3;function Nc({a:e,b:t,transposeA:n,transposeB:s,backend:i,bias:a=null,preluActivationWeights:u=null,leakyreluAlpha:o=0,activation:r=null}){const l=e.shape.length,h=t.shape.length,c=n?e.shape[l-2]:e.shape[l-1],f=s?t.shape[h-1]:t.shape[h-2],d=n?e.shape[l-1]:e.shape[l-2],p=s?t.shape[h-2]:t.shape[h-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),x=pt(m),b=pt(g),v=Bt(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([d,p]);P(c===f,()=>`Error in matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${s} must match.`);const w=n?[x,c,d]:[x,d,c],C=s?[b,p,f]:[b,f,p],S=kt({inputs:{x:e},backend:i,attrs:{shape:w}}),k=kt({inputs:{x:t},backend:i,attrs:{shape:C}}),T=[S,k],N=Math.max(x,b),R=n?S.shape[1]:S.shape[2],L=a!=null,z=u!=null,U=r==="leakyrelu",H=r!=null?yh(r,!0):null,Y=L||z||U||H!=null;let Q;if((d===1||p===1)&&R>kS&&Y===!1){let I=S,A=k;n&&(I=_e({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),T.push(I)),s&&(A=_e({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),T.push(A));const D=p!==1,F=p===1;let j=I;D&&(j=kt({inputs:{x:I},backend:i,attrs:{shape:[N,R,1]}}),T.push(j));const O=p===1?2:1;let _=A;F&&(_=kt({inputs:{x:A},backend:i,attrs:{shape:[N,1,R]}}),T.push(_));const V=dm({inputs:{a:j,b:_},backend:i});Q=Ch({inputs:{x:V},backend:i,attrs:{axis:O,keepDims:!0}}),T.push(V)}else{const I=Cn(e.dtype,t.dtype),A=new SS(w,C,[N,d,p],n,s,L,H,z,U),D=[S,k];if(a!=null&&D.push(a),z&&D.push(u),U){const F=i.makeTensorInfo([],"float32",Ci(o,"float32"));D.push(F),T.push(F)}Q=i.runWebGLProgram(A,D,I)}const K=kt({inputs:{x:Q},backend:i,attrs:{shape:v}});T.push(Q);for(const I of T)i.disposeIntermediateTensorInfo(I);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uG(e){const{inputs:t,backend:n,attrs:s}=e,{a:i,b:a,bias:u,preluActivationWeights:o}=t,{transposeA:r,transposeB:l,activation:h,leakyreluAlpha:c}=s;return Nc({a:i,b:a,transposeA:r,transposeB:l,backend:n,bias:u,preluActivationWeights:o,leakyreluAlpha:c,activation:h})}const hG={kernelName:lc,backendName:"webgl",kernelFunc:uG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c0="return abs(x);";function fG(e){const{inputs:t,backend:n}=e,{x:s}=t;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const a=n.texData.get(s.dataId),u=pS(a.values);return n.makeTensorInfo(s.shape,s.dtype,u)}let i;return dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new qi(s.shape,c0):i=new Gs(s.shape,c0),n.runWebGLProgram(i,[s],s.dtype)}const dG={kernelName:Hc,backendName:"webgl",kernelFunc:fG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG=es+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,gG=Kt({opSnippet:pG}),mG={kernelName:ua,backendName:"webgl",kernelFunc:gG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG=es+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,bG=Kt({opSnippet:xG}),vG={kernelName:ha,backendName:"webgl",kernelFunc:bG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u0="return a + b;",yG=qe({opSnippet:u0,packedOpSnippet:u0,supportsComplex:!0,cpuKernelImpl:O4}),wG={kernelName:go,backendName:"webgl",kernelFunc:yG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CG{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((a,u)=>`T${u}`);const s=[];this.variableNames.forEach(a=>{s.push(`float v${a} = get${a}AtOutCoords();`)});const i=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SG{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((a,u)=>`T${u}`);const s=[];this.variableNames.forEach(a=>{s.push(`vec4 v${a} = get${a}AtOutCoords();`)});const i=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(e){const{inputs:t,backend:n}=e,s=t;if(s.length===1)return Tn({inputs:{x:s[0]},backend:n});if(s.length>dt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(s.length/2),l=tc({inputs:s.slice(0,r),backend:n}),h=tc({inputs:s.slice(r),backend:n});return tc({inputs:[l,h],backend:n})}const i=s.map(r=>r.dtype).reduce((r,l)=>Cn(r,l)),a=s.map(r=>r.shape),o=dt().getBool("WEBGL_PACK")?new SG(s[0].shape,a):new CG(s[0].shape,a);return n.runWebGLProgram(o,s,i)}const kG={kernelName:Ed,backendName:"webgl",kernelFunc:tc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s,o=i.shape.length,r=Ut(a,i.shape);let l=r;const h=be(l,o);let c=i;h!=null&&(c=_e({inputs:{x:i},backend:n,attrs:{perm:h}}),l=ke(l.length,o)),Ye("all",l,o);const[f,d]=We(c.shape,l),p=pt(d),m=kt({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}}),g=kr(m,m.dtype,"all",n);let x;if(u){const b=Se(f,r);x=kt({inputs:{x:g},backend:n,attrs:{shape:b}})}else x=kt({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),h!=null&&n.disposeIntermediateTensorInfo(c),x}const TG={kernelName:Nd,backendName:"webgl",kernelFunc:IG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s,o=i.shape.length,r=Ut(a,i.shape);let l=r;const h=be(l,o);let c=i;h!=null&&(c=_e({inputs:{x:i},backend:n,attrs:{perm:h}}),l=ke(l.length,o)),Ye("any",l,o);const[f,d]=We(c.shape,l),p=pt(d),m=kt({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}}),g=kr(m,m.dtype,"any",n);let x;if(u){const b=Se(f,r);x=kt({inputs:{x:g},backend:n,attrs:{shape:b}})}else x=kt({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),h!=null&&n.disposeIntermediateTensorInfo(c),x}const $G={kernelName:Dd,backendName:"webgl",kernelFunc:_G};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EG{constructor(t,n,s){this.variableNames=["A"];const{windowSize:i,batchSize:a,outSize:u}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[a,u];const o=n==="max"?">":"<",r=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${r};
          float candidate = getA(batch, inIdx);
          if (candidate ${o} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NG{constructor(t,n,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,P(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const a=t[t.length-1],u=Math.ceil(a/n);this.outputShape=t.slice(0,-1),u>1&&this.outputShape.push(u),i||this.variableNames.push("bestIndicesA");const o=this.outputShape,r=o.length,l=ie(r),h=en("coords",r);let c,f;if(u===1){f=r+1;const k=ie(f);c=`
        ${k} sourceLocR = ${k}(${h.join()}, 0);
        ++${h[r-1]};
        ${k} sourceLocG = ${k}(${h.join()}, 0);
        ++${h[r-2]};
        ${k} sourceLocA = ${k}(${h.join()}, 0);
        --${h[r-1]};
        ${k} sourceLocB = ${k}(${h.join()}, 0);
        --${h[r-2]};`}else f=r,c=`
        ${l} sourceLocR = coords;
        ++${h[r-1]};
        ${l} sourceLocG = coords;
        ++${h[r-2]};
        ${l} sourceLocA = coords;
        --${h[r-1]};
        ${l} sourceLocB = coords;
        --${h[r-2]};`;const d=["x","y","z","w","u","v"].slice(0,f),p="."+d[f-1],m=d.map(k=>"int "+k),g=en("sourceLocR",f-1).concat("inIdx.r"),x=en("sourceLocG",f-1).concat("inIdx.g"),b=en("sourceLocB",f-1).concat("inIdx.b"),y=en("sourceLocA",f-1).concat("inIdx.a"),v=s==="max"?"greaterThan":"lessThan",w=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${y.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${y.join()}) : 0.)`,S=i?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${S}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${h[r-1]} < ${o[r-1]-1};
        bool hasNextRow = ${h[r-2]} < ${o[r-2]-1};
        ${c}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IS(e,t,n,s=null){let i=t.shape[0],a=t.shape[1];s!=null&&(i=s.shape[0],a=s.shape[1]);const u=eh(a),o={windowSize:u,inSize:a,batchSize:i,outSize:Math.ceil(a/u)},r=new EG(o,n,s==null),l=[t];s!=null&&l.push(s);const h=e.runWebGLProgram(r,l,"int32");if(h.shape[1]===1)return h;const c=IS(e,t,n,h);return e.disposeIntermediateTensorInfo(h),c}function TS(e,t,n,s=null){const i=s!=null?s.shape:t.shape,a=i[i.length-1],u=eh(a),o=new NG(i,u,n,s==null),r=s==null?[t]:[t,s],l=e.runWebGLProgram(o,r,"int32");if(l.shape.length===t.shape.length){const h=TS(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}return l}function _S(e,t,n,s){const i=[n];if(Ye("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,t.shape.length),!dt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const a=[],u=e.texData.get(t.dataId),o=u!==null&&u.isPacked;let r=t;o&&(r=e.unpackTensor(t),a.push(r));const[l,h]=We(r.shape,i),c=pt(h),f=kt({inputs:{x:r},backend:e,attrs:{shape:[-1,c]}});a.push(f);const d=IS(e,f,s);a.push(d);const p=kt({inputs:{x:d},backend:e,attrs:{shape:l}});return a.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}return TS(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DG(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a}=s;let u=Ut(a,i.shape);const o=be(u,i.shape.length);let r=i;const l=[];o!=null&&(r=_e({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(r),u=ke(u.length,r.shape.length)),Ye("argMax",[u[0]],r.shape.length);const h=_S(n,r,u[0],"max");return l.forEach(c=>n.disposeIntermediateTensorInfo(c)),h}const AG={kernelName:jc,backendName:"webgl",kernelFunc:DG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RG(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a}=s;let u=Ut(a,i.shape);const o=be(u,i.shape.length);let r=i;const l=[];o!=null&&(r=_e({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(r),u=ke(u.length,r.shape.length)),Ye("argMin",[u[0]],r.shape.length);const h=_S(n,r,u[0],"min");return l.forEach(c=>n.disposeIntermediateTensorInfo(c)),h}const OG={kernelName:Xc,backendName:"webgl",kernelFunc:RG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG=es+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,PG=Kt({opSnippet:FG}),MG={kernelName:fa,backendName:"webgl",kernelFunc:PG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG=es+"return log(x + sqrt(x * x + 1.0));",BG=Kt({opSnippet:LG}),zG={kernelName:da,backendName:"webgl",kernelFunc:BG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG=es+`
  return atan(x);
`,VG=Kt({opSnippet:WG}),UG={kernelName:pa,backendName:"webgl",kernelFunc:VG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG=JU+`
  return atan(a, b);
`,HG=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+ZU+`
  return result;
`,jG=qe({opSnippet:GG,packedOpSnippet:HG}),XG={kernelName:ma,backendName:"webgl",kernelFunc:jG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG=es+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,qG=Kt({opSnippet:YG}),KG={kernelName:ga,backendName:"webgl",kernelFunc:qG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ia{constructor(t,n,s,i=!1,a=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const u=t.filterWidth,o=t.strideHeight,r=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const m=n==="avg",g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,x=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(m||(b="-1.0 / 1e-20"),s){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${o}, ${r});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${c};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?a?g:x:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const y="max";let v=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(v="avgValue / count");const w=Math.floor(u/4)*4,C=u%4,S=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${y}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${r});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${c};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${S}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${S}
          }
        }
        setOutput(${v});
      }
    `}}class pm{constructor(t,n,s,i=!1,a=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const u=t.filterWidth,o=t.strideDepth,r=t.strideHeight,l=t.strideWidth,h=t.dilationDepth,c=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=t.padInfo.front,x=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const y=n==="avg";let v="0.0";if(y||(v="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${o}, ${r}, ${l});
        const ivec3 pads = ivec3(${g}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${c}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?a?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / count");const S=Math.floor(u/4)*4,k=u%4,T=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${o}, ${r}, ${l});
      const ivec3 pads = ivec3(${g}, ${x}, ${b});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${S}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${T}
            }

            int xC = xCCorner + ${S};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${T}
            }
          }
          setOutput(${C});
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t;Il(i,"avgPool");const{filterSize:a,strides:u,pad:o,dimRoundingMode:r}=s,l=1;P(Qe(u,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${u} and dilations '${l}'`);const h=Zn(i.shape,a,u,l,o,r);if(h.filterWidth===1&&h.filterHeight===1&&Qt(h.inShape,h.outShape))return Tn({inputs:{x:i},backend:n});const c=new ia(h,"avg",!1);return n.runWebGLProgram(c,[i],"float32")}const ZG={kernelName:Yc,backendName:"webgl",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{filterSize:a,strides:u,pad:o,dimRoundingMode:r,dataFormat:l}=s,h=[1,1,1],c=Ks(i.shape,a,u,h,o,r,l),f=new pm(c,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const tH={kernelName:qc,backendName:"webgl",kernelFunc:QG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eH{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,i=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,o=t.dilationWidth,r=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=r-1-t.padInfo.top,c=l-1-t.padInfo.left,f=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${c});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
            wR += ${u}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${o}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class nH{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,s=t.filterHeight,i=t.filterWidth,a=t.strideDepth,u=t.strideHeight,o=t.strideWidth,r=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,c=t.effectiveFilterDepth,f=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=c-1-t.padInfo.front,m=f-1-t.padInfo.top,g=d-1-t.padInfo.left,x=1/(n*s*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
            wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${u}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sH(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,u=a,{filterSize:o,strides:r,pad:l,dimRoundingMode:h}=s,c=[1,1,1],f=Ks(u.shape,o,r,c,l,h),d=new nH(f);return n.runWebGLProgram(d,[i],u.dtype)}const iH={kernelName:Rd,backendName:"webgl",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,u=a;Il([i,a],"avgPoolGrad");const{filterSize:o,strides:r,pad:l}=s,h=Zn(u.shape,o,r,1,l),c=new eH(h);return n.runWebGLProgram(c,[i],u.dtype)}const oH={kernelName:Ad,backendName:"webgl",kernelFunc:rH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(e){const{inputs:t,backend:n,attrs:s}=e,{a:i,b:a}=t,{transposeA:u,transposeB:o}=s;return Nc({a:i,b:a,transposeA:u,transposeB:o,backend:n})}const lH={kernelName:Kc,backendName:"webgl",kernelFunc:aH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cH{constructor(t,n,s,i,a,u){this.outputShape=[],this.variableNames=["x","mean","variance"],Bt(t,n),Bt(t,s);let o="0.0";i!=null&&(Bt(t,i),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let r="1.0";a!=null&&(Bt(t,a),this.variableNames.push("scale"),r="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${o};
        float scale = ${r};
        float inv = scale * inversesqrt(variance + float(${u}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uH{constructor(t,n,s,i,a,u){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Bt(t,n),Bt(t,s);let o="vec4(0.0)";i!=null&&(Bt(t,i),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let r="vec4(1.0)";a!=null&&(Bt(t,a),this.variableNames.push("scale"),r="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${o};
        vec4 scale = ${r};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${u}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH=({inputs:e,backend:t,attrs:n})=>{const{x:s,mean:i,variance:a,offset:u,scale:o}=e;P(i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(u==null||i.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:r}=n;r==null&&(r=.001);const l=[s,i,a];let h=null;u!=null&&(h=u.shape,l.push(u));let c=null;o!=null&&(c=o.shape,l.push(o));const f=dt().getBool("WEBGL_PACK_NORMALIZATION")?new uH(s.shape,i.shape,a.shape,h,c,r):new cH(s.shape,i.shape,a.shape,h,c,r);return t.runWebGLProgram(f,l,l[0].dtype)},fH={kernelName:lu,backendName:"webgl",kernelFunc:hH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dH{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=ie(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=pH(this.rank);let i;const a=t.map((u,o)=>`sourceLoc.${sd[o]} = start[${o}] + coords.${sd[o]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const sd=["x","y","z","w","u","v"];function pH(e){if(e===1)return"sourceLoc";if(e<=6)return sd.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gH{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=ie(this.rank),s=en("coords",this.rank),i=en("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,u=`getChannel(getSource(${i.join()}), ${a})`,o=`
      result.x = ${u};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${u};
        --${i[this.rank-1]};
      }
    `,r=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${u};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${u};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((h,c)=>`start[${c}]`).join()});`:t.map((h,c)=>`${i[c]} = ${s[c]} + start[${c}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${o}
        ${r}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(e,t,n,s){const i=s.texData.get(e.dataId),a=s.makeTensorInfo(n,e.dtype),u=s.texData.get(a.dataId);Object.assign(u,i),u.refCount=1,u.shape=n,u.dtype=e.dtype;let o=$p(t,Dt(e.shape));i.slice&&(o+=i.slice.flatOffset),u.slice={flatOffset:o,origDataId:i.slice&&i.slice.origDataId||e.dataId};const r=s.dataRefCount.get(u.slice.origDataId)||1;return s.dataRefCount.set(u.slice.origDataId,r+1),a}function No(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{begin:a,size:u}=s,[o,r]=Xu(i,a,u);if(Ip(i,o,r),pt(r)===0)return n.makeTensorInfo(r,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const c=n.texData.get(i.dataId),f=aU(c.values,o,r,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,f)}const{isPacked:l}=n.texData.get(i.dataId),h=_p(i.shape,o,r);if(l||!h){const c=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gH(r):new dH(r),f=[o];return n.runWebGLProgram(c,[i],i.dtype,f)}return n.uploadToGPU(i.dataId),mH(i,o,r,n)}const xH={kernelName:Mu,backendName:"webgl",kernelFunc:No};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bH=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockShape:a,crops:u}=s;P(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=a.reduce((b,y)=>b*y),r=fl(i.shape,a,o),l=dl(r.length,a.length),h=pl(i.shape,a,o),c=pg(u,a.length),f=gg(h,u,a.length),d=[],p=kt({inputs:{x:i},backend:n,attrs:{shape:r}}),m=_e({inputs:{x:p},backend:n,attrs:{perm:l}}),g=kt({inputs:{x:m},backend:n,attrs:{shape:h}}),x=No({inputs:{x:g},backend:n,attrs:{begin:c,size:f}});return d.push(p),d.push(m),d.push(g),d.forEach(b=>n.disposeIntermediateTensorInfo(b)),x},vH={kernelName:Jc,backendName:"webgl",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,weights:a}=t,{size:u}=s,o=n.readSync(i.dataId),r=n.readSync(a.dataId),l=dS(o,r,a.dtype,a.shape,u);return n.makeTensorInfo([u],a.dtype,l)}const wH={kernelName:Od,backendName:"webgl",kernelFunc:yH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CH(e){const{inputs:t,backend:n}=e,{s0:s,s1:i}=t,a=n.readSync(s.dataId),u=n.readSync(i.dataId),o=Bt(Array.from(a),Array.from(u));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const SH={kernelName:Db,backendName:"webgl",kernelFunc:CH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kH="return float(a != b);",$S=qe({opSnippet:kH,cpuKernelImpl:eU,dtype:"bool"}),IH={kernelName:Iu,backendName:"webgl",kernelFunc:$S};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(e){const{inputs:t,backend:n}=e,{input:s}=t,i=n.texData.get(s.dataId);return Tn({inputs:{x:i.complexTensorInfos.real},backend:n})}const TH={kernelName:sp,backendName:"webgl",kernelFunc:$l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _H="return float(int(x));";function $H(e,t){const n=new Gs(e.shape,_H),s=t.runWebGLProgram(n,[e],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{dtype:a}=s;if(a==="complex64"){if(i.dtype==="complex64")return Tn({inputs:{x:i},backend:n});const u=ae(i.shape),o=id({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=Ni({inputs:{real:o,imag:u},backend:n});return u.dispose(),n.disposeIntermediateTensorInfo(o),r}if(i.dtype==="complex64"){const u=$l({inputs:{input:i},backend:n}),o=id({inputs:{x:u},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(u),o}if(!kb(i.dtype,a)){const u=Tn({inputs:{x:i},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:a}}if(a==="int32")return $H(i,n);if(a==="bool"){const u=n.makeTensorInfo([],"bool",He("bool",1)),r=$S({inputs:{a:i,b:u},backend:n});return n.disposeIntermediateTensorInfo(u),r}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${a}`)}const EH={kernelName:xa,backendName:"webgl",kernelFunc:id};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h0="return ceil(x);",NH=Kt({opSnippet:h0,packedOpSnippet:h0,cpuKernelImpl:P4}),DH={kernelName:ba,backendName:"webgl",kernelFunc:NH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AH{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RH{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OH(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{clipValueMin:a,clipValueMax:u}=s;let o;dt().getBool("WEBGL_PACK_CLIP")?o=new RH(i.shape):o=new AH(i.shape);const r=[[a],[u]];return n.runWebGLProgram(o,[i],i.dtype,r)}const FH={kernelName:va,backendName:"webgl",kernelFunc:OH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PH{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function MH(e){const{inputs:t,backend:n}=e,{x:s}=t,i=n.texData.get(s.dataId),a=new PH(s.shape),u=[f0(s,i.complexTensorInfos.real),f0(s,i.complexTensorInfos.imag)];return n.runWebGLProgram(a,u,u[0].dtype)}const LH={kernelName:Zc,backendName:"webgl",kernelFunc:MH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BH{constructor(t){this.outputShape=[],this.outputShape=Fs(t,1),this.variableNames=t.map((u,o)=>`T${o}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let u=1;u<n.length;u++)n[u]=n[u-1]+t[u][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let u=1;u<n.length;u++){const o=n[u-1];s.push(`else if (yC < ${n[u]}) setOutput(getT${u}(yR, yC-${o}));`)}const i=n.length,a=n[n.length-1];s.push(`else setOutput(getT${i}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zH{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Fs(t,n);const s=this.outputShape,i=s.length,a=ie(i),u=en("coords",i),o=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((m,g)=>`T${g}`);const r=new Array(t.length-1);r[0]=t[0][n];for(let m=1;m<r.length;m++)r[m]=r[m-1]+t[m][n];const l=o[n],h=o.slice(-2),c=o.join();let f=`if (${l} < ${r[0]}) {
        return getChannel(
            getT0(${c}), vec2(${h.join()}));
        }`;for(let m=1;m<r.length;m++){const g=r[m-1];f+=`
        if (${l} < ${r[m]}  && ${l} >= ${r[m-1]}) {
          return getChannel(
            getT${m}(${jl(o,l,g)}),
            vec2(${jl(h,l,g)}));
        }`}const d=r.length,p=r[r.length-1];f+=`
        return getChannel(
          getT${d}(${jl(o,l,p)}),
          vec2(${jl(h,l,p)}));`,this.userCode=`
      float getValue(${o.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${u}), 0., 0., 0.);

        ${u[i-1]} = ${u[i-1]} + 1;
        if (${u[i-1]} < ${s[i-1]}) {
          result.g = getValue(${u});
        }

        ${u[i-2]} = ${u[i-2]} + 1;
        if (${u[i-2]} < ${s[i-2]}) {
          result.a = getValue(${u});
        }

        ${u[i-1]} = ${u[i-1]} - 1;
        if (${u[i-2]} < ${s[i-2]} &&
            ${u[i-1]} < ${s[i-1]}) {
          result.b = getValue(${u});
        }
        setOutput(result);
      }
    `}}function jl(e,t,n){const s=e.indexOf(t);return e.map((a,u)=>u===s?`${a} - ${n}`:a).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(e){const{inputs:t,backend:n}=e,{input:s}=t,i=n.texData.get(s.dataId);return Tn({inputs:{x:i.complexTensorInfos.imag},backend:n})}const WH={kernelName:qd,backendName:"webgl",kernelFunc:Sh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fr(e,t,n){const s=e[0].dtype;if(s==="complex64"){const h=e.map(m=>$l({inputs:{input:m},backend:n})),c=e.map(m=>Sh({inputs:{input:m},backend:n})),f=Fr(h,t,n),d=Fr(c,t,n),p=Ni({inputs:{real:f,imag:d},backend:n});return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),c.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}let i=n.shouldExecuteOnCPU(e);if(s==="string"&&(i=!0),i){const h=e.map(x=>{const b=pt(x.shape.slice(t));return kt({inputs:{x},backend:n,attrs:{shape:[-1,b]}})}),c=h.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),f=Fs(h.map(x=>x.shape),1),d=h[0].shape[0]===1,p=M4(c,f,s,d),m=Fs(e.map(x=>x.shape),t),g=n.makeTensorInfo(m,s,p);return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}if(e.length>dt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const h=Math.floor(e.length/2),c=Fr(e.slice(0,h),t,n),f=Fr(e.slice(h),t,n),d=Fr([c,f],t,n);return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),d}if(dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const h=new zH(e.map(c=>c.shape),t);return n.runWebGLProgram(h,e,s)}const{tensors2D:a,outShape:u}=VH(e,t,n),o=new BH(a.map(h=>h.shape)),r=n.runWebGLProgram(o,a,s);a.forEach(h=>n.disposeIntermediateTensorInfo(h));const l=kt({inputs:{x:r},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(r),l}function VH(e,t,n){const s=Fs(e.map(a=>a.shape),t);return{tensors2D:e.map(a=>kt({inputs:{x:a},attrs:{shape:[-1,pt(a.shape.slice(t))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ES(e){const{inputs:t,backend:n,attrs:s}=e,{axis:i}=s,a=Ut(i,t[0].shape)[0],u=Fs(t.map(l=>l.shape),a);if(pt(u)===0)return n.makeTensorInfo(u,t[0].dtype,[]);const o=t.filter(l=>pt(l.shape)>0);if(o.length===1)return Tn({inputs:{x:o[0]},backend:n});const r=o.map(l=>l.shape);return hg(r,a),Fr(o,a,n)}const UH={kernelName:Qc,backendName:"webgl",kernelFunc:ES};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NS{constructor(t,n=!1,s=null,i=!1,a=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const u=t.padInfo.top,o=t.padInfo.left,r=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,c=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4,g=t.dataFormat==="channelsLast",x=g?1:2,b=g?2:3,y=g?3:1;let v="",w="";s&&(i?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:v=`
          float activation(float x) {
            ${s}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${r}, ${l});
      const ivec2 pads = ivec2(${u}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${y}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${c};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class GH{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,s=t.padInfo.top,i=t.padInfo.left,a=t.strideDepth,u=t.strideHeight,o=t.strideWidth,r=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,c=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${u}, ${o});
      const ivec3 pads = ivec3(${n}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${c}; wF++) {
          int xF = xFCorner + wF * ${r};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HH{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=mn(this.outputShape.length);const{dataFormat:s}=n,i=on(),a=s==="channelsLast",u=a?0:1,o=a?1:2,r=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${t[1]} && pos < ${t[0]}) {`;let l="";for(let h=0;h<=1;h++)for(let c=0;c<=1;c++)l+=`
          blockIndex = rc.y + ${c};
          pos = rc.x + ${h};

          ${r}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${u}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${o}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+c}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+c}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DS({x:e,filter:t,convInfo:n,backend:s,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:u=0,activation:o=null}){const r=e.shape,l=s.texData.get(e.dataId),h=n.inChannels,c=r[0]*r[1]*r[2],f=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const x=[];if(a!=null&&!d&&a.shape.length===3){const v=_e({inputs:{x:a},backend:s,attrs:{perm:[1,2,0]}});x.push(v),a=v}if(!((c===1||f===1)&&h>kS)&&l.isPacked&&d&&l.texture!=null&&r[2]%2!==0&&Qt(l.shape.slice(-3),r.slice(-3))){const v=r[0]*r[1]*(r[2]+1),w={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,P(Ec(l.shape,w.shape),()=>`packed reshape ${l.shape} to ${w.shape} isn't free`);const S=kt({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});x.push(S);const k=Nc({a:w,b:S,backend:s,transposeA:p,transposeB:m,bias:i,activation:o,preluActivationWeights:a,leakyreluAlpha:u}),T=s.texData.get(k.dataId);P(T.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,T.shape=n.outShape,g=Tn({inputs:{x:k},backend:s}),g.shape=n.outShape,x.push(k)}else{const v=d?e:_e({inputs:{x:e},backend:s,attrs:{perm:[0,2,3,1]}}),w=v.shape,C=w[0]*w[1]*w[2],S=kt({inputs:{x:v},backend:s,attrs:{shape:[1,C,n.inChannels]}}),k=kt({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),T=Nc({a:S,b:k,transposeA:p,transposeB:m,backend:s,bias:i,activation:o,preluActivationWeights:a,leakyreluAlpha:u}),N=[n.batchSize,n.outHeight,n.outWidth,n.outChannels],R=kt({inputs:{x:T},backend:s,attrs:{shape:N}});g=d?R:_e({inputs:{x:R},backend:s,attrs:{perm:[0,3,1,2]}}),d||(x.push(v),x.push(R)),x.push(S),x.push(k),x.push(T)}for(const v of x)s.disposeIntermediateTensorInfo(v);return g}function AS({x:e,filter:t,convInfo:n,backend:s,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:u=0,activation:o=null}){const{filterWidth:r,filterHeight:l,inChannels:h,outWidth:c,outHeight:f,dataFormat:d}=n,p=d==="channelsLast",m=r*l*h,g=f*c,x=[m,g],b=!0,y=!1,v=[];if(a!=null&&!p&&a.shape.length===3){const D=_e({inputs:{x:a},backend:s,attrs:{perm:[1,2,0]}});v.push(D),a=D}const w=kt({inputs:{x:e},backend:s,attrs:{shape:e.shape.slice(1)}}),C=kt({inputs:{x:t},backend:s,attrs:{shape:[1,m,pt(t.shape)/m]}});v.push(w),v.push(C);const S=new HH(x,n),k=[w.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=s.runWebGLProgram(S,[w],"float32",k),N=kt({inputs:{x:T},backend:s,attrs:{shape:[1,x[0],x[1]]}});v.push(T),v.push(N);const R=i!=null,L=a!=null,z=o==="leakyrelu",U=o?yh(o,!0):null,H=new SS(N.shape,C.shape,[1,g,n.outChannels],b,y,R,U,L,z),Y=[N,C];if(i&&Y.push(i),L&&Y.push(a),z){const D=s.makeTensorInfo([],"float32",Ci(u,"float32"));Y.push(D),v.push(D)}const Q=s.runWebGLProgram(H,Y,"float32"),K=[1,f,c,n.outChannels],I=kt({inputs:{x:Q},backend:s,attrs:{shape:K}}),A=p?I:_e({inputs:{x:I},backend:s,attrs:{perm:[0,3,1,2]}});p||v.push(I),v.push(Q);for(const D of v)s.disposeIntermediateTensorInfo(D);return A}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jH(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dataFormat:r,dilations:l,dimRoundingMode:h}=s,c=Js(r),f=Xe(i.shape,a.shape,u,l,o,h,!1,c);let d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=DS({x:i,filter:a,convInfo:f,backend:n});else if(dt().getBool("WEBGL_CONV_IM2COL")&&i.shape[0]===1)d=AS({x:i,filter:a,convInfo:f,backend:n});else{const m=new NS(f);d=n.runWebGLProgram(m,[i,a],"float32")}const p=kt({inputs:{x:d},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(d),p}const XH={kernelName:tu,backendName:"webgl",kernelFunc:jH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YH{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,s=t.strideWidth,i=t.padInfo.top,a=t.padInfo.left,u=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              if (${u}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qH{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,i=t.strideHeight,a=t.strideWidth,u=t.dataFormat==="channelsLast",o=n-1-t.padInfo.top,r=s-1-t.padInfo.left,l=u?1:2,h=u?2:3,c=u?3:1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${c}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${u}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class KH{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,s=t.strideHeight,i=t.strideWidth,a=t.padInfo.front,u=t.padInfo.top,o=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${a};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${u};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${o};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class JH{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,s=t.filterHeight,i=t.filterWidth,a=t.strideDepth,u=t.strideHeight,o=t.strideWidth,r=n-1-t.padInfo.front,l=s-1-t.padInfo.top,h=i-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${r}, ${l}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${u}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZH(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,pad:o,dataFormat:r,dimRoundingMode:l,filterShape:h}=s,c=Js(r),f=Xe(i.shape,h,u,1,o,l,!1,c),d=new YH(f);return n.runWebGLProgram(d,[i,a],"float32")}const QH={kernelName:Pd,backendName:"webgl",kernelFunc:ZH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{inputShape:u,strides:o,pad:r,dataFormat:l,dimRoundingMode:h}=s,c=Js(l),f=Xe(u,a.shape,o,1,r,h,!1,c),d=new qH(f);return n.runWebGLProgram(d,[i,a],"float32")}const ej={kernelName:eu,backendName:"webgl",kernelFunc:tj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dilations:r}=s,l=Si(i.shape,a.shape,u,r,o),h=new GH(l);return n.runWebGLProgram(h,[i,a],"float32")}const sj={kernelName:nu,backendName:"webgl",kernelFunc:nj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ij(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,pad:o,filterShape:r}=s,l=Si(i.shape,r,u,1,o),h=new KH(l);return n.runWebGLProgram(h,[i,a],"float32")}const rj={kernelName:Md,backendName:"webgl",kernelFunc:ij};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oj(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{pad:u,strides:o,inputShape:r}=s,l=Si(r,a.shape,o,1,u),h=new JH(l);return n.runWebGLProgram(h,[i,a],"float32")}const aj={kernelName:Ld,backendName:"webgl",kernelFunc:oj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj=Eo+`
  return cos(x);
`,cj=Kt({opSnippet:lj}),uj={kernelName:ya,backendName:"webgl",kernelFunc:cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,fj=Kt({opSnippet:hj}),dj={kernelName:wa,backendName:"webgl",kernelFunc:fj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pj{constructor(t,n,s,i,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[u,o,r,l]=t,[h]=n,[c,f]=s;this.outputShape=[h,c,f,l];const d=i==="bilinear"?1:0,[p,m]=[`${o-1}.0`,`${r-1}.0`],[g,x,b]=c>1?[`${(o-1)/(c-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[y,v,w]=f>1?[`${(r-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${y});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${u}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${v};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj=e=>{const{inputs:t,backend:n,attrs:s}=e,{image:i,boxes:a,boxInd:u}=t,{cropSize:o,method:r,extrapolationValue:l}=s,h=new pj(i.shape,a.shape,o,r,l);return n.runWebGLProgram(h,[i,a,u],"float32")},mj={kernelName:zd,backendName:"webgl",kernelFunc:gj};var ra;(function(e){e.Prod="*",e.Sum="+"})(ra||(ra={}));class d0{constructor(t,n,s,i){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,u=this.op===ra.Prod?"1.0":"0.0",o=s?u:`getX(${p0(a,"coords",this.op)})`,r=this.outputShape[this.outputShape.length-1];let l="",h="";s?(l=i?`end != ${r-1}`:"end != 0",h=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${r}`:"end >= pow2",h=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ie(a)} coords = getOutputCoords();
        int end = ${g0(a,"coords",this.op)};
        float val = ${o};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${h};
          ${g0(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${p0(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function p0(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function g0(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RS(e,t,n,s,i,a){const u=t.shape.length,o=be([s],u);let r=t;o!=null&&(r=_e({inputs:{x:t},backend:n,attrs:{perm:o}}));const l=ke(1,u)[0];if(l!==u-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const h=r.shape[l];let c=Tn({inputs:{x:r},backend:n});for(let f=0;f<=Math.ceil(Math.log2(h))-1;f++){const d=new d0(e,r.shape,!1,a),p=[[f]],m=c;c=n.runWebGLProgram(d,[c],c.dtype,p),n.disposeIntermediateTensorInfo(m)}if(i){const f=new d0(e,r.shape,i,a),d=c;c=n.runWebGLProgram(f,[c],c.dtype),n.disposeIntermediateTensorInfo(d)}if(o!=null){const f=ki(o),d=_e({inputs:{x:c},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(r),d}return c}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,exclusive:u,reverse:o}=s;return RS(ra.Prod,i,n,a,u,o)}const bj={kernelName:Bd,backendName:"webgl",kernelFunc:xj};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,exclusive:u,reverse:o}=s;return RS(ra.Sum,i,n,a,u,o)}const yj={kernelName:su,backendName:"webgl",kernelFunc:vj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,weights:a}=t,{size:u,binaryOutput:o}=s;if(i.shape.length===1){const r=n.readSync(i.dataId),l=n.readSync(a.dataId),h=dS(r,l,a.dtype,a.shape,u);return n.makeTensorInfo([u],a.dtype,h)}else if(i.shape.length===2){const r=n.bufferSync(i),l=n.bufferSync(a),h=F4(r,l,u,o);return n.makeTensorInfo(h.shape,a.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Cj={kernelName:Ab,backendName:"webgl",kernelFunc:wj};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sj{constructor(t,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockSize:a,dataFormat:u}=s,o=i.shape[0],r=u==="NHWC"?i.shape[1]:i.shape[2],l=u==="NHWC"?i.shape[2]:i.shape[3],h=u==="NHWC"?i.shape[3]:i.shape[1],c=r*a,f=l*a,d=h/(a*a),p=u==="NHWC"?[o,c,f,d]:[o,d,c,f],m=new Sj(p,a,u);return n.runWebGLProgram(m,[i],i.dtype)}const Ij={kernelName:Wd,backendName:"webgl",kernelFunc:kj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OS{constructor(t,n=!1,s=null,i=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=mn(this.outputShape.length);const u=t.filterHeight,o=t.filterWidth,r=t.outChannels/t.inChannels;let l="",h="";s&&(i?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const c=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${r};
        int q = d2 - d1 * ${r};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${u}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${o}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${c}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FS{constructor(t,n=!1,s=null,i=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=mn(this.outputShape.length);const u=t.outChannels/t.inChannels,o=t.padInfo.left,r=t.strideWidth,l=t.dilationWidth,h=t.filterHeight,c=t.filterWidth,f=c;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<c;x++)d+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;d+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let x=0;x<c;x++)d+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(f+1)/2;x++){const b=x*2;if(d+=`
          xC = xCCorner + ${b*l};
          `,r===1){if(b<c&&(o%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?d+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<c)){const y=o%2===0?Cb(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${y};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1&&(d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                      xTexelC${b} = getX(batch, xR, xCOffset, d1);
                      xTexelC${b}Ready = 1;
                    }
                    `),d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                  `):y===1?d+=`
                    xC${b+1} = xTexelC${b};
                    `:d+=`
                    xCOffset = xC + ${y};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<c&&(o%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<c&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<c&&(d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<c&&(d+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<c&&(d+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",m="";s&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dilations:r,dimRoundingMode:l}=s;let h=r;h==null&&(h=[1,1]),P(Qe(u,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${h}'`);const c=Xe(i.shape,a.shape,u,h,o,l,!0);let f;dt().getBool("WEBGL_PACK_DEPTHWISECONV")&&c.strideWidth<=2&&c.outChannels/c.inChannels===1?f=new FS(c):f=new OS(c);const d=[[c.padInfo.top,c.padInfo.left],[c.strideHeight,c.strideWidth],[c.dilationHeight,c.dilationWidth],[c.inHeight,c.inWidth]];return n.runWebGLProgram(f,[i,a],"float32",d)}const _j={kernelName:iu,backendName:"webgl",kernelFunc:Tj};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $j{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,s=t.strideWidth,i=t.padInfo.top,a=t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${u} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Ej{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,i=t.strideHeight,a=t.strideWidth,u=n-1-t.padInfo.top,o=s-1-t.padInfo.left,r=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${u}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${r}; dm++) {
              int d2 = d1 * ${r} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,dy:a}=t,{strides:u,dilations:o,pad:r,dimRoundingMode:l,filterShape:h}=s,c=Xe(i.shape,h,u,o,r,l,!0),f=new $j(c);return n.runWebGLProgram(f,[i,a],"float32")}const Dj={kernelName:Vd,backendName:"webgl",kernelFunc:Nj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,filter:a}=t,{strides:u,dilations:o,pad:r,dimRoundingMode:l,inputShape:h}=s,c=Xe(h,a.shape,u,o,r,l,!0),f=new Ej(c);return n.runWebGLProgram(f,[i,a],"float32")}const Rj={kernelName:Ud,backendName:"webgl",kernelFunc:Aj};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oj{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(e){const{inputs:t,backend:n}=e,{x:s}=t,i=[...s.shape,...s.shape],a=pt(s.shape),u=kt({inputs:{x:s},backend:n,attrs:{shape:[a]}}),o=new Oj(a),r=n.runWebGLProgram(o,[u],u.dtype),l=kt({inputs:{x:r},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(r),l}const Pj={kernelName:Rb,backendName:"webgl",kernelFunc:Fj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mj{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:s,padInfo:i,strideHeight:a,strideWidth:u,filterHeight:o,filterWidth:r,dilationHeight:l,dilationWidth:h}=t,{top:c,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${c}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${o}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${r}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a}=t,{strides:u,pad:o,dilations:r}=s,l=ll(i.shape,a.shape,u,o,"NHWC",r);let h;const c=new Mj(l);h=n.runWebGLProgram(c,[i,a],"float32");const f=kt({inputs:{x:h},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(h),f}const Bj={kernelName:ru,backendName:"webgl",kernelFunc:Lj};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(e){const{inputs:t,backend:n,attrs:s}=e,{equation:i}=s,a=t,{allDims:u,summedDims:o,idDims:r}=Sg(i,a.length);Ig(u.length,r,a);const{path:l,steps:h}=Tg(o,r),c=h.length;let f=null,d=u.length;const p=[];for(let m=0;m<c;++m){for(const g of h[m]){const{permutationIndices:x,expandDims:b}=kg(d,r[g]);let y;_g(x)?y=a[g]:(y=_e({inputs:{x:a[g]},backend:n,attrs:{perm:x}}),p.push(y));const v=y.shape.slice();for(let w=0;w<b.length;++w)v.splice(b[w],0,1);Qt(y.shape,v)||(y=kt({inputs:{x:y},backend:n,attrs:{shape:v}}),p.push(y)),f===null?f=y:(f=dm({inputs:{a:y,b:f},backend:n}),p.push(f))}m<c-1&&(l[m]>=0&&(f=Ch({inputs:{x:f},backend:n,attrs:{axis:l[m]-(u.length-d),keepDims:!1}}),p.push(f)),d--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const Wj={kernelName:Ob,backendName:"webgl",kernelFunc:zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj="return (x >= 0.0) ? x : (exp(x) - 1.0);",Uj=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Gj=Kt({opSnippet:Vj,packedOpSnippet:Uj}),Hj={kernelName:Sa,backendName:"webgl",kernelFunc:Gj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jj="return (b >= 1.0) ? a : a * (b + 1.0);",Xj=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Yj=e=>{const{inputs:t,backend:n}=e,{dy:s,y:i}=t,a=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _l(Xj,s.shape,i.shape):new uo(jj,s.shape,i.shape);return n.runWebGLProgram(a,[s,i],s.dtype)},qj={kernelName:Gd,backendName:"webgl",kernelFunc:Yj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj=`
  return vec4(equal(a, b));
`,Jj="return float(a == b);",Zj=qe({opSnippet:Jj,packedOpSnippet:Kj,dtype:"bool",cpuKernelImpl:L4}),Qj={kernelName:ou,backendName:"webgl",kernelFunc:Zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${mg};
  float a1 = ${xg};
  float a2 = ${bg};
  float a3 = ${vg};
  float a4 = ${yg};
  float a5 = ${wg};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,e5=Kt({opSnippet:t5}),n5={kernelName:ka,backendName:"webgl",kernelFunc:e5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5=Eo+`
  return exp(x);
`,i5=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,PS=Kt({opSnippet:s5,packedOpSnippet:i5,cpuKernelImpl:B4,dtype:"float32"}),r5={kernelName:Ia,backendName:"webgl",kernelFunc:PS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rd(e){const{inputs:t,attrs:n,backend:s}=e,{dim:i}=n,{input:a}=t,u=a.shape.length,o=a.shape.slice();let r=i;return i<0&&(P(-(u+1)<=i,()=>`Axis must be in the interval [${-(u+1)}, ${u}]`),r=u+i+1),o.splice(r,0,1),kt({inputs:{x:a},backend:s,attrs:{shape:o}})}const o5={kernelName:au,backendName:"webgl",kernelFunc:rd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m0="return exp(x) - 1.0;",a5=Kt({opSnippet:m0,packedOpSnippet:m0,cpuKernelImpl:z4}),l5={kernelName:Ta,backendName:"webgl",kernelFunc:a5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x0{constructor(t,n,s){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const a=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,u=s?`${i}.0`:"1.0";let o;if(t==="real")o="return real * expR - imag * expI;";else if(t==="imag")o="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${o}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${u};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MS(e,t,n){const s=n.texData.get(e.dataId),i=pt(e.shape),a=e.shape[e.shape.length-1],u=i/a,o=kt({inputs:{x:e},backend:n,attrs:{shape:[u,a]}}),r=o.shape,l=new x0("real",r,t),h=new x0("imag",r,t),c=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:r},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:r}],f=n.runWebGLProgram(l,c,"float32"),d=n.runWebGLProgram(h,c,"float32"),p=Ni({inputs:{real:f,imag:d},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d);const m=kt({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(e){const{inputs:t,backend:n}=e,{input:s}=t;return MS(s,!1,n)}const u5={kernelName:Hd,backendName:"webgl",kernelFunc:c5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h5{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function El(e){const{backend:t,attrs:n}=e,{shape:s,value:i}=n;let{dtype:a}=n;if(a=a||la(i),a==="string"){const u=nn(a,pt(s));return u.fill(i),t.makeTensorInfo(s,a,u)}else{const u=new h5(s,i),o=[[i]];return t.runWebGLProgram(u,[],a,o)}}const f5={kernelName:jd,backendName:"webgl",kernelFunc:El};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d5{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5={kernelName:Xd,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,s=t,i=new d5(n.shape);return s.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b0="return floor(x);",g5=Kt({opSnippet:b0,packedOpSnippet:b0,cpuKernelImpl:W4}),m5={kernelName:_a,backendName:"webgl",kernelFunc:g5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x5=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,b5=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,v5=qe({opSnippet:x5,packedOpSnippet:b5,dtype:"int32"}),y5={kernelName:$a,backendName:"webgl",kernelFunc:v5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w5{constructor(t){this.variableNames=["A"];const n=on(),[s,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C5{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=on(),[s,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5={kernelName:Cf,backendName:"webgl",kernelFunc:k5};let Er;function k5(e){const{inputs:t,backend:n,attrs:s}=e;let{pixels:i}=t;const{numChannels:a}=s,u=typeof HTMLVideoElement!="undefined"&&i instanceof HTMLVideoElement,o=typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement,[r,l]=u?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=[l,r],c=[l,r,a];(o||u)&&(Er==null&&(Er=document.createElement("canvas").getContext("2d")),Er.canvas.width=r,Er.canvas.height=l,Er.drawImage(i,0,0,r,l),i=Er.canvas);const f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=Dn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);const d=dt().getBool("WEBGL_PACK")?new C5(c):new w5(c),p=n.runWebGLProgram(d,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a,bias:u,preluActivationWeights:o}=t,{strides:r,pad:l,dataFormat:h,dilations:c,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s,m=Js(h),g=Xe(i.shape,a.shape,r,c,l,f,!1,m);let x;const b=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=DS({x:i,filter:a,convInfo:g,backend:n,bias:u,activation:d,preluActivationWeights:o,leakyreluAlpha:p});else if(dt().getBool("WEBGL_CONV_IM2COL")&&i.shape[0]===1)x=AS({x:i,filter:a,convInfo:g,backend:n,bias:u,activation:d,preluActivationWeights:o,leakyreluAlpha:p});else{const v=u!=null,w=o!=null,C=d==="leakyrelu",S=d?yh(d,!1):null,k=new NS(g,v,S,w,C),T=[i,a],N=(R,L)=>{if(L==="NCHW"&&R.shape.length===1&&R.shape[0]!==1){const z=kt({inputs:{x:R},backend:n,attrs:{shape:[R.shape[0],1,1]}});return b.push(z),z}return R};if(v&&T.push(N(u,h)),w&&T.push(N(o,h)),C){const R=n.makeTensorInfo([],"float32",Ci(p,"float32"));T.push(R),b.push(R)}x=n.runWebGLProgram(k,T,"float32")}const y=kt({inputs:{x},backend:n,attrs:{shape:g.outShape}});return b.push(x),b.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}const T5={kernelName:cc,backendName:"webgl",kernelFunc:I5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,filter:a,bias:u,preluActivationWeights:o}=t,{strides:r,pad:l,dilations:h,dimRoundingMode:c,activation:f,leakyreluAlpha:d}=s,p=[];let m=h;m==null&&(m=[1,1]),P(Qe(r,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${m}'`);const g=Xe(i.shape,a.shape,r,m,l,c,!0),x=dt().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=f?yh(f,x):null,y=[i,a],v=u!=null,w=o!=null,C=f==="leakyrelu";if(v&&y.push(u),w&&y.push(o),C){const N=n.makeTensorInfo([],"float32",Ci(d,"float32"));y.push(N),p.push(N)}let S;x?S=new FS(g,v,b,w,C):S=new OS(g,v,b,w,C);const k=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(S,y,"float32",k);return p.forEach(N=>n.disposeIntermediateTensorInfo(N)),T}const $5={kernelName:Vb,backendName:"webgl",kernelFunc:_5};class E5{constructor(t,n,s){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=s;const i=ie(n.length),a=ie(s.length),u=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${i} strides = ${i}(${this.strides});
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${u};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(e){const{inputs:t,backend:n}=e,{params:s,indices:i}=t,a=i.shape,u=a[a.length-1],o=pt(s.shape),[r,l,h,c]=kp(s,i),f=kt({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),d=kt({inputs:{x:s},backend:n,attrs:{shape:[pt(s.shape)/h,h]}});if(n.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const x=n.readSync(i.dataId),b=n.bufferSync(s),y=V4(x,b,s.dtype,l,u,h,c,s.shape,o);return n.makeTensorInfo(r,s.dtype,y.values)}const p=new E5(u,c,[l,h]),m=n.runWebGLProgram(p,[d,f],d.dtype),g=kt({inputs:{x:m},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),g}const D5={kernelName:Fb,backendName:"webgl",kernelFunc:N5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A5{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=ie(this.rank),i=R5(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function R5(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<e.length;i++)i===2?s.push("index"):s.push(`${n[i]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LS(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,indices:a}=t,{axis:u,batchDims:o}=s,r=Ut(u,i.shape)[0];if(dt().get("DEBUG")){const b=n.readSync(a.dataId),y=i.shape[r];for(let v=0;v<b.length;++v){const w=b[v];P(w<=y-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${y-1}]`)}}const l=Eg(i,a,r,o),h=pt(a.shape),c=[],f=kt({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),d=kt({inputs:{x:a},backend:n,attrs:{shape:[l.batchSize,h/l.batchSize]}});c.push(f),c.push(d);const p=[l.batchSize,l.outerSize,h/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,a])||i.dtype==="string"){const b=n.bufferSync(d),y=n.bufferSync(f),v=U4(y,b,p);return c.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(l.outputShape,v.dtype,v.values)}const m=new A5(f.shape,p),g=n.runWebGLProgram(m,[f,d],f.dtype);c.push(g);const x=kt({inputs:{x:g},backend:n,attrs:{shape:l.outputShape}});return c.forEach(b=>n.disposeIntermediateTensorInfo(b)),x}const O5={kernelName:cu,backendName:"webgl",kernelFunc:LS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F5="return float(a > b);",P5=`
  return vec4(greaterThan(a, b));
`,M5=qe({opSnippet:F5,packedOpSnippet:P5,cpuKernelImpl:G4,dtype:"bool"}),L5={kernelName:uu,backendName:"webgl",kernelFunc:M5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5="return float(a >= b);",z5=`
  return vec4(greaterThanEqual(a, b));
`,W5=qe({opSnippet:B5,packedOpSnippet:z5,dtype:"bool",cpuKernelImpl:H4}),V5={kernelName:Ea,backendName:"webgl",kernelFunc:W5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(e){const{inputs:t,backend:n}=e,{input:s}=t;return MS(s,!0,n)}const G5={kernelName:Yd,backendName:"webgl",kernelFunc:U5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5="return float(!isnan(x) && !isinf(x));",j5=Kt({opSnippet:H5,dtype:"bool"}),X5={kernelName:Da,backendName:"webgl",kernelFunc:j5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5="return float(isinf(x));",q5=Kt({opSnippet:Y5,dtype:"bool"}),K5={kernelName:Aa,backendName:"webgl",kernelFunc:q5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J5="return float(isnan(x));",Z5=Kt({opSnippet:J5,dtype:"bool"}),Q5={kernelName:Ra,backendName:"webgl",kernelFunc:Z5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX="return float(a < b);",eX=`
  return vec4(lessThan(a, b));
`,nX=qe({opSnippet:tX,packedOpSnippet:eX,cpuKernelImpl:j4,dtype:"bool"}),sX={kernelName:fu,backendName:"webgl",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX="return float(a <= b);",rX=`
  return vec4(lessThanEqual(a, b));
`,oX=qe({opSnippet:iX,packedOpSnippet:rX,cpuKernelImpl:X4,dtype:"bool"}),aX={kernelName:du,backendName:"webgl",kernelFunc:oX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(e){const{backend:t,attrs:n}=e,{start:s,stop:i,num:a}=n,u=Y4(s,i,a);return t.makeTensorInfo([u.length],"float32",u)}const cX={kernelName:Pb,backendName:"webgl",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX=Eo+`
  return x < 0.0 ? 0./0. : log(x);
`,hX=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,fX=Kt({opSnippet:uX,packedOpSnippet:hX,cpuKernelImpl:q4}),dX={kernelName:Oa,backendName:"webgl",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=Eo+`
  return log(1.0 + x);
`,gX=Kt({opSnippet:pX}),mX={kernelName:Fa,backendName:"webgl",kernelFunc:gX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX="return float(a >= 1.0 && b >= 1.0);",bX=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,vX=qe({opSnippet:xX,packedOpSnippet:bX,dtype:"bool"}),yX={kernelName:pu,backendName:"webgl",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX="return float(!(x >= 1.0));",CX=Kt({opSnippet:wX}),SX={kernelName:gu,backendName:"webgl",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX="return float(a >= 1.0 || b >= 1.0);",IX=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,TX=qe({opSnippet:kX,packedOpSnippet:IX,dtype:"bool"}),_X={kernelName:mu,backendName:"webgl",kernelFunc:TX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $X{constructor(t,n,s,i,a){this.variableNames=["x"],this.outputShape=[];const u=n,o=t[3]-1;this.outputShape=t;let r;const l=`float(${s}) + float(${i}) * sum`;a===.5?r=`inversesqrt(${l})`:a===1?r=`1.0/(${l})`:r=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${u}; j <= ${u}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${o}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${r};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EX{constructor(t,n,s,i,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const u=n,o=t[3]-1;this.outputShape=t;let r;const l=`float(${s}) + float(${i}) * sum`;a===.5?r=`inversesqrt(${l})`:a===1?r=`1.0/(${l})`:r=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${u};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${u}; j <= ${u}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{depthRadius:a,bias:u,alpha:o,beta:r}=s,l=dt().getBool("WEBGL_PACK_NORMALIZATION")?new EX(i.shape,a,u,o,r):new $X(i.shape,a,u,o,r);return n.runWebGLProgram(l,[i],i.dtype)},DX={kernelName:xu,backendName:"webgl",kernelFunc:NX};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AX{constructor(t,n,s,i,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=s,this.alpha=i,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${a})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:i,y:a,dy:u}=t,{depthRadius:o,bias:r,alpha:l,beta:h}=s,c=new AX(i.shape,o,r,l,h);return n.runWebGLProgram(c,[i,a,u],i.dtype)},OX={kernelName:Kd,backendName:"webgl",kernelFunc:RX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FX(e,t,n,s){const i=pt(t),u=pt(e.shape)/i,o=kt({inputs:{x:e},attrs:{shape:[u,i]},backend:s}),r=kr(o,e.dtype,"max",s),l=kt({inputs:{x:r},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(r),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BS(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{reductionIndices:a,keepDims:u}=s,o=i.shape.length,r=Ut(a,i.shape);let l=r;const h=be(l,o),c=h!=null,f=n.shouldExecuteOnCPU([i]);let d=i;if(c){if(f){const y=n.texData.get(d.dataId).values,v=new Array(o);for(let S=0;S<v.length;S++)v[S]=i.shape[h[S]];const w=fm(y,i.shape,i.dtype,h,v);d=n.makeTensorInfo(v,i.dtype);const C=n.texData.get(d.dataId);C.values=w}else d=wh(i,h,n);l=ke(l.length,o)}Ye("max",l,o);const[p,m]=We(d.shape,l);let g=p;u&&(g=Se(p,r));let x;if(f){const y=n.texData.get(d.dataId).values,v=K4(y,pt(m),g,i.dtype);x=n.makeTensorInfo(g,i.dtype);const w=n.texData.get(x.dataId);w.values=v}else x=FX(d,m,g,n);return c&&n.disposeIntermediateTensorInfo(d),x}const PX={kernelName:bu,backendName:"webgl",kernelFunc:BS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX=bS+`
  return max(a, b);
`,LX=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+vh+`
  return result;
`,BX=qe({opSnippet:MX,packedOpSnippet:LX,cpuKernelImpl:J4}),zX={kernelName:Pa,backendName:"webgl",kernelFunc:BX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t;Il(i,"maxPool");const{filterSize:a,strides:u,pad:o,dimRoundingMode:r}=s,l=1;P(Qe(u,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${u} and dilations '${l}'`);const h=Zn(i.shape,a,u,l,o,r);if(h.filterWidth===1&&h.filterHeight===1&&Qt(h.inShape,h.outShape))return Tn({inputs:{x:i},backend:n});const c=new ia(h,"max",!1);return n.runWebGLProgram(c,[i],i.dtype)}const VX={kernelName:vu,backendName:"webgl",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{filterSize:a,strides:u,pad:o,dataFormat:r,dimRoundingMode:l}=s,h=[1,1,1],c=Ks(i.shape,a,u,h,o,l,r),f=new pm(c,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const GX={kernelName:yu,backendName:"webgl",kernelFunc:UX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HX{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,s=t.strideWidth,i=t.dilationHeight,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,o=a-1-t.padInfo.top,r=u-1-t.padInfo.left,l=a*u-1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${u} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class jX{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,s=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,o=t.dilationWidth,r=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,c=r-1-t.padInfo.front,f=l-1-t.padInfo.top,d=h-1-t.padInfo.left,p=r*l*h-1;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${r};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${o}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a}=t,u=a,{filterSize:o,strides:r,pad:l,dimRoundingMode:h}=s,c=[1,1,1],f=Ks(u.shape,o,r,c,l,h),d=new pm(f,"max",!0),p=n.runWebGLProgram(d,[u],u.dtype),m=new jX(f),g=n.runWebGLProgram(m,[i,p],u.dtype);return n.disposeIntermediateTensorInfo(p),g}const YX={kernelName:Zd,backendName:"webgl",kernelFunc:XX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(e){const{inputs:t,backend:n,attrs:s}=e,{dy:i,input:a,output:u}=t,o=a;Il([a,u],"maxPoolGrad");const{filterSize:r,strides:l,pad:h,dimRoundingMode:c}=s,f=Zn(o.shape,r,l,1,h,c),d=!0,p=new ia(f,"max",d),m=n.runWebGLProgram(p,[o],o.dtype),g=new HX(f),x=n.runWebGLProgram(g,[i,m],o.dtype);return n.disposeIntermediateTensorInfo(m),x}const KX={kernelName:Jd,backendName:"webgl",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(e,t,n,s){let i=new ia(n,"max",!1);const a=s.runWebGLProgram(i,[e],"float32");i=new ia(n,"max",!0,!0,t);const u=s.runWebGLProgram(i,[e],"float32");return[a,u]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZX={kernelName:Mb,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{filterSize:i,strides:a,pad:u,includeBatchInIndex:o}=t,r=n;P(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];P(Qe(a,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${l}'`);const h=Zn(s.shape,i,a,l,u),[c,f]=JX(s,o,h,r);return[c,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(e,t,n,s){const i=pt(t),u=pt(e.shape)/i,o=kt({inputs:{x:e},attrs:{shape:[u,i]},backend:s}),r=kr(o,"float32","mean",s),l=kt({inputs:{x:r},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(r),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t6={kernelName:wu,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{keepDims:i,axis:a}=t,u=n,o=s.shape.length,r=Ut(a,s.shape);let l=r;const h=be(l,o),c=h!=null,f=u.shouldExecuteOnCPU([s]),d=[];let p=s;if(c){if(f){const v=u.texData.get(p.dataId).values,w=new Array(o);for(let k=0;k<w.length;k++)w[k]=s.shape[h[k]];const C=fm(v,s.shape,s.dtype,h,w);p=u.makeTensorInfo(w,s.dtype);const S=u.texData.get(p.dataId);S.values=C}else p=wh(s,h,u);d.push(p),l=ke(l.length,o)}Ye("sum",l,o);const[m,g]=We(p.shape,l);let x=m;i&&(x=Se(m,r));const b=QX(p,g,x,u);for(const y of d)u.disposeIntermediateTensorInfo(y);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s,o=i.shape.length,r=Ut(a,i.shape);let l=r;const h=be(l,o);let c=i;h!=null&&(c=_e({inputs:{x:i},backend:n,attrs:{perm:h}}),l=ke(l.length,i.shape.length)),Ye("min",l,o);const[f,d]=We(c.shape,l),p=pt(d),m=kt({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}}),g=kr(m,m.dtype,"min",n);let x;if(u){const b=Se(f,r);x=kt({inputs:{x:g},backend:n,attrs:{shape:b}})}else x=kt({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),h!=null&&n.disposeIntermediateTensorInfo(c),x}const n6={kernelName:Cu,backendName:"webgl",kernelFunc:e6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s6=bS+`
  return min(a, b);
`,i6=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+vh+`
  return result;
`,r6=qe({opSnippet:s6,packedOpSnippet:i6,cpuKernelImpl:Z4}),o6={kernelName:Ma,backendName:"webgl",kernelFunc:r6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a6{constructor(t,n,s){this.variableNames=["x"],this.outputShape=n.map((h,c)=>h[0]+t[c]+h[1]);const i=t.length,a=ie(i),u=n.map(h=>h[0]).join(","),o=n.map((h,c)=>h[0]+t[c]).join(","),r=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${u};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${u});
      ${a} end = ${a}(${o});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+t[m]+p[1]);const i=t.length,a=ie(i),u=n.map(p=>p[0]).join(","),o=n.map((p,m)=>p[0]+t[m]).join(","),r=en("rc",i),l=en("source",i),h=`${r[i-1]} < ${this.outputShape[i-1]}`,c=i===1?"source":`vec2(${l.slice(-2).join()})`,f=s==="reflect"?0:1;let d="";if(i===1){const p=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${a} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${r[i-1]} += 1;
        if(${h}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
      `}else{const p=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${a} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${r[i-1]} += 1;
        if(${h}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
        rc = outputLoc;
        ${r[i-2]} += 1;
        if(${r[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${c});
          ${r[i-1]} += 1;
          if(${h}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${c});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${u});
      const ${a} end = ${a}(${o});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c6=({inputs:e,backend:t,attrs:n})=>{const{x:s}=e,{paddings:i,mode:a}=n,u=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l6(s.shape,i,a):new a6(s.shape,i,a);return t.runWebGLProgram(u,[s],s.dtype)},u6={kernelName:Su,backendName:"webgl",kernelFunc:c6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h6=`if (b == 0.0) return NAN;
  return mod(a, b);`,f6=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+vh+`
  return result;
`,d6=qe({opSnippet:h6,packedOpSnippet:f6}),p6={kernelName:La,backendName:"webgl",kernelFunc:d6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g6{constructor(t,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m6=`
if (a == b) {
  return 1.0;
};
return a / b;`,x6=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,zS=qe({opSnippet:m6,packedOpSnippet:x6,checkOutOfBounds:!0}),b6={kernelName:Ca,backendName:"webgl",kernelFunc:zS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v0="return a - b;",WS=qe({opSnippet:v0,packedOpSnippet:v0,supportsComplex:!0,cpuKernelImpl:gU}),v6={kernelName:tl,backendName:"webgl",kernelFunc:WS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VS(e){const{inputs:t,backend:n,attrs:s}=e,{logits:i}=t,{dim:a}=s,u=Ut([a],i.shape),o=BS({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),r=Se(o.shape,u),l=kt({inputs:{x:o},backend:n,attrs:{shape:r}}),h=WS({inputs:{a:i,b:l},backend:n}),c=PS({inputs:{x:h},backend:n}),f=Ch({inputs:{x:c},backend:n,attrs:{axis:u,keepDims:!1}}),d=kt({inputs:{x:f},backend:n,attrs:{shape:r}}),p=zS({inputs:{a:c,b:d},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}const y6={kernelName:Wu,backendName:"webgl",kernelFunc:VS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(e){const{inputs:t,backend:n,attrs:s}=e,{logits:i}=t,{numSamples:a,seed:u,normalized:o}=s,r=o?i:VS({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=r.shape[0],h=r.shape[1],c=new g6(l,h,a),f=[[u]],d=n.runWebGLProgram(c,[r],"int32",f);return o||n.disposeIntermediateTensorInfo(r),d}const C6={kernelName:Lb,backendName:"webgl",kernelFunc:w6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6=es+`
  return -x;
`,k6=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function I6(e){const{inputs:t,backend:n}=e,{x:s}=t;if(n.shouldExecuteOnCPU([s])){const a=n.texData.get(s.dataId),[u,o]=tU(a.values,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,u)}let i;return dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new qi(s.shape,k6):i=new Gs(s.shape,S6),n.runWebGLProgram(i,[s],s.dtype)}const T6={kernelName:ku,backendName:"webgl",kernelFunc:I6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6=eg;function $6(e){Nn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r}=s,l=n.readSync(i.dataId),h=n.readSync(a.dataId),{selectedIndices:c}=_6(l,h,u,o,r);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}const E6={kernelName:Qd,backendName:"webgl",kernelFunc:$6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N6=ng;function D6(e){Nn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r,padToMaxOutputSize:l}=s,h=n.readSync(i.dataId),c=n.readSync(a.dataId),{selectedIndices:f,validOutputs:d}=N6(h,c,u,o,r,l);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const A6={kernelName:tp,backendName:"webgl",kernelFunc:D6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R6=sg;function O6(e){Nn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:i,scores:a}=t,{maxOutputSize:u,iouThreshold:o,scoreThreshold:r,softNmsSigma:l}=s,h=n.readSync(i.dataId),c=n.readSync(a.dataId),f=u,d=o,p=r,m=l,{selectedIndices:g,selectedScores:x}=R6(h,c,f,d,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const F6={kernelName:ep,backendName:"webgl",kernelFunc:O6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P6{constructor(t,n,s,i){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M6=e=>{const{inputs:t,backend:n,attrs:s}=e,{indices:i}=t,{depth:a,onValue:u,offValue:o}=s,r=pt(i.shape),l=new P6(r,a,u,o),h=kt({inputs:{x:i},backend:n,attrs:{shape:[r]}}),c=n.runWebGLProgram(l,[h],i.dtype);n.disposeIntermediateTensorInfo(h);const f=[...i.shape,a],d=kt({inputs:{x:c},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),d},L6={kernelName:_u,backendName:"webgl",kernelFunc:M6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dc(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),a=Dc({inputs:{x:i},backend:n}),u=Sh({inputs:{input:s},backend:n}),o=Dc({inputs:{x:u},backend:n}),r=Ni({inputs:{real:a,imag:o},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(o),r}else return El({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const B6={kernelName:Gu,backendName:"webgl",kernelFunc:Dc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),a=US({inputs:{x:i},backend:n}),u=Sh({inputs:{input:s},backend:n}),o=Dc({inputs:{x:u},backend:n}),r=Ni({inputs:{real:a,imag:o},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(o),r}else return El({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const z6={kernelName:Tu,backendName:"webgl",kernelFunc:US};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(e){const{inputs:t,backend:n,attrs:s}=e,{axis:i}=s;if(t.length===1)return rd({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,u=t[0].dtype;t.forEach(h=>{Jn(a,h.shape,"All tensors passed to stack must have matching shapes"),P(u===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],r=t.map(h=>{const c=rd({inputs:{input:h},backend:n,attrs:{dim:i}});return o.push(c),c}),l=ES({inputs:r,backend:n,attrs:{axis:i}});return o.forEach(h=>n.disposeIntermediateTensorInfo(h)),l}const V6={kernelName:$u,backendName:"webgl",kernelFunc:W6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U6{constructor(t,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,h)=>l[0]+t[h]+l[1]);const i=t.length,a=ie(i),u=n.map(l=>l[0]).join(","),o=n.map((l,h)=>l[0]+t[h]).join(","),r=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${u};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${u});
      ${a} end = ${a}(${o});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G6{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+t[g]+m[1]);const i=t.length,a=ie(i),u=n.map(m=>m[0]).join(","),o=n.map((m,g)=>m[0]+t[g]).join(","),r=en("rc",i),l=en("source",i),h=`${r[i-1]} < ${this.outputShape[i-1]}`,c=i===1?"source":`vec2(${l.slice(-2).join()})`,f=[`${a} rc = outputLoc;`,`${r[i-1]} += 1;
       if(${h}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${r[i-2]} += 1;
       if(${r[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${r[i-1]} += 1;
         if(${h}) {`],d=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=i===1?2:4;m<g;m++)p+=`
        ${f[m]}
        if (${d}) {
          result[${m}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${m}] = getChannel(getX(${l.join()}), ${c});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${u});
      const ${a} end = ${a}(${o});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GS=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{paddings:a,constantValue:u}=s;if(pt(i.shape)===0){const l=a.map((h,c)=>h[0]+i.shape[c]+h[1]);return El({backend:n,attrs:{shape:l,value:u,dtype:i.dtype}})}const o=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new G6(i.shape,a,u):new U6(i.shape,a,u),r=[[u]];return n.runWebGLProgram(o,[i],i.dtype,r)},H6={kernelName:Eu,backendName:"webgl",kernelFunc:GS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j6=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,X6=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+vh+`
  return result;
`,Y6=qe({opSnippet:j6,packedOpSnippet:X6}),q6={kernelName:za,backendName:"webgl",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{axis:a,keepDims:u}=s,o=i.shape.length,r=[],l=Ut(a,i.shape);let h=l;const c=be(h,o);let f=i;c!=null&&(f=_e({inputs:{x:i},backend:n,attrs:{perm:c}}),h=ke(h.length,o),r.push(f)),Ye("prod",h,o);let d;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:m,outShape:g,outDtype:x}=nU(f.shape,f.dtype,p,h);d=n.makeTensorInfo(g,x,m)}else{const[p,m]=We(f.shape,h),g=pt(m),x=kt({inputs:{x:f},backend:n,attrs:{shape:[-1,g]}}),b=yp(i.dtype),y=kr(x,b,"prod",n);d=kt({inputs:{x:y},backend:n,attrs:{shape:p}}),r.push(x),r.push(y)}if(u){r.push(d);const p=Se(d.shape,l);d=kt({inputs:{x:d},backend:n,attrs:{shape:p}})}return r.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const J6={kernelName:Du,backendName:"webgl",kernelFunc:K6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HS=e=>{const{backend:t,attrs:n}=e,{start:s,stop:i,step:a,dtype:u}=n,o=sU(s,i,a,u);return t.makeTensorInfo([o.length],u,o)},Z6={kernelName:np,backendName:"webgl",kernelFunc:HS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6="return 1.0 / x;",tY=Kt({opSnippet:Q6}),eY={kernelName:Wa,backendName:"webgl",kernelFunc:tY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY=es+`
  return (x < 0.0) ? 0.0 : x;
`,sY=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iY=Kt({opSnippet:nY,packedOpSnippet:sY}),rY={kernelName:Va,backendName:"webgl",kernelFunc:iY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oY=es+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,aY=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lY=Kt({opSnippet:oY,packedOpSnippet:aY}),cY={kernelName:Ua,backendName:"webgl",kernelFunc:lY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uY{constructor(t,n,s,i,a){this.variableNames=["A"],this.outputShape=[];const[u,o,r,l]=t;this.outputShape=[u,n,s,l];const h=[i&&n>1?o-1:o,i&&s>1?r-1:r],c=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;a?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/c[0]},
          ${h[1]/c[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${r}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hY{constructor(t,n,s,i,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[u,o,r,l]=t;this.outputShape=[u,n,s,l];const h=[i&&n>1?o-1:o,i&&s>1?r-1:r],c=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;a?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/c[0]},
          ${h[1]/c[1]},
          ${h[1]/c[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${r}.0,
                                     ${r}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(e){const{inputs:t,backend:n,attrs:s}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:u,size:o}=s,[r,l]=o,h=dt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hY(i.shape,r,l,a,u):new uY(i.shape,r,l,a,u);return n.runWebGLProgram(h,[i],"float32")}const dY={kernelName:Ou,backendName:"webgl",kernelFunc:fY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pY{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,a]=n,[,u,o]=t,r=[s&&u>1?i-1:i,s&&o>1?a-1:a],l=[s&&u>1?u-1:u,s&&o>1?o-1:o],h=r[0]/l[0],c=r[1]/l[1],f=1/h,d=1/c,p=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${c});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${u}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gY(e){const{inputs:t,backend:n,attrs:s}=e,{images:i,dy:a}=t,{alignCorners:u}=s,o=new pY(a.shape,i.shape,u);return n.runWebGLProgram(o,[a],a.dtype)}const mY={kernelName:rp,backendName:"webgl",kernelFunc:gY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xY{constructor(t,n,s,i,a){this.variableNames=["A"],this.outputShape=[];const[u,o,r,l]=t;this.outputShape=[u,n,s,l];const h=[i&&n>1?o-1:o,i&&s>1?r-1:r],c=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let d;a?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/c[0]},
          ${h[1]/c[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${r}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bY{constructor(t,n,s,i,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[u,o,r,l]=t;this.outputShape=[u,n,s,l];const h=[i&&n>1?o-1:o,i&&s>1?r-1:r],c=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let d;a?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/c[0]},
          ${h[1]/c[1]},
          ${h[1]/c[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${r}.0,
                                     ${r}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(e){const{inputs:t,backend:n,attrs:s}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:u,size:o}=s,[r,l]=o,h=dt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new bY(i.shape,r,l,a,u):new xY(i.shape,r,l,a,u);return n.runWebGLProgram(h,[i],i.dtype)}const yY={kernelName:Ru,backendName:"webgl",kernelFunc:vY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wY{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,a]=n,[,u,o]=t,r=[s&&u>1?i-1:i,s&&o>1?a-1:a],l=[s&&u>1?u-1:u,s&&o>1?o-1:o],h=r[0]/l[0],c=r[1]/l[1],f=1/h,d=1/c,p=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${c});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${u}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float sourceFracRow =
              float(${r[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${r[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(e){const{inputs:t,backend:n,attrs:s}=e,{images:i,dy:a}=t,{alignCorners:u}=s,o=new wY(a.shape,i.shape,u);return n.runWebGLProgram(o,[a],a.dtype)}const SY={kernelName:ip,backendName:"webgl",kernelFunc:CY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kY{constructor(t,n){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const i=o=>n.indexOf(o)!==-1&&t[o]!==1?`${t[o]} - coords[${o}] - 1`:`coords[${o}]`,a=t.map((o,r)=>i(r)).join(","),u=ie(s);this.userCode=`
      void main() {
        ${u} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IY{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const i=en("rc",s),a=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,u=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,o=ie(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${r(i.slice())};
          if(${a}){
            result.g = ${l(i.slice())};
          }
          if(${u}) {
            result.b = ${h(i.slice())};
            if(${a}) {
              result.a = ${c(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function r(p){return f(p)}function l(p){return p[s-1]="("+p[s-1]+" + 1)",f(p)}function h(p){return p[s-2]="("+p[s-2]+" + 1)",f(p)}function c(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",f(p)}function f(p){const m=t.map((b,y)=>d(y,p)),g=m.join(","),x=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function d(p,m){return n.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{dims:a}=s,u=i.shape.length,o=Ut(a,i.shape);if(u===0)return Tn({inputs:{x:i},backend:n});const r=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new IY(i.shape,o):new kY(i.shape,o);return n.runWebGLProgram(r,[i],i.dtype)}const _Y={kernelName:Fu,backendName:"webgl",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Y{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],i=t[2];this.outputShape=t;let a="";typeof n=="number"?a=`float outputValue = ${n.toFixed(2)};`:a=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EY={kernelName:bp,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,{radians:i,fillValue:a,center:u}=t,o=n,r=new $Y(s.shape,a),[l,h]=dg(u,s.shape[1],s.shape[2]),c=[[l,h,Math.sin(i),Math.cos(i)]];return o.runWebGLProgram(r,[s],s.dtype,c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,DY=Kt({opSnippet:NY}),AY={kernelName:Ga,backendName:"webgl",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY="return inversesqrt(x);",OY=Kt({opSnippet:RY,cpuKernelImpl:iU}),FY={kernelName:Ha,backendName:"webgl",kernelFunc:OY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jS{constructor(t,n,s,i,a,u,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=u;const r=ie(a.length),l=ie(u.length);let h="";s===1?h="i":s===2&&(h="i, j");const c=`getIndices(${h})`;let f="";i===1?f="i":i===2&&(f="i, coords[1]");const d=`getUpdates(${f})`,p=n>1?"strides[j]":"strides";this.userCode=`
        ${r} strides = ${r}(${a});

        void main() {
          ${l} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${c});
              flattenedIndex += index * ${p};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${d};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(e){const{inputs:t,backend:n,attrs:s}=e,{indices:i,updates:a}=t,{shape:u}=s,{sliceRank:o,numUpdates:r,sliceSize:l,strides:h,outputSize:c}=al(a,i,u),f=[c/l,l];if(c===0)return n.makeTensorInfo(u,i.dtype);const d=kt({inputs:{x:i},backend:n,attrs:{shape:[r,o]}}),p=kt({inputs:{x:a},backend:n,attrs:{shape:[r,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new jS(r,o,d.shape.length,p.shape.length,h,f),x=n.runWebGLProgram(g,[p,d,m],p.dtype),b=kt({inputs:{x},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(m),b}const MY={kernelName:Bb,backendName:"webgl",kernelFunc:PY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LY{constructor(t,n,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const a="while (left < right) {",u=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,o=dt().getNumber("WEBGL_VERSION")===2?a:u,r=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${o}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${r} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BY(e){const{inputs:t,backend:n,attrs:s}=e,{sortedSequence:i,values:a}=t,{side:u}=s,o=new LY(i.shape[0],i.shape[1],a.shape[1],u),r=[[i.shape[1]]];return n.runWebGLProgram(o,[i,a],"int32",r)}const zY={kernelName:zb,backendName:"webgl",kernelFunc:BY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WY{constructor(t,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let i,a;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)a="resRC",i="resRC";else{const o=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],l=[];for(let h=0;h<n.length;h++)l.push(`${o[h]}`),h<t&&r.push(`${o[h]}`);i=r.join(),a=l.join()}const u=ie(s);this.userCode=`
      void main() {
        ${u} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VY(e){const{inputs:t,backend:n}=e,{condition:s,t:i,e:a}=t,u=new WY(s.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(u,[s,i,a],Cn(i.dtype,a.dtype))}const UY={kernelName:Pu,backendName:"webgl",kernelFunc:VY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GY=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${nh};
  float scale = ${sh};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,HY=Kt({opSnippet:GY}),jY={kernelName:ja,backendName:"webgl",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XY=Eo+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,YY=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qY=Kt({opSnippet:XY,packedOpSnippet:YY,cpuKernelImpl:oU}),KY={kernelName:Ka,backendName:"webgl",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,ZY=Kt({opSnippet:JY}),QY={kernelName:qa,backendName:"webgl",kernelFunc:ZY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq=Eo+`
  return sin(x);
`,eq=Kt({opSnippet:tq}),nq={kernelName:Xa,backendName:"webgl",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,iq=Kt({opSnippet:sq}),rq={kernelName:Ya,backendName:"webgl",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,aq=Kt({opSnippet:oq}),lq={kernelName:Ja,backendName:"webgl",kernelFunc:aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cq=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{blockShape:a,paddings:u}=s;P(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=a.reduce((x,b)=>x*b),r=[[0,0]];r.push(...u);for(let x=1+a.length;x<i.shape.length;++x)r.push([0,0]);const l=[],h=GS({inputs:{x:i},backend:n,attrs:{paddings:r,constantValue:0}}),c=fl(h.shape,a,o,!1),f=dl(c.length,a.length,!1),d=pl(h.shape,a,o,!1),p=kt({inputs:{x:h},backend:n,attrs:{shape:c}}),m=_e({inputs:{x:p},backend:n,attrs:{perm:f}}),g=kt({inputs:{x:m},backend:n,attrs:{shape:d}});return l.push(h),l.push(p),l.push(m),l.forEach(x=>n.disposeIntermediateTensorInfo(x)),g},uq={kernelName:Bu,backendName:"webgl",kernelFunc:cq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(e){const{inputs:t,backend:n}=e,{indices:s,values:i,denseShape:a,defaultValue:u}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${a.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(u.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${u.shape}`);const o=n.readSync(s.dataId),r=n.readSync(i.dataId),l=n.readSync(a.dataId),h=n.readSync(u.dataId)[0],[c,f,d,p,m]=lU(o,s.shape,s.dtype,r,i.dtype,l,h);return[n.makeTensorInfo(f,s.dtype,c),n.makeTensorInfo([f[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const fq={kernelName:op,backendName:"webgl",kernelFunc:hq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(e){const{inputs:t,backend:n}=e,{inputIndices:s,inputShape:i,newShape:a}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const u=Array.from(n.readSync(i.dataId)),o=n.readSync(s.dataId),r=Array.from(n.readSync(a.dataId)),[l,h,c]=cU(o,s.shape,s.dtype,u,r);return[n.makeTensorInfo(h,s.dtype,l),n.makeTensorInfo([c.length],a.dtype,new Int32Array(c))]}const pq={kernelName:ap,backendName:"webgl",kernelFunc:dq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(e){const{inputs:t,backend:n}=e,{data:s,indices:i,segmentIds:a}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${a.shape}`);const u=n.readSync(s.dataId),o=n.readSync(i.dataId),r=n.readSync(a.dataId),[l,h]=gS(u,s.shape,s.dtype,o,r,!0);return n.makeTensorInfo(h,s.dtype,l)}const mq={kernelName:lp,backendName:"webgl",kernelFunc:gq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(e){const{inputs:t,backend:n}=e,{data:s,indices:i,segmentIds:a}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${a.shape}`);const u=n.readSync(s.dataId),o=n.readSync(i.dataId),r=n.readSync(a.dataId),[l,h]=gS(u,s.shape,s.dtype,o,r);return n.makeTensorInfo(h,s.dtype,l)}const bq={kernelName:cp,backendName:"webgl",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vq(e){const{inputs:t,backend:n,attrs:s}=e,{sparseIndices:i,sparseValues:a,defaultValue:u}=t,{outputShape:o}=s,{sliceRank:r,numUpdates:l,sliceSize:h,strides:c,outputSize:f}=al(a,i,o),d=!1;if(a.dtype==="string"){const x=n.bufferSync(i),b=n.bufferSync(a),y=gi(n.readSync(u.dataId)[0]),v=rU(x,b,o,f,h,l,r,c,y,d);return n.makeTensorInfo(o,v.dtype,v.values)}const p=new jS(l,r,i.shape.length,a.shape.length,c,[f,1],d),m=n.runWebGLProgram(p,[a,i,u],a.dtype),g=kt({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),g}const yq={kernelName:Wb,backendName:"webgl",kernelFunc:vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{numOrSizeSplits:a,axis:u}=s,o=Ut(u,i.shape)[0],r=$g(i,a,o),l=i.shape.length,h=new Array(l).fill(0),c=i.shape.slice();return r.map(f=>{const d=[...c];d[o]=f;const p=No({inputs:{x:i},backend:n,attrs:{begin:h,size:d}});return h[o]+=f,p})}const Cq={kernelName:zu,backendName:"webgl",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y0="return sqrt(x);",Sq=Kt({opSnippet:y0,packedOpSnippet:y0,cpuKernelImpl:uU}),kq={kernelName:Za,backendName:"webgl",kernelFunc:Sq};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iq="return x * x;",Tq=Kt({opSnippet:Iq}),_q={kernelName:up,backendName:"webgl",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w0="return (a - b) * (a - b);",$q=qe({opSnippet:w0,packedOpSnippet:w0}),Eq={kernelName:Qa,backendName:"webgl",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq({inputs:e,attrs:t,backend:n}){const{x:s}=e,i=es+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,a=new Gs(s.shape,i);return n.runWebGLProgram(a,[s],s.dtype)}const Dq={kernelName:il,backendName:"webgl",kernelFunc:Nq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aq{constructor(t,n,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,a=ie(s.length),u=ie(s.length);let o="";if(i===1)o="coords * strides + begin";else{let r=0;o=s.map((l,h)=>(r++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${r-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${t});
      ${a} strides = ${a}(${n});

      void main() {
        ${u} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{begin:a,end:u,strides:o,beginMask:r,endMask:l,ellipsisMask:h,newAxisMask:c,shrinkAxisMask:f}=s,{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:x,begin:b,end:y,strides:v}=Ep(i.shape,a,u,o,r,l,h,c,f);let w;if(m)w=kt({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||x){P(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const S=Tp(b,y,v),k=No({inputs:{x:i},backend:n,attrs:{begin:b,size:S}});w=kt({inputs:{x:k},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(k)}else if(n.shouldExecuteOnCPU([i])){const k=n.readSync(i.dataId),T=Vt(i.shape,i.dtype,k),N=hU(d,T,v,b);w=n.makeTensorInfo(p,i.dtype,N.values)}else{const k=new Aq(b,v,d);w=n.runWebGLProgram(k,[i],i.dtype)}const C=kt({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),C}const Oq={kernelName:hp,backendName:"webgl",kernelFunc:Rq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(e){const{inputs:t,backend:n,attrs:s}=e,{separator:i,nGramWidths:a,leftPad:u,rightPad:o,padWidth:r,preserveShortSequences:l}=s,{data:h,dataSplits:c}=t,f=n.readSync(h.dataId),d=n.readSync(c.dataId),[p,m]=fU(f,d,i,a,u,o,r,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(c.shape,"int32",m)]}const Pq={kernelName:fp,backendName:"webgl",kernelFunc:Fq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mq(e){const{inputs:t,backend:n,attrs:s}=e,{skipEmpty:i}=s,{input:a,delimiter:u}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(u.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${u.shape}`);const o=n.readSync(a.dataId),r=n.readSync(u.dataId)[0],[l,h,c]=dU(o,r,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(c))]}const Lq={kernelName:dp,backendName:"webgl",kernelFunc:Mq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(e){const{inputs:t,backend:n,attrs:s}=e,{numBuckets:i}=s,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const u=n.readSync(a.dataId),o=pU(u,i);return n.makeTensorInfo(a.shape,"int32",o)}const zq={kernelName:pp,backendName:"webgl",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq="return tan(x);",Vq=Kt({opSnippet:Wq}),Uq={kernelName:el,backendName:"webgl",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Hq=Kt({opSnippet:Gq}),jq={kernelName:nl,backendName:"webgl",kernelFunc:Hq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xq{constructor(t,n){this.variableNames=["A"];const s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[u]*n[u];this.outputShape=s,this.rank=s.length;const i=ie(this.rank),a=Yq(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}}function Yq(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<e.length;i++)s.push(`imod(${n[i]}, ${e[i]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XS(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{reps:a}=s;if(i.dtype==="string"||i.shape.length>5){const r=n.readSync(i.dataId),l=i.dtype==="string"?r.map(f=>gi(f)):r,h=Vt(i.shape,i.dtype,l),c=mU(h,a);return n.makeTensorInfo(c.shape,c.dtype,c.values)}const u=new Xq(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const qq={kernelName:sl,backendName:"webgl",kernelFunc:XS};class Kq{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Jq{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pi(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function C0(e){let t=1;for(;t<e;)t*=2;return t}function Zq(e){const{inputs:t,backend:n,attrs:s}=e,{x:i}=t,{k:a,sorted:u}=s,o=dt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),r=dt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,h=l[l.length-1];if(n.shouldExecuteOnCPU([i])||h<o||a>r){const N=n.readSync(i.dataId),[R,L]=xU(N,l,i.dtype,a,u);return[n.makeTensorInfo(R.shape,R.dtype,R.values),n.makeTensorInfo(L.shape,L.dtype,L.values)]}if(a===0)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(h===1)return[i,El({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const c=n.texData.get(i.dataId),f=c!==null&&c.isPacked,d=f?n.unpackTensor(i):i,m=pt(l)/h,g=kt({inputs:{x:d},attrs:{shape:[m,h]},backend:n});f&&Pi(n,d);const x=C0(a),b=C0(h);let y=null;const v=()=>y===null?[g,g]:[g,y],w=(N,R,L)=>{const z=v(),U=new Kq(L),Y=[[h],[y===null?1:0],[Number.NEGATIVE_INFINITY],[N],[R]],Q=y;y=n.runWebGLProgram(U,z,"int32",Y),Pi(n,Q)};for(let N=1;N<x;N*=2){const R=N*2;for(let L=N;L>=1;L/=2)w(R,L,[m,b])}for(let N=b;N>x;N/=2){const R=v(),L=new Jq([m,N/2]),U=[[h],[y===null?1:0],[x]],H=y;y=n.runWebGLProgram(L,R,"int32",U),Pi(n,H);const Y=x/2,Q=Y*2;for(let K=Y;K>=1;K/=2)w(Q,K,y.shape)}let C=y;y=No({inputs:{x:y},backend:n,attrs:{begin:0,size:[m,a]}}),Pi(n,C);let S=LS({inputs:{x:g,indices:y},backend:n,attrs:{axis:1,batchDims:1}});Pi(n,g);const k=l.slice(0,-1);k.push(a),C=y,y=kt({inputs:{x:y},attrs:{shape:k},backend:n}),Pi(n,C);const T=S;return S=kt({inputs:{x:S},attrs:{shape:k},backend:n}),Pi(n,T),[S,y]}const Qq={kernelName:gp,backendName:"webgl",kernelFunc:Zq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tK{constructor(t,n,s,i,a,u){this.variableNames=["Image","Transforms"],this.outputShape=u;const o=s==="nearest"?1:2;let r;switch(i){case"constant":r=1;break;case"reflect":r=2;break;case"wrap":r=3;break;case"nearest":r=4;break;default:r=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${r} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${r} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${r} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${o} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(e){const{inputs:t,backend:n,attrs:s}=e,{image:i,transforms:a}=t,{interpolation:u,fillMode:o,fillValue:r,outputShape:l}=s,[h,c,f,d]=i.shape,[p,m]=l!=null?l:[c,f],g=[h,p,m,d],x=new tK(c,f,u,o,r,g);return n.runWebGLProgram(x,[i,a],"float32")}const nK={kernelName:mp,backendName:"webgl",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(e){const{inputs:t,attrs:n,backend:s}=e,{axis:i}=n,{x:a}=t;Il(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const u=s.readSync(a.dataId),{outputValues:o,outputShape:r,indices:l}=bU(u,i,a.shape,a.dtype);return[s.makeTensorInfo(r,a.dtype,o),s.makeTensorInfo([l.length],"int32",l)]}const iK={kernelName:xp,backendName:"webgl",kernelFunc:sK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(e){const{inputs:t,backend:n,attrs:s}=e,{value:i}=t;let{axis:a}=s;a<0&&(a+=i.shape.length);const u=i,o=u.shape.length,r=i.shape[a],l=new Array(o-1);let h=0;for(let m=0;m<o;m++)m!==a&&(l[h++]=u.shape[m]);const c=[],f=new Array(o).fill(0),d=u.shape.slice();d[a]=1;const p=new Array(r);for(let m=0;m<p.length;m++){f[a]=m;const g=No({inputs:{x:u},backend:n,attrs:{begin:f,size:d}}),x=kt({inputs:{x:g},backend:n,attrs:{shape:l}});p[m]=x,c.push(g)}return c.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const oK={kernelName:Vu,backendName:"webgl",kernelFunc:rK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aK{constructor(t,n){this.variableNames=["x","segmentIds"];const s=t.windowSize,i=t.batchSize,a=t.inSize,u=t.numSegments,o=u*Math.ceil(a/s);this.outputShape=[i,o];const r="0.0",l="sumValue",h=Math.floor(s/4)*4,c=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let d="";a%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let p="";a%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${r};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${u})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${u})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${c===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(e){const{inputs:t,backend:n,attrs:s}=e,{x:i,segmentIds:a}=t,{numSegments:u}=s,o=i.shape.length,r=[];let l=0;const h=be([l],o);let c=i;h!=null&&(c=_e({inputs:{x:i},backend:n,attrs:{perm:h}}),r.push(c),l=ke(1,o)[0]);const f=Ey(c.shape,l,u),d=pt([c.shape[l]]),p=kt({inputs:{x:c},backend:n,attrs:{shape:[-1,d]}});r.push(p);const m=yp(i.dtype),g=(v,w,C,S,k)=>{const T=v.shape[0],N=v.shape[1],R=$y(N,k),L={windowSize:R,inSize:N,batchSize:T,numSegments:k},z=new aK(L,w),U=n.compileAndRun(z,[v,C],S);if(r.push(U),U.shape[1]===k)return U;const H=HS({backend:n,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),Y=XS({inputs:{x:H},backend:n,attrs:{reps:[N/R]}});return r.push(H),r.push(Y),g(U,w,Y,S,k)},x=g(p,"unsortedSegmentSum",a,m,u),b=kt({inputs:{x},backend:n,attrs:{shape:f}});let y=b;if(h!=null){r.push(b);const v=ki(h);y=_e({inputs:{x:y},backend:n,attrs:{perm:v}})}return r.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}const cK={kernelName:Uu,backendName:"webgl",kernelFunc:lK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK=[hG,dG,mG,vG,wG,kG,TG,$G,AG,OG,MG,zG,UG,XG,KG,ZG,tH,iH,oH,lH,fH,vH,wH,SH,EH,DH,FH,jU,LH,UH,XH,QH,ej,sj,rj,aj,uj,dj,mj,bj,yj,Cj,Ij,_j,Dj,Rj,Pj,Bj,Wj,Hj,qj,Qj,n5,r5,o5,l5,u5,f5,p5,m5,y5,S5,T5,$5,D5,O5,L5,V5,HU,G5,WH,X5,K5,Q5,YU,sX,aX,cX,dX,mX,yX,SX,_X,DX,OX,PX,zX,VX,GX,YX,KX,ZX,t6,n6,o6,u6,p6,C6,QU,T6,E6,A6,F6,IH,L6,z6,V6,H6,q6,KU,J6,Z6,TH,b6,eY,rY,cY,eG,dY,mY,yY,SY,_Y,EY,AY,FY,MY,zY,UY,jY,KY,QY,nq,rq,xH,y6,lq,uq,fq,pq,mq,bq,yq,Cq,kq,_q,Eq,Dq,Oq,Pq,Lq,zq,v6,lG,Uq,jq,qq,Qq,nK,cG,iK,oK,cK,B6];for(const e of uK)Ub(e);/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(e,t,n,s,i){let r=lt(()=>{const l=e.E.slice([0,1,0]).pad([[0,0],[0,1],[0,0]]).sub(e.E),h=e.E.slice([1,0,0]).pad([[0,1],[0,0],[0,0]]).sub(e.E),c=we([h.gather(2,2).expandDims(2),l.gather(2,2).expandDims(2).mul(-1),l.gather(1,2).sub(h.gather(0,2)).expandDims(2)],2);return Sn(e.H.sub(c.div(t).div(e.u).mul(n).mul(e.dilation)).mul(e.attenuation).mul(e.absorption).mul(.9999),-1e10,1e10)});Lt(e.H),e.H=r,r=lt(()=>{const l=e.H.sub(e.H.slice([0,0,0],[-1,e.H.shape[1]-1,-1]).pad([[0,0],[1,0],[0,0]])),h=e.H.sub(e.H.slice([0,0,0],[e.H.shape[0]-1,-1,-1]).pad([[1,0],[0,0],[0,0]])),c=we([h.gather(2,2).expandDims(2),l.gather(2,2).expandDims(2).mul(-1),l.gather(1,2).sub(h.gather(0,2)).expandDims(2)],2);return e.E.add(e.emission.mul(Jo(s*i)).mul(i/10).mul(n).pad([[0,0],[0,0],[2,0]])).add(c.div(t).div(e.e).mul(n).mul(e.dilation)).mul(e.absorption).mul(e.attenuation)}),Lt(e.E),e.E=r,r=lt(()=>{let l=e.E.gather(2,2).expandDims(2);return we([l.mul(Jo(s*i)),l.mul(jp(s*i))],2).mul(n).add(e.power).mul(.998)}),Lt(e.power),e.power=r}function fK(e=600,t=400,n=40,s=1,i=.3){this.t=0,this.dx=s,this.dt=i,this.settings={wavelength:10},this.pixel_W=e,this.pixel_H=t,this.sim_W=e+n*2,this.sim_H=t+n*2;const a=this.sim_W*s,u=this.sim_H*s,o=no(0,this.sim_W).mul(s).cast("float32"),r=no(0,this.sim_H).mul(s).cast("float32"),l=WE(o,r);console.log(l[0]);const h=tr(tr(l[0],l[1]),tr(Tt(a,l[0]),Tt(u,l[1]))).div(n).clipByValue(0,1),c=h.sub(1).abs().mul(-.05).exp().expandDims(2),f=h.sub(1).abs().mul(-.1).exp().expandDims(2);this.fields={E:ae([this.sim_H,this.sim_W,3]),H:ae([this.sim_H,this.sim_W,3]),e:yn([this.sim_H,this.sim_W,1]),u:yn([this.sim_H,this.sim_W,1]),power:ae([this.sim_H,this.sim_W,2]),gx:l[0],gy:l[1],dilation:c,attenuation:f,absorption:ae([this.sim_H,this.sim_W,1]),emission:ae([this.sim_H,this.sim_W,1])},this.clear=function(){this.t=0,this.fields.E.dispose(),this.fields.E=ae([this.sim_H,this.sim_W,3]),this.fields.H.dispose(),this.fields.H=ae([this.sim_H,this.sim_W,3]),this.fields.power.dispose(),this.fields.power=ae([this.sim_H,this.sim_W,2])},this.update=function(){const d=2*Math.PI/this.settings.wavelength,p=Math.min(.5,this.settings.wavelength/10);for(let m=0;m<5;m++)this.t+=p,hK(this.fields,this.dx,p,this.t,d);for(let m in this.fields)this.fields[m]=ms(this.fields[m])}}var jr={},dK={},pK=Object.freeze(Object.defineProperty({__proto__:null,default:dK},Symbol.toStringTag,{value:"Module"})),qh=XT(pK);(function(e){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.2.1"};if(e.fabric=t,typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var n=qh,s=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=s.document,t.jsdomImplForWrapper=qh.implForWrapper,t.nodeCanvas=qh.Canvas,t.window=s,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=t),function(){function o(d,p){if(!!this.__eventListeners[d]){var m=this.__eventListeners[d];p?m[m.indexOf(p)]=!1:t.util.array.fill(m,!1)}}function r(d,p){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var m in d)this.on(m,d[m]);else this.__eventListeners[d]||(this.__eventListeners[d]=[]),this.__eventListeners[d].push(p);return this}function l(d,p){var m=function(){p.apply(this,arguments),this.off(d,m)}.bind(this);this.on(d,m)}function h(d,p){if(arguments.length===1)for(var m in d)l.call(this,m,d[m]);else l.call(this,d,p);return this}function c(d,p){if(!this.__eventListeners)return this;if(arguments.length===0)for(d in this.__eventListeners)o.call(this,d);else if(arguments.length===1&&typeof arguments[0]=="object")for(var m in d)o.call(this,m,d[m]);else o.call(this,d,p);return this}function f(d,p){if(!this.__eventListeners)return this;var m=this.__eventListeners[d];if(!m)return this;for(var g=0,x=m.length;g<x;g++)m[g]&&m[g].call(this,p||{});return this.__eventListeners[d]=m.filter(function(b){return b!==!1}),this}t.Observable={fire:f,on:r,once:h,off:c}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var o=0,r=arguments.length;o<r;o++)this._onObjectAdded(arguments[o]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(o,r,l){var h=this._objects;return l?h[r]=o:h.splice(r,0,o),this._onObjectAdded&&this._onObjectAdded(o),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var o=this._objects,r,l=!1,h=0,c=arguments.length;h<c;h++)r=o.indexOf(arguments[h]),r!==-1&&(l=!0,o.splice(r,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[h]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(o,r){for(var l=this.getObjects(),h=0,c=l.length;h<c;h++)o.call(r,l[h],h,l);return this},getObjects:function(o){return typeof o=="undefined"?this._objects.concat():this._objects.filter(function(r){return r.type===o})},item:function(o){return this._objects[o]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(o,r){return this._objects.indexOf(o)>-1?!0:r?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(o,!0)}):!1},complexity:function(){return this._objects.reduce(function(o,r){return o+=r.complexity?r.complexity():0,o},0)}},t.CommonMethods={_setOptions:function(o){for(var r in o)this.set(r,o[r])},_initGradient:function(o,r){o&&o.colorStops&&!(o instanceof t.Gradient)&&this.set(r,new t.Gradient(o))},_initPattern:function(o,r,l){o&&o.source&&!(o instanceof t.Pattern)?this.set(r,new t.Pattern(o,l)):l&&l()},_setObject:function(o){for(var r in o)this._set(r,o[r])},set:function(o,r){return typeof o=="object"?this._setObject(o):this._set(o,r),this},_set:function(o,r){this[o]=r},toggle:function(o){var r=this.get(o);return typeof r=="boolean"&&this.set(o,!r),this},get:function(o){return this[o]}},function(o){var r=Math.sqrt,l=Math.atan2,h=Math.pow,c=Math.PI/180,f=Math.PI/2;t.util={cos:function(d){if(d===0)return 1;d<0&&(d=-d);var p=d/f;switch(p){case 1:case 3:return 0;case 2:return-1}return Math.cos(d)},sin:function(d){if(d===0)return 0;var p=d/f,m=1;switch(d<0&&(m=-1),p){case 1:return m;case 2:return 0;case 3:return-m}return Math.sin(d)},removeFromArray:function(d,p){var m=d.indexOf(p);return m!==-1&&d.splice(m,1),d},getRandomInt:function(d,p){return Math.floor(Math.random()*(p-d+1))+d},degreesToRadians:function(d){return d*c},radiansToDegrees:function(d){return d/c},rotatePoint:function(d,p,m){var g=new t.Point(d.x-p.x,d.y-p.y),x=t.util.rotateVector(g,m);return new t.Point(x.x,x.y).addEquals(p)},rotateVector:function(d,p){var m=t.util.sin(p),g=t.util.cos(p),x=d.x*g-d.y*m,b=d.x*m+d.y*g;return{x,y:b}},createVector:function(d,p){return new t.Point(p.x-d.x,p.y-d.y)},calcAngleBetweenVectors:function(d,p){return Math.acos((d.x*p.x+d.y*p.y)/(Math.hypot(d.x,d.y)*Math.hypot(p.x,p.y)))},getHatVector:function(d){return new t.Point(d.x,d.y).multiply(1/Math.hypot(d.x,d.y))},getBisector:function(d,p,m){var g=t.util.createVector(d,p),x=t.util.createVector(d,m),b=t.util.calcAngleBetweenVectors(g,x),y=t.util.calcAngleBetweenVectors(t.util.rotateVector(g,b),x),v=b*(y===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(g,v)),angle:b}},projectStrokeOnPoints:function(d,p,m){var g=[],x=p.strokeWidth/2,b=p.strokeUniform?new t.Point(1/p.scaleX,1/p.scaleY):new t.Point(1,1),y=function(v){var w=x/Math.hypot(v.x,v.y);return new t.Point(v.x*w*b.x,v.y*w*b.y)};return d.length<=1||d.forEach(function(v,w){var C=new t.Point(v.x,v.y),S,k;w===0?(k=d[w+1],S=m?y(t.util.createVector(k,C)).addEquals(C):d[d.length-1]):w===d.length-1?(S=d[w-1],k=m?y(t.util.createVector(S,C)).addEquals(C):d[0]):(S=d[w-1],k=d[w+1]);var T=t.util.getBisector(C,S,k),N=T.vector,R=T.angle,L,z;if(p.strokeLineJoin==="miter"&&(L=-x/Math.sin(R/2),z=new t.Point(N.x*L*b.x,N.y*L*b.y),Math.hypot(z.x,z.y)/x<=p.strokeMiterLimit)){g.push(C.add(z)),g.push(C.subtract(z));return}L=-x*Math.SQRT2,z=new t.Point(N.x*L*b.x,N.y*L*b.y),g.push(C.add(z)),g.push(C.subtract(z))}),g},transformPoint:function(d,p,m){return m?new t.Point(p[0]*d.x+p[2]*d.y,p[1]*d.x+p[3]*d.y):new t.Point(p[0]*d.x+p[2]*d.y+p[4],p[1]*d.x+p[3]*d.y+p[5])},makeBoundingBoxFromPoints:function(d,p){if(p)for(var m=0;m<d.length;m++)d[m]=t.util.transformPoint(d[m],p);var g=[d[0].x,d[1].x,d[2].x,d[3].x],x=t.util.array.min(g),b=t.util.array.max(g),y=b-x,v=[d[0].y,d[1].y,d[2].y,d[3].y],w=t.util.array.min(v),C=t.util.array.max(v),S=C-w;return{left:x,top:w,width:y,height:S}},invertTransform:function(d){var p=1/(d[0]*d[3]-d[1]*d[2]),m=[p*d[3],-p*d[1],-p*d[2],p*d[0]],g=t.util.transformPoint({x:d[4],y:d[5]},m,!0);return m[4]=-g.x,m[5]=-g.y,m},toFixed:function(d,p){return parseFloat(Number(d).toFixed(p))},parseUnit:function(d,p){var m=/\D{0,2}$/.exec(d),g=parseFloat(d);switch(p||(p=t.Text.DEFAULT_SVG_FONT_SIZE),m[0]){case"mm":return g*t.DPI/25.4;case"cm":return g*t.DPI/2.54;case"in":return g*t.DPI;case"pt":return g*t.DPI/72;case"pc":return g*t.DPI/72*12;case"em":return g*p;default:return g}},falseFunction:function(){return!1},getKlass:function(d,p){return d=t.util.string.camelize(d.charAt(0).toUpperCase()+d.slice(1)),t.util.resolveNamespace(p)[d]},getSvgAttributes:function(d){var p=["instantiated_by_use","style","id","class"];switch(d){case"linearGradient":p=p.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":p=p.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":p=p.concat(["offset","stop-color","stop-opacity"]);break}return p},resolveNamespace:function(d){if(!d)return t;var p=d.split("."),m=p.length,g,x=o||t.window;for(g=0;g<m;++g)x=x[p[g]];return x},loadImage:function(d,p,m,g){if(!d){p&&p.call(m,d);return}var x=t.util.createImage(),b=function(){p&&p.call(m,x,!1),x=x.onload=x.onerror=null};x.onload=b,x.onerror=function(){t.log("Error loading "+x.src),p&&p.call(m,null,!0),x=x.onload=x.onerror=null},d.indexOf("data")!==0&&g!==void 0&&g!==null&&(x.crossOrigin=g),d.substring(0,14)==="data:image/svg"&&(x.onload=null,t.util.loadImageInDom(x,b)),x.src=d},loadImageInDom:function(d,p){var m=t.document.createElement("div");m.style.width=m.style.height="1px",m.style.left=m.style.top="-100%",m.style.position="absolute",m.appendChild(d),t.document.querySelector("body").appendChild(m),d.onload=function(){p(),m.parentNode.removeChild(m),m=null}},enlivenObjects:function(d,p,m,g){d=d||[];var x=[],b=0,y=d.length;function v(){++b===y&&p&&p(x.filter(function(w){return w}))}if(!y){p&&p(x);return}d.forEach(function(w,C){if(!w||!w.type){v();return}var S=t.util.getKlass(w.type,m);S.fromObject(w,function(k,T){T||(x[C]=k),g&&g(w,k,T),v()})})},enlivenObjectEnlivables:function(d,p,m){var g=t.Object.ENLIVEN_PROPS.filter(function(x){return!!d[x]});t.util.enlivenObjects(g.map(function(x){return d[x]}),function(x){var b={};g.forEach(function(y,v){b[y]=x[v],p&&(p[y]=x[v])}),m&&m(b)})},enlivenPatterns:function(d,p){d=d||[];function m(){++x===b&&p&&p(g)}var g=[],x=0,b=d.length;if(!b){p&&p(g);return}d.forEach(function(y,v){y&&y.source?new t.Pattern(y,function(w){g[v]=w,m()}):(g[v]=y,m())})},groupSVGElements:function(d,p,m){var g;return d&&d.length===1?d[0]:(p&&(p.width&&p.height?p.centerPoint={x:p.width/2,y:p.height/2}:(delete p.width,delete p.height)),g=new t.Group(d,p),typeof m!="undefined"&&(g.sourcePath=m),g)},populateWithProperties:function(d,p,m){if(m&&Array.isArray(m))for(var g=0,x=m.length;g<x;g++)m[g]in d&&(p[m[g]]=d[m[g]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(d){var p=t.util.createCanvasElement();return p.width=d.width,p.height=d.height,p.getContext("2d").drawImage(d,0,0),p},toDataURL:function(d,p,m){return d.toDataURL("image/"+p,m)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(d,p,m){return[d[0]*p[0]+d[2]*p[1],d[1]*p[0]+d[3]*p[1],d[0]*p[2]+d[2]*p[3],d[1]*p[2]+d[3]*p[3],m?0:d[0]*p[4]+d[2]*p[5]+d[4],m?0:d[1]*p[4]+d[3]*p[5]+d[5]]},qrDecompose:function(d){var p=l(d[1],d[0]),m=h(d[0],2)+h(d[1],2),g=r(m),x=(d[0]*d[3]-d[2]*d[1])/g,b=l(d[0]*d[2]+d[1]*d[3],m);return{angle:p/c,scaleX:g,scaleY:x,skewX:b/c,skewY:0,translateX:d[4],translateY:d[5]}},calcRotateMatrix:function(d){if(!d.angle)return t.iMatrix.concat();var p=t.util.degreesToRadians(d.angle),m=t.util.cos(p),g=t.util.sin(p);return[m,g,-g,m,0,0]},calcDimensionsMatrix:function(d){var p=typeof d.scaleX=="undefined"?1:d.scaleX,m=typeof d.scaleY=="undefined"?1:d.scaleY,g=[d.flipX?-p:p,0,0,d.flipY?-m:m,0,0],x=t.util.multiplyTransformMatrices,b=t.util.degreesToRadians;return d.skewX&&(g=x(g,[1,0,Math.tan(b(d.skewX)),1],!0)),d.skewY&&(g=x(g,[1,Math.tan(b(d.skewY)),0,1],!0)),g},composeMatrix:function(d){var p=[1,0,0,1,d.translateX||0,d.translateY||0],m=t.util.multiplyTransformMatrices;return d.angle&&(p=m(p,t.util.calcRotateMatrix(d))),(d.scaleX!==1||d.scaleY!==1||d.skewX||d.skewY||d.flipX||d.flipY)&&(p=m(p,t.util.calcDimensionsMatrix(d))),p},resetObjectTransform:function(d){d.scaleX=1,d.scaleY=1,d.skewX=0,d.skewY=0,d.flipX=!1,d.flipY=!1,d.rotate(0)},saveObjectTransform:function(d){return{scaleX:d.scaleX,scaleY:d.scaleY,skewX:d.skewX,skewY:d.skewY,angle:d.angle,left:d.left,flipX:d.flipX,flipY:d.flipY,top:d.top}},isTransparent:function(d,p,m,g){g>0&&(p>g?p-=g:p=0,m>g?m-=g:m=0);var x=!0,b,y,v=d.getImageData(p,m,g*2||1,g*2||1),w=v.data.length;for(b=3;b<w&&(y=v.data[b],x=y<=0,x!==!1);b+=4);return v=null,x},parsePreserveAspectRatioAttribute:function(d){var p="meet",m="Mid",g="Mid",x=d.split(" "),b;return x&&x.length&&(p=x.pop(),p!=="meet"&&p!=="slice"?(b=p,p="meet"):x.length&&(b=x.pop())),m=b!=="none"?b.slice(1,4):"none",g=b!=="none"?b.slice(5,8):"none",{meetOrSlice:p,alignX:m,alignY:g}},clearFabricFontCache:function(d){d=(d||"").toLowerCase(),d?t.charWidthsCache[d]&&delete t.charWidthsCache[d]:t.charWidthsCache={}},limitDimsByArea:function(d,p){var m=Math.sqrt(p*d),g=Math.floor(p/m);return{x:Math.floor(m),y:g}},capValue:function(d,p,m){return Math.max(d,Math.min(p,m))},findScaleToFit:function(d,p){return Math.min(p.width/d.width,p.height/d.height)},findScaleToCover:function(d,p){return Math.max(p.width/d.width,p.height/d.height)},matrixToSVG:function(d){return"matrix("+d.map(function(p){return t.util.toFixed(p,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(d,p){var m=t.util.invertTransform(p),g=t.util.multiplyTransformMatrices(m,d.calcOwnMatrix());t.util.applyTransformToObject(d,g)},addTransformToObject:function(d,p){t.util.applyTransformToObject(d,t.util.multiplyTransformMatrices(p,d.calcOwnMatrix()))},applyTransformToObject:function(d,p){var m=t.util.qrDecompose(p),g=new t.Point(m.translateX,m.translateY);d.flipX=!1,d.flipY=!1,d.set("scaleX",m.scaleX),d.set("scaleY",m.scaleY),d.skewX=m.skewX,d.skewY=m.skewY,d.angle=m.angle,d.setPositionByOrigin(g,"center","center")},sizeAfterTransform:function(d,p,m){var g=d/2,x=p/2,b=[{x:-g,y:-x},{x:g,y:-x},{x:-g,y:x},{x:g,y:x}],y=t.util.calcDimensionsMatrix(m),v=t.util.makeBoundingBoxFromPoints(b,y);return{x:v.width,y:v.height}},mergeClipPaths:function(d,p){var m=d,g=p;m.inverted&&!g.inverted&&(m=p,g=d),t.util.applyTransformToObject(g,t.util.multiplyTransformMatrices(t.util.invertTransform(m.calcTransformMatrix()),g.calcTransformMatrix()));var x=m.inverted&&g.inverted;return x&&(m.inverted=g.inverted=!1),new t.Group([m],{clipPath:g,inverted:x})}}}(e),function(){var o=Array.prototype.join,r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function h(I,A,D,F,j,O,_,V,X,rt,st){var ot=t.util.cos(I),ht=t.util.sin(I),mt=t.util.cos(A),$=t.util.sin(A),E=D*j*mt-F*O*$+_,B=F*j*mt+D*O*$+V,G=rt+X*(-D*j*ht-F*O*ot),W=st+X*(-F*j*ht+D*O*ot),J=E+X*(D*j*$+F*O*mt),at=B+X*(F*j*$-D*O*mt);return["C",G,W,J,at,E,B]}function c(I,A,D,F,j,O,_){var V=Math.PI,X=_*V/180,rt=t.util.sin(X),st=t.util.cos(X),ot=0,ht=0;D=Math.abs(D),F=Math.abs(F);var mt=-st*I*.5-rt*A*.5,$=-st*A*.5+rt*I*.5,E=D*D,B=F*F,G=$*$,W=mt*mt,J=E*B-E*G-B*W,at=0;if(J<0){var ct=Math.sqrt(1-J/(E*B));D*=ct,F*=ct}else at=(j===O?-1:1)*Math.sqrt(J/(E*G+B*W));var ut=at*D*$/F,q=-at*F*mt/D,gt=st*ut-rt*q+I*.5,xt=rt*ut+st*q+A*.5,vt=f(1,0,(mt-ut)/D,($-q)/F),Ct=f((mt-ut)/D,($-q)/F,(-mt-ut)/D,(-$-q)/F);O===0&&Ct>0?Ct-=2*V:O===1&&Ct<0&&(Ct+=2*V);for(var It=Math.ceil(Math.abs(Ct/V*2)),Ft=[],Ot=Ct/It,Ht=8/3*Math.sin(Ot/4)*Math.sin(Ot/4)/Math.sin(Ot/2),Te=vt+Ot,Fe=0;Fe<It;Fe++)Ft[Fe]=h(vt,Te,st,rt,D,F,gt,xt,Ht,ot,ht),ot=Ft[Fe][5],ht=Ft[Fe][6],vt=Te,Te+=Ot;return Ft}function f(I,A,D,F){var j=Math.atan2(A,I),O=Math.atan2(F,D);return O>=j?O-j:2*Math.PI-(j-O)}function d(I,A,D,F,j,O,_,V){var X;if(t.cachesBoundsOfCurve&&(X=o.call(arguments),t.boundsOfCurveCache[X]))return t.boundsOfCurveCache[X];var rt=Math.sqrt,st=Math.min,ot=Math.max,ht=Math.abs,mt=[],$=[[],[]],E,B,G,W,J,at,ct,ut;B=6*I-12*D+6*j,E=-3*I+9*D-9*j+3*_,G=3*D-3*I;for(var q=0;q<2;++q){if(q>0&&(B=6*A-12*F+6*O,E=-3*A+9*F-9*O+3*V,G=3*F-3*A),ht(E)<1e-12){if(ht(B)<1e-12)continue;W=-G/B,0<W&&W<1&&mt.push(W);continue}ct=B*B-4*G*E,!(ct<0)&&(ut=rt(ct),J=(-B+ut)/(2*E),0<J&&J<1&&mt.push(J),at=(-B-ut)/(2*E),0<at&&at<1&&mt.push(at))}for(var gt,xt,vt=mt.length,Ct=vt,It;vt--;)W=mt[vt],It=1-W,gt=It*It*It*I+3*It*It*W*D+3*It*W*W*j+W*W*W*_,$[0][vt]=gt,xt=It*It*It*A+3*It*It*W*F+3*It*W*W*O+W*W*W*V,$[1][vt]=xt;$[0][Ct]=I,$[1][Ct]=A,$[0][Ct+1]=_,$[1][Ct+1]=V;var Ft=[{x:st.apply(null,$[0]),y:st.apply(null,$[1])},{x:ot.apply(null,$[0]),y:ot.apply(null,$[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[X]=Ft),Ft}function p(I,A,D){for(var F=D[1],j=D[2],O=D[3],_=D[4],V=D[5],X=D[6],rt=D[7],st=c(X-I,rt-A,F,j,_,V,O),ot=0,ht=st.length;ot<ht;ot++)st[ot][1]+=I,st[ot][2]+=A,st[ot][3]+=I,st[ot][4]+=A,st[ot][5]+=I,st[ot][6]+=A;return st}function m(I){var A=0,D=0,F=I.length,j=0,O=0,_,V,X,rt=[],st,ot,ht;for(V=0;V<F;++V){switch(X=!1,_=I[V].slice(0),_[0]){case"l":_[0]="L",_[1]+=A,_[2]+=D;case"L":A=_[1],D=_[2];break;case"h":_[1]+=A;case"H":_[0]="L",_[2]=D,A=_[1];break;case"v":_[1]+=D;case"V":_[0]="L",D=_[1],_[1]=A,_[2]=D;break;case"m":_[0]="M",_[1]+=A,_[2]+=D;case"M":A=_[1],D=_[2],j=_[1],O=_[2];break;case"c":_[0]="C",_[1]+=A,_[2]+=D,_[3]+=A,_[4]+=D,_[5]+=A,_[6]+=D;case"C":ot=_[3],ht=_[4],A=_[5],D=_[6];break;case"s":_[0]="S",_[1]+=A,_[2]+=D,_[3]+=A,_[4]+=D;case"S":st==="C"?(ot=2*A-ot,ht=2*D-ht):(ot=A,ht=D),A=_[3],D=_[4],_[0]="C",_[5]=_[3],_[6]=_[4],_[3]=_[1],_[4]=_[2],_[1]=ot,_[2]=ht,ot=_[3],ht=_[4];break;case"q":_[0]="Q",_[1]+=A,_[2]+=D,_[3]+=A,_[4]+=D;case"Q":ot=_[1],ht=_[2],A=_[3],D=_[4];break;case"t":_[0]="T",_[1]+=A,_[2]+=D;case"T":st==="Q"?(ot=2*A-ot,ht=2*D-ht):(ot=A,ht=D),_[0]="Q",A=_[1],D=_[2],_[1]=ot,_[2]=ht,_[3]=A,_[4]=D;break;case"a":_[0]="A",_[6]+=A,_[7]+=D;case"A":X=!0,rt=rt.concat(p(A,D,_)),A=_[6],D=_[7];break;case"z":case"Z":A=j,D=O;break}X||rt.push(_),st=_[0]}return rt}function g(I,A,D,F){return Math.sqrt((D-I)*(D-I)+(F-A)*(F-A))}function x(I){return I*I*I}function b(I){return 3*I*I*(1-I)}function y(I){return 3*I*(1-I)*(1-I)}function v(I){return(1-I)*(1-I)*(1-I)}function w(I,A,D,F,j,O,_,V){return function(X){var rt=x(X),st=b(X),ot=y(X),ht=v(X);return{x:_*rt+j*st+D*ot+I*ht,y:V*rt+O*st+F*ot+A*ht}}}function C(I,A,D,F,j,O,_,V){return function(X){var rt=1-X,st=3*rt*rt*(D-I)+6*rt*X*(j-D)+3*X*X*(_-j),ot=3*rt*rt*(F-A)+6*rt*X*(O-F)+3*X*X*(V-O);return Math.atan2(ot,st)}}function S(I){return I*I}function k(I){return 2*I*(1-I)}function T(I){return(1-I)*(1-I)}function N(I,A,D,F,j,O){return function(_){var V=S(_),X=k(_),rt=T(_);return{x:j*V+D*X+I*rt,y:O*V+F*X+A*rt}}}function R(I,A,D,F,j,O){return function(_){var V=1-_,X=2*V*(D-I)+2*_*(j-D),rt=2*V*(F-A)+2*_*(O-F);return Math.atan2(rt,X)}}function L(I,A,D){var F={x:A,y:D},j,O=0,_;for(_=1;_<=100;_+=1)j=I(_/100),O+=g(F.x,F.y,j.x,j.y),F=j;return O}function z(I,A){for(var D=0,F=0,j=I.iterator,O={x:I.x,y:I.y},_,V,X=.01,rt=I.angleFinder,st;F<A&&X>1e-4;)_=j(D),st=D,V=g(O.x,O.y,_.x,_.y),V+F>A?(D-=X,X/=2):(O=_,D+=X,F+=V);return _.angle=rt(st),_}function U(I){for(var A=0,D=I.length,F,j=0,O=0,_=0,V=0,X=[],rt,st,ot,ht=0;ht<D;ht++){switch(F=I[ht],st={x:j,y:O,command:F[0]},F[0]){case"M":st.length=0,_=j=F[1],V=O=F[2];break;case"L":st.length=g(j,O,F[1],F[2]),j=F[1],O=F[2];break;case"C":rt=w(j,O,F[1],F[2],F[3],F[4],F[5],F[6]),ot=C(j,O,F[1],F[2],F[3],F[4],F[5],F[6]),st.iterator=rt,st.angleFinder=ot,st.length=L(rt,j,O),j=F[5],O=F[6];break;case"Q":rt=N(j,O,F[1],F[2],F[3],F[4]),ot=R(j,O,F[1],F[2],F[3],F[4]),st.iterator=rt,st.angleFinder=ot,st.length=L(rt,j,O),j=F[3],O=F[4];break;case"Z":case"z":st.destX=_,st.destY=V,st.length=g(j,O,_,V),j=_,O=V;break}A+=st.length,X.push(st)}return X.push({length:A,x:j,y:O}),X}function H(I,A,D){D||(D=U(I));for(var F=0;A-D[F].length>0&&F<D.length-2;)A-=D[F].length,F++;var j=D[F],O=A/j.length,_=j.command,V=I[F],X;switch(_){case"M":return{x:j.x,y:j.y,angle:0};case"Z":case"z":return X=new t.Point(j.x,j.y).lerp(new t.Point(j.destX,j.destY),O),X.angle=Math.atan2(j.destY-j.y,j.destX-j.x),X;case"L":return X=new t.Point(j.x,j.y).lerp(new t.Point(V[1],V[2]),O),X.angle=Math.atan2(V[2]-j.y,V[1]-j.x),X;case"C":return z(j,A);case"Q":return z(j,A)}}function Y(I){var A=[],D=[],F,j,O=t.rePathCommand,_="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",V="("+_+")"+t.commaWsp,X="([01])"+t.commaWsp+"?",rt=V+"?"+V+"?"+V+X+X+V+"?("+_+")",st=new RegExp(rt,"g"),ot,ht,mt;if(!I||!I.match)return A;mt=I.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var $=0,E,B=mt.length;$<B;$++){F=mt[$],ht=F.slice(1).trim(),D.length=0;var G=F.charAt(0);if(E=[G],G.toLowerCase()==="a")for(var W;W=st.exec(ht);)for(var J=1;J<W.length;J++)D.push(W[J]);else for(;ot=O.exec(ht);)D.push(ot[0]);for(var J=0,at=D.length;J<at;J++)j=parseFloat(D[J]),isNaN(j)||E.push(j);var ct=r[G.toLowerCase()],ut=l[G]||G;if(E.length-1>ct)for(var q=1,gt=E.length;q<gt;q+=ct)A.push([G].concat(E.slice(q,q+ct))),G=ut;else A.push(E)}return A}function Q(I,A){var D=[],F,j=new t.Point(I[0].x,I[0].y),O=new t.Point(I[1].x,I[1].y),_=I.length,V=1,X=0,rt=_>2;for(A=A||0,rt&&(V=I[2].x<O.x?-1:I[2].x===O.x?0:1,X=I[2].y<O.y?-1:I[2].y===O.y?0:1),D.push(["M",j.x-V*A,j.y-X*A]),F=1;F<_;F++){if(!j.eq(O)){var st=j.midPointFrom(O);D.push(["Q",j.x,j.y,st.x,st.y])}j=I[F],F+1<I.length&&(O=I[F+1])}return rt&&(V=j.x>I[F-2].x?1:j.x===I[F-2].x?0:-1,X=j.y>I[F-2].y?1:j.y===I[F-2].y?0:-1),D.push(["L",j.x+V*A,j.y+X*A]),D}function K(I,A,D){return D&&(A=t.util.multiplyTransformMatrices(A,[1,0,0,1,-D.x,-D.y])),I.map(function(F){for(var j=F.slice(0),O={},_=1;_<F.length-1;_+=2)O.x=F[_],O.y=F[_+1],O=t.util.transformPoint(O,A),j[_]=O.x,j[_+1]=O.y;return j})}t.util.joinPath=function(I){return I.map(function(A){return A.join(" ")}).join(" ")},t.util.parsePath=Y,t.util.makePathSimpler=m,t.util.getSmoothPathFromPoints=Q,t.util.getPathSegmentsInfo=U,t.util.getBoundsOfCurve=d,t.util.getPointOnPath=H,t.util.transformPath=K}(),function(){var o=Array.prototype.slice;function r(d,p){for(var m=o.call(arguments,2),g=[],x=0,b=d.length;x<b;x++)g[x]=m.length?d[x][p].apply(d[x],m):d[x][p].call(d[x]);return g}function l(d,p){return f(d,p,function(m,g){return m>=g})}function h(d,p){return f(d,p,function(m,g){return m<g})}function c(d,p){for(var m=d.length;m--;)d[m]=p;return d}function f(d,p,m){if(!(!d||d.length===0)){var g=d.length-1,x=p?d[g][p]:d[g];if(p)for(;g--;)m(d[g][p],x)&&(x=d[g][p]);else for(;g--;)m(d[g],x)&&(x=d[g]);return x}}t.util.array={fill:c,invoke:r,min:h,max:l}}(),function(){function o(l,h,c){if(c)if(!t.isLikelyNode&&h instanceof Element)l=h;else if(h instanceof Array){l=[];for(var f=0,d=h.length;f<d;f++)l[f]=o({},h[f],c)}else if(h&&typeof h=="object")for(var p in h)p==="canvas"||p==="group"?l[p]=null:h.hasOwnProperty(p)&&(l[p]=o({},h[p],c));else l=h;else for(var p in h)l[p]=h[p];return l}function r(l,h){return o({},l,h)}t.util.object={extend:o,clone:r},t.util.object.extend(t.util,t.Observable)}(),function(){function o(f){return f.replace(/-+(.)?/g,function(d,p){return p?p.toUpperCase():""})}function r(f,d){return f.charAt(0).toUpperCase()+(d?f.slice(1):f.slice(1).toLowerCase())}function l(f){return f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(f){var d=0,p,m=[];for(d=0,p;d<f.length;d++)(p=c(f,d))!==!1&&m.push(p);return m}function c(f,d){var p=f.charCodeAt(d);if(isNaN(p))return"";if(p<55296||p>57343)return f.charAt(d);if(55296<=p&&p<=56319){if(f.length<=d+1)throw"High surrogate without following low surrogate";var m=f.charCodeAt(d+1);if(56320>m||m>57343)throw"High surrogate without following low surrogate";return f.charAt(d)+f.charAt(d+1)}if(d===0)throw"Low surrogate without preceding high surrogate";var g=f.charCodeAt(d-1);if(55296>g||g>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:o,capitalize:r,escapeXml:l,graphemeSplit:h}}(),function(){var o=Array.prototype.slice,r=function(){},l=function(){for(var p in{toString:1})if(p==="toString")return!1;return!0}(),h=function(p,m,g){for(var x in m)x in p.prototype&&typeof p.prototype[x]=="function"&&(m[x]+"").indexOf("callSuper")>-1?p.prototype[x]=function(b){return function(){var y=this.constructor.superclass;this.constructor.superclass=g;var v=m[b].apply(this,arguments);if(this.constructor.superclass=y,b!=="initialize")return v}}(x):p.prototype[x]=m[x],l&&(m.toString!==Object.prototype.toString&&(p.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(p.prototype.valueOf=m.valueOf))};function c(){}function f(p){for(var m=null,g=this;g.constructor.superclass;){var x=g.constructor.superclass.prototype[p];if(g[p]!==x){m=x;break}g=g.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,o.call(arguments,1)):m.call(this):console.log("tried to callSuper "+p+", method not found in prototype chain",this)}function d(){var p=null,m=o.call(arguments,0);typeof m[0]=="function"&&(p=m.shift());function g(){this.initialize.apply(this,arguments)}g.superclass=p,g.subclasses=[],p&&(c.prototype=p.prototype,g.prototype=new c,p.subclasses.push(g));for(var x=0,b=m.length;x<b;x++)h(g,m[x],p);return g.prototype.initialize||(g.prototype.initialize=r),g.prototype.constructor=g,g.prototype.callSuper=f,g}t.util.createClass=d}(),function(){var o=!!t.document.createElement("div").attachEvent,r=["touchstart","touchmove","touchend"];t.util.addListener=function(h,c,f,d){h&&h.addEventListener(c,f,o?!1:d)},t.util.removeListener=function(h,c,f,d){h&&h.removeEventListener(c,f,o?!1:d)};function l(h){var c=h.changedTouches;return c&&c[0]?c[0]:h}t.util.getPointer=function(h){var c=h.target,f=t.util.getScrollLeftTop(c),d=l(h);return{x:d.clientX+f.left,y:d.clientY+f.top}},t.util.isTouchEvent=function(h){return r.indexOf(h.type)>-1||h.pointerType==="touch"}}(),function(){function o(d,p){var m=d.style;if(!m)return d;if(typeof p=="string")return d.style.cssText+=";"+p,p.indexOf("opacity")>-1?f(d,p.match(/opacity:\s*(\d?\.?\d*)/)[1]):d;for(var g in p)if(g==="opacity")f(d,p[g]);else{var x=g==="float"||g==="cssFloat"?typeof m.styleFloat=="undefined"?"cssFloat":"styleFloat":g;m[x]=p[g]}return d}var r=t.document.createElement("div"),l=typeof r.style.opacity=="string",h=typeof r.style.filter=="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(d){return d};l?f=function(d,p){return d.style.opacity=p,d}:h&&(f=function(d,p){var m=d.style;return d.currentStyle&&!d.currentStyle.hasLayout&&(m.zoom=1),c.test(m.filter)?(p=p>=.9999?"":"alpha(opacity="+p*100+")",m.filter=m.filter.replace(c,p)):m.filter+=" alpha(opacity="+p*100+")",d}),t.util.setStyle=o}(),function(){var o=Array.prototype.slice;function r(v){return typeof v=="string"?t.document.getElementById(v):v}var l,h=function(v){return o.call(v,0)};try{l=h(t.document.childNodes)instanceof Array}catch{}l||(h=function(v){for(var w=new Array(v.length),C=v.length;C--;)w[C]=v[C];return w});function c(v,w){var C=t.document.createElement(v);for(var S in w)S==="class"?C.className=w[S]:S==="for"?C.htmlFor=w[S]:C.setAttribute(S,w[S]);return C}function f(v,w){v&&(" "+v.className+" ").indexOf(" "+w+" ")===-1&&(v.className+=(v.className?" ":"")+w)}function d(v,w,C){return typeof w=="string"&&(w=c(w,C)),v.parentNode&&v.parentNode.replaceChild(w,v),w.appendChild(v),w}function p(v){for(var w=0,C=0,S=t.document.documentElement,k=t.document.body||{scrollLeft:0,scrollTop:0};v&&(v.parentNode||v.host)&&(v=v.parentNode||v.host,v===t.document?(w=k.scrollLeft||S.scrollLeft||0,C=k.scrollTop||S.scrollTop||0):(w+=v.scrollLeft||0,C+=v.scrollTop||0),!(v.nodeType===1&&v.style.position==="fixed")););return{left:w,top:C}}function m(v){var w,C=v&&v.ownerDocument,S={left:0,top:0},k={left:0,top:0},T,N={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return k;for(var R in N)k[N[R]]+=parseInt(g(v,R),10)||0;return w=C.documentElement,typeof v.getBoundingClientRect!="undefined"&&(S=v.getBoundingClientRect()),T=p(v),{left:S.left+T.left-(w.clientLeft||0)+k.left,top:S.top+T.top-(w.clientTop||0)+k.top}}var g;t.document.defaultView&&t.document.defaultView.getComputedStyle?g=function(v,w){var C=t.document.defaultView.getComputedStyle(v,null);return C?C[w]:void 0}:g=function(v,w){var C=v.style[w];return!C&&v.currentStyle&&(C=v.currentStyle[w]),C},function(){var v=t.document.documentElement.style,w="userSelect"in v?"userSelect":"MozUserSelect"in v?"MozUserSelect":"WebkitUserSelect"in v?"WebkitUserSelect":"KhtmlUserSelect"in v?"KhtmlUserSelect":"";function C(k){return typeof k.onselectstart!="undefined"&&(k.onselectstart=t.util.falseFunction),w?k.style[w]="none":typeof k.unselectable=="string"&&(k.unselectable="on"),k}function S(k){return typeof k.onselectstart!="undefined"&&(k.onselectstart=null),w?k.style[w]="":typeof k.unselectable=="string"&&(k.unselectable=""),k}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function x(v){var w=t.jsdomImplForWrapper(v);return w._canvas||w._image}function b(v){if(!!t.isLikelyNode){var w=t.jsdomImplForWrapper(v);w&&(w._image=null,w._canvas=null,w._currentSrc=null,w._attributes=null,w._classList=null)}}function y(v,w){v.imageSmoothingEnabled=v.imageSmoothingEnabled||v.webkitImageSmoothingEnabled||v.mozImageSmoothingEnabled||v.msImageSmoothingEnabled||v.oImageSmoothingEnabled,v.imageSmoothingEnabled=w}t.util.setImageSmoothing=y,t.util.getById=r,t.util.toArray=h,t.util.addClass=f,t.util.makeElement=c,t.util.wrapElement=d,t.util.getScrollLeftTop=p,t.util.getElementOffset=m,t.util.getNodeCanvas=x,t.util.cleanUpJsdomNode=b}(),function(){function o(h,c){return h+(/\?/.test(h)?"&":"?")+c}function r(){}function l(h,c){c||(c={});var f=c.method?c.method.toUpperCase():"GET",d=c.onComplete||function(){},p=new t.window.XMLHttpRequest,m=c.body||c.parameters;return p.onreadystatechange=function(){p.readyState===4&&(d(p),p.onreadystatechange=r)},f==="GET"&&(m=null,typeof c.parameters=="string"&&(h=o(h,c.parameters))),p.open(f,h,!0),(f==="POST"||f==="PUT")&&p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.send(m),p}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var o=t.util.object.extend,r=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var x=this.splice(0);return x.forEach(function(b){b.cancel()}),x},cancelByCanvas:function(x){if(!x)return[];var b=this.filter(function(y){return typeof y.target=="object"&&y.target.canvas===x});return b.forEach(function(y){y.cancel()}),b},cancelByTarget:function(x){var b=this.findAnimationsByTarget(x);return b.forEach(function(y){y.cancel()}),b},findAnimationIndex:function(x){return this.indexOf(this.findAnimation(x))},findAnimation:function(x){return this.find(function(b){return b.cancel===x})},findAnimationsByTarget:function(x){return x?this.filter(function(b){return b.target===x}):[]}});function h(){return!1}function c(x,b,y,v){return-y*Math.cos(x/v*(Math.PI/2))+y+b}function f(x){x||(x={});var b=!1,y,v=function(){var w=t.runningAnimations.indexOf(y);return w>-1&&t.runningAnimations.splice(w,1)[0]};return y=o(r(x),{cancel:function(){return b=!0,v()},currentValue:"startValue"in x?x.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(y),m(function(w){var C=w||+new Date,S=x.duration||500,k=C+S,T,N=x.onChange||h,R=x.abort||h,L=x.onComplete||h,z=x.easing||c,U="startValue"in x?x.startValue.length>0:!1,H="startValue"in x?x.startValue:0,Y="endValue"in x?x.endValue:100,Q=x.byValue||(U?H.map(function(K,I){return Y[I]-H[I]}):Y-H);x.onStart&&x.onStart(),function K(I){T=I||+new Date;var A=T>k?S:T-C,D=A/S,F=U?H.map(function(O,_){return z(A,H[_],Q[_],S)}):z(A,H,Q,S),j=Math.abs(U?(F[0]-H[0])/Q[0]:(F-H)/Q);if(y.currentValue=U?F.slice():F,y.completionRate=j,y.durationRate=D,!b){if(R(F,j,D)){v();return}if(T>k){y.currentValue=U?Y.slice():Y,y.completionRate=1,y.durationRate=1,N(U?Y.slice():Y,1,1),L(Y,1,1),v();return}else N(F,j,D),m(K)}}(C)}),y.cancel}var d=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(x){return t.window.setTimeout(x,1e3/60)},p=t.window.cancelAnimationFrame||t.window.clearTimeout;function m(){return d.apply(t.window,arguments)}function g(){return p.apply(t.window,arguments)}t.util.animate=f,t.util.requestAnimFrame=m,t.util.cancelAnimFrame=g,t.runningAnimations=l}(),function(){function o(l,h,c){var f="rgba("+parseInt(l[0]+c*(h[0]-l[0]),10)+","+parseInt(l[1]+c*(h[1]-l[1]),10)+","+parseInt(l[2]+c*(h[2]-l[2]),10);return f+=","+(l&&h?parseFloat(l[3]+c*(h[3]-l[3])):1),f+=")",f}function r(l,h,c,f){var d=new t.Color(l).getSource(),p=new t.Color(h).getSource(),m=f.onComplete,g=f.onChange;return f=f||{},t.util.animate(t.util.object.extend(f,{duration:c||500,startValue:d,endValue:p,byValue:p,easing:function(x,b,y,v){var w=f.colorEasing?f.colorEasing(x,v):1-Math.cos(x/v*(Math.PI/2));return o(b,y,w)},onComplete:function(x,b,y){if(m)return m(o(p,p,0),b,y)},onChange:function(x,b,y){if(g){if(Array.isArray(x))return g(o(x,x,0),b,y);g(x,b,y)}}}))}t.util.animateColor=r}(),function(){function o(I,A,D,F){return I<Math.abs(A)?(I=A,F=D/4):A===0&&I===0?F=D/(2*Math.PI)*Math.asin(1):F=D/(2*Math.PI)*Math.asin(A/I),{a:I,c:A,p:D,s:F}}function r(I,A,D){return I.a*Math.pow(2,10*(A-=1))*Math.sin((A*D-I.s)*(2*Math.PI)/I.p)}function l(I,A,D,F){return D*((I=I/F-1)*I*I+1)+A}function h(I,A,D,F){return I/=F/2,I<1?D/2*I*I*I+A:D/2*((I-=2)*I*I+2)+A}function c(I,A,D,F){return D*(I/=F)*I*I*I+A}function f(I,A,D,F){return-D*((I=I/F-1)*I*I*I-1)+A}function d(I,A,D,F){return I/=F/2,I<1?D/2*I*I*I*I+A:-D/2*((I-=2)*I*I*I-2)+A}function p(I,A,D,F){return D*(I/=F)*I*I*I*I+A}function m(I,A,D,F){return D*((I=I/F-1)*I*I*I*I+1)+A}function g(I,A,D,F){return I/=F/2,I<1?D/2*I*I*I*I*I+A:D/2*((I-=2)*I*I*I*I+2)+A}function x(I,A,D,F){return-D*Math.cos(I/F*(Math.PI/2))+D+A}function b(I,A,D,F){return D*Math.sin(I/F*(Math.PI/2))+A}function y(I,A,D,F){return-D/2*(Math.cos(Math.PI*I/F)-1)+A}function v(I,A,D,F){return I===0?A:D*Math.pow(2,10*(I/F-1))+A}function w(I,A,D,F){return I===F?A+D:D*(-Math.pow(2,-10*I/F)+1)+A}function C(I,A,D,F){return I===0?A:I===F?A+D:(I/=F/2,I<1?D/2*Math.pow(2,10*(I-1))+A:D/2*(-Math.pow(2,-10*--I)+2)+A)}function S(I,A,D,F){return-D*(Math.sqrt(1-(I/=F)*I)-1)+A}function k(I,A,D,F){return D*Math.sqrt(1-(I=I/F-1)*I)+A}function T(I,A,D,F){return I/=F/2,I<1?-D/2*(Math.sqrt(1-I*I)-1)+A:D/2*(Math.sqrt(1-(I-=2)*I)+1)+A}function N(I,A,D,F){var j=1.70158,O=0,_=D;if(I===0)return A;if(I/=F,I===1)return A+D;O||(O=F*.3);var V=o(_,D,O,j);return-r(V,I,F)+A}function R(I,A,D,F){var j=1.70158,O=0,_=D;if(I===0)return A;if(I/=F,I===1)return A+D;O||(O=F*.3);var V=o(_,D,O,j);return V.a*Math.pow(2,-10*I)*Math.sin((I*F-V.s)*(2*Math.PI)/V.p)+V.c+A}function L(I,A,D,F){var j=1.70158,O=0,_=D;if(I===0)return A;if(I/=F/2,I===2)return A+D;O||(O=F*(.3*1.5));var V=o(_,D,O,j);return I<1?-.5*r(V,I,F)+A:V.a*Math.pow(2,-10*(I-=1))*Math.sin((I*F-V.s)*(2*Math.PI)/V.p)*.5+V.c+A}function z(I,A,D,F,j){return j===void 0&&(j=1.70158),D*(I/=F)*I*((j+1)*I-j)+A}function U(I,A,D,F,j){return j===void 0&&(j=1.70158),D*((I=I/F-1)*I*((j+1)*I+j)+1)+A}function H(I,A,D,F,j){return j===void 0&&(j=1.70158),I/=F/2,I<1?D/2*(I*I*(((j*=1.525)+1)*I-j))+A:D/2*((I-=2)*I*(((j*=1.525)+1)*I+j)+2)+A}function Y(I,A,D,F){return D-Q(F-I,0,D,F)+A}function Q(I,A,D,F){return(I/=F)<1/2.75?D*(7.5625*I*I)+A:I<2/2.75?D*(7.5625*(I-=1.5/2.75)*I+.75)+A:I<2.5/2.75?D*(7.5625*(I-=2.25/2.75)*I+.9375)+A:D*(7.5625*(I-=2.625/2.75)*I+.984375)+A}function K(I,A,D,F){return I<F/2?Y(I*2,0,D,F)*.5+A:Q(I*2-F,0,D,F)*.5+D*.5+A}t.util.ease={easeInQuad:function(I,A,D,F){return D*(I/=F)*I+A},easeOutQuad:function(I,A,D,F){return-D*(I/=F)*(I-2)+A},easeInOutQuad:function(I,A,D,F){return I/=F/2,I<1?D/2*I*I+A:-D/2*(--I*(I-2)-1)+A},easeInCubic:function(I,A,D,F){return D*(I/=F)*I*I+A},easeOutCubic:l,easeInOutCubic:h,easeInQuart:c,easeOutQuart:f,easeInOutQuart:d,easeInQuint:p,easeOutQuint:m,easeInOutQuint:g,easeInSine:x,easeOutSine:b,easeInOutSine:y,easeInExpo:v,easeOutExpo:w,easeInOutExpo:C,easeInCirc:S,easeOutCirc:k,easeInOutCirc:T,easeInElastic:N,easeOutElastic:R,easeInOutElastic:L,easeInBack:z,easeOutBack:U,easeInOutBack:H,easeInBounce:Y,easeOutBounce:Q,easeInOutBounce:K}}(),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.util.object.clone,c=r.util.toFixed,f=r.util.parseUnit,d=r.util.multiplyTransformMatrices,p=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],m=["symbol","image","marker","pattern","view","svg"],g=["pattern","defs","symbol","metadata","clipPath","mask","desc"],x=["symbol","g","a","svg","clipPath","defs"],b={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},y={stroke:"strokeOpacity",fill:"fillOpacity"},v="font-size",w="clip-path";r.svgValidTagNamesRegEx=k(p),r.svgViewBoxElementsRegEx=k(m),r.svgInvalidAncestorsRegEx=k(g),r.svgValidParentsRegEx=k(x),r.cssRules={},r.gradientDefs={},r.clipPaths={};function C(O){return O in b?b[O]:O}function S(O,_,V,X){var rt=Array.isArray(_),st;if((O==="fill"||O==="stroke")&&_==="none")_="";else{if(O==="strokeUniform")return _==="non-scaling-stroke";if(O==="strokeDashArray")_==="none"?_=null:_=_.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(O==="transformMatrix")V&&V.transformMatrix?_=d(V.transformMatrix,r.parseTransformAttribute(_)):_=r.parseTransformAttribute(_);else if(O==="visible")_=_!=="none"&&_!=="hidden",V&&V.visible===!1&&(_=!1);else if(O==="opacity")_=parseFloat(_),V&&typeof V.opacity!="undefined"&&(_*=V.opacity);else if(O==="textAnchor")_=_==="start"?"left":_==="end"?"right":"center";else if(O==="charSpacing")st=f(_,X)/X*1e3;else if(O==="paintFirst"){var ot=_.indexOf("fill"),ht=_.indexOf("stroke"),_="fill";(ot>-1&&ht>-1&&ht<ot||ot===-1&&ht>-1)&&(_="stroke")}else{if(O==="href"||O==="xlink:href"||O==="font")return _;if(O==="imageSmoothing")return _==="optimizeQuality";st=rt?_.map(f):f(_,X)}}return!rt&&isNaN(st)?_:st}function k(O){return new RegExp("^("+O.join("|")+")\\b","i")}function T(O){for(var _ in y)if(!(typeof O[y[_]]=="undefined"||O[_]==="")){if(typeof O[_]=="undefined"){if(!r.Object.prototype[_])continue;O[_]=r.Object.prototype[_]}if(O[_].indexOf("url(")!==0){var V=new r.Color(O[_]);O[_]=V.setAlpha(c(V.getAlpha()*O[y[_]],2)).toRgba()}}return O}function N(O,_){var V,X=[],rt,st,ot;for(st=0,ot=_.length;st<ot;st++)V=_[st],rt=O.getElementsByTagName(V),X=X.concat(Array.prototype.slice.call(rt));return X}r.parseTransformAttribute=function(){function O(q,gt){var xt=r.util.cos(gt[0]),vt=r.util.sin(gt[0]),Ct=0,It=0;gt.length===3&&(Ct=gt[1],It=gt[2]),q[0]=xt,q[1]=vt,q[2]=-vt,q[3]=xt,q[4]=Ct-(xt*Ct-vt*It),q[5]=It-(vt*Ct+xt*It)}function _(q,gt){var xt=gt[0],vt=gt.length===2?gt[1]:gt[0];q[0]=xt,q[3]=vt}function V(q,gt,xt){q[xt]=Math.tan(r.util.degreesToRadians(gt[0]))}function X(q,gt){q[4]=gt[0],gt.length===2&&(q[5]=gt[1])}var rt=r.iMatrix,st=r.reNum,ot=r.commaWsp,ht="(?:(skewX)\\s*\\(\\s*("+st+")\\s*\\))",mt="(?:(skewY)\\s*\\(\\s*("+st+")\\s*\\))",$="(?:(rotate)\\s*\\(\\s*("+st+")(?:"+ot+"("+st+")"+ot+"("+st+"))?\\s*\\))",E="(?:(scale)\\s*\\(\\s*("+st+")(?:"+ot+"("+st+"))?\\s*\\))",B="(?:(translate)\\s*\\(\\s*("+st+")(?:"+ot+"("+st+"))?\\s*\\))",G="(?:(matrix)\\s*\\(\\s*("+st+")"+ot+"("+st+")"+ot+"("+st+")"+ot+"("+st+")"+ot+"("+st+")"+ot+"("+st+")\\s*\\))",W="(?:"+G+"|"+B+"|"+E+"|"+$+"|"+ht+"|"+mt+")",J="(?:"+W+"(?:"+ot+"*"+W+")*)",at="^\\s*(?:"+J+"?)\\s*$",ct=new RegExp(at),ut=new RegExp(W,"g");return function(q){var gt=rt.concat(),xt=[];if(!q||q&&!ct.test(q))return gt;q.replace(ut,function(Ct){var It=new RegExp(W).exec(Ct).filter(function(Ht){return!!Ht}),Ft=It[1],Ot=It.slice(2).map(parseFloat);switch(Ft){case"translate":X(gt,Ot);break;case"rotate":Ot[0]=r.util.degreesToRadians(Ot[0]),O(gt,Ot);break;case"scale":_(gt,Ot);break;case"skewX":V(gt,Ot,2);break;case"skewY":V(gt,Ot,1);break;case"matrix":gt=Ot;break}xt.push(gt.concat()),gt=rt.concat()});for(var vt=xt[0];xt.length>1;)xt.shift(),vt=r.util.multiplyTransformMatrices(vt,xt[0]);return vt}}();function R(O,_){var V,X;O.replace(/;\s*$/,"").split(";").forEach(function(rt){var st=rt.split(":");V=st[0].trim().toLowerCase(),X=st[1].trim(),_[V]=X})}function L(O,_){var V,X;for(var rt in O)typeof O[rt]!="undefined"&&(V=rt.toLowerCase(),X=O[rt],_[V]=X)}function z(O,_){var V={};for(var X in r.cssRules[_])if(U(O,X.split(" ")))for(var rt in r.cssRules[_][X])V[rt]=r.cssRules[_][X][rt];return V}function U(O,_){var V,X=!0;return V=Y(O,_.pop()),V&&_.length&&(X=H(O,_)),V&&X&&_.length===0}function H(O,_){for(var V,X=!0;O.parentNode&&O.parentNode.nodeType===1&&_.length;)X&&(V=_.pop()),O=O.parentNode,X=Y(O,V);return _.length===0}function Y(O,_){var V=O.nodeName,X=O.getAttribute("class"),rt=O.getAttribute("id"),st,ot;if(st=new RegExp("^"+V,"i"),_=_.replace(st,""),rt&&_.length&&(st=new RegExp("#"+rt+"(?![a-zA-Z\\-]+)","i"),_=_.replace(st,"")),X&&_.length)for(X=X.split(" "),ot=X.length;ot--;)st=new RegExp("\\."+X[ot]+"(?![a-zA-Z\\-]+)","i"),_=_.replace(st,"");return _.length===0}function Q(O,_){var V;if(O.getElementById&&(V=O.getElementById(_)),V)return V;var X,rt,st,ot=O.getElementsByTagName("*");for(rt=0,st=ot.length;rt<st;rt++)if(X=ot[rt],_===X.getAttribute("id"))return X}function K(O){for(var _=N(O,["use","svg:use"]),V=0;_.length&&V<_.length;){var X=_[V],rt=X.getAttribute("xlink:href")||X.getAttribute("href");if(rt===null)return;var st=rt.slice(1),ot=X.getAttribute("x")||0,ht=X.getAttribute("y")||0,mt=Q(O,st).cloneNode(!0),$=(mt.getAttribute("transform")||"")+" translate("+ot+", "+ht+")",E,B=_.length,G,W,J,at,ct=r.svgNS;if(A(mt),/^svg$/i.test(mt.nodeName)){var ut=mt.ownerDocument.createElementNS(ct,"g");for(W=0,J=mt.attributes,at=J.length;W<at;W++)G=J.item(W),ut.setAttributeNS(ct,G.nodeName,G.nodeValue);for(;mt.firstChild;)ut.appendChild(mt.firstChild);mt=ut}for(W=0,J=X.attributes,at=J.length;W<at;W++)G=J.item(W),!(G.nodeName==="x"||G.nodeName==="y"||G.nodeName==="xlink:href"||G.nodeName==="href")&&(G.nodeName==="transform"?$=G.nodeValue+" "+$:mt.setAttribute(G.nodeName,G.nodeValue));mt.setAttribute("transform",$),mt.setAttribute("instantiated_by_use","1"),mt.removeAttribute("id"),E=X.parentNode,E.replaceChild(mt,X),_.length===B&&V++}}var I=new RegExp("^\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*$");function A(O){if(!r.svgViewBoxElementsRegEx.test(O.nodeName))return{};var _=O.getAttribute("viewBox"),V=1,X=1,rt=0,st=0,ot,ht,mt,$,E=O.getAttribute("width"),B=O.getAttribute("height"),G=O.getAttribute("x")||0,W=O.getAttribute("y")||0,J=O.getAttribute("preserveAspectRatio")||"",at=!_||!(_=_.match(I)),ct=!E||!B||E==="100%"||B==="100%",ut=at&&ct,q={},gt="",xt=0,vt=0;if(q.width=0,q.height=0,q.toBeParsed=ut,at&&(G||W)&&O.parentNode&&O.parentNode.nodeName!=="#document"&&(gt=" translate("+f(G)+" "+f(W)+") ",mt=(O.getAttribute("transform")||"")+gt,O.setAttribute("transform",mt),O.removeAttribute("x"),O.removeAttribute("y")),ut)return q;if(at)return q.width=f(E),q.height=f(B),q;if(rt=-parseFloat(_[1]),st=-parseFloat(_[2]),ot=parseFloat(_[3]),ht=parseFloat(_[4]),q.minX=rt,q.minY=st,q.viewBoxWidth=ot,q.viewBoxHeight=ht,ct?(q.width=ot,q.height=ht):(q.width=f(E),q.height=f(B),V=q.width/ot,X=q.height/ht),J=r.util.parsePreserveAspectRatioAttribute(J),J.alignX!=="none"&&(J.meetOrSlice==="meet"&&(X=V=V>X?X:V),J.meetOrSlice==="slice"&&(X=V=V>X?V:X),xt=q.width-ot*V,vt=q.height-ht*V,J.alignX==="Mid"&&(xt/=2),J.alignY==="Mid"&&(vt/=2),J.alignX==="Min"&&(xt=0),J.alignY==="Min"&&(vt=0)),V===1&&X===1&&rt===0&&st===0&&G===0&&W===0)return q;if((G||W)&&O.parentNode.nodeName!=="#document"&&(gt=" translate("+f(G)+" "+f(W)+") "),mt=gt+" matrix("+V+" 0 0 "+X+" "+(rt*V+xt)+" "+(st*X+vt)+") ",O.nodeName==="svg"){for($=O.ownerDocument.createElementNS(r.svgNS,"g");O.firstChild;)$.appendChild(O.firstChild);O.appendChild($)}else $=O,$.removeAttribute("x"),$.removeAttribute("y"),mt=$.getAttribute("transform")+mt;return $.setAttribute("transform",mt),q}function D(O,_){for(;O&&(O=O.parentNode);)if(O.nodeName&&_.test(O.nodeName.replace("svg:",""))&&!O.getAttribute("instantiated_by_use"))return!0;return!1}r.parseSVGDocument=function(O,_,V,X){if(!!O){K(O);var rt=r.Object.__uid++,st,ot,ht=A(O),mt=r.util.toArray(O.getElementsByTagName("*"));if(ht.crossOrigin=X&&X.crossOrigin,ht.svgUid=rt,mt.length===0&&r.isLikelyNode){mt=O.selectNodes('//*[name(.)!="svg"]');var $=[];for(st=0,ot=mt.length;st<ot;st++)$[st]=mt[st];mt=$}var E=mt.filter(function(G){return A(G),r.svgValidTagNamesRegEx.test(G.nodeName.replace("svg:",""))&&!D(G,r.svgInvalidAncestorsRegEx)});if(!E||E&&!E.length){_&&_([],{});return}var B={};mt.filter(function(G){return G.nodeName.replace("svg:","")==="clipPath"}).forEach(function(G){var W=G.getAttribute("id");B[W]=r.util.toArray(G.getElementsByTagName("*")).filter(function(J){return r.svgValidTagNamesRegEx.test(J.nodeName.replace("svg:",""))})}),r.gradientDefs[rt]=r.getGradientDefs(O),r.cssRules[rt]=r.getCSSRules(O),r.clipPaths[rt]=B,r.parseElements(E,function(G,W){_&&(_(G,ht,W,mt),delete r.gradientDefs[rt],delete r.cssRules[rt],delete r.clipPaths[rt])},h(ht),V,X)}};function F(O,_){var V=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],X="xlink:href",rt=_.getAttribute(X).slice(1),st=Q(O,rt);if(st&&st.getAttribute(X)&&F(O,st),V.forEach(function(ht){st&&!_.hasAttribute(ht)&&st.hasAttribute(ht)&&_.setAttribute(ht,st.getAttribute(ht))}),!_.children.length)for(var ot=st.cloneNode(!0);ot.firstChild;)_.appendChild(ot.firstChild);_.removeAttribute(X)}var j=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+r.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+r.reNum+"))?\\s+(.*)");l(r,{parseFontDeclaration:function(O,_){var V=O.match(j);if(!!V){var X=V[1],rt=V[3],st=V[4],ot=V[5],ht=V[6];X&&(_.fontStyle=X),rt&&(_.fontWeight=isNaN(parseFloat(rt))?rt:parseFloat(rt)),st&&(_.fontSize=f(st)),ht&&(_.fontFamily=ht),ot&&(_.lineHeight=ot==="normal"?1:ot)}},getGradientDefs:function(O){var _=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],V=N(O,_),X,rt=0,st={};for(rt=V.length;rt--;)X=V[rt],X.getAttribute("xlink:href")&&F(O,X),st[X.getAttribute("id")]=X;return st},parseAttributes:function(O,_,V){if(!!O){var X,rt={},st,ot;typeof V=="undefined"&&(V=O.getAttribute("svgUid")),O.parentNode&&r.svgValidParentsRegEx.test(O.parentNode.nodeName)&&(rt=r.parseAttributes(O.parentNode,_,V));var ht=_.reduce(function(J,at){return X=O.getAttribute(at),X&&(J[at]=X),J},{}),mt=l(z(O,V),r.parseStyleAttribute(O));ht=l(ht,mt),mt[w]&&O.setAttribute(w,mt[w]),st=ot=rt.fontSize||r.Text.DEFAULT_SVG_FONT_SIZE,ht[v]&&(ht[v]=st=f(ht[v],ot));var $,E,B={};for(var G in ht)$=C(G),E=S($,ht[G],rt,st),B[$]=E;B&&B.font&&r.parseFontDeclaration(B.font,B);var W=l(rt,B);return r.svgValidParentsRegEx.test(O.nodeName)?W:T(W)}},parseElements:function(O,_,V,X,rt){new r.ElementsParser(O,_,V,X,rt).parse()},parseStyleAttribute:function(O){var _={},V=O.getAttribute("style");return V&&(typeof V=="string"?R(V,_):L(V,_)),_},parsePointsAttribute:function(O){if(!O)return null;O=O.replace(/,/g," ").trim(),O=O.split(/\s+/);var _=[],V,X;for(V=0,X=O.length;V<X;V+=2)_.push({x:parseFloat(O[V]),y:parseFloat(O[V+1])});return _},getCSSRules:function(O){var _=O.getElementsByTagName("style"),V,X,rt={},st;for(V=0,X=_.length;V<X;V++){var ot=_[V].textContent;ot=ot.replace(/\/\*[\s\S]*?\*\//g,""),ot.trim()!==""&&(st=ot.split("}"),st=st.filter(function(ht){return ht.trim()}),st.forEach(function(ht){var mt=ht.split("{"),$={},E=mt[1].trim(),B=E.split(";").filter(function(at){return at.trim()});for(V=0,X=B.length;V<X;V++){var G=B[V].split(":"),W=G[0].trim(),J=G[1].trim();$[W]=J}ht=mt[0].trim(),ht.split(",").forEach(function(at){at=at.replace(/^svg/i,"").trim(),at!==""&&(rt[at]?r.util.object.extend(rt[at],$):rt[at]=r.util.object.clone($))})}))}return rt},loadSVGFromURL:function(O,_,V,X){O=O.replace(/^\n\s*/,"").trim(),new r.util.request(O,{method:"get",onComplete:rt});function rt(st){var ot=st.responseXML;if(!ot||!ot.documentElement)return _&&_(null),!1;r.parseSVGDocument(ot.documentElement,function(ht,mt,$,E){_&&_(ht,mt,$,E)},V,X)}},loadSVGFromString:function(O,_,V,X){var rt=new r.window.DOMParser,st=rt.parseFromString(O.trim(),"text/xml");r.parseSVGDocument(st.documentElement,function(ot,ht,mt,$){_(ot,ht,mt,$)},V,X)}})}(e),t.ElementsParser=function(o,r,l,h,c,f){this.elements=o,this.callback=r,this.options=l,this.reviver=h,this.svgUid=l&&l.svgUid||0,this.parsingOptions=c,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=f},function(o){o.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},o.createObjects=function(){var r=this;this.elements.forEach(function(l,h){l.setAttribute("svgUid",r.svgUid),r.createObject(l,h)})},o.findTag=function(r){return t[t.util.string.capitalize(r.tagName.replace("svg:",""))]},o.createObject=function(r,l){var h=this.findTag(r);if(h&&h.fromElement)try{h.fromElement(r,this.createCallback(l,r),this.options)}catch(c){t.log(c)}else this.checkIfDone()},o.createCallback=function(r,l){var h=this;return function(c){var f;h.resolveGradient(c,l,"fill"),h.resolveGradient(c,l,"stroke"),c instanceof t.Image&&c._originalElement&&(f=c.parsePreserveAspectRatioAttribute(l)),c._removeTransformMatrix(f),h.resolveClipPath(c,l),h.reviver&&h.reviver(l,c),h.instances[r]=c,h.checkIfDone()}},o.extractPropertyDefinition=function(r,l,h){var c=r[l],f=this.regexUrl;if(!!f.test(c)){f.lastIndex=0;var d=f.exec(c)[1];return f.lastIndex=0,t[h][this.svgUid][d]}},o.resolveGradient=function(r,l,h){var c=this.extractPropertyDefinition(r,h,"gradientDefs");if(c){var f=l.getAttribute(h+"-opacity"),d=t.Gradient.fromElement(c,r,f,this.options);r.set(h,d)}},o.createClipPathCallback=function(r,l){return function(h){h._removeTransformMatrix(),h.fillRule=h.clipRule,l.push(h)}},o.resolveClipPath=function(r,l){var h=this.extractPropertyDefinition(r,"clipPath","clipPaths"),c,f,d,p,m,g;if(h){p=[],d=t.util.invertTransform(r.calcTransformMatrix());for(var x=h[0].parentNode,b=l;b.parentNode&&b.getAttribute("clip-path")!==r.clipPath;)b=b.parentNode;b.parentNode.appendChild(x);for(var y=0;y<h.length;y++)c=h[y],f=this.findTag(c),f.fromElement(c,this.createClipPathCallback(r,p),this.options);p.length===1?h=p[0]:h=new t.Group(p),m=t.util.multiplyTransformMatrices(d,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,b);var g=t.util.qrDecompose(m);h.flipX=!1,h.flipY=!1,h.set("scaleX",g.scaleX),h.set("scaleY",g.scaleY),h.angle=g.angle,h.skewX=g.skewX,h.skewY=0,h.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),r.clipPath=h}else delete r.clipPath},o.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(r){return r!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(o){var r=o.fabric||(o.fabric={});if(r.Point){r.warn("fabric.Point is already defined");return}r.Point=l;function l(h,c){this.x=h,this.y=c}l.prototype={type:"point",constructor:l,add:function(h){return new l(this.x+h.x,this.y+h.y)},addEquals:function(h){return this.x+=h.x,this.y+=h.y,this},scalarAdd:function(h){return new l(this.x+h,this.y+h)},scalarAddEquals:function(h){return this.x+=h,this.y+=h,this},subtract:function(h){return new l(this.x-h.x,this.y-h.y)},subtractEquals:function(h){return this.x-=h.x,this.y-=h.y,this},scalarSubtract:function(h){return new l(this.x-h,this.y-h)},scalarSubtractEquals:function(h){return this.x-=h,this.y-=h,this},multiply:function(h){return new l(this.x*h,this.y*h)},multiplyEquals:function(h){return this.x*=h,this.y*=h,this},divide:function(h){return new l(this.x/h,this.y/h)},divideEquals:function(h){return this.x/=h,this.y/=h,this},eq:function(h){return this.x===h.x&&this.y===h.y},lt:function(h){return this.x<h.x&&this.y<h.y},lte:function(h){return this.x<=h.x&&this.y<=h.y},gt:function(h){return this.x>h.x&&this.y>h.y},gte:function(h){return this.x>=h.x&&this.y>=h.y},lerp:function(h,c){return typeof c=="undefined"&&(c=.5),c=Math.max(Math.min(1,c),0),new l(this.x+(h.x-this.x)*c,this.y+(h.y-this.y)*c)},distanceFrom:function(h){var c=this.x-h.x,f=this.y-h.y;return Math.sqrt(c*c+f*f)},midPointFrom:function(h){return this.lerp(h)},min:function(h){return new l(Math.min(this.x,h.x),Math.min(this.y,h.y))},max:function(h){return new l(Math.max(this.x,h.x),Math.max(this.y,h.y))},toString:function(){return this.x+","+this.y},setXY:function(h,c){return this.x=h,this.y=c,this},setX:function(h){return this.x=h,this},setY:function(h){return this.y=h,this},setFromPoint:function(h){return this.x=h.x,this.y=h.y,this},swap:function(h){var c=this.x,f=this.y;this.x=h.x,this.y=h.y,h.x=c,h.y=f},clone:function(){return new l(this.x,this.y)}}}(e),function(o){var r=o.fabric||(o.fabric={});if(r.Intersection){r.warn("fabric.Intersection is already defined");return}function l(h){this.status=h,this.points=[]}r.Intersection=l,r.Intersection.prototype={constructor:l,appendPoint:function(h){return this.points.push(h),this},appendPoints:function(h){return this.points=this.points.concat(h),this}},r.Intersection.intersectLineLine=function(h,c,f,d){var p,m=(d.x-f.x)*(h.y-f.y)-(d.y-f.y)*(h.x-f.x),g=(c.x-h.x)*(h.y-f.y)-(c.y-h.y)*(h.x-f.x),x=(d.y-f.y)*(c.x-h.x)-(d.x-f.x)*(c.y-h.y);if(x!==0){var b=m/x,y=g/x;0<=b&&b<=1&&0<=y&&y<=1?(p=new l("Intersection"),p.appendPoint(new r.Point(h.x+b*(c.x-h.x),h.y+b*(c.y-h.y)))):p=new l}else m===0||g===0?p=new l("Coincident"):p=new l("Parallel");return p},r.Intersection.intersectLinePolygon=function(h,c,f){var d=new l,p=f.length,m,g,x,b;for(b=0;b<p;b++)m=f[b],g=f[(b+1)%p],x=l.intersectLineLine(h,c,m,g),d.appendPoints(x.points);return d.points.length>0&&(d.status="Intersection"),d},r.Intersection.intersectPolygonPolygon=function(h,c){var f=new l,d=h.length,p;for(p=0;p<d;p++){var m=h[p],g=h[(p+1)%d],x=l.intersectLinePolygon(m,g,c);f.appendPoints(x.points)}return f.points.length>0&&(f.status="Intersection"),f},r.Intersection.intersectPolygonRectangle=function(h,c,f){var d=c.min(f),p=c.max(f),m=new r.Point(p.x,d.y),g=new r.Point(d.x,p.y),x=l.intersectLinePolygon(d,m,h),b=l.intersectLinePolygon(m,p,h),y=l.intersectLinePolygon(p,g,h),v=l.intersectLinePolygon(g,d,h),w=new l;return w.appendPoints(x.points),w.appendPoints(b.points),w.appendPoints(y.points),w.appendPoints(v.points),w.points.length>0&&(w.status="Intersection"),w}}(e),function(o){var r=o.fabric||(o.fabric={});if(r.Color){r.warn("fabric.Color is already defined.");return}function l(c){c?this._tryParsingColor(c):this.setSource([0,0,0,1])}r.Color=l,r.Color.prototype={_tryParsingColor:function(c){var f;c in l.colorNameMap&&(c=l.colorNameMap[c]),c==="transparent"&&(f=[255,255,255,0]),f||(f=l.sourceFromHex(c)),f||(f=l.sourceFromRgb(c)),f||(f=l.sourceFromHsl(c)),f||(f=[0,0,0,1]),f&&this.setSource(f)},_rgbToHsl:function(c,f,d){c/=255,f/=255,d/=255;var p,m,g,x=r.util.array.max([c,f,d]),b=r.util.array.min([c,f,d]);if(g=(x+b)/2,x===b)p=m=0;else{var y=x-b;switch(m=g>.5?y/(2-x-b):y/(x+b),x){case c:p=(f-d)/y+(f<d?6:0);break;case f:p=(d-c)/y+2;break;case d:p=(c-f)/y+4;break}p/=6}return[Math.round(p*360),Math.round(m*100),Math.round(g*100)]},getSource:function(){return this._source},setSource:function(c){this._source=c},toRgb:function(){var c=this.getSource();return"rgb("+c[0]+","+c[1]+","+c[2]+")"},toRgba:function(){var c=this.getSource();return"rgba("+c[0]+","+c[1]+","+c[2]+","+c[3]+")"},toHsl:function(){var c=this.getSource(),f=this._rgbToHsl(c[0],c[1],c[2]);return"hsl("+f[0]+","+f[1]+"%,"+f[2]+"%)"},toHsla:function(){var c=this.getSource(),f=this._rgbToHsl(c[0],c[1],c[2]);return"hsla("+f[0]+","+f[1]+"%,"+f[2]+"%,"+c[3]+")"},toHex:function(){var c=this.getSource(),f,d,p;return f=c[0].toString(16),f=f.length===1?"0"+f:f,d=c[1].toString(16),d=d.length===1?"0"+d:d,p=c[2].toString(16),p=p.length===1?"0"+p:p,f.toUpperCase()+d.toUpperCase()+p.toUpperCase()},toHexa:function(){var c=this.getSource(),f;return f=Math.round(c[3]*255),f=f.toString(16),f=f.length===1?"0"+f:f,this.toHex()+f.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(c){var f=this.getSource();return f[3]=c,this.setSource(f),this},toGrayscale:function(){var c=this.getSource(),f=parseInt((c[0]*.3+c[1]*.59+c[2]*.11).toFixed(0),10),d=c[3];return this.setSource([f,f,f,d]),this},toBlackWhite:function(c){var f=this.getSource(),d=(f[0]*.3+f[1]*.59+f[2]*.11).toFixed(0),p=f[3];return c=c||127,d=Number(d)<Number(c)?0:255,this.setSource([d,d,d,p]),this},overlayWith:function(c){c instanceof l||(c=new l(c));var f=[],d=this.getAlpha(),p=.5,m=this.getSource(),g=c.getSource(),x;for(x=0;x<3;x++)f.push(Math.round(m[x]*(1-p)+g[x]*p));return f[3]=d,this.setSource(f),this}},r.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,r.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,r.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,r.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function h(c,f,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?c+(f-c)*6*d:d<1/2?f:d<2/3?c+(f-c)*(2/3-d)*6:c}r.Color.fromRgb=function(c){return l.fromSource(l.sourceFromRgb(c))},r.Color.sourceFromRgb=function(c){var f=c.match(l.reRGBa);if(f){var d=parseInt(f[1],10)/(/%$/.test(f[1])?100:1)*(/%$/.test(f[1])?255:1),p=parseInt(f[2],10)/(/%$/.test(f[2])?100:1)*(/%$/.test(f[2])?255:1),m=parseInt(f[3],10)/(/%$/.test(f[3])?100:1)*(/%$/.test(f[3])?255:1);return[parseInt(d,10),parseInt(p,10),parseInt(m,10),f[4]?parseFloat(f[4]):1]}},r.Color.fromRgba=l.fromRgb,r.Color.fromHsl=function(c){return l.fromSource(l.sourceFromHsl(c))},r.Color.sourceFromHsl=function(c){var f=c.match(l.reHSLa);if(!!f){var d=(parseFloat(f[1])%360+360)%360/360,p=parseFloat(f[2])/(/%$/.test(f[2])?100:1),m=parseFloat(f[3])/(/%$/.test(f[3])?100:1),g,x,b;if(p===0)g=x=b=m;else{var y=m<=.5?m*(p+1):m+p-m*p,v=m*2-y;g=h(v,y,d+1/3),x=h(v,y,d),b=h(v,y,d-1/3)}return[Math.round(g*255),Math.round(x*255),Math.round(b*255),f[4]?parseFloat(f[4]):1]}},r.Color.fromHsla=l.fromHsl,r.Color.fromHex=function(c){return l.fromSource(l.sourceFromHex(c))},r.Color.sourceFromHex=function(c){if(c.match(l.reHex)){var f=c.slice(c.indexOf("#")+1),d=f.length===3||f.length===4,p=f.length===8||f.length===4,m=d?f.charAt(0)+f.charAt(0):f.substring(0,2),g=d?f.charAt(1)+f.charAt(1):f.substring(2,4),x=d?f.charAt(2)+f.charAt(2):f.substring(4,6),b=p?d?f.charAt(3)+f.charAt(3):f.substring(6,8):"FF";return[parseInt(m,16),parseInt(g,16),parseInt(x,16),parseFloat((parseInt(b,16)/255).toFixed(2))]}},r.Color.fromSource=function(c){var f=new l;return f.setSource(c),f}}(e),function(o){var r=o.fabric||(o.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],h=["ns","nesw","ew","nwse"],c={},f="left",d="top",p="right",m="bottom",g="center",x={top:m,bottom:d,left:p,right:f,center:g},b=r.util.radiansToDegrees,y=Math.sign||function($){return($>0)-($<0)||+$};function v($,E){var B=$.angle+b(Math.atan2(E.y,E.x))+360;return Math.round(B%360/45)}function w($,E){var B=E.transform.target,G=B.canvas,W=r.util.object.clone(E);W.target=B,G&&G.fire("object:"+$,W),B.fire($,E)}function C($,E){var B=E.canvas,G=B.uniScaleKey,W=$[G];return B.uniformScaling&&!W||!B.uniformScaling&&W}function S($){return $.originX===g&&$.originY===g}function k($,E,B){var G=$.lockScalingX,W=$.lockScalingY;return!!(G&&W||!E&&(G||W)&&B||G&&E==="x"||W&&E==="y")}function T($,E,B){var G="not-allowed",W=C($,B),J="";if(E.x!==0&&E.y===0?J="x":E.x===0&&E.y!==0&&(J="y"),k(B,J,W))return G;var at=v(B,E);return l[at]+"-resize"}function N($,E,B){var G="not-allowed";if(E.x!==0&&B.lockSkewingY||E.y!==0&&B.lockSkewingX)return G;var W=v(B,E)%4;return h[W]+"-resize"}function R($,E,B){return $[B.canvas.altActionKey]?c.skewCursorStyleHandler($,E,B):c.scaleCursorStyleHandler($,E,B)}function L($,E,B){var G=$[B.canvas.altActionKey];if(E.x===0)return G?"skewX":"scaleY";if(E.y===0)return G?"skewY":"scaleX"}function z($,E,B){return B.lockRotation?"not-allowed":E.cursorStyle}function U($,E,B,G){return{e:$,transform:E,pointer:{x:B,y:G}}}function H($){return function(E,B,G,W){var J=B.target,at=J.getCenterPoint(),ct=J.translateToOriginPoint(at,B.originX,B.originY),ut=$(E,B,G,W);return J.setPositionByOrigin(ct,B.originX,B.originY),ut}}function Y($,E){return function(B,G,W,J){var at=E(B,G,W,J);return at&&w($,U(B,G,W,J)),at}}function Q($,E,B,G,W){var J=$.target,at=J.controls[$.corner],ct=J.canvas.getZoom(),ut=J.padding/ct,q=J.toLocalPoint(new r.Point(G,W),E,B);return q.x>=ut&&(q.x-=ut),q.x<=-ut&&(q.x+=ut),q.y>=ut&&(q.y-=ut),q.y<=ut&&(q.y+=ut),q.x-=at.offsetX,q.y-=at.offsetY,q}function K($){return $.flipX!==$.flipY}function I($,E,B,G,W){if($[E]!==0){var J=$._getTransformedDimensions()[G],at=W/J*$[B];$.set(B,at)}}function A($,E,B,G){var W=E.target,J=W._getTransformedDimensions(0,W.skewY),at=Q(E,E.originX,E.originY,B,G),ct=Math.abs(at.x*2)-J.x,ut=W.skewX,q;ct<2?q=0:(q=b(Math.atan2(ct/W.scaleX,J.y/W.scaleY)),E.originX===f&&E.originY===m&&(q=-q),E.originX===p&&E.originY===d&&(q=-q),K(W)&&(q=-q));var gt=ut!==q;if(gt){var xt=W._getTransformedDimensions().y;W.set("skewX",q),I(W,"skewY","scaleY","y",xt)}return gt}function D($,E,B,G){var W=E.target,J=W._getTransformedDimensions(W.skewX,0),at=Q(E,E.originX,E.originY,B,G),ct=Math.abs(at.y*2)-J.y,ut=W.skewY,q;ct<2?q=0:(q=b(Math.atan2(ct/W.scaleY,J.x/W.scaleX)),E.originX===f&&E.originY===m&&(q=-q),E.originX===p&&E.originY===d&&(q=-q),K(W)&&(q=-q));var gt=ut!==q;if(gt){var xt=W._getTransformedDimensions().x;W.set("skewY",q),I(W,"skewX","scaleX","x",xt)}return gt}function F($,E,B,G){var W=E.target,J=W.skewX,at,ct=E.originY;if(W.lockSkewingX)return!1;if(J===0){var ut=Q(E,g,g,B,G);ut.x>0?at=f:at=p}else J>0&&(at=ct===d?f:p),J<0&&(at=ct===d?p:f),K(W)&&(at=at===f?p:f);E.originX=at;var q=Y("skewing",H(A));return q($,E,B,G)}function j($,E,B,G){var W=E.target,J=W.skewY,at,ct=E.originX;if(W.lockSkewingY)return!1;if(J===0){var ut=Q(E,g,g,B,G);ut.y>0?at=d:at=m}else J>0&&(at=ct===f?d:m),J<0&&(at=ct===f?m:d),K(W)&&(at=at===d?m:d);E.originY=at;var q=Y("skewing",H(D));return q($,E,B,G)}function O($,E,B,G){var W=E,J=W.target,at=J.translateToOriginPoint(J.getCenterPoint(),W.originX,W.originY);if(J.lockRotation)return!1;var ct=Math.atan2(W.ey-at.y,W.ex-at.x),ut=Math.atan2(G-at.y,B-at.x),q=b(ut-ct+W.theta),gt=!0;if(J.snapAngle>0){var xt=J.snapAngle,vt=J.snapThreshold||xt,Ct=Math.ceil(q/xt)*xt,It=Math.floor(q/xt)*xt;Math.abs(q-It)<vt?q=It:Math.abs(q-Ct)<vt&&(q=Ct)}return q<0&&(q=360+q),q%=360,gt=J.angle!==q,J.angle=q,gt}function _($,E,B,G,W){W=W||{};var J=E.target,at=J.lockScalingX,ct=J.lockScalingY,ut=W.by,q,gt,xt,vt,Ct=C($,J),It=k(J,ut,Ct),Ft,Ot,Ht=E.gestureScale;if(It)return!1;if(Ht)gt=E.scaleX*Ht,xt=E.scaleY*Ht;else{if(q=Q(E,E.originX,E.originY,B,G),Ft=ut!=="y"?y(q.x):1,Ot=ut!=="x"?y(q.y):1,E.signX||(E.signX=Ft),E.signY||(E.signY=Ot),J.lockScalingFlip&&(E.signX!==Ft||E.signY!==Ot))return!1;if(vt=J._getTransformedDimensions(),Ct&&!ut){var Te=Math.abs(q.x)+Math.abs(q.y),Fe=E.original,zs=Math.abs(vt.x*Fe.scaleX/J.scaleX)+Math.abs(vt.y*Fe.scaleY/J.scaleY),Cs=Te/zs;gt=Fe.scaleX*Cs,xt=Fe.scaleY*Cs}else gt=Math.abs(q.x*J.scaleX/vt.x),xt=Math.abs(q.y*J.scaleY/vt.y);S(E)&&(gt*=2,xt*=2),E.signX!==Ft&&ut!=="y"&&(E.originX=x[E.originX],gt*=-1,E.signX=Ft),E.signY!==Ot&&ut!=="x"&&(E.originY=x[E.originY],xt*=-1,E.signY=Ot)}var Ir=J.scaleX,an=J.scaleY;return ut?(ut==="x"&&J.set("scaleX",gt),ut==="y"&&J.set("scaleY",xt)):(!at&&J.set("scaleX",gt),!ct&&J.set("scaleY",xt)),Ir!==J.scaleX||an!==J.scaleY}function V($,E,B,G){return _($,E,B,G)}function X($,E,B,G){return _($,E,B,G,{by:"x"})}function rt($,E,B,G){return _($,E,B,G,{by:"y"})}function st($,E,B,G){return $[E.target.canvas.altActionKey]?c.skewHandlerX($,E,B,G):c.scalingY($,E,B,G)}function ot($,E,B,G){return $[E.target.canvas.altActionKey]?c.skewHandlerY($,E,B,G):c.scalingX($,E,B,G)}function ht($,E,B,G){var W=E.target,J=Q(E,E.originX,E.originY,B,G),at=W.strokeWidth/(W.strokeUniform?W.scaleX:1),ct=S(E)?2:1,ut=W.width,q=Math.abs(J.x*ct/W.scaleX)-at;return W.set("width",Math.max(q,0)),ut!==q}function mt($,E,B,G){var W=E.target,J=B-E.offsetX,at=G-E.offsetY,ct=!W.get("lockMovementX")&&W.left!==J,ut=!W.get("lockMovementY")&&W.top!==at;return ct&&W.set("left",J),ut&&W.set("top",at),(ct||ut)&&w("moving",U($,E,B,G)),ct||ut}c.scaleCursorStyleHandler=T,c.skewCursorStyleHandler=N,c.scaleSkewCursorStyleHandler=R,c.rotationWithSnapping=Y("rotating",H(O)),c.scalingEqually=Y("scaling",H(V)),c.scalingX=Y("scaling",H(X)),c.scalingY=Y("scaling",H(rt)),c.scalingYOrSkewingX=st,c.scalingXOrSkewingY=ot,c.changeWidth=Y("resizing",H(ht)),c.skewHandlerX=F,c.skewHandlerY=j,c.dragHandler=mt,c.scaleOrSkewActionName=L,c.rotationStyleHandler=z,c.fireEvent=w,c.wrapWithFixedAnchor=H,c.wrapWithFireEvent=Y,c.getLocalPoint=Q,r.controlsUtils=c}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.degreesToRadians,h=r.controlsUtils;function c(d,p,m,g,x){g=g||{};var b=this.sizeX||g.cornerSize||x.cornerSize,y=this.sizeY||g.cornerSize||x.cornerSize,v=typeof g.transparentCorners!="undefined"?g.transparentCorners:x.transparentCorners,w=v?"stroke":"fill",C=!v&&(g.cornerStrokeColor||x.cornerStrokeColor),S=p,k=m,T;d.save(),d.fillStyle=g.cornerColor||x.cornerColor,d.strokeStyle=g.cornerStrokeColor||x.cornerStrokeColor,b>y?(T=b,d.scale(1,y/b),k=m*b/y):y>b?(T=y,d.scale(b/y,1),S=p*y/b):T=b,d.lineWidth=1,d.beginPath(),d.arc(S,k,T/2,0,2*Math.PI,!1),d[w](),C&&d.stroke(),d.restore()}function f(d,p,m,g,x){g=g||{};var b=this.sizeX||g.cornerSize||x.cornerSize,y=this.sizeY||g.cornerSize||x.cornerSize,v=typeof g.transparentCorners!="undefined"?g.transparentCorners:x.transparentCorners,w=v?"stroke":"fill",C=!v&&(g.cornerStrokeColor||x.cornerStrokeColor),S=b/2,k=y/2;d.save(),d.fillStyle=g.cornerColor||x.cornerColor,d.strokeStyle=g.cornerStrokeColor||x.cornerStrokeColor,d.lineWidth=1,d.translate(p,m),d.rotate(l(x.angle)),d[w+"Rect"](-S,-k,b,y),C&&d.strokeRect(-S,-k,b,y),d.restore()}h.renderCircleControl=c,h.renderSquareControl=f}(e),function(o){var r=o.fabric||(o.fabric={});function l(h){for(var c in h)this[c]=h[c]}r.Control=l,r.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(h,c){return c.cursorStyle},getActionName:function(h,c){return c.actionName},getVisibility:function(h,c){var f=h._controlsVisibility;return f&&typeof f[c]!="undefined"?f[c]:this.visible},setVisibility:function(h){this.visible=h},positionHandler:function(h,c){var f=r.util.transformPoint({x:this.x*h.x+this.offsetX,y:this.y*h.y+this.offsetY},c);return f},calcCornerCoords:function(h,c,f,d,p){var m,g,x,b,y=p?this.touchSizeX:this.sizeX,v=p?this.touchSizeY:this.sizeY;if(y&&v&&y!==v){var w=Math.atan2(v,y),C=Math.sqrt(y*y+v*v)/2,S=w-r.util.degreesToRadians(h),k=Math.PI/2-w-r.util.degreesToRadians(h);m=C*r.util.cos(S),g=C*r.util.sin(S),x=C*r.util.cos(k),b=C*r.util.sin(k)}else{var T=y&&v?y:c;C=T*.7071067812;var S=r.util.degreesToRadians(45-h);m=x=C*r.util.cos(S),g=b=C*r.util.sin(S)}return{tl:{x:f-b,y:d-x},tr:{x:f+m,y:d-g},bl:{x:f-m,y:d+g},br:{x:f+b,y:d+x}}},render:function(h,c,f,d,p){switch(d=d||{},d.cornerStyle||p.cornerStyle){case"circle":r.controlsUtils.renderCircleControl.call(this,h,c,f,d,p);break;default:r.controlsUtils.renderSquareControl.call(this,h,c,f,d,p)}}}}(e),function(){function o(f,d){var p=f.getAttribute("style"),m=f.getAttribute("offset")||0,g,x,b,y;if(m=parseFloat(m)/(/%$/.test(m)?100:1),m=m<0?0:m>1?1:m,p){var v=p.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),y=v.length;y--;){var w=v[y].split(/\s*:\s*/),C=w[0].trim(),S=w[1].trim();C==="stop-color"?g=S:C==="stop-opacity"&&(b=S)}}return g||(g=f.getAttribute("stop-color")||"rgb(0,0,0)"),b||(b=f.getAttribute("stop-opacity")),g=new t.Color(g),x=g.getAlpha(),b=isNaN(parseFloat(b))?1:parseFloat(b),b*=x*d,{offset:m,color:g.toRgb(),opacity:b}}function r(f){return{x1:f.getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0}}function l(f){return{x1:f.getAttribute("fx")||f.getAttribute("cx")||"50%",y1:f.getAttribute("fy")||f.getAttribute("cy")||"50%",r1:0,x2:f.getAttribute("cx")||"50%",y2:f.getAttribute("cy")||"50%",r2:f.getAttribute("r")||"50%"}}var h=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(f){f||(f={}),f.coords||(f.coords={});var d,p=this;Object.keys(f).forEach(function(m){p[m]=f[m]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,d={x1:f.coords.x1||0,y1:f.coords.y1||0,x2:f.coords.x2||0,y2:f.coords.y2||0},this.type==="radial"&&(d.r1=f.coords.r1||0,d.r2=f.coords.r2||0),this.coords=d,this.colorStops=f.colorStops.slice()},addColorStop:function(f){for(var d in f){var p=new t.Color(f[d]);this.colorStops.push({offset:parseFloat(d),color:p.toRgb(),opacity:p.getAlpha()})}return this},toObject:function(f){var d={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,d,f),d},toSVG:function(f,x){var p=h(this.coords,!0),m,g,x=x||{},b,y,v=h(this.colorStops,!0),w=p.r1>p.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,k=-this.offsetY,T=!!x.additionalTransform,N=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(v.sort(function(H,Y){return H.offset-Y.offset}),N==="objectBoundingBox"?(S/=f.width,k/=f.height):(S+=f.width/2,k+=f.height/2),f.type==="path"&&this.gradientUnits!=="percentage"&&(S-=f.pathOffset.x,k-=f.pathOffset.y),C[4]-=S,C[5]-=k,y='id="SVGID_'+this.id+'" gradientUnits="'+N+'"',y+=' gradientTransform="'+(T?x.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?b=["<linearGradient ",y,' x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,`">
`]:this.type==="radial"&&(b=["<radialGradient ",y,' cx="',w?p.x1:p.x2,'" cy="',w?p.y1:p.y2,'" r="',w?p.r1:p.r2,'" fx="',w?p.x2:p.x1,'" fy="',w?p.y2:p.y1,`">
`]),this.type==="radial"){if(w)for(v=v.concat(),v.reverse(),m=0,g=v.length;m<g;m++)v[m].offset=1-v[m].offset;var R=Math.min(p.r1,p.r2);if(R>0){var L=Math.max(p.r1,p.r2),z=R/L;for(m=0,g=v.length;m<g;m++)v[m].offset+=z*(1-v[m].offset)}}for(m=0,g=v.length;m<g;m++){var U=v[m];b.push("<stop ",'offset="',U.offset*100+"%",'" style="stop-color:',U.color,typeof U.opacity!="undefined"?";stop-opacity: "+U.opacity:";",`"/>
`)}return b.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),b.join("")},toLive:function(f){var d,p=t.util.object.clone(this.coords),m,g;if(!!this.type){for(this.type==="linear"?d=f.createLinearGradient(p.x1,p.y1,p.x2,p.y2):this.type==="radial"&&(d=f.createRadialGradient(p.x1,p.y1,p.r1,p.x2,p.y2,p.r2)),m=0,g=this.colorStops.length;m<g;m++){var x=this.colorStops[m].color,b=this.colorStops[m].opacity,y=this.colorStops[m].offset;typeof b!="undefined"&&(x=new t.Color(x).setAlpha(b).toRgba()),d.addColorStop(y,x)}return d}}}),t.util.object.extend(t.Gradient,{fromElement:function(f,d,p,m){var g=parseFloat(p)/(/%$/.test(p)?100:1);g=g<0?0:g>1?1:g,isNaN(g)&&(g=1);var x=f.getElementsByTagName("stop"),b,y=f.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",v=f.getAttribute("gradientTransform")||"",w=[],C,S,k=0,T=0,N;for(f.nodeName==="linearGradient"||f.nodeName==="LINEARGRADIENT"?(b="linear",C=r(f)):(b="radial",C=l(f)),S=x.length;S--;)w.push(o(x[S],g));N=t.parseTransformAttribute(v),c(d,C,m,y),y==="pixels"&&(k=-d.left,T=-d.top);var R=new t.Gradient({id:f.getAttribute("id"),type:b,coords:C,colorStops:w,gradientUnits:y,gradientTransform:N,offsetX:k,offsetY:T});return R}});function c(f,d,p,m){var g,x;Object.keys(d).forEach(function(b){g=d[b],g==="Infinity"?x=1:g==="-Infinity"?x=0:(x=parseFloat(d[b],10),typeof g=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(g)&&(x*=.01,m==="pixels"&&((b==="x1"||b==="x2"||b==="r2")&&(x*=p.viewBoxWidth||p.width),(b==="y1"||b==="y2")&&(x*=p.viewBoxHeight||p.height)))),d[b]=x})}}(),function(){var o=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(r,l){if(r||(r={}),this.id=t.Object.__uid++,this.setOptions(r),!r.source||r.source&&typeof r.source!="string"){l&&l(this);return}else{var h=this;this.source=t.util.createImage(),t.util.loadImage(r.source,function(c,f){h.source=c,l&&l(h,f)},null,this.crossOrigin)}},toObject:function(r){var l=t.Object.NUM_FRACTION_DIGITS,h,c;return typeof this.source.src=="string"?h=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(h=this.source.toDataURL()),c={type:"pattern",source:h,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:o(this.offsetX,l),offsetY:o(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,c,r),c},toSVG:function(r){var l=typeof this.source=="function"?this.source():this.source,h=l.width/r.width,c=l.height/r.height,f=this.offsetX/r.width,d=this.offsetY/r.height,p="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(c=1,d&&(c+=Math.abs(d))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(h=1,f&&(h+=Math.abs(f))),l.src?p=l.src:l.toDataURL&&(p=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+f+'" y="'+d+'" width="'+h+'" height="'+c+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+p+`"></image>
</pattern>
`},setOptions:function(r){for(var l in r)this[l]=r[l]},toLive:function(r){var l=this.source;return!l||typeof l.src!="undefined"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":r.createPattern(l,this.repeat)}})}(),function(o){var r=o.fabric||(o.fabric={}),l=r.util.toFixed;if(r.Shadow){r.warn("fabric.Shadow is already defined.");return}r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(h){typeof h=="string"&&(h=this._parseShadow(h));for(var c in h)this[c]=h[c];this.id=r.Object.__uid++},_parseShadow:function(h){var c=h.trim(),f=r.Shadow.reOffsetsAndBlur.exec(c)||[],d=c.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseFloat(f[1],10)||0,offsetY:parseFloat(f[2],10)||0,blur:parseFloat(f[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(h){var c=40,f=40,d=r.Object.NUM_FRACTION_DIGITS,p=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-h.angle)),m=20,g=new r.Color(this.color);return h.width&&h.height&&(c=l((Math.abs(p.x)+this.blur)/h.width,d)*100+m,f=l((Math.abs(p.y)+this.blur)/h.height,d)*100+m),h.flipX&&(p.x*=-1),h.flipY&&(p.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+f+'%" height="'+(100+2*f)+'%" x="-'+c+'%" width="'+(100+2*c)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,d)+`"></feGaussianBlur>
	<feOffset dx="`+l(p.x,d)+'" dy="'+l(p.y,d)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+g.toRgb()+'" flood-opacity="'+g.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var h={},c=r.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(f){this[f]!==c[f]&&(h[f]=this[f])},this),h}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(e),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var o=t.util.object.extend,r=t.util.getElementOffset,l=t.util.removeFromArray,h=t.util.toFixed,c=t.util.transformPoint,f=t.util.invertTransform,d=t.util.getNodeCanvas,p=t.util.createCanvasElement,m=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(g,x){x||(x={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,x)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,x){var b=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(x),this.interactive||this._initRetinaScaling(),x.overlayImage&&this.setOverlayImage(x.overlayImage,b),x.backgroundImage&&this.setBackgroundImage(x.backgroundImage,b),x.backgroundColor&&this.setBackgroundColor(x.backgroundColor,b),x.overlayColor&&this.setOverlayColor(x.overlayColor,b),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var g=t.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,x,b){x.setAttribute("width",this.width*g),x.setAttribute("height",this.height*g),b.scale(g,g)},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(g,x,b){return this.__setBgOverlayImage("overlayImage",g,x,b)},setBackgroundImage:function(g,x,b){return this.__setBgOverlayImage("backgroundImage",g,x,b)},setOverlayColor:function(g,x){return this.__setBgOverlayColor("overlayColor",g,x)},setBackgroundColor:function(g,x){return this.__setBgOverlayColor("backgroundColor",g,x)},__setBgOverlayImage:function(g,x,b,y){return typeof x=="string"?t.util.loadImage(x,function(v,w){if(v){var C=new t.Image(v,y);this[g]=C,C.canvas=this}b&&b(v,w)},this,y&&y.crossOrigin):(y&&x.setOptions(y),this[g]=x,x&&(x.canvas=this),b&&b(x,!1)),this},__setBgOverlayColor:function(g,x,b){return this[g]=x,this._initGradient(x,g),this._initPattern(x,g,b),this},_createCanvasElement:function(){var g=p();if(!g||(g.style||(g.style={}),typeof g.getContext=="undefined"))throw m;return g},_initOptions:function(g){var x=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(x.width,10)||0,this.height=this.height||parseInt(x.height,10)||0,this.lowerCanvasEl.style&&(x.width=this.width,x.height=this.height,x.style.width=this.width+"px",x.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=t.util.getById(g)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,x){return this.setDimensions({width:g},x)},setHeight:function(g,x){return this.setDimensions({height:g},x)},setDimensions:function(g,x){var b;x=x||{};for(var y in g)b=g[y],x.cssOnly||(this._setBackstoreDimension(y,g[y]),b+="px",this.hasLostContext=!0),x.backstoreOnly||this._setCssDimension(y,b);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),x.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,x){return this.lowerCanvasEl[g]=x,this.upperCanvasEl&&(this.upperCanvasEl[g]=x),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=x),this[g]=x,this},_setCssDimension:function(g,x){return this.lowerCanvasEl.style[g]=x,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=x),this.wrapperEl&&(this.wrapperEl.style[g]=x),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var x=this._activeObject,b=this.backgroundImage,y=this.overlayImage,v,w,C;for(this.viewportTransform=g,w=0,C=this._objects.length;w<C;w++)v=this._objects[w],v.group||v.setCoords(!0);return x&&x.setCoords(),b&&b.setCoords(!0),y&&y.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,x){var b=g,y=this.viewportTransform.slice(0);g=c(g,f(this.viewportTransform)),y[0]=x,y[3]=x;var v=c(g,y);return y[4]+=b.x-v.x,y[5]+=b.y-v.y,this.setViewportTransform(y)},setZoom:function(g){return this.zoomToPoint(new t.Point(0,0),g),this},absolutePan:function(g){var x=this.viewportTransform.slice(0);return x[4]=-g.x,x[5]=-g.y,this.setViewportTransform(x)},relativePan:function(g){return this.absolutePan(new t.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},x=this.width,b=this.height,y=f(this.viewportTransform);return g.tl=c({x:0,y:0},y),g.br=c({x,y:b},y),g.tr=new t.Point(g.br.x,g.tl.y),g.bl=new t.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,x){var b=this.viewportTransform,y=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),t.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this._renderObjects(g,x),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),y&&(y.canvas=this,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var x=this.viewportTransform,b=this.clipPath;g.save(),g.transform(x[0],x[1],x[2],x[3],x[4],x[5]),g.globalCompositeOperation="destination-in",b.transform(g),g.scale(1/b.zoomX,1/b.zoomY),g.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),g.restore()},_renderObjects:function(g,x){var b,y;for(b=0,y=x.length;b<y;++b)x[b]&&x[b].render(g)},_renderBackgroundOrOverlay:function(g,x){var b=this[x+"Color"],y=this[x+"Image"],v=this.viewportTransform,w=this[x+"Vpt"];if(!(!b&&!y)){if(b){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=b.toLive?b.toLive(g,this):b,w&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),g.transform(1,0,0,1,b.offsetX||0,b.offsetY||0);var C=b.gradientTransform||b.patternTransform;C&&g.transform(C[0],C[1],C[2],C[3],C[4],C[5]),g.fill(),g.restore()}y&&(g.save(),w&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),y.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new t.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new t.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var x=this.getCenterPoint();return this._centerObject(g,x)},viewportCenterObject:function(g){var x=this.getVpCenter();return this._centerObject(g,x)},viewportCenterObjectH:function(g){var x=this.getVpCenter();return this._centerObject(g,new t.Point(x.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var x=this.getVpCenter();return this._centerObject(g,new t.Point(g.getCenterPoint().x,x.y))},getVpCenter:function(){var g=this.getCenterPoint(),x=f(this.viewportTransform);return c(g,x)},_centerObject:function(g,x){return g.setPositionByOrigin(x,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,x){var b=this.clipPath,y={version:t.version,objects:this._toObjects(g,x)};return b&&!b.excludeFromExport&&(y.clipPath=this._toObject(this.clipPath,g,x)),o(y,this.__serializeBgOverlay(g,x)),t.util.populateWithProperties(this,y,x),y},_toObjects:function(g,x){return this._objects.filter(function(b){return!b.excludeFromExport}).map(function(b){return this._toObject(b,g,x)},this)},_toObject:function(g,x,b){var y;this.includeDefaultValues||(y=g.includeDefaultValues,g.includeDefaultValues=!1);var v=g[x](b);return this.includeDefaultValues||(g.includeDefaultValues=y),v},__serializeBgOverlay:function(g,x){var b={},y=this.backgroundImage,v=this.overlayImage,w=this.backgroundColor,C=this.overlayColor;return w&&w.toObject?w.excludeFromExport||(b.background=w.toObject(x)):w&&(b.background=w),C&&C.toObject?C.excludeFromExport||(b.overlay=C.toObject(x)):C&&(b.overlay=C),y&&!y.excludeFromExport&&(b.backgroundImage=this._toObject(y,g,x)),v&&!v.excludeFromExport&&(b.overlayImage=this._toObject(v,g,x)),b},svgViewportTransformation:!0,toSVG:function(g,x){g||(g={}),g.reviver=x;var b=[];return this._setSVGPreamble(b,g),this._setSVGHeader(b,g),this.clipPath&&b.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(b,"background"),this._setSVGBgOverlayImage(b,"backgroundImage",x),this._setSVGObjects(b,x),this.clipPath&&b.push(`</g>
`),this._setSVGBgOverlayColor(b,"overlay"),this._setSVGBgOverlayImage(b,"overlayImage",x),b.push("</svg>"),b.join("")},_setSVGPreamble:function(g,x){x.suppressPreamble||g.push('<?xml version="1.0" encoding="',x.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,x){var b=x.width||this.width,y=x.height||this.height,v,w='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;x.viewBox?w='viewBox="'+x.viewBox.x+" "+x.viewBox.y+" "+x.viewBox.width+" "+x.viewBox.height+'" ':this.svgViewportTransformation&&(v=this.viewportTransform,w='viewBox="'+h(-v[4]/v[0],C)+" "+h(-v[5]/v[3],C)+" "+h(this.width/v[0],C)+" "+h(this.height/v[3],C)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b,'" ','height="',y,'" ',w,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(x),`</defs>
`)},createSVGClipPathMarkup:function(g){var x=this.clipPath;return x?(x.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+x.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this,x=["background","overlay"].map(function(b){var y=g[b+"Color"];if(y&&y.toLive){var v=g[b+"Vpt"],w=g.viewportTransform,C={width:g.width/(v?w[0]:1),height:g.height/(v?w[3]:1)};return y.toSVG(C,{additionalTransform:v?t.util.matrixToSVG(w):""})}});return x.join("")},createSVGFontFacesMarkup:function(){var g="",x={},b,y,v,w,C,S,k,T,N,R=t.fontPaths,L=[];for(this._objects.forEach(function U(H){L.push(H),H._objects&&H._objects.forEach(U)}),T=0,N=L.length;T<N;T++)if(b=L[T],y=b.fontFamily,!(b.type.indexOf("text")===-1||x[y]||!R[y])&&(x[y]=!0,!!b.styles)){v=b.styles;for(C in v){w=v[C];for(k in w)S=w[k],y=S.fontFamily,!x[y]&&R[y]&&(x[y]=!0)}}for(var z in x)g+=[`		@font-face {
`,"			font-family: '",z,`';
`,"			src: url('",R[z],`');
`,`		}
`].join("");return g&&(g=['	<style type="text/css">',`<![CDATA[
`,g,"]]>",`</style>
`].join("")),g},_setSVGObjects:function(g,x){var b,y,v,w=this._objects;for(y=0,v=w.length;y<v;y++)b=w[y],!b.excludeFromExport&&this._setSVGObject(g,b,x)},_setSVGObject:function(g,x,b){g.push(x.toSVG(b))},_setSVGBgOverlayImage:function(g,x,b){this[x]&&!this[x].excludeFromExport&&this[x].toSVG&&g.push(this[x].toSVG(b))},_setSVGBgOverlayColor:function(g,x){var b=this[x+"Color"],y=this.viewportTransform,v=this.width,w=this.height;if(!!b)if(b.toLive){var C=b.repeat,S=t.util.invertTransform(y),k=this[x+"Vpt"],T=k?t.util.matrixToSVG(S):"";g.push('<rect transform="'+T+" translate(",v/2,",",w/2,')"',' x="',b.offsetX-v/2,'" y="',b.offsetY-w/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?b.source.width:v,'" height="',C==="repeat-x"||C==="no-repeat"?b.source.height:w,'" fill="url(#SVGID_'+b.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',b,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var x=this._activeObject,b,y,v;if(g===x&&g.type==="activeSelection")for(v=x._objects,b=v.length;b--;)y=v[b],l(this._objects,y),this._objects.unshift(y);else l(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var x=this._activeObject,b,y,v;if(g===x&&g.type==="activeSelection")for(v=x._objects,b=0;b<v.length;b++)y=v[b],l(this._objects,y),this._objects.push(y);else l(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,x){if(!g)return this;var b=this._activeObject,y,v,w,C,S,k=0;if(g===b&&g.type==="activeSelection")for(S=b._objects,y=0;y<S.length;y++)v=S[y],w=this._objects.indexOf(v),w>0+k&&(C=w-1,l(this._objects,v),this._objects.splice(C,0,v)),k++;else w=this._objects.indexOf(g),w!==0&&(C=this._findNewLowerIndex(g,w,x),l(this._objects,g),this._objects.splice(C,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,x,b){var y,v;if(b)for(y=x,v=x-1;v>=0;--v){var w=g.intersectsWithObject(this._objects[v])||g.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(g);if(w){y=v;break}}else y=x-1;return y},bringForward:function(g,x){if(!g)return this;var b=this._activeObject,y,v,w,C,S,k=0;if(g===b&&g.type==="activeSelection")for(S=b._objects,y=S.length;y--;)v=S[y],w=this._objects.indexOf(v),w<this._objects.length-1-k&&(C=w+1,l(this._objects,v),this._objects.splice(C,0,v)),k++;else w=this._objects.indexOf(g),w!==this._objects.length-1&&(C=this._findNewUpperIndex(g,w,x),l(this._objects,g),this._objects.splice(C,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,x,b){var y,v,w;if(b)for(y=x,v=x+1,w=this._objects.length;v<w;++v){var C=g.intersectsWithObject(this._objects[v])||g.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(g);if(C){y=v;break}}else y=x+1;return y},moveTo:function(g,x){return l(this._objects,g),this._objects.splice(x,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),o(t.StaticCanvas.prototype,t.Observable),o(t.StaticCanvas.prototype,t.Collection),o(t.StaticCanvas.prototype,t.DataURLExporter),o(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var x=p();if(!x||!x.getContext)return null;var b=x.getContext("2d");if(!b)return null;switch(g){case"setLineDash":return typeof b.setLineDash!="undefined";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var g=d(this.lowerCanvasEl);return g&&g.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(g){var x=d(this.lowerCanvasEl);return x&&x.createJPEGStream(g)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(o){o.strokeStyle=this.color,o.lineWidth=this.width,o.lineCap=this.strokeLineCap,o.miterLimit=this.strokeMiterLimit,o.lineJoin=this.strokeLineJoin,o.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(o){var r=this.canvas.viewportTransform;o.save(),o.transform(r[0],r[1],r[2],r[3],r[4],r[5])},_setShadow:function(){if(!!this.shadow){var o=this.canvas,r=this.shadow,l=o.contextTop,h=o.getZoom();o&&o._isRetinaScaling()&&(h*=t.devicePixelRatio),l.shadowColor=r.color,l.shadowBlur=r.blur*h,l.shadowOffsetX=r.offsetX*h,l.shadowOffsetY=r.offsetY*h}},needsFullRender:function(){var o=new t.Color(this.color);return o.getAlpha()<1||!!this.shadow},_resetShadow:function(){var o=this.canvas.contextTop;o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0},_isOutSideCanvas:function(o){return o.x<0||o.x>this.canvas.getWidth()||o.y<0||o.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(o){this.canvas=o,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(o,r,l){var h=r.midPointFrom(l);return o.quadraticCurveTo(r.x,r.y,h.x,h.y),h},onMouseDown:function(o,r){!this.canvas._isMainEvent(r.e)||(this.drawStraightLine=r.e[this.straightLineKey],this._prepareForDrawing(o),this._captureDrawingPath(o),this._render())},onMouseMove:function(o,r){if(!!this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o))&&this._captureDrawingPath(o)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,h=l.length,c=this.canvas.contextTop;this._saveAndTransform(c),this.oldEnd&&(c.beginPath(),c.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(c,l[h-2],l[h-1],!0),c.stroke(),c.restore()}},onMouseUp:function(o){return this.canvas._isMainEvent(o.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(o){var r=new t.Point(o.x,o.y);this._reset(),this._addPoint(r),this.canvas.contextTop.moveTo(r.x,r.y)},_addPoint:function(o){return this._points.length>1&&o.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(o),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(o){var r=new t.Point(o.x,o.y);return this._addPoint(r)},_render:function(o){var r,l,h=this._points[0],c=this._points[1];if(o=o||this.canvas.contextTop,this._saveAndTransform(o),o.beginPath(),this._points.length===2&&h.x===c.x&&h.y===c.y){var f=this.width/1e3;h=new t.Point(h.x,h.y),c=new t.Point(c.x,c.y),h.x-=f,c.x+=f}for(o.moveTo(h.x,h.y),r=1,l=this._points.length;r<l;r++)this._drawSegment(o,h,c),h=this._points[r],c=this._points[r+1];o.lineTo(h.x,h.y),o.stroke(),o.restore()},convertPointsToSVGPath:function(o){var r=this.width/1e3;return t.util.getSmoothPathFromPoints(o,r)},_isEmptySVGPath:function(o){var r=t.util.joinPath(o);return r==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(o){var r=new t.Path(o,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,r.shadow=new t.Shadow(this.shadow)),r},decimatePoints:function(o,r){if(o.length<=2)return o;var l=this.canvas.getZoom(),h=Math.pow(r/l,2),c,f=o.length-1,d=o[0],p=[d],m;for(c=1;c<f-1;c++)m=Math.pow(d.x-o[c].x,2)+Math.pow(d.y-o[c].y,2),m>=h&&(d=o[c],p.push(d));return p.push(o[f]),p},_finalizeAndAddPath:function(){var o=this.canvas.contextTop;o.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var r=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(r)){this.canvas.requestRenderAll();return}var l=this.createPath(r);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(o){this.canvas=o,this.points=[]},drawDot:function(o){var r=this.addPoint(o),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,r),l.restore()},dot:function(o,r){o.fillStyle=r.fill,o.beginPath(),o.arc(r.x,r.y,r.radius,0,Math.PI*2,!1),o.closePath(),o.fill()},onMouseDown:function(o){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(o)},_render:function(){var o=this.canvas.contextTop,r,l,h=this.points;for(this._saveAndTransform(o),r=0,l=h.length;r<l;r++)this.dot(o,h[r]);o.restore()},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(o),this._render()):this.drawDot(o))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove,r,l;this.canvas.renderOnAddRemove=!1;var h=[];for(r=0,l=this.points.length;r<l;r++){var c=this.points[r],f=new t.Circle({radius:c.radius,left:c.x,top:c.y,originX:"center",originY:"center",fill:c.fill});this.shadow&&(f.shadow=new t.Shadow(this.shadow)),h.push(f)}var d=new t.Group(h);d.canvas=this.canvas,this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},addPoint:function(o){var r=new t.Point(o.x,o.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,h=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return r.radius=l,r.fill=h,this.points.push(r),r}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(o){this.canvas=o,this.sprayChunks=[]},onMouseDown:function(o){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(o),this.render(this.sprayChunkPoints)},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.addSprayChunk(o),this.render(this.sprayChunkPoints))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var r=[],l=0,h=this.sprayChunks.length;l<h;l++)for(var c=this.sprayChunks[l],f=0,d=c.length;f<d;f++){var p=new t.Rect({width:c[f].width,height:c[f].width,left:c[f].x+1,top:c[f].y+1,originX:"center",originY:"center",fill:this.color});r.push(p)}this.optimizeOverlapping&&(r=this._getOptimizedRects(r));var m=new t.Group(r);this.shadow&&m.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:m}),this.canvas.add(m),this.canvas.fire("path:created",{path:m}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},_getOptimizedRects:function(o){var r={},l,h,c;for(h=0,c=o.length;h<c;h++)l=o[h].left+""+o[h].top,r[l]||(r[l]=o[h]);var f=[];for(l in r)f.push(r[l]);return f},render:function(o){var r=this.canvas.contextTop,l,h;for(r.fillStyle=this.color,this._saveAndTransform(r),l=0,h=o.length;l<h;l++){var c=o[l];typeof c.opacity!="undefined"&&(r.globalAlpha=c.opacity),r.fillRect(c.x,c.y,c.width,c.width)}r.restore()},_render:function(){var o=this.canvas.contextTop,r,l;for(o.fillStyle=this.color,this._saveAndTransform(o),r=0,l=this.sprayChunks.length;r<l;r++)this.render(this.sprayChunks[r]);o.restore()},addSprayChunk:function(o){this.sprayChunkPoints=[];var r,l,h,c=this.width/2,f;for(f=0;f<this.density;f++){r=t.util.getRandomInt(o.x-c,o.x+c),l=t.util.getRandomInt(o.y-c,o.y+c),this.dotWidthVariance?h=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):h=this.dotWidth;var d=new t.Point(r,l);d.width=h,this.randomOpacity&&(d.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(d)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var o=20,r=5,l=t.util.createCanvasElement(),h=l.getContext("2d");return l.width=l.height=o+r,h.fillStyle=this.color,h.beginPath(),h.arc(o/2,o/2,o/2,0,Math.PI*2,!1),h.closePath(),h.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(o){return o.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(o){this.callSuper("_setBrushStyles",o),o.strokeStyle=this.getPattern(o)},createPath:function(o){var r=this.callSuper("createPath",o),l=r._getLeftTopCoords().scalarAdd(r.strokeWidth/2);return r.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),r}}),function(){var o=t.util.getPointer,r=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(c,f){f||(f={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(c,f),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var c=this.getActiveObjects(),f,d,p;if(c.length>0&&!this.preserveObjectStacking){d=[],p=[];for(var m=0,g=this._objects.length;m<g;m++)f=this._objects[m],c.indexOf(f)===-1?d.push(f):p.push(f);c.length>1&&(this._activeObject._objects=p),d.push.apply(d,p)}else d=this._objects;return d},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var c=this.contextContainer;return this.renderCanvas(c,this._chooseObjectsToRender()),this},renderTopLayer:function(c){c.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(c),this.contextTopDirty=!0),c.restore()},renderTop:function(){var c=this.contextTop;return this.clearContext(c),this.renderTopLayer(c),this.fire("after:render"),this},_normalizePointer:function(c,f){var d=c.calcTransformMatrix(),p=t.util.invertTransform(d),m=this.restorePointerVpt(f);return t.util.transformPoint(m,p)},isTargetTransparent:function(c,f,d){if(c.shouldCache()&&c._cacheCanvas&&c!==this._activeObject){var p=this._normalizePointer(c,{x:f,y:d}),m=Math.max(c.cacheTranslationX+p.x*c.zoomX,0),g=Math.max(c.cacheTranslationY+p.y*c.zoomY,0),v=t.util.isTransparent(c._cacheContext,Math.round(m),Math.round(g),this.targetFindTolerance);return v}var x=this.contextCache,b=c.selectionBackgroundColor,y=this.viewportTransform;c.selectionBackgroundColor="",this.clearContext(x),x.save(),x.transform(y[0],y[1],y[2],y[3],y[4],y[5]),c.render(x),x.restore(),c.selectionBackgroundColor=b;var v=t.util.isTransparent(x,f,d,this.targetFindTolerance);return v},_isSelectionKeyPressed:function(c){var f=!1;return Array.isArray(this.selectionKey)?f=!!this.selectionKey.find(function(d){return c[d]===!0}):f=c[this.selectionKey],f},_shouldClearSelection:function(c,f){var d=this.getActiveObjects(),p=this._activeObject;return!f||f&&p&&d.length>1&&d.indexOf(f)===-1&&p!==f&&!this._isSelectionKeyPressed(c)||f&&!f.evented||f&&!f.selectable&&p&&p!==f},_shouldCenterTransform:function(c,f,d){if(!!c){var p;return f==="scale"||f==="scaleX"||f==="scaleY"||f==="resizing"?p=this.centeredScaling||c.centeredScaling:f==="rotate"&&(p=this.centeredRotation||c.centeredRotation),p?!d:d}},_getOriginFromCorner:function(c,f){var d={x:c.originX,y:c.originY};return f==="ml"||f==="tl"||f==="bl"?d.x="right":(f==="mr"||f==="tr"||f==="br")&&(d.x="left"),f==="tl"||f==="mt"||f==="tr"?d.y="bottom":(f==="bl"||f==="mb"||f==="br")&&(d.y="top"),d},_getActionFromCorner:function(c,f,d,p){if(!f||!c)return"drag";var m=p.controls[f];return m.getActionName(d,m,p)},_setupCurrentTransform:function(c,f,d){if(!!f){var p=this.getPointer(c),m=f.__corner,g=f.controls[m],x=d&&m?g.getActionHandler(c,f,g):t.controlsUtils.dragHandler,b=this._getActionFromCorner(d,m,c,f),y=this._getOriginFromCorner(f,m),v=c[this.centeredKey],w={target:f,action:b,actionHandler:x,corner:m,scaleX:f.scaleX,scaleY:f.scaleY,skewX:f.skewX,skewY:f.skewY,offsetX:p.x-f.left,offsetY:p.y-f.top,originX:y.x,originY:y.y,ex:p.x,ey:p.y,lastX:p.x,lastY:p.y,theta:r(f.angle),width:f.width*f.scaleX,shiftKey:c.shiftKey,altKey:v,original:t.util.saveObjectTransform(f)};this._shouldCenterTransform(f,b,v)&&(w.originX="center",w.originY="center"),w.original.originX=y.x,w.original.originY=y.y,this._currentTransform=w,this._beforeTransform(c)}},setCursor:function(c){this.upperCanvasEl.style.cursor=c},_drawSelection:function(c){var f=this._groupSelector,d=new t.Point(f.ex,f.ey),p=t.util.transformPoint(d,this.viewportTransform),m=new t.Point(f.ex+f.left,f.ey+f.top),g=t.util.transformPoint(m,this.viewportTransform),x=Math.min(p.x,g.x),b=Math.min(p.y,g.y),y=Math.max(p.x,g.x),v=Math.max(p.y,g.y),w=this.selectionLineWidth/2;this.selectionColor&&(c.fillStyle=this.selectionColor,c.fillRect(x,b,y-x,v-b)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(c.lineWidth=this.selectionLineWidth,c.strokeStyle=this.selectionBorderColor,x+=w,b+=w,y-=w,v-=w,t.Object.prototype._setLineDash.call(this,c,this.selectionDashArray),c.strokeRect(x,b,y-x,v-b))},findTarget:function(c,f){if(!this.skipTargetFind){var d=!0,p=this.getPointer(c,d),m=this._activeObject,g=this.getActiveObjects(),x,b,y=l(c),v=g.length>1&&!f||g.length===1;if(this.targets=[],v&&m._findTargetCorner(p,y)||g.length>1&&!f&&m===this._searchPossibleTargets([m],p))return m;if(g.length===1&&m===this._searchPossibleTargets([m],p))if(this.preserveObjectStacking)x=m,b=this.targets,this.targets=[];else return m;var w=this._searchPossibleTargets(this._objects,p);return c[this.altSelectionKey]&&w&&x&&w!==x&&(w=x,this.targets=b),w}},_checkTarget:function(c,f,d){if(f&&f.visible&&f.evented&&f.containsPoint(c))if((this.perPixelTargetFind||f.perPixelTargetFind)&&!f.isEditing){var p=this.isTargetTransparent(f,d.x,d.y);if(!p)return!0}else return!0},_searchPossibleTargets:function(c,f){for(var d,p=c.length,m;p--;){var g=c[p],x=g.group?this._normalizePointer(g.group,f):f;if(this._checkTarget(x,g,f)){d=c[p],d.subTargetCheck&&d instanceof t.Group&&(m=this._searchPossibleTargets(d._objects,f),m&&this.targets.push(m));break}}return d},restorePointerVpt:function(c){return t.util.transformPoint(c,t.util.invertTransform(this.viewportTransform))},getPointer:function(c,f){if(this._absolutePointer&&!f)return this._absolutePointer;if(this._pointer&&f)return this._pointer;var d=o(c),p=this.upperCanvasEl,m=p.getBoundingClientRect(),g=m.width||0,x=m.height||0,b;(!g||!x)&&("top"in m&&"bottom"in m&&(x=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(g=Math.abs(m.right-m.left))),this.calcOffset(),d.x=d.x-this._offset.left,d.y=d.y-this._offset.top,f||(d=this.restorePointerVpt(d));var y=this.getRetinaScaling();return y!==1&&(d.x/=y,d.y/=y),g===0||x===0?b={width:1,height:1}:b={width:p.width/g,height:p.height/x},{x:d.x*b.width,y:d.y*b.height}},_createUpperCanvas:function(){var c=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),f=this.lowerCanvasEl,d=this.upperCanvasEl;d?d.className="":(d=this._createCanvasElement(),this.upperCanvasEl=d),t.util.addClass(d,"upper-canvas "+c),this.wrapperEl.appendChild(d),this._copyCanvasStyle(f,d),this._applyCanvasStyle(d),this.contextTop=d.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(c){var f=this.width||c.width,d=this.height||c.height;t.util.setStyle(c,{position:"absolute",width:f+"px",height:d+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),c.width=f,c.height=d,t.util.makeElementUnselectable(c)},_copyCanvasStyle:function(c,f){f.style.cssText=c.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var c=this._activeObject;return c?c.type==="activeSelection"&&c._objects?c._objects.slice(0):[c]:[]},_onObjectRemoved:function(c){c===this._activeObject&&(this.fire("before:selection:cleared",{target:c}),this._discardActiveObject(),this.fire("selection:cleared",{target:c}),c.fire("deselected")),c===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",c)},_fireSelectionEvents:function(c,f){var d=!1,p=this.getActiveObjects(),m=[],g=[];c.forEach(function(x){p.indexOf(x)===-1&&(d=!0,x.fire("deselected",{e:f,target:x}),g.push(x))}),p.forEach(function(x){c.indexOf(x)===-1&&(d=!0,x.fire("selected",{e:f,target:x}),m.push(x))}),c.length>0&&p.length>0?d&&this.fire("selection:updated",{e:f,selected:m,deselected:g}):p.length>0?this.fire("selection:created",{e:f,selected:m}):c.length>0&&this.fire("selection:cleared",{e:f,deselected:g})},setActiveObject:function(c,f){var d=this.getActiveObjects();return this._setActiveObject(c,f),this._fireSelectionEvents(d,f),this},_setActiveObject:function(c,f){return this._activeObject===c||!this._discardActiveObject(f,c)||c.onSelect({e:f})?!1:(this._activeObject=c,!0)},_discardActiveObject:function(c,f){var d=this._activeObject;if(d){if(d.onDeselect({e:c,object:f}))return!1;this._activeObject=null}return!0},discardActiveObject:function(c){var f=this.getActiveObjects(),d=this.getActiveObject();return f.length&&this.fire("before:selection:cleared",{target:d,e:c}),this._discardActiveObject(c),this._fireSelectionEvents(f,c),this},dispose:function(){var c=this.wrapperEl;return this.removeListeners(),c.removeChild(this.upperCanvasEl),c.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(f){t.util.cleanUpJsdomNode(this[f]),this[f]=void 0}.bind(this)),c.parentNode&&c.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(c){var f=this._activeObject;f&&f._renderControls(c)},_toObject:function(c,f,d){var p=this._realizeGroupTransformOnObject(c),m=this.callSuper("_toObject",c,f,d);return this._unwindGroupTransformOnObject(c,p),m},_realizeGroupTransformOnObject:function(c){if(c.group&&c.group.type==="activeSelection"&&this._activeObject===c.group){var f=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],d={};return f.forEach(function(p){d[p]=c[p]}),t.util.addTransformToObject(c,this._activeObject.calcOwnMatrix()),d}else return null},_unwindGroupTransformOnObject:function(c,f){f&&c.set(f)},_setSVGObject:function(c,f,d){var p=this._realizeGroupTransformOnObject(f);this.callSuper("_setSVGObject",c,f,d),this._unwindGroupTransformOnObject(f,p)},setViewportTransform:function(c){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,c)}});for(var h in t.StaticCanvas)h!=="prototype"&&(t.Canvas[h]=t.StaticCanvas[h])}(),function(){var o=t.util.addListener,r=t.util.removeListener,l=3,h=2,c=1,f={passive:!1};function d(p,m){return p.button&&p.button===m-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(o,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(p,m){var g=this.upperCanvasEl,x=this._getEventPrefix();p(t.window,"resize",this._onResize),p(g,x+"down",this._onMouseDown),p(g,x+"move",this._onMouseMove,f),p(g,x+"out",this._onMouseOut),p(g,x+"enter",this._onMouseEnter),p(g,"wheel",this._onMouseWheel),p(g,"contextmenu",this._onContextMenu),p(g,"dblclick",this._onDoubleClick),p(g,"dragover",this._onDragOver),p(g,"dragenter",this._onDragEnter),p(g,"dragleave",this._onDragLeave),p(g,"drop",this._onDrop),this.enablePointerEvents||p(g,"touchstart",this._onTouchStart,f),typeof eventjs!="undefined"&&m in eventjs&&(eventjs[m](g,"gesture",this._onGesture),eventjs[m](g,"drag",this._onDrag),eventjs[m](g,"orientation",this._onOrientationChange),eventjs[m](g,"shake",this._onShake),eventjs[m](g,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(r,"remove");var p=this._getEventPrefix();r(t.document,p+"up",this._onMouseUp),r(t.document,"touchend",this._onTouchEnd,f),r(t.document,p+"move",this._onMouseMove,f),r(t.document,"touchmove",this._onMouseMove,f)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(p,m){this.__onTransformGesture&&this.__onTransformGesture(p,m)},_onDrag:function(p,m){this.__onDrag&&this.__onDrag(p,m)},_onMouseWheel:function(p){this.__onMouseWheel(p)},_onMouseOut:function(p){var m=this._hoveredTarget;this.fire("mouse:out",{target:m,e:p}),this._hoveredTarget=null,m&&m.fire("mouseout",{e:p});var g=this;this._hoveredTargets.forEach(function(x){g.fire("mouse:out",{target:m,e:p}),x&&m.fire("mouseout",{e:p})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(x){x.isEditing&&x.hiddenTextarea.focus()})},_onMouseEnter:function(p){!this._currentTransform&&!this.findTarget(p)&&(this.fire("mouse:over",{target:null,e:p}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(p,m){this.__onOrientationChange&&this.__onOrientationChange(p,m)},_onShake:function(p,m){this.__onShake&&this.__onShake(p,m)},_onLongPress:function(p,m){this.__onLongPress&&this.__onLongPress(p,m)},_onDragOver:function(p){p.preventDefault();var m=this._simpleEventHandler("dragover",p);this._fireEnterLeaveEvents(m,p)},_onDrop:function(p){return this._simpleEventHandler("drop:before",p),this._simpleEventHandler("drop",p)},_onContextMenu:function(p){return this.stopContextMenu&&(p.stopPropagation(),p.preventDefault()),!1},_onDoubleClick:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"dblclick"),this._resetTransformEventData(p)},getPointerId:function(p){var m=p.changedTouches;return m?m[0]&&m[0].identifier:this.enablePointerEvents?p.pointerId:-1},_isMainEvent:function(p){return p.isPrimary===!0?!0:p.isPrimary===!1?!1:p.type==="touchend"&&p.touches.length===0?!0:p.changedTouches?p.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(p){p.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();o(t.document,"touchend",this._onTouchEnd,f),o(t.document,"touchmove",this._onMouseMove,f),r(m,g+"down",this._onMouseDown)},_onMouseDown:function(p){this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();r(m,g+"move",this._onMouseMove,f),o(t.document,g+"up",this._onMouseUp),o(t.document,g+"move",this._onMouseMove,f)},_onTouchEnd:function(p){if(!(p.touches.length>0)){this.__onMouseUp(p),this._resetTransformEventData(),this.mainTouchId=null;var m=this._getEventPrefix();r(t.document,"touchend",this._onTouchEnd,f),r(t.document,"touchmove",this._onMouseMove,f);var g=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){o(g.upperCanvasEl,m+"down",g._onMouseDown),g._willAddMouseDown=0},400)}},_onMouseUp:function(p){this.__onMouseUp(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();this._isMainEvent(p)&&(r(t.document,g+"up",this._onMouseUp),r(t.document,g+"move",this._onMouseMove,f),o(m,g+"move",this._onMouseMove,f))},_onMouseMove:function(p){!this.allowTouchScrolling&&p.preventDefault&&p.preventDefault(),this.__onMouseMove(p)},_onResize:function(){this.calcOffset()},_shouldRender:function(p){var m=this._activeObject;return!!m!=!!p||m&&p&&m!==p?!0:(m&&m.isEditing,!1)},__onMouseUp:function(p){var m,g=this._currentTransform,x=this._groupSelector,b=!1,y=!x||x.left===0&&x.top===0;if(this._cacheTransformEventData(p),m=this._target,this._handleEvent(p,"up:before"),d(p,l)){this.fireRightClick&&this._handleEvent(p,"up",l,y);return}if(d(p,h)){this.fireMiddleClick&&this._handleEvent(p,"up",h,y),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(p);return}if(!!this._isMainEvent(p)){if(g&&(this._finalizeCurrentTransform(p),b=g.actionPerformed),!y){var v=m===this._activeObject;this._maybeGroupObjects(p),b||(b=this._shouldRender(m)||!v&&m===this._activeObject)}var w,C;if(m){if(w=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p)),m.selectable&&m!==this._activeObject&&m.activeOn==="up")this.setActiveObject(m,p),b=!0;else{var S=m.controls[w],k=S&&S.getMouseUpHandler(p,m,S);k&&(C=this.getPointer(p),k(p,g,C.x,C.y))}m.isMoving=!1}if(g&&(g.target!==m||g.corner!==w)){var T=g.target&&g.target.controls[g.corner],N=T&&T.getMouseUpHandler(p,m,S);C=C||this.getPointer(p),N&&N(p,g,C.x,C.y)}this._setCursorFromEvent(p,m),this._handleEvent(p,"up",c,y),this._groupSelector=null,this._currentTransform=null,m&&(m.__corner=0),b?this.requestRenderAll():y||this.renderTop()}},_simpleEventHandler:function(p,m){var g=this.findTarget(m),x=this.targets,b={e:m,target:g,subTargets:x};if(this.fire(p,b),g&&g.fire(p,b),!x)return g;for(var y=0;y<x.length;y++)x[y].fire(p,b);return g},_handleEvent:function(p,m,g,x){var b=this._target,y=this.targets||[],v={e:p,target:b,subTargets:y,button:g||c,isClick:x||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};m==="up"&&(v.currentTarget=this.findTarget(p),v.currentSubTargets=this.targets),this.fire("mouse:"+m,v),b&&b.fire("mouse"+m,v);for(var w=0;w<y.length;w++)y[w].fire("mouse"+m,v)},_finalizeCurrentTransform:function(p){var m=this._currentTransform,g=m.target,x={e:p,target:g,transform:m,action:m.action};g._scaling&&(g._scaling=!1),g.setCoords(),(m.actionPerformed||this.stateful&&g.hasStateChanged())&&this._fire("modified",x)},_onMouseDownInDrawingMode:function(p){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(p).requestRenderAll();var m=this.getPointer(p);this.freeDrawingBrush.onMouseDown(m,{e:p,pointer:m}),this._handleEvent(p,"down")},_onMouseMoveInDrawingMode:function(p){if(this._isCurrentlyDrawing){var m=this.getPointer(p);this.freeDrawingBrush.onMouseMove(m,{e:p,pointer:m})}this.setCursor(this.freeDrawingCursor),this._handleEvent(p,"move")},_onMouseUpInDrawingMode:function(p){var m=this.getPointer(p);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:p,pointer:m}),this._handleEvent(p,"up")},__onMouseDown:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"down:before");var m=this._target;if(d(p,l)){this.fireRightClick&&this._handleEvent(p,"down",l);return}if(d(p,h)){this.fireMiddleClick&&this._handleEvent(p,"down",h);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(p);return}if(!!this._isMainEvent(p)&&!this._currentTransform){var g=this._pointer;this._previousPointer=g;var x=this._shouldRender(m),b=this._shouldGroup(p,m);if(this._shouldClearSelection(p,m)?this.discardActiveObject(p):b&&(this._handleGrouping(p,m),m=this._activeObject),this.selection&&(!m||!m.selectable&&!m.isEditing&&m!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),m){var y=m===this._activeObject;m.selectable&&m.activeOn==="down"&&this.setActiveObject(m,p);var v=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p));if(m.__corner=v,m===this._activeObject&&(v||!b)){this._setupCurrentTransform(p,m,y);var w=m.controls[v],g=this.getPointer(p),C=w&&w.getMouseDownHandler(p,m,w);C&&C(p,this._currentTransform,g.x,g.y)}}this._handleEvent(p,"down"),(x||b)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(p){this._resetTransformEventData(),this._pointer=this.getPointer(p,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(p)||null},_beforeTransform:function(p){var m=this._currentTransform;this.stateful&&m.target.saveState(),this.fire("before:transform",{e:p,transform:m})},__onMouseMove:function(p){this._handleEvent(p,"move:before"),this._cacheTransformEventData(p);var m,g;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(p);return}if(!!this._isMainEvent(p)){var x=this._groupSelector;x?(g=this._absolutePointer,x.left=g.x-x.ex,x.top=g.y-x.ey,this.renderTop()):this._currentTransform?this._transformObject(p):(m=this.findTarget(p)||null,this._setCursorFromEvent(p,m),this._fireOverOutEvents(m,p)),this._handleEvent(p,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(p,m){var g=this._hoveredTarget,x=this._hoveredTargets,b=this.targets,y=Math.max(x.length,b.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:g,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<y;v++)this.fireSyntheticInOutEvents(b[v],m,{oldTarget:x[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=p,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(p,m){var g=this._draggedoverTarget,x=this._hoveredTargets,b=this.targets,y=Math.max(x.length,b.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:g,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<y;v++)this.fireSyntheticInOutEvents(b[v],m,{oldTarget:x[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=p},fireSyntheticInOutEvents:function(p,m,g){var x,b,y=g.oldTarget,v,w,C=y!==p,S=g.canvasEvtIn,k=g.canvasEvtOut;C&&(x={e:m,target:p,previousTarget:y},b={e:m,target:y,nextTarget:p}),w=p&&C,v=y&&C,v&&(k&&this.fire(k,b),y.fire(g.evtOut,b)),w&&(S&&this.fire(S,x),p.fire(g.evtIn,x))},__onMouseWheel:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"wheel"),this._resetTransformEventData()},_transformObject:function(p){var m=this.getPointer(p),g=this._currentTransform;g.reset=!1,g.shiftKey=p.shiftKey,g.altKey=p[this.centeredKey],this._performTransformAction(p,g,m),g.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(p,m,g){var x=g.x,b=g.y,y=m.action,v=!1,w=m.actionHandler;w&&(v=w(p,m,x,b)),y==="drag"&&v&&(m.target.isMoving=!0,this.setCursor(m.target.moveCursor||this.moveCursor)),m.actionPerformed=m.actionPerformed||v},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(p,m){if(!m)return this.setCursor(this.defaultCursor),!1;var g=m.hoverCursor||this.hoverCursor,x=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,b=(!x||!x.contains(m))&&m._findTargetCorner(this.getPointer(p,!0));b?this.setCursor(this.getCornerCursor(b,m,p)):(m.subTargetCheck&&this.targets.concat().reverse().map(function(y){g=y.hoverCursor||g}),this.setCursor(g))},getCornerCursor:function(p,m,g){var x=m.controls[p];return x.cursorStyleHandler(g,x,m)}})}(),function(){var o=Math.min,r=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,h){var c=this._activeObject;return c&&this._isSelectionKeyPressed(l)&&h&&h.selectable&&this.selection&&(c!==h||c.type==="activeSelection")&&!h.onSelect({e:l})},_handleGrouping:function(l,h){var c=this._activeObject;c.__corner||h===c&&(h=this.findTarget(l,!0),!h||!h.selectable)||(c&&c.type==="activeSelection"?this._updateActiveSelection(h,l):this._createActiveSelection(h,l))},_updateActiveSelection:function(l,h){var c=this._activeObject,f=c._objects.slice(0);c.contains(l)?(c.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),c.size()===1&&this._setActiveObject(c.item(0),h)):(c.addWithUpdate(l),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(f,h)},_createActiveSelection:function(l,h){var c=this.getActiveObjects(),f=this._createGroup(l);this._hoveredTarget=f,this._setActiveObject(f,h),this._fireSelectionEvents(c,h)},_createGroup:function(l){var h=this._objects,c=h.indexOf(this._activeObject)<h.indexOf(l),f=c?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(f,{canvas:this})},_groupSelectedObjects:function(l){var h=this._collectObjects(l),c;h.length===1?this.setActiveObject(h[0],l):h.length>1&&(c=new t.ActiveSelection(h.reverse(),{canvas:this}),this.setActiveObject(c,l))},_collectObjects:function(l){for(var h=[],c,f=this._groupSelector.ex,d=this._groupSelector.ey,p=f+this._groupSelector.left,m=d+this._groupSelector.top,g=new t.Point(o(f,p),o(d,m)),x=new t.Point(r(f,p),r(d,m)),b=!this.selectionFullyContained,y=f===p&&d===m,v=this._objects.length;v--&&(c=this._objects[v],!(!(!c||!c.selectable||!c.visible)&&(b&&c.intersectsWithRect(g,x,!0)||c.isContainedWithinRect(g,x,!0)||b&&c.containsPoint(g,null,!0)||b&&c.containsPoint(x,null,!0))&&(h.push(c),y))););return h.length>1&&(h=h.filter(function(w){return!w.onSelect({e:l})})),h},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(o){o||(o={});var r=o.format||"png",l=o.quality||1,h=(o.multiplier||1)*(o.enableRetinaScaling?this.getRetinaScaling():1),c=this.toCanvasElement(h,o);return t.util.toDataURL(c,r,l)},toCanvasElement:function(o,r){o=o||1,r=r||{};var l=(r.width||this.width)*o,h=(r.height||this.height)*o,c=this.getZoom(),f=this.width,d=this.height,p=c*o,m=this.viewportTransform,g=(m[4]-(r.left||0))*o,x=(m[5]-(r.top||0))*o,b=this.interactive,y=[p,0,0,p,g,x],v=this.enableRetinaScaling,w=t.util.createCanvasElement(),C=this.contextTop;return w.width=l,w.height=h,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=y,this.width=l,this.height=h,this.calcViewportBoundaries(),this.renderCanvas(w.getContext("2d"),this._objects),this.viewportTransform=m,this.width=f,this.height=d,this.calcViewportBoundaries(),this.interactive=b,this.enableRetinaScaling=v,this.contextTop=C,w}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(o,r,l){if(!!o){var h=typeof o=="string"?JSON.parse(o):t.util.object.clone(o),c=this,f=h.clipPath,d=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete h.clipPath,this._enlivenObjects(h.objects,function(p){c.clear(),c._setBgOverlay(h,function(){f?c._enlivenObjects([f],function(m){c.clipPath=m[0],c.__setupCanvas.call(c,h,p,d,r)}):c.__setupCanvas.call(c,h,p,d,r)})},l),this}},__setupCanvas:function(o,r,l,h){var c=this;r.forEach(function(f,d){c.insertAt(f,d)}),this.renderOnAddRemove=l,delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,this._setOptions(o),this.renderAll(),h&&h()},_setBgOverlay:function(o,r){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!o.backgroundImage&&!o.overlayImage&&!o.background&&!o.overlay){r&&r();return}var h=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&r&&r()};this.__setBgOverlay("backgroundImage",o.backgroundImage,l,h),this.__setBgOverlay("overlayImage",o.overlayImage,l,h),this.__setBgOverlay("backgroundColor",o.background,l,h),this.__setBgOverlay("overlayColor",o.overlay,l,h)},__setBgOverlay:function(o,r,l,h){var c=this;if(!r){l[o]=!0,h&&h();return}o==="backgroundImage"||o==="overlayImage"?t.util.enlivenObjects([r],function(f){c[o]=f[0],l[o]=!0,h&&h()}):this["set"+t.util.string.capitalize(o,!0)](r,function(){l[o]=!0,h&&h()})},_enlivenObjects:function(o,r,l){if(!o||o.length===0){r&&r([]);return}t.util.enlivenObjects(o,function(h){r&&r(h)},null,l)},_toDataURL:function(o,r){this.clone(function(l){r(l.toDataURL(o))})},_toDataURLWithMultiplier:function(o,r,l){this.clone(function(h){l(h.toDataURLWithMultiplier(o,r))})},clone:function(o,r){var l=JSON.stringify(this.toJSON(r));this.cloneWithoutData(function(h){h.loadFromJSON(l,function(){o&&o(h)})})},cloneWithoutData:function(o){var r=t.util.createCanvasElement();r.width=this.width,r.height=this.height;var l=new t.Canvas(r);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),o&&o(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):o&&o(l)}}),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.util.object.clone,c=r.util.toFixed,f=r.util.string.capitalize,d=r.util.degreesToRadians,p=!r.isLikelyNode,m=2;r.Object||(r.Object=r.util.createClass(r.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:p,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(g){g&&this.setOptions(g)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=r.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(g){var x=r.perfLimitSizeTotal,b=g.width,y=g.height,v=r.maxCacheSideLimit,w=r.minCacheSideLimit;if(b<=v&&y<=v&&b*y<=x)return b<w&&(g.width=w),y<w&&(g.height=w),g;var C=b/y,S=r.util.limitDimsByArea(C,x),k=r.util.capValue,T=k(w,S.x,v),N=k(w,S.y,v);return b>T&&(g.zoomX/=b/T,g.width=T,g.capped=!0),y>N&&(g.zoomY/=y/N,g.height=N,g.capped=!0),g},_getCacheCanvasDimensions:function(){var g=this.getTotalObjectScaling(),x=this._getTransformedDimensions(0,0),b=x.x*g.scaleX/this.scaleX,y=x.y*g.scaleY/this.scaleY;return{width:b+m,height:y+m,zoomX:g.scaleX,zoomY:g.scaleY,x:b,y}},_updateCacheCanvas:function(){var g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){var x=g._currentTransform.target,b=g._currentTransform.action;if(this===x&&b.slice&&b.slice(0,5)==="scale")return!1}var y=this._cacheCanvas,v=this._limitCacheSize(this._getCacheCanvasDimensions()),w=r.minCacheSideLimit,C=v.width,S=v.height,k,T,N=v.zoomX,R=v.zoomY,L=C!==this.cacheWidth||S!==this.cacheHeight,z=this.zoomX!==N||this.zoomY!==R,U=L||z,H=0,Y=0,Q=!1;if(L){var K=this._cacheCanvas.width,I=this._cacheCanvas.height,A=C>K||S>I,D=(C<K*.9||S<I*.9)&&K>w&&I>w;Q=A||D,A&&!v.capped&&(C>w||S>w)&&(H=C*.1,Y=S*.1)}return this instanceof r.Text&&this.path&&(U=!0,Q=!0,H+=this.getHeightOfLine(0)*this.zoomX,Y+=this.getHeightOfLine(0)*this.zoomY),U?(Q?(y.width=Math.ceil(C+H),y.height=Math.ceil(S+Y)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,y.width,y.height)),k=v.x/2,T=v.y/2,this.cacheTranslationX=Math.round(y.width/2-k)+k,this.cacheTranslationY=Math.round(y.height/2-T)+T,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(N,R),this.zoomX=N,this.zoomY=R,!0):!1},setOptions:function(g){this._setOptions(g),this._initGradient(g.fill,"fill"),this._initGradient(g.stroke,"stroke"),this._initPattern(g.fill,"fill"),this._initPattern(g.stroke,"stroke")},transform:function(g){var x=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,b=this.calcTransformMatrix(!x);g.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(g){var x=r.Object.NUM_FRACTION_DIGITS,b={type:this.type,version:r.version,originX:this.originX,originY:this.originY,left:c(this.left,x),top:c(this.top,x),width:c(this.width,x),height:c(this.height,x),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:c(this.strokeWidth,x),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:c(this.strokeMiterLimit,x),scaleX:c(this.scaleX,x),scaleY:c(this.scaleY,x),angle:c(this.angle,x),flipX:this.flipX,flipY:this.flipY,opacity:c(this.opacity,x),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:c(this.skewX,x),skewY:c(this.skewY,x)};return this.clipPath&&!this.clipPath.excludeFromExport&&(b.clipPath=this.clipPath.toObject(g),b.clipPath.inverted=this.clipPath.inverted,b.clipPath.absolutePositioned=this.clipPath.absolutePositioned),r.util.populateWithProperties(this,b,g),this.includeDefaultValues||(b=this._removeDefaultValues(b)),b},toDatalessObject:function(g){return this.toObject(g)},_removeDefaultValues:function(g){var x=r.util.getKlass(g.type).prototype,b=x.stateProperties;return b.forEach(function(y){y==="left"||y==="top"||(g[y]===x[y]&&delete g[y],Array.isArray(g[y])&&Array.isArray(x[y])&&g[y].length===0&&x[y].length===0&&delete g[y])}),g},toString:function(){return"#<fabric."+f(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var g=r.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(g.scaleX),scaleY:Math.abs(g.scaleY)}},getTotalObjectScaling:function(){var g=this.getObjectScaling(),x=g.scaleX,b=g.scaleY;if(this.canvas){var y=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();x*=y*v,b*=y*v}return{scaleX:x,scaleY:b}},getObjectOpacity:function(){var g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g},_set:function(g,x){var b=g==="scaleX"||g==="scaleY",y=this[g]!==x,v=!1;return b&&(x=this._constrainScale(x)),g==="scaleX"&&x<0?(this.flipX=!this.flipX,x*=-1):g==="scaleY"&&x<0?(this.flipY=!this.flipY,x*=-1):g==="shadow"&&x&&!(x instanceof r.Shadow)?x=new r.Shadow(x):g==="dirty"&&this.group&&this.group.set("dirty",x),this[g]=x,y&&(v=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(g)>-1?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&this.stateProperties.indexOf(g)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:r.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(g),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),g.restore())},renderCache:function(g){g=g||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(g,x){if(g.save(),x.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",x.absolutePositioned){var b=r.util.invertTransform(this.calcTransformMatrix());g.transform(b[0],b[1],b[2],b[3],b[4],b[5])}x.transform(g),g.scale(1/x.zoomX,1/x.zoomY),g.drawImage(x._cacheCanvas,-x.cacheTranslationX,-x.cacheTranslationY),g.restore()},drawObject:function(g,x){var b=this.fill,y=this.stroke;x?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=b,this.stroke=y},_drawClipPath:function(g,x){!x||(x.canvas=this.canvas,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,x))},drawCacheOnCanvas:function(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(g){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!g){var x=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-x/2,-b/2,x,b)}return!0}return!1},_renderBackground:function(g){if(!!this.backgroundColor){var x=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-x.x/2,-x.y/2,x.x,x.y),this._removeShadow(g)}},_setOpacity:function(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity},_setStrokeStyles:function(g,x){var b=x.stroke;b&&(g.lineWidth=x.strokeWidth,g.lineCap=x.strokeLineCap,g.lineDashOffset=x.strokeDashOffset,g.lineJoin=x.strokeLineJoin,g.miterLimit=x.strokeMiterLimit,b.toLive?b.gradientUnits==="percentage"||b.gradientTransform||b.patternTransform?this._applyPatternForTransformedGradient(g,b):(g.strokeStyle=b.toLive(g,this),this._applyPatternGradientTransform(g,b)):g.strokeStyle=x.stroke)},_setFillStyles:function(g,x){var b=x.fill;b&&(b.toLive?(g.fillStyle=b.toLive(g,this),this._applyPatternGradientTransform(g,x.fill)):g.fillStyle=b)},_setClippingProperties:function(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"},_setLineDash:function(g,x){!x||x.length===0||(1&x.length&&x.push.apply(x,x),g.setLineDash(x))},_renderControls:function(g,x){var b=this.getViewportTransform(),y=this.calcTransformMatrix(),v,w,C;x=x||{},w=typeof x.hasBorders!="undefined"?x.hasBorders:this.hasBorders,C=typeof x.hasControls!="undefined"?x.hasControls:this.hasControls,y=r.util.multiplyTransformMatrices(b,y),v=r.util.qrDecompose(y),g.save(),g.translate(v.translateX,v.translateY),g.lineWidth=1*this.borderScaleFactor,this.group||(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),g.rotate(d(this.group?v.angle:this.angle)),x.forActiveSelection||this.group?w&&this.drawBordersInGroup(g,v,x):w&&this.drawBorders(g,x),C&&this.drawControls(g,x),g.restore()},_setShadow:function(g){if(!!this.shadow){var x=this.shadow,b=this.canvas,y,v=b&&b.viewportTransform[0]||1,w=b&&b.viewportTransform[3]||1;x.nonScaling?y={scaleX:1,scaleY:1}:y=this.getObjectScaling(),b&&b._isRetinaScaling()&&(v*=r.devicePixelRatio,w*=r.devicePixelRatio),g.shadowColor=x.color,g.shadowBlur=x.blur*r.browserShadowBlurConstant*(v+w)*(y.scaleX+y.scaleY)/4,g.shadowOffsetX=x.offsetX*v*y.scaleX,g.shadowOffsetY=x.offsetY*w*y.scaleY}},_removeShadow:function(g){!this.shadow||(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)},_applyPatternGradientTransform:function(g,x){if(!x||!x.toLive)return{offsetX:0,offsetY:0};var b=x.gradientTransform||x.patternTransform,y=-this.width/2+x.offsetX||0,v=-this.height/2+x.offsetY||0;return x.gradientUnits==="percentage"?g.transform(this.width,0,0,this.height,y,v):g.transform(1,0,0,1,y,v),b&&g.transform(b[0],b[1],b[2],b[3],b[4],b[5]),{offsetX:y,offsetY:v}},_renderPaintInOrder:function(g){this.paintFirst==="stroke"?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))},_render:function(){},_renderFill:function(g){!this.fill||(g.save(),this._setFillStyles(g,this),this.fillRule==="evenodd"?g.fill("evenodd"):g.fill(),g.restore())},_renderStroke:function(g){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform&&this.group){var x=this.getObjectScaling();g.scale(1/x.scaleX,1/x.scaleY)}else this.strokeUniform&&g.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}},_applyPatternForTransformedGradient:function(g,x){var b=this._limitCacheSize(this._getCacheCanvasDimensions()),y=r.util.createCanvasElement(),v,w=this.canvas.getRetinaScaling(),C=b.x/this.scaleX/w,S=b.y/this.scaleY/w;y.width=C,y.height=S,v=y.getContext("2d"),v.beginPath(),v.moveTo(0,0),v.lineTo(C,0),v.lineTo(C,S),v.lineTo(0,S),v.closePath(),v.translate(C/2,S/2),v.scale(b.zoomX/this.scaleX/w,b.zoomY/this.scaleY/w),this._applyPatternGradientTransform(v,x),v.fillStyle=x.toLive(g),v.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(w*this.scaleX/b.zoomX,w*this.scaleY/b.zoomY),g.strokeStyle=v.createPattern(y,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var g=r.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",g.scaleX),this.set("scaleY",g.scaleY),this.angle=g.angle,this.skewX=g.skewX,this.skewY=0}},_removeTransformMatrix:function(g){var x=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),x=r.util.transformPoint(x,this.transformMatrix)),this.transformMatrix=null,g&&(this.scaleX*=g.scaleX,this.scaleY*=g.scaleY,this.cropX=g.cropX,this.cropY=g.cropY,x.x+=g.offsetLeft,x.y+=g.offsetTop,this.width=g.width,this.height=g.height),this.setPositionByOrigin(x,"center","center")},clone:function(g,x){var b=this.toObject(x);this.constructor.fromObject?this.constructor.fromObject(b,g):r.Object._fromObject("Object",b,g)},cloneAsImage:function(g,x){var b=this.toCanvasElement(x);return g&&g(new r.Image(b)),this},toCanvasElement:function(g){g||(g={});var x=r.util,b=x.saveObjectTransform(this),y=this.group,v=this.shadow,w=Math.abs,C=(g.multiplier||1)*(g.enableRetinaScaling?r.devicePixelRatio:1);delete this.group,g.withoutTransform&&x.resetObjectTransform(this),g.withoutShadow&&(this.shadow=null);var S=r.util.createCanvasElement(),k=this.getBoundingRect(!0,!0),T=this.shadow,N,R={x:0,y:0},L,z,U;T&&(L=T.blur,T.nonScaling?N={scaleX:1,scaleY:1}:N=this.getObjectScaling(),R.x=2*Math.round(w(T.offsetX)+L)*w(N.scaleX),R.y=2*Math.round(w(T.offsetY)+L)*w(N.scaleY)),z=k.width+R.x,U=k.height+R.y,S.width=Math.ceil(z),S.height=Math.ceil(U);var H=new r.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});g.format==="jpeg"&&(H.backgroundColor="#fff"),this.setPositionByOrigin(new r.Point(H.width/2,H.height/2),"center","center");var Y=this.canvas;H.add(this);var Q=H.toCanvasElement(C||1,g);return this.shadow=v,this.set("canvas",Y),y&&(this.group=y),this.set(b).setCoords(),H._objects=[],H.dispose(),H=null,Q},toDataURL:function(g){return g||(g={}),r.util.toDataURL(this.toCanvasElement(g),g.format||"png",g.quality||1)},isType:function(g){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===g},complexity:function(){return 1},toJSON:function(g){return this.toObject(g)},rotate:function(g){var x=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return x&&this._setOriginToCenter(),this.set("angle",g),x&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(g,x){x=x||this.canvas.getPointer(g);var b=new r.Point(x.x,x.y),y=this._getLeftTopCoords();return this.angle&&(b=r.util.rotatePoint(b,y,d(-this.angle))),{x:b.x-y.x,y:b.y-y.y}},_setupCompositeOperation:function(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){r.runningAnimations&&r.runningAnimations.cancelByTarget(this)}}),r.util.createAccessors&&r.util.createAccessors(r.Object),l(r.Object.prototype,r.Observable),r.Object.NUM_FRACTION_DIGITS=2,r.Object.ENLIVEN_PROPS=["clipPath"],r.Object._fromObject=function(g,x,b,y){var v=r[g];x=h(x,!0),r.util.enlivenPatterns([x.fill,x.stroke],function(w){typeof w[0]!="undefined"&&(x.fill=w[0]),typeof w[1]!="undefined"&&(x.stroke=w[1]),r.util.enlivenObjectEnlivables(x,x,function(){var C=y?new v(x[y],x):new v(x);b&&b(C)})})},r.Object.__uid=0)}(e),function(){var o=t.util.degreesToRadians,r={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(h,c,f,d,p){var m=h.x,g=h.y,x,b,y;return typeof c=="string"?c=r[c]:c-=.5,typeof d=="string"?d=r[d]:d-=.5,x=d-c,typeof f=="string"?f=l[f]:f-=.5,typeof p=="string"?p=l[p]:p-=.5,b=p-f,(x||b)&&(y=this._getTransformedDimensions(),m=h.x+x*y.x,g=h.y+b*y.y),new t.Point(m,g)},translateToCenterPoint:function(h,c,f){var d=this.translateToGivenOrigin(h,c,f,"center","center");return this.angle?t.util.rotatePoint(d,h,o(this.angle)):d},translateToOriginPoint:function(h,c,f){var d=this.translateToGivenOrigin(h,"center","center",c,f);return this.angle?t.util.rotatePoint(d,h,o(this.angle)):d},getCenterPoint:function(){var h=new t.Point(this.left,this.top);return this.translateToCenterPoint(h,this.originX,this.originY)},getPointByOrigin:function(h,c){var f=this.getCenterPoint();return this.translateToOriginPoint(f,h,c)},toLocalPoint:function(h,c,f){var d=this.getCenterPoint(),p,m;return typeof c!="undefined"&&typeof f!="undefined"?p=this.translateToGivenOrigin(d,"center","center",c,f):p=new t.Point(this.left,this.top),m=new t.Point(h.x,h.y),this.angle&&(m=t.util.rotatePoint(m,d,-o(this.angle))),m.subtractEquals(p)},setPositionByOrigin:function(h,c,f){var d=this.translateToCenterPoint(h,c,f),p=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",p.x),this.set("top",p.y)},adjustPosition:function(h){var c=o(this.angle),f=this.getScaledWidth(),d=t.util.cos(c)*f,p=t.util.sin(c)*f,m,g;typeof this.originX=="string"?m=r[this.originX]:m=this.originX-.5,typeof h=="string"?g=r[h]:g=h-.5,this.left+=d*(g-m),this.top+=p*(g-m),this.setCoords(),this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var h=this.getCenterPoint();this.originX="center",this.originY="center",this.left=h.x,this.top=h.y},_resetOrigin:function(){var h=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=h.x,this.top=h.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function o(f){return[new t.Point(f.tl.x,f.tl.y),new t.Point(f.tr.x,f.tr.y),new t.Point(f.br.x,f.br.y),new t.Point(f.bl.x,f.bl.y)]}var r=t.util,l=r.degreesToRadians,h=r.multiplyTransformMatrices,c=r.transformPoint;r.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(f,d){return d?f?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),f?this.aCoords:this.lineCoords)},getCoords:function(f,d){return o(this._getCoords(f,d))},intersectsWithRect:function(f,d,p,m){var g=this.getCoords(p,m),x=t.Intersection.intersectPolygonRectangle(g,f,d);return x.status==="Intersection"},intersectsWithObject:function(f,d,p){var m=t.Intersection.intersectPolygonPolygon(this.getCoords(d,p),f.getCoords(d,p));return m.status==="Intersection"||f.isContainedWithinObject(this,d,p)||this.isContainedWithinObject(f,d,p)},isContainedWithinObject:function(f,d,p){for(var m=this.getCoords(d,p),g=d?f.aCoords:f.lineCoords,x=0,b=f._getImageLines(g);x<4;x++)if(!f.containsPoint(m[x],b))return!1;return!0},isContainedWithinRect:function(f,d,p,m){var g=this.getBoundingRect(p,m);return g.left>=f.x&&g.left+g.width<=d.x&&g.top>=f.y&&g.top+g.height<=d.y},containsPoint:function(f,x,p,m){var g=this._getCoords(p,m),x=x||this._getImageLines(g),b=this._findCrossPoints(f,x);return b!==0&&b%2===1},isOnScreen:function(f){if(!this.canvas)return!1;var d=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br,m=this.getCoords(!0,f);return m.some(function(g){return g.x<=p.x&&g.x>=d.x&&g.y<=p.y&&g.y>=d.y})||this.intersectsWithRect(d,p,!0,f)?!0:this._containsCenterOfCanvas(d,p,f)},_containsCenterOfCanvas:function(f,d,p){var m={x:(f.x+d.x)/2,y:(f.y+d.y)/2};return!!this.containsPoint(m,null,!0,p)},isPartiallyOnScreen:function(f){if(!this.canvas)return!1;var d=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br;if(this.intersectsWithRect(d,p,!0,f))return!0;var m=this.getCoords(!0,f).every(function(g){return(g.x>=p.x||g.x<=d.x)&&(g.y>=p.y||g.y<=d.y)});return m&&this._containsCenterOfCanvas(d,p,f)},_getImageLines:function(f){var d={topline:{o:f.tl,d:f.tr},rightline:{o:f.tr,d:f.br},bottomline:{o:f.br,d:f.bl},leftline:{o:f.bl,d:f.tl}};return d},_findCrossPoints:function(f,d){var p,m,g,x,b,y=0,v;for(var w in d)if(v=d[w],!(v.o.y<f.y&&v.d.y<f.y)&&!(v.o.y>=f.y&&v.d.y>=f.y)&&(v.o.x===v.d.x&&v.o.x>=f.x?b=v.o.x:(p=0,m=(v.d.y-v.o.y)/(v.d.x-v.o.x),g=f.y-p*f.x,x=v.o.y-m*v.o.x,b=-(g-x)/(p-m)),b>=f.x&&(y+=1),y===2))break;return y},getBoundingRect:function(f,d){var p=this.getCoords(f,d);return r.makeBoundingBoxFromPoints(p)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(f){return Math.abs(f)<this.minScaleLimit?f<0?-this.minScaleLimit:this.minScaleLimit:f===0?1e-4:f},scale:function(f){return this._set("scaleX",f),this._set("scaleY",f),this.setCoords()},scaleToWidth:function(f,d){var p=this.getBoundingRect(d).width/this.getScaledWidth();return this.scale(f/this.width/p)},scaleToHeight:function(f,d){var p=this.getBoundingRect(d).height/this.getScaledHeight();return this.scale(f/this.height/p)},calcLineCoords:function(){var f=this.getViewportTransform(),d=this.padding,p=l(this.angle),m=r.cos(p),g=r.sin(p),x=m*d,b=g*d,y=x+b,v=x-b,w=this.calcACoords(),C={tl:c(w.tl,f),tr:c(w.tr,f),bl:c(w.bl,f),br:c(w.br,f)};return d&&(C.tl.x-=v,C.tl.y-=y,C.tr.x+=y,C.tr.y-=v,C.bl.x-=y,C.bl.y+=v,C.br.x+=v,C.br.y+=y),C},calcOCoords:function(){var f=this._calcRotateMatrix(),d=this._calcTranslateMatrix(),p=this.getViewportTransform(),m=h(p,d),g=h(m,f),g=h(g,[1/p[0],0,0,1/p[3],0,0]),x=this._calculateCurrentDimensions(),b={};return this.forEachControl(function(y,v,w){b[v]=y.positionHandler(x,g,w)}),b},calcACoords:function(){var f=this._calcRotateMatrix(),d=this._calcTranslateMatrix(),p=h(d,f),m=this._getTransformedDimensions(),g=m.x/2,x=m.y/2;return{tl:c({x:-g,y:-x},p),tr:c({x:g,y:-x},p),bl:c({x:-g,y:x},p),br:c({x:g,y:x},p)}},setCoords:function(f){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),f?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return r.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var f=this.getCenterPoint();return[1,0,0,1,f.x,f.y]},transformMatrixKey:function(f){var d="_",p="";return!f&&this.group&&(p=this.group.transformMatrixKey(f)+d),p+this.top+d+this.left+d+this.scaleX+d+this.scaleY+d+this.skewX+d+this.skewY+d+this.angle+d+this.originX+d+this.originY+d+this.width+d+this.height+d+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(f){var d=this.calcOwnMatrix();if(f||!this.group)return d;var p=this.transformMatrixKey(f),m=this.matrixCache||(this.matrixCache={});return m.key===p?m.value:(this.group&&(d=h(this.group.calcTransformMatrix(!1),d)),m.key=p,m.value=d,d)},calcOwnMatrix:function(){var f=this.transformMatrixKey(!0),d=this.ownMatrixCache||(this.ownMatrixCache={});if(d.key===f)return d.value;var p=this._calcTranslateMatrix(),m={angle:this.angle,translateX:p[4],translateY:p[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return d.key=f,d.value=r.composeMatrix(m),d.value},_getNonTransformedDimensions:function(){var f=this.strokeWidth,d=this.width+f,p=this.height+f;return{x:d,y:p}},_getTransformedDimensions:function(f,d){typeof f=="undefined"&&(f=this.skewX),typeof d=="undefined"&&(d=this.skewY);var p,m,g,x=f===0&&d===0;if(this.strokeUniform?(m=this.width,g=this.height):(p=this._getNonTransformedDimensions(),m=p.x,g=p.y),x)return this._finalizeDimensions(m*this.scaleX,g*this.scaleY);var b=r.sizeAfterTransform(m,g,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:f,skewY:d});return this._finalizeDimensions(b.x,b.y)},_finalizeDimensions:function(f,d){return this.strokeUniform?{x:f+this.strokeWidth,y:d+this.strokeWidth}:{x:f,y:d}},_calculateCurrentDimensions:function(){var f=this.getViewportTransform(),d=this._getTransformedDimensions(),p=c(d,f,!0);return p.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(o){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,o):this.canvas&&this.canvas.sendBackwards(this,o),this},bringForward:function(o){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,o):this.canvas&&this.canvas.bringForward(this,o),this},moveTo:function(o){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,o):this.canvas&&this.canvas.moveTo(this,o),this}}),function(){function o(l,h){if(h){if(h.toLive)return l+": url(#SVGID_"+h.id+"); ";var c=new t.Color(h),f=l+": "+c.toRgb()+"; ",d=c.getAlpha();return d!==1&&(f+=l+"-opacity: "+d.toString()+"; "),f}else return l+": none; "}var r=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var h=this.fillRule?this.fillRule:"nonzero",c=this.strokeWidth?this.strokeWidth:"0",f=this.strokeDashArray?this.strokeDashArray.join(" "):"none",d=this.strokeDashOffset?this.strokeDashOffset:"0",p=this.strokeLineCap?this.strokeLineCap:"butt",m=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",x=typeof this.opacity!="undefined"?this.opacity:"1",b=this.visible?"":" visibility: hidden;",y=l?"":this.getSvgFilter(),v=o("fill",this.fill),w=o("stroke",this.stroke);return[w,"stroke-width: ",c,"; ","stroke-dasharray: ",f,"; ","stroke-linecap: ",p,"; ","stroke-dashoffset: ",d,"; ","stroke-linejoin: ",m,"; ","stroke-miterlimit: ",g,"; ",v,"fill-rule: ",h,"; ","opacity: ",x,";",y,b].join("")},getSvgSpanStyles:function(l,h){var c="; ",d=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+c:"",f=l.strokeWidth?"stroke-width: "+l.strokeWidth+c:"",d=d,p=l.fontSize?"font-size: "+l.fontSize+"px"+c:"",m=l.fontStyle?"font-style: "+l.fontStyle+c:"",g=l.fontWeight?"font-weight: "+l.fontWeight+c:"",x=l.fill?o("fill",l.fill):"",b=l.stroke?o("stroke",l.stroke):"",y=this.getSvgTextDecoration(l),v=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return y&&(y="text-decoration: "+y+c),[b,f,d,p,m,g,y,x,v,h?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(h){return l[h.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,h){var c=l?this.calcTransformMatrix():this.calcOwnMatrix(),f='transform="'+t.util.matrixToSVG(c);return f+(h||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var h=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,h),'" y="',r(-this.height/2,h),'" width="',r(this.width,h),'" height="',r(this.height,h),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,h){h=h||{};var c=h.reviver,f=h.additionalTransform||"",d=[this.getSvgTransform(!0,f),this.getSvgCommons()].join(""),p=l.indexOf("COMMON_PARTS");return l[p]=d,c?c(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,h){h=h||{};var c=h.noStyle,f=h.reviver,d=c?"":'style="'+this.getSvgStyles()+'" ',p=h.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,g=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",x=m&&m.absolutePositioned,b=this.stroke,y=this.fill,v=this.shadow,w,C=[],S,k=l.indexOf("COMMON_PARTS"),T=h.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(f)+`</clipPath>
`),x&&C.push("<g ",p,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),x?"":p+this.getSvgCommons(),` >
`),w=[d,g,c?"":this.addPaintOrder()," ",T?'transform="'+T+'" ':""].join(""),l[k]=w,y&&y.toLive&&C.push(y.toSVG(this)),b&&b.toLive&&C.push(b.toSVG(this)),v&&C.push(v.toSVG(this)),m&&C.push(S),C.push(l.join("")),C.push(`</g>
`),x&&C.push(`</g>
`),f?f(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var o=t.util.object.extend,r="stateProperties";function l(c,f,d){var p={},m=!0;d.forEach(function(g){p[g]=c[g]}),o(c[f],p,m)}function h(c,f,d){if(c===f)return!0;if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(var p=0,m=c.length;p<m;p++)if(!h(c[p],f[p]))return!1;return!0}else if(c&&typeof c=="object"){var g=Object.keys(c),x;if(!f||typeof f!="object"||!d&&g.length!==Object.keys(f).length)return!1;for(var p=0,m=g.length;p<m;p++)if(x=g[p],!(x==="canvas"||x==="group")&&!h(c[x],f[x]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(c){c=c||r;var f="_"+c;return Object.keys(this[f]).length<this[c].length?!0:!h(this[f],this,!0)},saveState:function(c){var f=c&&c.propertySet||r,d="_"+f;return this[d]?(l(this,d,this[f]),c&&c.stateProperties&&l(this,d,c.stateProperties),this):this.setupState(c)},setupState:function(c){c=c||{};var f=c.propertySet||r;return c.propertySet=f,this["_"+f]={},this.saveState(c),this}})}(),function(){var o=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(r,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=r.x,c=r.y,f,d,p=Object.keys(this.oCoords),m=p.length-1,g;for(this.__corner=0;m>=0;m--)if(g=p[m],!!this.isControlVisible(g)&&(d=this._getImageLines(l?this.oCoords[g].touchCorner:this.oCoords[g].corner),f=this._findCrossPoints({x:h,y:c},d),f!==0&&f%2===1))return this.__corner=g,g;return!1},forEachControl:function(r){for(var l in this.controls)r(this.controls[l],l,this)},_setCornerCoords:function(){var r=this.oCoords;for(var l in r){var h=this.controls[l];r[l].corner=h.calcCornerCoords(this.angle,this.cornerSize,r[l].x,r[l].y,!1),r[l].touchCorner=h.calcCornerCoords(this.angle,this.touchCornerSize,r[l].x,r[l].y,!0)}},drawSelectionBackground:function(r){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;r.save();var l=this.getCenterPoint(),h=this._calculateCurrentDimensions(),c=this.canvas.viewportTransform;return r.translate(l.x,l.y),r.scale(1/c[0],1/c[3]),r.rotate(o(this.angle)),r.fillStyle=this.selectionBackgroundColor,r.fillRect(-h.x/2,-h.y/2,h.x,h.y),r.restore(),this},drawBorders:function(r,l){l=l||{};var h=this._calculateCurrentDimensions(),c=this.borderScaleFactor,f=h.x+c,d=h.y+c,p=typeof l.hasControls!="undefined"?l.hasControls:this.hasControls,m=!1;return r.save(),r.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(r,l.borderDashArray||this.borderDashArray),r.strokeRect(-f/2,-d/2,f,d),p&&(r.beginPath(),this.forEachControl(function(g,x,b){g.withConnection&&g.getVisibility(b,x)&&(m=!0,r.moveTo(g.x*f,g.y*d),r.lineTo(g.x*f+g.offsetX,g.y*d+g.offsetY))}),m&&r.stroke()),r.restore(),this},drawBordersInGroup:function(r,l,h){h=h||{};var c=t.util.sizeAfterTransform(this.width,this.height,l),f=this.strokeWidth,d=this.strokeUniform,p=this.borderScaleFactor,m=c.x+f*(d?this.canvas.getZoom():l.scaleX)+p,g=c.y+f*(d?this.canvas.getZoom():l.scaleY)+p;return r.save(),this._setLineDash(r,h.borderDashArray||this.borderDashArray),r.strokeStyle=h.borderColor||this.borderColor,r.strokeRect(-m/2,-g/2,m,g),r.restore(),this},drawControls:function(r,l){l=l||{},r.save();var h=this.canvas.getRetinaScaling(),c,f;return r.setTransform(h,0,0,h,0,0),r.strokeStyle=r.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(r.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(r,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(c=this.group.calcTransformMatrix()),this.forEachControl(function(d,p,m){f=m.oCoords[p],d.getVisibility(m,p)&&(c&&(f=t.util.transformPoint(f,c)),d.render(r,f.x,f.y,l,m))}),r.restore(),this},isControlVisible:function(r){return this.controls[r]&&this.controls[r].getVisibility(this,r)},setControlVisible:function(r,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[r]=l,this},setControlsVisibility:function(r){r||(r={});for(var l in r)this.setControlVisible(l,r[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(o,r){r=r||{};var l=function(){},h=r.onComplete||l,c=r.onChange||l,f=this;return t.util.animate({target:this,startValue:o.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(d){o.set("left",d),f.requestRenderAll(),c()},onComplete:function(){o.setCoords(),h()}})},fxCenterObjectV:function(o,r){r=r||{};var l=function(){},h=r.onComplete||l,c=r.onChange||l,f=this;return t.util.animate({target:this,startValue:o.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(d){o.set("top",d),f.requestRenderAll(),c()},onComplete:function(){o.setCoords(),h()}})},fxRemove:function(o,r){r=r||{};var l=function(){},h=r.onComplete||l,c=r.onChange||l,f=this;return t.util.animate({target:this,startValue:o.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(d){o.set("opacity",d),f.requestRenderAll(),c()},onComplete:function(){f.remove(o),h()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var o=[],r,l,h=[];for(r in arguments[0])o.push(r);for(var c=0,f=o.length;c<f;c++)r=o[c],l=c!==f-1,h.push(this._animate(r,arguments[0][r],arguments[1],l));return h}else return this._animate.apply(this,arguments)},_animate:function(o,r,l,h){var c=this,f;r=r.toString(),l?l=t.util.object.clone(l):l={},~o.indexOf(".")&&(f=o.split("."));var d=c.colorProperties.indexOf(o)>-1||f&&c.colorProperties.indexOf(f[1])>-1,p=f?this.get(f[0])[f[1]]:this.get(o);"from"in l||(l.from=p),d||(~r.indexOf("=")?r=p+parseFloat(r.replace("=","")):r=parseFloat(r));var m={target:this,startValue:l.from,endValue:r,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(g,x,b){return l.abort.call(c,g,x,b)},onChange:function(g,x,b){f?c[f[0]][f[1]]=g:c.set(o,g),!h&&l.onChange&&l.onChange(g,x,b)},onComplete:function(g,x,b){h||(c.setCoords(),l.onComplete&&l.onComplete(g,x,b))}};return d?t.util.animateColor(m.startValue,m.endValue,m.duration,m):t.util.animate(m)}}),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.util.object.clone,c={x1:1,x2:1,y1:1,y2:1};if(r.Line){r.warn("fabric.Line is already defined");return}r.Line=r.util.createClass(r.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:r.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(d,p){d||(d=[0,0,0,0]),this.callSuper("initialize",p),this.set("x1",d[0]),this.set("y1",d[1]),this.set("x2",d[2]),this.set("y2",d[3]),this._setWidthHeight(p)},_setWidthHeight:function(d){d||(d={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in d?d.left:this._getLeftToOriginX(),this.top="top"in d?d.top:this._getTopToOriginY()},_set:function(d,p){return this.callSuper("_set",d,p),typeof c[d]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:f({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:f({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(d){d.beginPath();var p=this.calcLinePoints();d.moveTo(p.x1,p.y1),d.lineTo(p.x2,p.y2),d.lineWidth=this.strokeWidth;var m=d.strokeStyle;d.strokeStyle=this.stroke||d.fillStyle,this.stroke&&this._renderStroke(d),d.strokeStyle=m},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(d){return l(this.callSuper("toObject",d),this.calcLinePoints())},_getNonTransformedDimensions:function(){var d=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(d.y-=this.strokeWidth),this.height===0&&(d.x-=this.strokeWidth)),d},calcLinePoints:function(){var d=this.x1<=this.x2?-1:1,p=this.y1<=this.y2?-1:1,m=d*this.width*.5,g=p*this.height*.5,x=d*this.width*-.5,b=p*this.height*-.5;return{x1:m,x2:x,y1:g,y2:b}},_toSVG:function(){var d=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`" />
`]}}),r.Line.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),r.Line.fromElement=function(d,p,m){m=m||{};var g=r.parseAttributes(d,r.Line.ATTRIBUTE_NAMES),x=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];p(new r.Line(x,l(g,m)))},r.Line.fromObject=function(d,p){function m(x){delete x.points,p&&p(x)}var g=h(d,!0);g.points=[d.x1,d.y1,d.x2,d.y2],r.Object._fromObject("Line",g,m,"points")};function f(d,p){var m=d.origin,g=d.axis1,x=d.axis2,b=d.dimension,y=p.nearest,v=p.center,w=p.farthest;return function(){switch(this.get(m)){case y:return Math.min(this.get(g),this.get(x));case v:return Math.min(this.get(g),this.get(x))+.5*this.get(b);case w:return Math.max(this.get(g),this.get(x))}}}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.degreesToRadians;if(r.Circle){r.warn("fabric.Circle is already defined.");return}r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:r.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(c,f){return this.callSuper("_set",c,f),c==="radius"&&this.setRadius(f),this},toObject:function(c){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(c))},_toSVG:function(){var c,f=0,d=0,p=(this.endAngle-this.startAngle)%360;if(p===0)c=["<circle ","COMMON_PARTS",'cx="'+f+'" cy="'+d+'" ','r="',this.radius,`" />
`];else{var m=l(this.startAngle),g=l(this.endAngle),x=this.radius,b=r.util.cos(m)*x,y=r.util.sin(m)*x,v=r.util.cos(g)*x,w=r.util.sin(g)*x,C=p>180?"1":"0";c=['<path d="M '+b+" "+y," A "+x+" "+x," 0 ",+C+" 1"," "+v+" "+w,'" ',"COMMON_PARTS",` />
`]}return c},_render:function(c){c.beginPath(),c.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(c)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(c){return this.radius=c,this.set("width",c*2).set("height",c*2)}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),r.Circle.fromElement=function(c,f){var d=r.parseAttributes(c,r.Circle.ATTRIBUTE_NAMES);if(!h(d))throw new Error("value of `r` attribute is required and can not be negative");d.left=(d.left||0)-d.radius,d.top=(d.top||0)-d.radius,f(new r.Circle(d))};function h(c){return"radius"in c&&c.radius>=0}r.Circle.fromObject=function(c,f){r.Object._fromObject("Circle",c,f)}}(e),function(o){var r=o.fabric||(o.fabric={});if(r.Triangle){r.warn("fabric.Triangle is already defined");return}r.Triangle=r.util.createClass(r.Object,{type:"triangle",width:100,height:100,_render:function(l){var h=this.width/2,c=this.height/2;l.beginPath(),l.moveTo(-h,c),l.lineTo(0,-c),l.lineTo(h,c),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,h=this.height/2,c=[-l+" "+h,"0 "+-h,l+" "+h].join(",");return["<polygon ","COMMON_PARTS",'points="',c,'" />']}}),r.Triangle.fromObject=function(l,h){return r.Object._fromObject("Triangle",l,h)}}(e),function(o){var r=o.fabric||(o.fabric={}),l=Math.PI*2;if(r.Ellipse){r.warn("fabric.Ellipse is already defined.");return}r.Ellipse=r.util.createClass(r.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this.set("rx",h&&h.rx||0),this.set("ry",h&&h.ry||0)},_set:function(h,c){switch(this.callSuper("_set",h,c),h){case"rx":this.rx=c,this.set("width",c*2);break;case"ry":this.ry=c,this.set("height",c*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(h){h.beginPath(),h.save(),h.transform(1,0,0,this.ry/this.rx,0,0),h.arc(0,0,this.rx,0,l,!1),h.restore(),this._renderPaintInOrder(h)}}),r.Ellipse.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),r.Ellipse.fromElement=function(h,c){var f=r.parseAttributes(h,r.Ellipse.ATTRIBUTE_NAMES);f.left=(f.left||0)-f.rx,f.top=(f.top||0)-f.ry,c(new r.Ellipse(f))},r.Ellipse.fromObject=function(h,c){r.Object._fromObject("Ellipse",h,c)}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend;if(r.Rect){r.warn("fabric.Rect is already defined");return}r.Rect=r.util.createClass(r.Object,{stateProperties:r.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(h){var c=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,p=this.height,m=-this.width/2,g=-this.height/2,x=c!==0||f!==0,b=1-.5522847498;h.beginPath(),h.moveTo(m+c,g),h.lineTo(m+d-c,g),x&&h.bezierCurveTo(m+d-b*c,g,m+d,g+b*f,m+d,g+f),h.lineTo(m+d,g+p-f),x&&h.bezierCurveTo(m+d,g+p-b*f,m+d-b*c,g+p,m+d-c,g+p),h.lineTo(m+c,g+p),x&&h.bezierCurveTo(m+b*c,g+p,m,g+p-b*f,m,g+p-f),h.lineTo(m,g+f),x&&h.bezierCurveTo(m,g+b*f,m+b*c,g,m+c,g),h.closePath(),this._renderPaintInOrder(h)},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){var h=-this.width/2,c=-this.height/2;return["<rect ","COMMON_PARTS",'x="',h,'" y="',c,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),r.Rect.fromElement=function(h,c,f){if(!h)return c(null);f=f||{};var d=r.parseAttributes(h,r.Rect.ATTRIBUTE_NAMES);d.left=d.left||0,d.top=d.top||0,d.height=d.height||0,d.width=d.width||0;var p=new r.Rect(l(f?r.util.object.clone(f):{},d));p.visible=p.visible&&p.width>0&&p.height>0,c(p)},r.Rect.fromObject=function(h,c){return r.Object._fromObject("Rect",h,c)}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.util.array.min,c=r.util.array.max,f=r.util.toFixed,d=r.util.projectStrokeOnPoints;if(r.Polyline){r.warn("fabric.Polyline is already defined");return}r.Polyline=r.util.createClass(r.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:r.Object.prototype.cacheProperties.concat("points"),initialize:function(p,m){m=m||{},this.points=p||[],this.callSuper("initialize",m),this._setPositionDimensions(m)},_projectStrokeOnPoints:function(){return d(this.points,this,!0)},_setPositionDimensions:function(p){var m=this._calcDimensions(p),g,x=this.exactBoundingBox?this.strokeWidth:0;this.width=m.width-x,this.height=m.height-x,p.fromSVG||(g=this.translateToGivenOrigin({x:m.left-this.strokeWidth/2+x/2,y:m.top-this.strokeWidth/2+x/2},"left","top",this.originX,this.originY)),typeof p.left=="undefined"&&(this.left=p.fromSVG?m.left:g.x),typeof p.top=="undefined"&&(this.top=p.fromSVG?m.top:g.y),this.pathOffset={x:m.left+this.width/2+x/2,y:m.top+this.height/2+x/2}},_calcDimensions:function(){var p=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,m=h(p,"x")||0,g=h(p,"y")||0,x=c(p,"x")||0,b=c(p,"y")||0,y=x-m,v=b-g;return{left:m,top:g,width:y,height:v}},toObject:function(p){return l(this.callSuper("toObject",p),{points:this.points.concat()})},_toSVG:function(){for(var p=[],m=this.pathOffset.x,g=this.pathOffset.y,x=r.Object.NUM_FRACTION_DIGITS,b=0,y=this.points.length;b<y;b++)p.push(f(this.points[b].x-m,x),",",f(this.points[b].y-g,x)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',p.join(""),`" />
`]},commonRender:function(p){var m,g=this.points.length,x=this.pathOffset.x,b=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;p.beginPath(),p.moveTo(this.points[0].x-x,this.points[0].y-b);for(var y=0;y<g;y++)m=this.points[y],p.lineTo(m.x-x,m.y-b);return!0},_render:function(p){!this.commonRender(p)||this._renderPaintInOrder(p)},complexity:function(){return this.get("points").length}}),r.Polyline.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polyline.fromElementGenerator=function(p){return function(m,g,x){if(!m)return g(null);x||(x={});var b=r.parsePointsAttribute(m.getAttribute("points")),y=r.parseAttributes(m,r[p].ATTRIBUTE_NAMES);y.fromSVG=!0,g(new r[p](b,l(y,x)))}},r.Polyline.fromElement=r.Polyline.fromElementGenerator("Polyline"),r.Polyline.fromObject=function(p,m){return r.Object._fromObject("Polyline",p,m,"points")}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.projectStrokeOnPoints;if(r.Polygon){r.warn("fabric.Polygon is already defined");return}r.Polygon=r.util.createClass(r.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(h){!this.commonRender(h)||(h.closePath(),this._renderPaintInOrder(h))}}),r.Polygon.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polygon.fromElement=r.Polyline.fromElementGenerator("Polygon"),r.Polygon.fromObject=function(h,c){r.Object._fromObject("Polygon",h,c,"points")}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.array.min,h=r.util.array.max,c=r.util.object.extend,f=r.util.object.clone,d=r.util.toFixed;if(r.Path){r.warn("fabric.Path is already defined");return}r.Path=r.util.createClass(r.Object,{type:"path",path:null,cacheProperties:r.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:r.Object.prototype.stateProperties.concat("path"),initialize:function(p,m){m=f(m||{}),delete m.path,this.callSuper("initialize",m),this._setPath(p||[],m)},_setPath:function(p,m){this.path=r.util.makePathSimpler(Array.isArray(p)?p:r.util.parsePath(p)),r.Polyline.prototype._setPositionDimensions.call(this,m||{})},_renderPathCommands:function(p){var m,g=0,x=0,b=0,y=0,v=0,w=0,C=-this.pathOffset.x,S=-this.pathOffset.y;p.beginPath();for(var k=0,T=this.path.length;k<T;++k)switch(m=this.path[k],m[0]){case"L":b=m[1],y=m[2],p.lineTo(b+C,y+S);break;case"M":b=m[1],y=m[2],g=b,x=y,p.moveTo(b+C,y+S);break;case"C":b=m[5],y=m[6],v=m[3],w=m[4],p.bezierCurveTo(m[1]+C,m[2]+S,v+C,w+S,b+C,y+S);break;case"Q":p.quadraticCurveTo(m[1]+C,m[2]+S,m[3]+C,m[4]+S),b=m[3],y=m[4],v=m[1],w=m[2];break;case"z":case"Z":b=g,y=x,p.closePath();break}},_render:function(p){this._renderPathCommands(p),this._renderPaintInOrder(p)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){return c(this.callSuper("toObject",p),{path:this.path.map(function(m){return m.slice()})})},toDatalessObject:function(p){var m=this.toObject(["sourcePath"].concat(p));return m.sourcePath&&delete m.path,m},_toSVG:function(){var p=r.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',p,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var p=r.Object.NUM_FRACTION_DIGITS;return" translate("+d(-this.pathOffset.x,p)+", "+d(-this.pathOffset.y,p)+")"},toClipPathSVG:function(p){var m=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},toSVG:function(p){var m=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var p=[],m=[],g,x=0,b=0,y=0,v=0,w,C=0,S=this.path.length;C<S;++C){switch(g=this.path[C],g[0]){case"L":y=g[1],v=g[2],w=[];break;case"M":y=g[1],v=g[2],x=y,b=v,w=[];break;case"C":w=r.util.getBoundsOfCurve(y,v,g[1],g[2],g[3],g[4],g[5],g[6]),y=g[5],v=g[6];break;case"Q":w=r.util.getBoundsOfCurve(y,v,g[1],g[2],g[1],g[2],g[3],g[4]),y=g[3],v=g[4];break;case"z":case"Z":y=x,v=b;break}w.forEach(function(U){p.push(U.x),m.push(U.y)}),p.push(y),m.push(v)}var k=l(p)||0,T=l(m)||0,N=h(p)||0,R=h(m)||0,L=N-k,z=R-T;return{left:k,top:T,width:L,height:z}}}),r.Path.fromObject=function(p,m){if(typeof p.sourcePath=="string"){var g=p.sourcePath;r.loadSVGFromURL(g,function(x){var b=x[0];b.setOptions(p),m&&m(b)})}else r.Object._fromObject("Path",p,m,"path")},r.Path.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["d"]),r.Path.fromElement=function(p,m,g){var x=r.parseAttributes(p,r.Path.ATTRIBUTE_NAMES);x.fromSVG=!0,m(new r.Path(x.d,c(x,g)))}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.array.min,h=r.util.array.max;r.Group||(r.Group=r.util.createClass(r.Object,r.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(c,f,d){f=f||{},this._objects=[],d&&this.callSuper("initialize",f),this._objects=c||[];for(var p=this._objects.length;p--;)this._objects[p].group=this;if(d)this._updateObjectsACoords();else{var m=f&&f.centerPoint;f.originX!==void 0&&(this.originX=f.originX),f.originY!==void 0&&(this.originY=f.originY),m||this._calcBounds(),this._updateObjectsCoords(m),delete f.centerPoint,this.callSuper("initialize",f)}this.setCoords()},_updateObjectsACoords:function(){for(var c=!0,f=this._objects.length;f--;)this._objects[f].setCoords(c)},_updateObjectsCoords:function(f){for(var f=f||this.getCenterPoint(),d=this._objects.length;d--;)this._updateObjectCoords(this._objects[d],f)},_updateObjectCoords:function(c,f){var d=c.left,p=c.top,m=!0;c.set({left:d-f.x,top:p-f.y}),c.group=this,c.setCoords(m)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(c){var f=!!this.group;return this._restoreObjectsState(),r.util.resetObjectTransform(this),c&&(f&&r.util.removeTransformFromObject(c,this.group.calcTransformMatrix()),this._objects.push(c),c.group=this,c._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,f?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(c){return this._restoreObjectsState(),r.util.resetObjectTransform(this),this.remove(c),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(c){this.dirty=!0,c.group=this,c._set("canvas",this.canvas)},_onObjectRemoved:function(c){this.dirty=!0,delete c.group},_set:function(c,f){var d=this._objects.length;if(this.useSetOnGroup)for(;d--;)this._objects[d].setOnGroup(c,f);if(c==="canvas")for(;d--;)this._objects[d]._set(c,f);r.Object.prototype._set.call(this,c,f)},toObject:function(c){var f=this.includeDefaultValues,d=this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){var g=m.includeDefaultValues;m.includeDefaultValues=f;var x=m.toObject(c);return m.includeDefaultValues=g,x}),p=r.Object.prototype.toObject.call(this,c);return p.objects=d,p},toDatalessObject:function(c){var f,d=this.sourcePath;if(d)f=d;else{var p=this.includeDefaultValues;f=this._objects.map(function(g){var x=g.includeDefaultValues;g.includeDefaultValues=p;var b=g.toDatalessObject(c);return g.includeDefaultValues=x,b})}var m=r.Object.prototype.toDatalessObject.call(this,c);return m.objects=f,m},render:function(c){this._transformDone=!0,this.callSuper("render",c),this._transformDone=!1},shouldCache:function(){var c=r.Object.prototype.shouldCache.call(this);if(c){for(var f=0,d=this._objects.length;f<d;f++)if(this._objects[f].willDrawShadow())return this.ownCaching=!1,!1}return c},willDrawShadow:function(){if(r.Object.prototype.willDrawShadow.call(this))return!0;for(var c=0,f=this._objects.length;c<f;c++)if(this._objects[c].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(c){for(var f=0,d=this._objects.length;f<d;f++)this._objects[f].render(c);this._drawClipPath(c,this.clipPath)},isCacheDirty:function(c){if(this.callSuper("isCacheDirty",c))return!0;if(!this.statefullCache)return!1;for(var f=0,d=this._objects.length;f<d;f++)if(this._objects[f].isCacheDirty(!0)){if(this._cacheCanvas){var p=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-m/2,p,m)}return!0}return!1},_restoreObjectsState:function(){var c=this.calcOwnMatrix();return this._objects.forEach(function(f){r.util.addTransformToObject(f,c),delete f.group,f.setCoords()}),this},destroy:function(){return this._objects.forEach(function(c){c.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(c){c.dispose&&c.dispose()}),this._objects=[]},toActiveSelection:function(){if(!!this.canvas){var c=this._objects,f=this.canvas;this._objects=[];var d=this.toObject();delete d.objects;var p=new r.ActiveSelection([]);return p.set(d),p.type="activeSelection",f.remove(this),c.forEach(function(m){m.group=p,m.dirty=!0,f.add(m)}),p.canvas=f,p._objects=c,f._activeObject=p,p.setCoords(),p}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var c=!0;return this.forEachObject(function(f){f.setCoords(c)}),this},_calcBounds:function(c){for(var f=[],d=[],p,m,g,x=["tr","br","bl","tl"],b=0,y=this._objects.length,v,w=x.length;b<y;++b){for(p=this._objects[b],g=p.calcACoords(),v=0;v<w;v++)m=x[v],f.push(g[m].x),d.push(g[m].y);p.aCoords=g}this._getBounds(f,d,c)},_getBounds:function(c,f,d){var p=new r.Point(l(c),l(f)),m=new r.Point(h(c),h(f)),g=p.y||0,x=p.x||0,b=m.x-p.x||0,y=m.y-p.y||0;this.width=b,this.height=y,d||this.setPositionByOrigin({x,y:g},"left","top")},_toSVG:function(c){for(var f=["<g ","COMMON_PARTS",` >
`],d=0,p=this._objects.length;d<p;d++)f.push("		",this._objects[d].toSVG(c));return f.push(`</g>
`),f},getSvgStyles:function(){var c=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",f=this.visible?"":" visibility: hidden;";return[c,this.getSvgFilter(),f].join("")},toClipPathSVG:function(c){for(var f=[],d=0,p=this._objects.length;d<p;d++)f.push("	",this._objects[d].toClipPathSVG(c));return this._createBaseClipPathSVGMarkup(f,{reviver:c})}}),r.Group.fromObject=function(c,f){var d=c.objects,p=r.util.object.clone(c,!0);if(delete p.objects,typeof d=="string"){r.loadSVGFromURL(d,function(m){var g=r.util.groupSVGElements(m,c,d);g.set(p),f&&f(g)});return}r.util.enlivenObjects(d,function(m){var g=r.util.object.clone(c,!0);delete g.objects,r.util.enlivenObjectEnlivables(c,g,function(){f&&f(new r.Group(m,g,!0))})})})}(e),function(o){var r=o.fabric||(o.fabric={});r.ActiveSelection||(r.ActiveSelection=r.util.createClass(r.Group,{type:"activeSelection",initialize:function(l,h){h=h||{},this._objects=l||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;h.originX&&(this.originX=h.originX),h.originY&&(this.originY=h.originY),this._calcBounds(),this._updateObjectsCoords(),r.Object.prototype.initialize.call(this,h),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var h=r.Object.prototype.toObject.call(this),c=new r.Group([]);if(delete h.type,c.set(h),l.forEach(function(d){d.canvas.remove(d),d.group=c}),c._objects=l,!this.canvas)return c;var f=this.canvas;return f.add(c),f._activeObject=c,c.setCoords(),c},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,h,c){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,h),c=c||{},typeof c.hasControls=="undefined"&&(c.hasControls=!1),c.forActiveSelection=!0;for(var f=0,d=this._objects.length;f<d;f++)this._objects[f]._renderControls(l,c);l.restore()}}),r.ActiveSelection.fromObject=function(l,h){r.util.enlivenObjects(l.objects,function(c){delete l.objects,h&&h(new r.ActiveSelection(c,l,!0))})})}(e),function(o){var r=t.util.object.extend;if(o.fabric||(o.fabric={}),o.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,h){h||(h={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",h),this._initElement(l,h)},getElement:function(){return this._element||{}},setElement:function(l,h){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(h),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var h=t.filterBackend;h&&h.evictCachesForKey&&h.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var h=this.width/2,c=this.height/2;l.beginPath(),l.moveTo(-h,-c),l.lineTo(h,-c),l.lineTo(h,c),l.lineTo(-h,c),l.lineTo(-h,-c),l.closePath()}},toObject:function(l){var h=[];this.filters.forEach(function(f){f&&h.push(f.toObject())});var c=r(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:h});return this.resizeFilter&&(c.resizeFilter=this.resizeFilter.toObject()),c},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],h=[],c,f=this._element,d=-this.width/2,p=-this.height/2,m="",g="";if(!f)return[];if(this.hasCrop()){var x=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+x+`">
`,'	<rect x="'+d+'" y="'+p+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),m=' clip-path="url(#imageCrop_'+x+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),h.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',d-this.cropX,'" y="',p-this.cropY,'" width="',f.width||f.naturalWidth,'" height="',f.height||f.height,g,'"',m,`></image>
`),this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null,c=["	<rect ",'x="',d,'" y="',p,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=b}return this.paintFirst!=="fill"?l=l.concat(c,h):l=l.concat(h,c),l},getSrc:function(l){var h=l?this._element:this._originalElement;return h?h.toDataURL?h.toDataURL():this.srcFromAttribute?h.getAttribute("src"):h.src:this.src||""},setSrc:function(l,h,c){return t.util.loadImage(l,function(f,d){this.setElement(f,c),this._setWidthHeight(),h&&h(this,d)},this,c&&c.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,h=this.minimumScaleTrigger,c=this.getTotalObjectScaling(),f=c.scaleX,d=c.scaleY,p=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||f>h&&d>h){this._element=p,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=f,this._lastScaleY=d;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var m=t.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,x=p.width,b=p.height;m.width=x,m.height=b,this._element=m,this._lastScaleX=l.scaleX=f,this._lastScaleY=l.scaleY=d,t.filterBackend.applyFilters([l],p,x,b,this._element,g),this._filterScalingX=m.width/this._originalElement.width,this._filterScalingY=m.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(p){return p&&!p.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var h=this._originalElement,c=h.naturalWidth||h.width,f=h.naturalHeight||h.height;if(this._element===this._originalElement){var d=t.util.createCanvasElement();d.width=c,d.height=f,this._element=d,this._filteredEl=d}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,c,f),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,c,f,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var h=this._element;if(!!h){var c=this._filterScalingX,f=this._filterScalingY,d=this.width,p=this.height,m=Math.min,g=Math.max,x=g(this.cropX,0),b=g(this.cropY,0),y=h.naturalWidth||h.width,v=h.naturalHeight||h.height,w=x*c,C=b*f,S=m(d*c,y-w),k=m(p*f,v-C),T=-d/2,N=-p/2,R=m(d,y/c-x),L=m(p,v/f-b);h&&l.drawImage(h,w,C,S,k,T,N,R,L)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,h){this.setElement(t.util.getById(l),h),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,h){l&&l.length?t.util.enlivenObjects(l,function(c){h&&h(c)},"fabric.Image.filters"):h&&h()},_setWidthHeight:function(l){l||(l={});var h=this.getElement();this.width=l.width||h.naturalWidth||h.width||0,this.height=l.height||h.naturalHeight||h.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),h=this._element.width,c=this._element.height,f=1,d=1,p=0,m=0,g=0,x=0,b,y=this.width,v=this.height,w={width:y,height:v};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(f=d=t.util.findScaleToFit(this._element,w),b=(y-h*f)/2,l.alignX==="Min"&&(p=-b),l.alignX==="Max"&&(p=b),b=(v-c*d)/2,l.alignY==="Min"&&(m=-b),l.alignY==="Max"&&(m=b)),l.meetOrSlice==="slice"&&(f=d=t.util.findScaleToCover(this._element,w),b=h-y/f,l.alignX==="Mid"&&(g=b/2),l.alignX==="Max"&&(g=b),b=c-v/d,l.alignY==="Mid"&&(x=b/2),l.alignY==="Max"&&(x=b),h=y/f,c=v/d)):(f=y/h,d=v/c),{width:h,height:c,scaleX:f,scaleY:d,offsetLeft:p,offsetTop:m,cropX:g,cropY:x}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,h){var c=t.util.object.clone(l);t.util.loadImage(c.src,function(f,d){if(d){h&&h(null,!0);return}t.Image.prototype._initFilters.call(c,c.filters,function(p){c.filters=p||[],t.Image.prototype._initFilters.call(c,[c.resizeFilter],function(m){c.resizeFilter=m[0],t.util.enlivenObjectEnlivables(c,c,function(){var g=new t.Image(f,c);h(g,!1)})})})},null,c.crossOrigin)},t.Image.fromURL=function(l,h,c){t.util.loadImage(l,function(f,d){h&&h(new t.Image(f,c),d)},null,c&&c.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,h,c){var f=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(f["xlink:href"],h,r(c?t.util.object.clone(c):{},f))}}(e),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var o=this.angle%360;return o>0?Math.round((o-1)/90)*90:Math.round(o/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(o){o=o||{};var r=function(){},l=o.onComplete||r,h=o.onChange||r,c=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){c.rotate(f),h()},onComplete:function(){c.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(o){return o.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(o){return o.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function o(l,h){var c="precision "+h+` float;
void main(){}`,f=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(f,c),l.compileShader(f),!!l.getShaderParameter(f,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var h=document.createElement("canvas"),c=h.getContext("webgl")||h.getContext("experimental-webgl"),f=!1;if(c){t.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),f=t.maxTextureSize>=l;for(var d=["highp","mediump","lowp"],p=0;p<3;p++)if(o(c,d[p])){t.webGlPrecision=d[p];break}}return this.isSupported=f,f},t.WebglFilterBackend=r;function r(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}r.prototype={tileSize:2048,resources:{},setupGLContext:function(l,h){this.dispose(),this.createWebGLCanvas(l,h),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,h)},chooseFastestCopyGLTo2DMethod:function(l,h){var c=typeof window.performance!="undefined",f;try{new ImageData(1,1),f=!0}catch{f=!1}var d=typeof ArrayBuffer!="undefined",p=typeof Uint8ClampedArray!="undefined";if(!!(c&&f&&d&&p)){var m=t.util.createCanvasElement(),g=new ArrayBuffer(l*h*4);if(t.forceGLPutImageData){this.imageBuffer=g,this.copyGLTo2D=u;return}var x={imageBuffer:g,destinationWidth:l,destinationHeight:h,targetCanvas:m},b,y,v;m.width=l,m.height=h,b=window.performance.now(),a.call(x,this.gl,x),y=window.performance.now()-b,b=window.performance.now(),u.call(x,this.gl,x),v=window.performance.now()-b,y>v?(this.imageBuffer=g,this.copyGLTo2D=u):this.copyGLTo2D=a}},createWebGLCanvas:function(l,h){var c=t.util.createCanvasElement();c.width=l,c.height=h;var f={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},d=c.getContext("webgl",f);d||(d=c.getContext("experimental-webgl",f)),d&&(d.clearColor(0,0,0,0),this.canvas=c,this.gl=d)},applyFilters:function(l,h,c,f,d,p){var m=this.gl,g;p&&(g=this.getCachedTexture(p,h));var x={originalWidth:h.width||h.originalWidth,originalHeight:h.height||h.originalHeight,sourceWidth:c,sourceHeight:f,destinationWidth:c,destinationHeight:f,context:m,sourceTexture:this.createTexture(m,c,f,!g&&h),targetTexture:this.createTexture(m,c,f),originalTexture:g||this.createTexture(m,c,f,!g&&h),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:d},b=m.createFramebuffer();return m.bindFramebuffer(m.FRAMEBUFFER,b),l.forEach(function(y){y&&y.applyTo(x)}),i(x),this.copyGLTo2D(m,x),m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(x.sourceTexture),m.deleteTexture(x.targetTexture),m.deleteFramebuffer(b),d.getContext("2d").setTransform(1,0,0,1,0,0),x},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,h,c,f){var d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),f?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,f):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,h,c,0,l.RGBA,l.UNSIGNED_BYTE,null),d},getCachedTexture:function(l,h){if(this.textureCache[l])return this.textureCache[l];var c=this.createTexture(this.gl,h.width,h.height,h);return this.textureCache[l]=c,c},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:a,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,h={renderer:"",vendor:""};if(!l)return h;var c=l.getExtension("WEBGL_debug_renderer_info");if(c){var f=l.getParameter(c.UNMASKED_RENDERER_WEBGL),d=l.getParameter(c.UNMASKED_VENDOR_WEBGL);f&&(h.renderer=f.toLowerCase()),d&&(h.vendor=d.toLowerCase())}return this.gpuInfo=h,h}}}();function i(o){var r=o.targetCanvas,l=r.width,h=r.height,c=o.destinationWidth,f=o.destinationHeight;(l!==c||h!==f)&&(r.width=c,r.height=f)}function a(o,r){var l=o.canvas,h=r.targetCanvas,c=h.getContext("2d");c.translate(0,h.height),c.scale(1,-1);var f=l.height-h.height;c.drawImage(l,0,f,h.width,h.height,0,0,h.width,h.height)}function u(o,r){var l=r.targetCanvas,h=l.getContext("2d"),c=r.destinationWidth,f=r.destinationHeight,d=c*f*4,p=new Uint8Array(this.imageBuffer,0,d),m=new Uint8ClampedArray(this.imageBuffer,0,d);o.readPixels(0,0,c,f,o.RGBA,o.UNSIGNED_BYTE,p);var g=new ImageData(m,c,f);h.putImageData(g,0,0)}(function(){var o=function(){};t.Canvas2dFilterBackend=r;function r(){}r.prototype={evictCachesForKey:o,dispose:o,clearWebGLCaches:o,resources:{},applyFilters:function(l,h,c,f,d){var p=d.getContext("2d");p.drawImage(h,0,0,c,f);var m=p.getImageData(0,0,c,f),g=p.getImageData(0,0,c,f),x={sourceWidth:c,sourceHeight:f,imageData:m,originalEl:h,originalImageData:g,canvasEl:d,ctx:p,filterBackend:this};return l.forEach(function(b){b.applyTo(x)}),(x.imageData.width!==c||x.imageData.height!==f)&&(d.width=x.imageData.width,d.height=x.imageData.height),p.putImageData(x.imageData,0,0),x}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(o){o&&this.setOptions(o)},setOptions:function(o){for(var r in o)this[r]=o[r]},createProgram:function(o,r,l){r=r||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(r=r.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var h=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(h,l),o.compileShader(h),!o.getShaderParameter(h,o.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+o.getShaderInfoLog(h));var c=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(c,r),o.compileShader(c),!o.getShaderParameter(c,o.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+o.getShaderInfoLog(c));var f=o.createProgram();if(o.attachShader(f,h),o.attachShader(f,c),o.linkProgram(f),!o.getProgramParameter(f,o.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+o.getProgramInfoLog(f));var d=this.getAttributeLocations(o,f),p=this.getUniformLocations(o,f)||{};return p.uStepW=o.getUniformLocation(f,"uStepW"),p.uStepH=o.getUniformLocation(f,"uStepH"),{program:f,attributeLocations:d,uniformLocations:p}},getAttributeLocations:function(o,r){return{aPosition:o.getAttribLocation(r,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(o,r,l){var h=r.aPosition,c=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,c),o.enableVertexAttribArray(h),o.vertexAttribPointer(h,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,l,o.STATIC_DRAW)},_setupFrameBuffer:function(o){var r=o.context,l,h;o.passes>1?(l=o.destinationWidth,h=o.destinationHeight,(o.sourceWidth!==l||o.sourceHeight!==h)&&(r.deleteTexture(o.targetTexture),o.targetTexture=o.filterBackend.createTexture(r,l,h)),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o.targetTexture,0)):(r.bindFramebuffer(r.FRAMEBUFFER,null),r.finish())},_swapTextures:function(o){o.passes--,o.pass++;var r=o.targetTexture;o.targetTexture=o.sourceTexture,o.sourceTexture=r},isNeutralState:function(){var o=this.mainParameter,r=t.Image.filters[this.type].prototype;if(o)if(Array.isArray(r[o])){for(var l=r[o].length;l--;)if(this[o][l]!==r[o][l])return!1;return!0}else return r[o]===this[o];else return!1},applyTo:function(o){o.webgl?(this._setupFrameBuffer(o),this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},retrieveShader:function(o){return o.programCache.hasOwnProperty(this.type)||(o.programCache[this.type]=this.createProgram(o.context)),o.programCache[this.type]},applyToWebGL:function(o){var r=o.context,l=this.retrieveShader(o);o.pass===0&&o.originalTexture?r.bindTexture(r.TEXTURE_2D,o.originalTexture):r.bindTexture(r.TEXTURE_2D,o.sourceTexture),r.useProgram(l.program),this.sendAttributeData(r,l.attributeLocations,o.aPosition),r.uniform1f(l.uniformLocations.uStepW,1/o.sourceWidth),r.uniform1f(l.uniformLocations.uStepH,1/o.sourceHeight),this.sendUniformData(r,l.uniformLocations),r.viewport(0,0,o.destinationWidth,o.destinationHeight),r.drawArrays(r.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(o,r,l){o.activeTexture(l),o.bindTexture(o.TEXTURE_2D,r),o.activeTexture(o.TEXTURE0)},unbindAdditionalTexture:function(o,r){o.activeTexture(r),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(o){this[this.mainParameter]=o},sendUniformData:function(){},createHelpLayer:function(o){if(!o.helpLayer){var r=document.createElement("canvas");r.width=o.sourceWidth,r.height=o.sourceHeight,o.helpLayer=r}},toObject:function(){var o={type:this.type},r=this.mainParameter;return r&&(o[r]=this[r]),o},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(o,r){var l=new t.Image.filters[o.type](o);return r&&r(l),l},function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.ColorMatrix=h(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(c){this.callSuper("initialize",c),this.matrix=this.matrix.slice(0)},applyTo2d:function(c){var f=c.imageData,d=f.data,p=d.length,m=this.matrix,g,x,b,y,v,w=this.colorsOnly;for(v=0;v<p;v+=4)g=d[v],x=d[v+1],b=d[v+2],w?(d[v]=g*m[0]+x*m[1]+b*m[2]+m[4]*255,d[v+1]=g*m[5]+x*m[6]+b*m[7]+m[9]*255,d[v+2]=g*m[10]+x*m[11]+b*m[12]+m[14]*255):(y=d[v+3],d[v]=g*m[0]+x*m[1]+b*m[2]+y*m[3]+m[4]*255,d[v+1]=g*m[5]+x*m[6]+b*m[7]+y*m[8]+m[9]*255,d[v+2]=g*m[10]+x*m[11]+b*m[12]+y*m[13]+m[14]*255,d[v+3]=g*m[15]+x*m[16]+b*m[17]+y*m[18]+m[19]*255)},getUniformLocations:function(c,f){return{uColorMatrix:c.getUniformLocation(f,"uColorMatrix"),uConstants:c.getUniformLocation(f,"uConstants")}},sendUniformData:function(c,f){var d=this.matrix,p=[d[0],d[1],d[2],d[3],d[5],d[6],d[7],d[8],d[10],d[11],d[12],d[13],d[15],d[16],d[17],d[18]],m=[d[4],d[9],d[14],d[19]];c.uniformMatrix4fv(f.uColorMatrix,!1,p),c.uniform4fv(f.uConstants,m)}}),r.Image.filters.ColorMatrix.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Brightness=h(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(c){if(this.brightness!==0){var f=c.imageData,d=f.data,p,m=d.length,g=Math.round(this.brightness*255);for(p=0;p<m;p+=4)d[p]=d[p]+g,d[p+1]=d[p+1]+g,d[p+2]=d[p+2]+g}},getUniformLocations:function(c,f){return{uBrightness:c.getUniformLocation(f,"uBrightness")}},sendUniformData:function(c,f){c.uniform1f(f.uBrightness,this.brightness)}}),r.Image.filters.Brightness.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.Image.filters,c=r.util.createClass;h.Convolute=c(h.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(f){var d=Math.sqrt(this.matrix.length),p=this.type+"_"+d+"_"+(this.opaque?1:0),m=this.fragmentSource[p];return f.programCache.hasOwnProperty(p)||(f.programCache[p]=this.createProgram(f.context,m)),f.programCache[p]},applyTo2d:function(f){var d=f.imageData,p=d.data,m=this.matrix,g=Math.round(Math.sqrt(m.length)),x=Math.floor(g/2),b=d.width,y=d.height,v=f.ctx.createImageData(b,y),w=v.data,C=this.opaque?1:0,S,k,T,N,R,L,z,U,H,Y,Q,K,I;for(Q=0;Q<y;Q++)for(Y=0;Y<b;Y++){for(R=(Q*b+Y)*4,S=0,k=0,T=0,N=0,I=0;I<g;I++)for(K=0;K<g;K++)z=Q+I-x,L=Y+K-x,!(z<0||z>=y||L<0||L>=b)&&(U=(z*b+L)*4,H=m[I*g+K],S+=p[U]*H,k+=p[U+1]*H,T+=p[U+2]*H,C||(N+=p[U+3]*H));w[R]=S,w[R+1]=k,w[R+2]=T,C?w[R+3]=p[R+3]:w[R+3]=N}f.imageData=v},getUniformLocations:function(f,d){return{uMatrix:f.getUniformLocation(d,"uMatrix"),uOpaque:f.getUniformLocation(d,"uOpaque"),uHalfSize:f.getUniformLocation(d,"uHalfSize"),uSize:f.getUniformLocation(d,"uSize")}},sendUniformData:function(f,d){f.uniform1fv(d.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),r.Image.filters.Convolute.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Grayscale=h(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(c){var f=c.imageData,d=f.data,p,m=d.length,g,x=this.mode;for(p=0;p<m;p+=4)x==="average"?g=(d[p]+d[p+1]+d[p+2])/3:x==="lightness"?g=(Math.min(d[p],d[p+1],d[p+2])+Math.max(d[p],d[p+1],d[p+2]))/2:x==="luminosity"&&(g=.21*d[p]+.72*d[p+1]+.07*d[p+2]),d[p]=g,d[p+1]=g,d[p+2]=g},retrieveShader:function(c){var f=this.type+"_"+this.mode;if(!c.programCache.hasOwnProperty(f)){var d=this.fragmentSource[this.mode];c.programCache[f]=this.createProgram(c.context,d)}return c.programCache[f]},getUniformLocations:function(c,f){return{uMode:c.getUniformLocation(f,"uMode")}},sendUniformData:function(c,f){var d=1;c.uniform1i(f.uMode,d)},isNeutralState:function(){return!1}}),r.Image.filters.Grayscale.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Invert=h(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(c){var f=c.imageData,d=f.data,p,m=d.length;for(p=0;p<m;p+=4)d[p]=255-d[p],d[p+1]=255-d[p+1],d[p+2]=255-d[p+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(c,f){return{uInvert:c.getUniformLocation(f,"uInvert")}},sendUniformData:function(c,f){c.uniform1i(f.uInvert,this.invert)}}),r.Image.filters.Invert.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.Image.filters,c=r.util.createClass;h.Noise=c(h.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(f){if(this.noise!==0){var d=f.imageData,p=d.data,m,g=p.length,x=this.noise,b;for(m=0,g=p.length;m<g;m+=4)b=(.5-Math.random())*x,p[m]+=b,p[m+1]+=b,p[m+2]+=b}},getUniformLocations:function(f,d){return{uNoise:f.getUniformLocation(d,"uNoise"),uSeed:f.getUniformLocation(d,"uSeed")}},sendUniformData:function(f,d){f.uniform1f(d.uNoise,this.noise/255),f.uniform1f(d.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),r.Image.filters.Noise.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Pixelate=h(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(c){var f=c.imageData,d=f.data,p=f.height,m=f.width,g,x,b,y,v,w,C,S,k,T,N;for(x=0;x<p;x+=this.blocksize)for(b=0;b<m;b+=this.blocksize)for(g=x*4*m+b*4,y=d[g],v=d[g+1],w=d[g+2],C=d[g+3],T=Math.min(x+this.blocksize,p),N=Math.min(b+this.blocksize,m),S=x;S<T;S++)for(k=b;k<N;k++)g=S*4*m+k*4,d[g]=y,d[g+1]=v,d[g+2]=w,d[g+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(c,f){return{uBlocksize:c.getUniformLocation(f,"uBlocksize"),uStepW:c.getUniformLocation(f,"uStepW"),uStepH:c.getUniformLocation(f,"uStepH")}},sendUniformData:function(c,f){c.uniform1f(f.uBlocksize,this.blocksize)}}),r.Image.filters.Pixelate.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.extend,h=r.Image.filters,c=r.util.createClass;h.RemoveColor=c(h.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(f){var d=f.imageData,p=d.data,m,g=this.distance*255,x,b,y,v=new r.Color(this.color).getSource(),w=[v[0]-g,v[1]-g,v[2]-g],C=[v[0]+g,v[1]+g,v[2]+g];for(m=0;m<p.length;m+=4)x=p[m],b=p[m+1],y=p[m+2],x>w[0]&&b>w[1]&&y>w[2]&&x<C[0]&&b<C[1]&&y<C[2]&&(p[m+3]=0)},getUniformLocations:function(f,d){return{uLow:f.getUniformLocation(d,"uLow"),uHigh:f.getUniformLocation(d,"uHigh")}},sendUniformData:function(f,d){var p=new r.Color(this.color).getSource(),m=parseFloat(this.distance),g=[0+p[0]/255-m,0+p[1]/255-m,0+p[2]/255-m,1],x=[p[0]/255+m,p[1]/255+m,p[2]/255+m,1];f.uniform4fv(d.uLow,g),f.uniform4fv(d.uHigh,x)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),r.Image.filters.RemoveColor.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass,c={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var f in c)l[f]=h(l.ColorMatrix,{type:f,matrix:c[f],mainParameter:!1,colorsOnly:!0}),r.Image.filters[f].fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric,l=r.Image.filters,h=r.util.createClass;l.BlendColor=h(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(c){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[c]+`}
}`},retrieveShader:function(c){var f=this.type+"_"+this.mode,d;return c.programCache.hasOwnProperty(f)||(d=this.buildSource(this.mode),c.programCache[f]=this.createProgram(c.context,d)),c.programCache[f]},applyTo2d:function(c){var f=c.imageData,d=f.data,p=d.length,m,g,x,b,y,v,w,C=1-this.alpha;w=new r.Color(this.color).getSource(),m=w[0]*this.alpha,g=w[1]*this.alpha,x=w[2]*this.alpha;for(var S=0;S<p;S+=4)switch(b=d[S],y=d[S+1],v=d[S+2],this.mode){case"multiply":d[S]=b*m/255,d[S+1]=y*g/255,d[S+2]=v*x/255;break;case"screen":d[S]=255-(255-b)*(255-m)/255,d[S+1]=255-(255-y)*(255-g)/255,d[S+2]=255-(255-v)*(255-x)/255;break;case"add":d[S]=b+m,d[S+1]=y+g,d[S+2]=v+x;break;case"diff":case"difference":d[S]=Math.abs(b-m),d[S+1]=Math.abs(y-g),d[S+2]=Math.abs(v-x);break;case"subtract":d[S]=b-m,d[S+1]=y-g,d[S+2]=v-x;break;case"darken":d[S]=Math.min(b,m),d[S+1]=Math.min(y,g),d[S+2]=Math.min(v,x);break;case"lighten":d[S]=Math.max(b,m),d[S+1]=Math.max(y,g),d[S+2]=Math.max(v,x);break;case"overlay":d[S]=m<128?2*b*m/255:255-2*(255-b)*(255-m)/255,d[S+1]=g<128?2*y*g/255:255-2*(255-y)*(255-g)/255,d[S+2]=x<128?2*v*x/255:255-2*(255-v)*(255-x)/255;break;case"exclusion":d[S]=m+b-2*m*b/255,d[S+1]=g+y-2*g*y/255,d[S+2]=x+v-2*x*v/255;break;case"tint":d[S]=m+b*C,d[S+1]=g+y*C,d[S+2]=x+v*C}},getUniformLocations:function(c,f){return{uColor:c.getUniformLocation(f,"uColor")}},sendUniformData:function(c,f){var d=new r.Color(this.color).getSource();d[0]=this.alpha*d[0]/255,d[1]=this.alpha*d[1]/255,d[2]=this.alpha*d[2]/255,d[3]=this.alpha,c.uniform4fv(f.uColor,d)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendColor.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric,l=r.Image.filters,h=r.util.createClass;l.BlendImage=h(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(c){var f=this.type+"_"+this.mode,d=this.fragmentSource[this.mode];return c.programCache.hasOwnProperty(f)||(c.programCache[f]=this.createProgram(c.context,d)),c.programCache[f]},applyToWebGL:function(c){var f=c.context,d=this.createTexture(c.filterBackend,this.image);this.bindAdditionalTexture(f,d,f.TEXTURE1),this.callSuper("applyToWebGL",c),this.unbindAdditionalTexture(f,f.TEXTURE1)},createTexture:function(c,f){return c.getCachedTexture(f.cacheKey,f._element)},calculateMatrix:function(){var c=this.image,f=c._element.width,d=c._element.height;return[1/c.scaleX,0,0,0,1/c.scaleY,0,-c.left/f,-c.top/d,1]},applyTo2d:function(c){var f=c.imageData,d=c.filterBackend.resources,p=f.data,m=p.length,g=f.width,x=f.height,b,y,v,w,C,S,k,T,N,R,L=this.image,z;d.blendImage||(d.blendImage=r.util.createCanvasElement()),N=d.blendImage,R=N.getContext("2d"),N.width!==g||N.height!==x?(N.width=g,N.height=x):R.clearRect(0,0,g,x),R.setTransform(L.scaleX,0,0,L.scaleY,L.left,L.top),R.drawImage(L._element,0,0,g,x),z=R.getImageData(0,0,g,x).data;for(var U=0;U<m;U+=4)switch(C=p[U],S=p[U+1],k=p[U+2],T=p[U+3],b=z[U],y=z[U+1],v=z[U+2],w=z[U+3],this.mode){case"multiply":p[U]=C*b/255,p[U+1]=S*y/255,p[U+2]=k*v/255,p[U+3]=T*w/255;break;case"mask":p[U+3]=w;break}},getUniformLocations:function(c,f){return{uTransformMatrix:c.getUniformLocation(f,"uTransformMatrix"),uImage:c.getUniformLocation(f,"uImage")}},sendUniformData:function(c,f){var d=this.calculateMatrix();c.uniform1i(f.uImage,1),c.uniformMatrix3fv(f.uTransformMatrix,!1,d)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendImage.fromObject=function(c,f){r.Image.fromObject(c.image,function(d){var p=r.util.object.clone(c);p.image=d,f(new r.Image.filters.BlendImage(p))})}}(e),function(o){var r=o.fabric||(o.fabric={}),l=Math.pow,h=Math.floor,c=Math.sqrt,f=Math.abs,d=Math.round,p=Math.sin,m=Math.ceil,g=r.Image.filters,x=r.util.createClass;g.Resize=x(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(b,y){return{uDelta:b.getUniformLocation(y,"uDelta"),uTaps:b.getUniformLocation(y,"uTaps")}},sendUniformData:function(b,y){b.uniform2fv(y.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),b.uniform1fv(y.uTaps,this.taps)},retrieveShader:function(b){var y=this.getFilterWindow(),v=this.type+"_"+y;if(!b.programCache.hasOwnProperty(v)){var w=this.generateShader(y);b.programCache[v]=this.createProgram(b.context,w)}return b.programCache[v]},getFilterWindow:function(){var b=this.tempScale;return Math.ceil(this.lanczosLobes/b)},getTaps:function(){for(var b=this.lanczosCreate(this.lanczosLobes),y=this.tempScale,v=this.getFilterWindow(),w=new Array(v),C=1;C<=v;C++)w[C-1]=b(C*y);return w},generateShader:function(w){for(var y=new Array(w),v=this.fragmentSourceTOP,w,C=1;C<=w;C++)y[C-1]=C+".0 * uDelta";return v+="uniform float uTaps["+w+`];
`,v+=`void main() {
`,v+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,v+=`  float sum = 1.0;
`,y.forEach(function(S,k){v+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+k+`];
`,v+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+k+`];
`,v+="  sum += 2.0 * uTaps["+k+`];
`}),v+=`  gl_FragColor = color / sum;
`,v+="}",v},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(b){b.webgl?(b.passes++,this.width=b.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=b.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),b.destinationWidth=this.dW,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceWidth=b.destinationWidth,this.height=b.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),b.destinationHeight=this.dH,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceHeight=b.destinationHeight):this.applyTo2d(b)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(b){return function(y){if(y>=b||y<=-b)return 0;if(y<11920929e-14&&y>-11920929e-14)return 1;y*=Math.PI;var v=y/b;return p(y)/y*p(v)/v}},applyTo2d:function(b){var y=b.imageData,v=this.scaleX,w=this.scaleY;this.rcpScaleX=1/v,this.rcpScaleY=1/w;var C=y.width,S=y.height,k=d(C*v),T=d(S*w),N;this.resizeType==="sliceHack"?N=this.sliceByTwo(b,C,S,k,T):this.resizeType==="hermite"?N=this.hermiteFastResize(b,C,S,k,T):this.resizeType==="bilinear"?N=this.bilinearFiltering(b,C,S,k,T):this.resizeType==="lanczos"&&(N=this.lanczosResize(b,C,S,k,T)),b.imageData=N},sliceByTwo:function(b,y,v,w,C){var S=b.imageData,k=.5,T=!1,N=!1,R=y*k,L=v*k,z=r.filterBackend.resources,U,H,Y=0,Q=0,K=y,I=0;for(z.sliceByTwo||(z.sliceByTwo=document.createElement("canvas")),U=z.sliceByTwo,(U.width<y*1.5||U.height<v)&&(U.width=y*1.5,U.height=v),H=U.getContext("2d"),H.clearRect(0,0,y*1.5,v),H.putImageData(S,0,0),w=h(w),C=h(C);!T||!N;)y=R,v=L,w<h(R*k)?R=h(R*k):(R=w,T=!0),C<h(L*k)?L=h(L*k):(L=C,N=!0),H.drawImage(U,Y,Q,y,v,K,I,R,L),Y=K,Q=I,I+=L;return H.getImageData(Y,Q,w,C)},lanczosResize:function(b,y,v,w,C){function S(D){var F,j,O,_,V,X,rt,st,ot,ht,mt;for(I.x=(D+.5)*L,A.x=h(I.x),F=0;F<C;F++){for(I.y=(F+.5)*z,A.y=h(I.y),V=0,X=0,rt=0,st=0,ot=0,j=A.x-Y;j<=A.x+Y;j++)if(!(j<0||j>=y)){ht=h(1e3*f(j-I.x)),K[ht]||(K[ht]={});for(var $=A.y-Q;$<=A.y+Q;$++)$<0||$>=v||(mt=h(1e3*f($-I.y)),K[ht][mt]||(K[ht][mt]=R(c(l(ht*U,2)+l(mt*H,2))/1e3)),O=K[ht][mt],O>0&&(_=($*y+j)*4,V+=O,X+=O*k[_],rt+=O*k[_+1],st+=O*k[_+2],ot+=O*k[_+3]))}_=(F*w+D)*4,N[_]=X/V,N[_+1]=rt/V,N[_+2]=st/V,N[_+3]=ot/V}return++D<w?S(D):T}var k=b.imageData.data,T=b.ctx.createImageData(w,C),N=T.data,R=this.lanczosCreate(this.lanczosLobes),L=this.rcpScaleX,z=this.rcpScaleY,U=2/this.rcpScaleX,H=2/this.rcpScaleY,Y=m(L*this.lanczosLobes/2),Q=m(z*this.lanczosLobes/2),K={},I={},A={};return S(0)},bilinearFiltering:function(b,y,v,w,C){var S,k,T,N,R,L,z,U,H,Y,Q,K,I=0,A,D=this.rcpScaleX,F=this.rcpScaleY,j=4*(y-1),O=b.imageData,_=O.data,V=b.ctx.createImageData(w,C),X=V.data;for(z=0;z<C;z++)for(U=0;U<w;U++)for(R=h(D*U),L=h(F*z),H=D*U-R,Y=F*z-L,A=4*(L*y+R),Q=0;Q<4;Q++)S=_[A+Q],k=_[A+4+Q],T=_[A+j+Q],N=_[A+j+4+Q],K=S*(1-H)*(1-Y)+k*H*(1-Y)+T*Y*(1-H)+N*H*Y,X[I++]=K;return V},hermiteFastResize:function(b,y,v,w,C){for(var S=this.rcpScaleX,k=this.rcpScaleY,T=m(S/2),N=m(k/2),R=b.imageData,L=R.data,z=b.ctx.createImageData(w,C),U=z.data,H=0;H<C;H++)for(var Y=0;Y<w;Y++){for(var Q=(Y+H*w)*4,K=0,I=0,A=0,D=0,F=0,j=0,O=0,_=(H+.5)*k,V=h(H*k);V<(H+1)*k;V++)for(var X=f(_-(V+.5))/N,rt=(Y+.5)*S,st=X*X,ot=h(Y*S);ot<(Y+1)*S;ot++){var ht=f(rt-(ot+.5))/T,mt=c(st+ht*ht);mt>1&&mt<-1||(K=2*mt*mt*mt-3*mt*mt+1,K>0&&(ht=4*(ot+V*y),O+=K*L[ht+3],A+=K,L[ht+3]<255&&(K=K*L[ht+3]/250),D+=K*L[ht],F+=K*L[ht+1],j+=K*L[ht+2],I+=K))}U[Q]=D/I,U[Q+1]=F/I,U[Q+2]=j/I,U[Q+3]=O/A}return z},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),r.Image.filters.Resize.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Contrast=h(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(c){if(this.contrast!==0){var f=c.imageData,d,m,p=f.data,m=p.length,g=Math.floor(this.contrast*255),x=259*(g+255)/(255*(259-g));for(d=0;d<m;d+=4)p[d]=x*(p[d]-128)+128,p[d+1]=x*(p[d+1]-128)+128,p[d+2]=x*(p[d+2]-128)+128}},getUniformLocations:function(c,f){return{uContrast:c.getUniformLocation(f,"uContrast")}},sendUniformData:function(c,f){c.uniform1f(f.uContrast,this.contrast)}}),r.Image.filters.Contrast.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Saturation=h(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(c){if(this.saturation!==0){var f=c.imageData,d=f.data,p=d.length,m=-this.saturation,g,x;for(g=0;g<p;g+=4)x=Math.max(d[g],d[g+1],d[g+2]),d[g]+=x!==d[g]?(x-d[g])*m:0,d[g+1]+=x!==d[g+1]?(x-d[g+1])*m:0,d[g+2]+=x!==d[g+2]?(x-d[g+2])*m:0}},getUniformLocations:function(c,f){return{uSaturation:c.getUniformLocation(f,"uSaturation")}},sendUniformData:function(c,f){c.uniform1f(f.uSaturation,-this.saturation)}}),r.Image.filters.Saturation.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Vibrance=h(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(c){if(this.vibrance!==0){var f=c.imageData,d=f.data,p=d.length,m=-this.vibrance,g,x,b,y;for(g=0;g<p;g+=4)x=Math.max(d[g],d[g+1],d[g+2]),b=(d[g]+d[g+1]+d[g+2])/3,y=Math.abs(x-b)*2/255*m,d[g]+=x!==d[g]?(x-d[g])*y:0,d[g+1]+=x!==d[g+1]?(x-d[g+1])*y:0,d[g+2]+=x!==d[g+2]?(x-d[g+2])*y:0}},getUniformLocations:function(c,f){return{uVibrance:c.getUniformLocation(f,"uVibrance")}},sendUniformData:function(c,f){c.uniform1f(f.uVibrance,-this.vibrance)}}),r.Image.filters.Vibrance.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Blur=h(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(c){c.webgl?(this.aspectRatio=c.sourceWidth/c.sourceHeight,c.passes++,this._setupFrameBuffer(c),this.horizontal=!0,this.applyToWebGL(c),this._swapTextures(c),this._setupFrameBuffer(c),this.horizontal=!1,this.applyToWebGL(c),this._swapTextures(c)):this.applyTo2d(c)},applyTo2d:function(c){c.imageData=this.simpleBlur(c)},simpleBlur:function(c){var f=c.filterBackend.resources,d,p,m=c.imageData.width,g=c.imageData.height;f.blurLayer1||(f.blurLayer1=r.util.createCanvasElement(),f.blurLayer2=r.util.createCanvasElement()),d=f.blurLayer1,p=f.blurLayer2,(d.width!==m||d.height!==g)&&(p.width=d.width=m,p.height=d.height=g);var x=d.getContext("2d"),b=p.getContext("2d"),y=15,v,w,C,S,k=this.blur*.06*.5;for(x.putImageData(c.imageData,0,0),b.clearRect(0,0,m,g),S=-y;S<=y;S++)v=(Math.random()-.5)/4,w=S/y,C=k*w*m+v,b.globalAlpha=1-Math.abs(w),b.drawImage(d,C,v),x.drawImage(p,0,0),b.globalAlpha=1,b.clearRect(0,0,p.width,p.height);for(S=-y;S<=y;S++)v=(Math.random()-.5)/4,w=S/y,C=k*w*g+v,b.globalAlpha=1-Math.abs(w),b.drawImage(d,v,C),x.drawImage(p,0,0),b.globalAlpha=1,b.clearRect(0,0,p.width,p.height);c.ctx.drawImage(d,0,0);var T=c.ctx.getImageData(0,0,d.width,d.height);return x.globalAlpha=1,x.clearRect(0,0,d.width,d.height),T},getUniformLocations:function(c,f){return{delta:c.getUniformLocation(f,"uDelta")}},sendUniformData:function(c,f){var d=this.chooseRightDelta();c.uniform2fv(f.delta,d)},chooseRightDelta:function(){var c=1,f=[0,0],d;return this.horizontal?this.aspectRatio>1&&(c=1/this.aspectRatio):this.aspectRatio<1&&(c=this.aspectRatio),d=c*this.blur*.12,this.horizontal?f[0]=d:f[1]=d,f}}),l.Blur.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Gamma=h(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(c){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,c)},applyTo2d:function(c){var f=c.imageData,d=f.data,p=this.gamma,m=d.length,g=1/p[0],x=1/p[1],b=1/p[2],y;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),y=0,m=256;y<m;y++)this.rVals[y]=Math.pow(y/255,g)*255,this.gVals[y]=Math.pow(y/255,x)*255,this.bVals[y]=Math.pow(y/255,b)*255;for(y=0,m=d.length;y<m;y+=4)d[y]=this.rVals[d[y]],d[y+1]=this.gVals[d[y+1]],d[y+2]=this.bVals[d[y+2]]},getUniformLocations:function(c,f){return{uGamma:c.getUniformLocation(f,"uGamma")}},sendUniformData:function(c,f){c.uniform3fv(f.uGamma,this.gamma)}}),r.Image.filters.Gamma.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.Composed=h(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(c){this.callSuper("initialize",c),this.subFilters=this.subFilters.slice(0)},applyTo:function(c){c.passes+=this.subFilters.length-1,this.subFilters.forEach(function(f){f.applyTo(c)})},toObject:function(){return r.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(c){return c.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(c){return!c.isNeutralState()})}}),r.Image.filters.Composed.fromObject=function(c,f){var d=c.subFilters||[],p=d.map(function(g){return new r.Image.filters[g.type](g)}),m=new r.Image.filters.Composed({subFilters:p});return f&&f(m),m}}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.Image.filters,h=r.util.createClass;l.HueRotation=h(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var c=this.rotation*Math.PI,f=r.util.cos(c),d=r.util.sin(c),p=1/3,m=Math.sqrt(p)*d,g=1-f;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=f+g/3,this.matrix[1]=p*g-m,this.matrix[2]=p*g+m,this.matrix[5]=p*g+m,this.matrix[6]=f+p*g,this.matrix[7]=p*g-m,this.matrix[10]=p*g-m,this.matrix[11]=p*g+m,this.matrix[12]=f+p*g},isNeutralState:function(c){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,c)},applyTo:function(c){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,c)}}),r.Image.filters.HueRotation.fromObject=r.Image.filters.BaseFilter.fromObject}(e),function(o){var r=o.fabric||(o.fabric={}),l=r.util.object.clone;if(r.Text){r.warn("fabric.Text is already defined");return}var h="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");r.Text=r.util.createClass(r.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:r.Object.prototype.stateProperties.concat(h),cacheProperties:r.Object.prototype.cacheProperties.concat(h),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(c,f){this.styles=f?f.styles||{}:{},this.text=c,this.__skipDimension=!0,this.callSuper("initialize",f),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var c=this.path;c&&(c.segmentsInfo=r.util.getPathSegmentsInfo(c.path))},getMeasuringContext:function(){return r._measuringContext||(r._measuringContext=this.canvas&&this.canvas.contextCache||r.util.createCanvasElement().getContext("2d")),r._measuringContext},_splitText:function(){var c=this._splitTextIntoLines(this.text);return this.textLines=c.lines,this._textLines=c.graphemeLines,this._unwrappedTextLines=c._unwrappedLines,this._text=c.graphemeText,c},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var c,f,d,p,m,g,x,b=0,y=this._textLines.length;b<y;b++)if(!(this.textAlign!=="justify"&&(b===y-1||this.isEndOfWrapping(b)))&&(p=0,m=this._textLines[b],f=this.getLineWidth(b),f<this.width&&(x=this.textLines[b].match(this._reSpacesAndTabs)))){d=x.length,c=(this.width-f)/d;for(var v=0,w=m.length;v<=w;v++)g=this.__charBounds[b][v],this._reSpaceAndTab.test(m[v])?(g.width+=c,g.kernedWidth+=c,g.left+=p,p+=c):g.left+=p}},isEndOfWrapping:function(c){return c===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var c=this.callSuper("_getCacheCanvasDimensions"),f=this.fontSize;return c.width+=f*c.zoomX,c.height+=f*c.zoomY,c},_render:function(c){var f=this.path;f&&!f.isNotVisible()&&f._render(c),this._setTextStyles(c),this._renderTextLinesBackground(c),this._renderTextDecoration(c,"underline"),this._renderText(c),this._renderTextDecoration(c,"overline"),this._renderTextDecoration(c,"linethrough")},_renderText:function(c){this.paintFirst==="stroke"?(this._renderTextStroke(c),this._renderTextFill(c)):(this._renderTextFill(c),this._renderTextStroke(c))},_setTextStyles:function(c,f,d){if(c.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":c.textBaseline="middle";break;case"ascender":c.textBaseline="top";break;case"descender":c.textBaseline="bottom";break}c.font=this._getFontDeclaration(f,d)},calcTextWidth:function(){for(var c=this.getLineWidth(0),f=1,d=this._textLines.length;f<d;f++){var p=this.getLineWidth(f);p>c&&(c=p)}return c},_renderTextLine:function(c,f,d,p,m,g){this._renderChars(c,f,d,p,m,g)},_renderTextLinesBackground:function(c){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var f,d,p=c.fillStyle,m,g,x=this._getLeftOffset(),b=this._getTopOffset(),y=0,v=0,w,C,S=this.path,k,T=0,N=this._textLines.length;T<N;T++){if(f=this.getHeightOfLine(T),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",T)){b+=f;continue}m=this._textLines[T],d=this._getLineLeftOffset(T),v=0,y=0,g=this.getValueOfPropertyAt(T,0,"textBackgroundColor");for(var R=0,L=m.length;R<L;R++)w=this.__charBounds[T][R],C=this.getValueOfPropertyAt(T,R,"textBackgroundColor"),S?(c.save(),c.translate(w.renderLeft,w.renderTop),c.rotate(w.angle),c.fillStyle=C,C&&c.fillRect(-w.width/2,-f/this.lineHeight*(1-this._fontSizeFraction),w.width,f/this.lineHeight),c.restore()):C!==g?(k=x+d+y,this.direction==="rtl"&&(k=this.width-k-v),c.fillStyle=g,g&&c.fillRect(k,b,v,f/this.lineHeight),y=w.left,v=w.width,g=C):v+=w.kernedWidth;C&&!S&&(k=x+d+y,this.direction==="rtl"&&(k=this.width-k-v),c.fillStyle=C,c.fillRect(k,b,v,f/this.lineHeight)),b+=f}c.fillStyle=p,this._removeShadow(c)}},getFontCache:function(c){var f=c.fontFamily.toLowerCase();r.charWidthsCache[f]||(r.charWidthsCache[f]={});var d=r.charWidthsCache[f],p=c.fontStyle.toLowerCase()+"_"+(c.fontWeight+"").toLowerCase();return d[p]||(d[p]={}),d[p]},_measureChar:function(c,f,d,p){var m=this.getFontCache(f),g=this._getFontDeclaration(f),x=this._getFontDeclaration(p),b=d+c,y=g===x,v,w,C,S=f.fontSize/this.CACHE_FONT_SIZE,k;if(d&&m[d]!==void 0&&(C=m[d]),m[c]!==void 0&&(k=v=m[c]),y&&m[b]!==void 0&&(w=m[b],k=w-C),v===void 0||C===void 0||w===void 0){var T=this.getMeasuringContext();this._setTextStyles(T,f,!0)}return v===void 0&&(k=v=T.measureText(c).width,m[c]=v),C===void 0&&y&&d&&(C=T.measureText(d).width,m[d]=C),y&&w===void 0&&(w=T.measureText(b).width,m[b]=w,k=w-C),{width:v*S,kernedWidth:k*S}},getHeightOfChar:function(c,f){return this.getValueOfPropertyAt(c,f,"fontSize")},measureLine:function(c){var f=this._measureLine(c);return this.charSpacing!==0&&(f.width-=this._getWidthOfCharSpacing()),f.width<0&&(f.width=0),f},_measureLine:function(c){var f=0,d,p,m=this._textLines[c],g,x,b=0,y=new Array(m.length),v=0,w,C,S=this.path,k=this.pathSide==="right";for(this.__charBounds[c]=y,d=0;d<m.length;d++)p=m[d],x=this._getGraphemeBox(p,c,d,g),y[d]=x,f+=x.kernedWidth,g=p;if(y[d]={left:x?x.left+x.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,w=r.util.getPointOnPath(S.path,0,S.segmentsInfo),w.x+=S.pathOffset.x,w.y+=S.pathOffset.y,this.textAlign){case"left":v=k?C-f:0;break;case"center":v=(C-f)/2;break;case"right":v=k?0:C-f;break}for(v+=this.pathStartOffset*(k?-1:1),d=k?m.length-1:0;k?d>=0:d<m.length;k?d--:d++)x=y[d],v>C?v%=C:v<0&&(v+=C),this._setGraphemeOnPath(v,x,w),v+=x.kernedWidth}return{width:f,numOfSpaces:b}},_setGraphemeOnPath:function(c,f,d){var p=c+f.kernedWidth/2,m=this.path,g=r.util.getPointOnPath(m.path,p,m.segmentsInfo);f.renderLeft=g.x-d.x,f.renderTop=g.y-d.y,f.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(c,f,d,p,m){var g=this.getCompleteStyleDeclaration(f,d),x=p?this.getCompleteStyleDeclaration(f,d-1):{},b=this._measureChar(c,g,p,x),y=b.kernedWidth,v=b.width,w;this.charSpacing!==0&&(w=this._getWidthOfCharSpacing(),v+=w,y+=w);var C={width:v,left:0,height:g.fontSize,kernedWidth:y,deltaY:g.deltaY};if(d>0&&!m){var S=this.__charBounds[f][d-1];C.left=S.left+S.width+b.kernedWidth-b.width}return C},getHeightOfLine:function(c){if(this.__lineHeights[c])return this.__lineHeights[c];for(var f=this._textLines[c],d=this.getHeightOfChar(c,0),p=1,m=f.length;p<m;p++)d=Math.max(this.getHeightOfChar(c,p),d);return this.__lineHeights[c]=d*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var c,f=0,d=0,p=this._textLines.length;d<p;d++)c=this.getHeightOfLine(d),f+=d===p-1?c/this.lineHeight:c;return f},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(c,f){c.save();for(var d=0,p=this._getLeftOffset(),m=this._getTopOffset(),g=0,x=this._textLines.length;g<x;g++){var b=this.getHeightOfLine(g),y=b/this.lineHeight,v=this._getLineLeftOffset(g);this._renderTextLine(f,c,this._textLines[g],p+v,m+d+y,g),d+=b}c.restore()},_renderTextFill:function(c){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(c,"fillText")},_renderTextStroke:function(c){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(c),c.save(),this._setLineDash(c,this.strokeDashArray),c.beginPath(),this._renderTextCommon(c,"strokeText"),c.closePath(),c.restore())},_renderChars:function(c,f,d,p,m,g){var x=this.getHeightOfLine(g),b=this.textAlign.indexOf("justify")!==-1,y,v,w="",C,S=0,k,T=this.path,N=!b&&this.charSpacing===0&&this.isEmptyStyles(g)&&!T,R=this.direction==="ltr",L=this.direction==="ltr"?1:-1,z,U=f.canvas.getAttribute("dir");if(f.save(),U!==this.direction&&(f.canvas.setAttribute("dir",R?"ltr":"rtl"),f.direction=R?"ltr":"rtl",f.textAlign=R?"left":"right"),m-=x*this._fontSizeFraction/this.lineHeight,N){this._renderChar(c,f,g,0,d.join(""),p,m,x),f.restore();return}for(var H=0,Y=d.length-1;H<=Y;H++)k=H===Y||this.charSpacing||T,w+=d[H],C=this.__charBounds[g][H],S===0?(p+=L*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,b&&!k&&this._reSpaceAndTab.test(d[H])&&(k=!0),k||(y=y||this.getCompleteStyleDeclaration(g,H),v=this.getCompleteStyleDeclaration(g,H+1),k=this._hasStyleChanged(y,v)),k&&(T?(f.save(),f.translate(C.renderLeft,C.renderTop),f.rotate(C.angle),this._renderChar(c,f,g,H,w,-S/2,0,x),f.restore()):(z=p,this._renderChar(c,f,g,H,w,z,m,x)),w="",y=v,p+=L*S,S=0);f.restore()},_applyPatternGradientTransformText:function(c){var f=r.util.createCanvasElement(),d,p=this.width+this.strokeWidth,m=this.height+this.strokeWidth;return f.width=p,f.height=m,d=f.getContext("2d"),d.beginPath(),d.moveTo(0,0),d.lineTo(p,0),d.lineTo(p,m),d.lineTo(0,m),d.closePath(),d.translate(p/2,m/2),d.fillStyle=c.toLive(d),this._applyPatternGradientTransform(d,c),d.fill(),d.createPattern(f,"no-repeat")},handleFiller:function(c,f,d){var p,m;return d.toLive?d.gradientUnits==="percentage"||d.gradientTransform||d.patternTransform?(p=-this.width/2,m=-this.height/2,c.translate(p,m),c[f]=this._applyPatternGradientTransformText(d),{offsetX:p,offsetY:m}):(c[f]=d.toLive(c,this),this._applyPatternGradientTransform(c,d)):(c[f]=d,{offsetX:0,offsetY:0})},_setStrokeStyles:function(c,f){return c.lineWidth=f.strokeWidth,c.lineCap=this.strokeLineCap,c.lineDashOffset=this.strokeDashOffset,c.lineJoin=this.strokeLineJoin,c.miterLimit=this.strokeMiterLimit,this.handleFiller(c,"strokeStyle",f.stroke)},_setFillStyles:function(c,f){return this.handleFiller(c,"fillStyle",f.fill)},_renderChar:function(c,f,d,p,m,g,x){var b=this._getStyleDeclaration(d,p),y=this.getCompleteStyleDeclaration(d,p),v=c==="fillText"&&y.fill,w=c==="strokeText"&&y.stroke&&y.strokeWidth,C,S;!w&&!v||(f.save(),v&&(C=this._setFillStyles(f,y)),w&&(S=this._setStrokeStyles(f,y)),f.font=this._getFontDeclaration(y),b&&b.textBackgroundColor&&this._removeShadow(f),b&&b.deltaY&&(x+=b.deltaY),v&&f.fillText(m,g-C.offsetX,x-C.offsetY),w&&f.strokeText(m,g-S.offsetX,x-S.offsetY),f.restore())},setSuperscript:function(c,f){return this._setScript(c,f,this.superscript)},setSubscript:function(c,f){return this._setScript(c,f,this.subscript)},_setScript:function(c,f,d){var p=this.get2DCursorLocation(c,!0),m=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"fontSize"),g=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"deltaY"),x={fontSize:m*d.size,deltaY:g+m*d.baseline};return this.setSelectionStyles(x,c,f),this},_hasStyleChanged:function(c,f){return c.fill!==f.fill||c.stroke!==f.stroke||c.strokeWidth!==f.strokeWidth||c.fontSize!==f.fontSize||c.fontFamily!==f.fontFamily||c.fontWeight!==f.fontWeight||c.fontStyle!==f.fontStyle||c.deltaY!==f.deltaY},_hasStyleChangedForSvg:function(c,f){return this._hasStyleChanged(c,f)||c.overline!==f.overline||c.underline!==f.underline||c.linethrough!==f.linethrough},_getLineLeftOffset:function(c){var f=this.getLineWidth(c),d=this.width-f,p=this.textAlign,m=this.direction,x,g=0,x=this.isEndOfWrapping(c);return p==="justify"||p==="justify-center"&&!x||p==="justify-right"&&!x||p==="justify-left"&&!x?0:(p==="center"&&(g=d/2),p==="right"&&(g=d),p==="justify-center"&&(g=d/2),p==="justify-right"&&(g=d),m==="rtl"&&(g-=d),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var c=this._forceClearCache;return c||(c=this.hasStateChanged("_dimensionAffectingProps")),c&&(this.dirty=!0,this._forceClearCache=!1),c},getLineWidth:function(c){if(this.__lineWidths[c]!==void 0)return this.__lineWidths[c];var f=this.measureLine(c),d=f.width;return this.__lineWidths[c]=d,d},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(c,f,d){var p=this._getStyleDeclaration(c,f);return p&&typeof p[d]!="undefined"?p[d]:this[d]},_renderTextDecoration:function(c,f){if(!(!this[f]&&!this.styleHas(f))){for(var d,p,m,g,x,b,y,v,w=this._getLeftOffset(),C=this._getTopOffset(),S,k,T,N,R,L,z,U,H=this.path,Y=this._getWidthOfCharSpacing(),Q=this.offsets[f],K=0,I=this._textLines.length;K<I;K++){if(d=this.getHeightOfLine(K),!this[f]&&!this.styleHas(f,K)){C+=d;continue}y=this._textLines[K],L=d/this.lineHeight,g=this._getLineLeftOffset(K),k=0,T=0,v=this.getValueOfPropertyAt(K,0,f),U=this.getValueOfPropertyAt(K,0,"fill"),S=C+L*(1-this._fontSizeFraction),p=this.getHeightOfChar(K,0),x=this.getValueOfPropertyAt(K,0,"deltaY");for(var A=0,D=y.length;A<D;A++)if(N=this.__charBounds[K][A],R=this.getValueOfPropertyAt(K,A,f),z=this.getValueOfPropertyAt(K,A,"fill"),m=this.getHeightOfChar(K,A),b=this.getValueOfPropertyAt(K,A,"deltaY"),H&&R&&z)c.save(),c.fillStyle=U,c.translate(N.renderLeft,N.renderTop),c.rotate(N.angle),c.fillRect(-N.kernedWidth/2,Q*m+b,N.kernedWidth,this.fontSize/15),c.restore();else if((R!==v||z!==U||m!==p||b!==x)&&T>0){var F=w+g+k;this.direction==="rtl"&&(F=this.width-F-T),v&&U&&(c.fillStyle=U,c.fillRect(F,S+Q*p+x,T,this.fontSize/15)),k=N.left,T=N.width,v=R,U=z,p=m,x=b}else T+=N.kernedWidth;var F=w+g+k;this.direction==="rtl"&&(F=this.width-F-T),c.fillStyle=z,R&&z&&c.fillRect(F,S+Q*p+x,T-Y,this.fontSize/15),C+=d}this._removeShadow(c)}},_getFontDeclaration:function(c,f){var d=c||this,p=this.fontFamily,m=r.Text.genericFonts.indexOf(p.toLowerCase())>-1,g=p===void 0||p.indexOf("'")>-1||p.indexOf(",")>-1||p.indexOf('"')>-1||m?d.fontFamily:'"'+d.fontFamily+'"';return[r.isLikelyNode?d.fontWeight:d.fontStyle,r.isLikelyNode?d.fontStyle:d.fontWeight,f?this.CACHE_FONT_SIZE+"px":d.fontSize+"px",g].join(" ")},render:function(c){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",c))},_splitTextIntoLines:function(c){for(var f=c.split(this._reNewline),d=new Array(f.length),p=[`
`],m=[],g=0;g<f.length;g++)d[g]=r.util.string.graphemeSplit(f[g]),m=m.concat(d[g],p);return m.pop(),{_unwrappedLines:d,lines:f,graphemeText:m,graphemeLines:d}},toObject:function(c){var f=h.concat(c),d=this.callSuper("toObject",f);return d.styles=l(this.styles,!0),d.path&&(d.path=this.path.toObject()),d},set:function(c,f){this.callSuper("set",c,f);var d=!1,p=!1;if(typeof c=="object")for(var m in c)m==="path"&&this.setPathInfo(),d=d||this._dimensionAffectingProps.indexOf(m)!==-1,p=p||m==="path";else d=this._dimensionAffectingProps.indexOf(c)!==-1,p=c==="path";return p&&this.setPathInfo(),d&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),r.Text.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),r.Text.DEFAULT_SVG_FONT_SIZE=16,r.Text.fromElement=function(c,f,d){if(!c)return f(null);var p=r.parseAttributes(c,r.Text.ATTRIBUTE_NAMES),m=p.textAnchor||"left";if(d=r.util.object.extend(d?l(d):{},p),d.top=d.top||0,d.left=d.left||0,p.textDecoration){var g=p.textDecoration;g.indexOf("underline")!==-1&&(d.underline=!0),g.indexOf("overline")!==-1&&(d.overline=!0),g.indexOf("line-through")!==-1&&(d.linethrough=!0),delete d.textDecoration}"dx"in p&&(d.left+=p.dx),"dy"in p&&(d.top+=p.dy),"fontSize"in d||(d.fontSize=r.Text.DEFAULT_SVG_FONT_SIZE);var x="";"textContent"in c?x=c.textContent:"firstChild"in c&&c.firstChild!==null&&"data"in c.firstChild&&c.firstChild.data!==null&&(x=c.firstChild.data),x=x.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var b=d.strokeWidth;d.strokeWidth=0;var y=new r.Text(x,d),v=y.getScaledHeight()/y.height,w=(y.height+y.strokeWidth)*y.lineHeight-y.height,C=w*v,S=y.getScaledHeight()+C,k=0;m==="center"&&(k=y.getScaledWidth()/2),m==="right"&&(k=y.getScaledWidth()),y.set({left:y.left-k,top:y.top-(S-y.fontSize*(.07+y._fontSizeFraction))/y.lineHeight,strokeWidth:typeof b!="undefined"?b:1}),f(y)},r.Text.fromObject=function(c,f){var d=l(c),p=c.path;return delete d.path,r.Object._fromObject("Text",d,function(m){p?r.Object._fromObject("Path",p,function(g){m.set("path",g),f(m)},"path"):f(m)},"text")},r.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],r.util.createAccessors&&r.util.createAccessors(r.Text)}(e),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(o){if(!this.styles||typeof o!="undefined"&&!this.styles[o])return!0;var r=typeof o=="undefined"?this.styles:{line:this.styles[o]};for(var l in r)for(var h in r[l])for(var c in r[l][h])return!1;return!0},styleHas:function(o,r){if(!this.styles||!o||o===""||typeof r!="undefined"&&!this.styles[r])return!1;var l=typeof r=="undefined"?this.styles:{0:this.styles[r]};for(var h in l)for(var c in l[h])if(typeof l[h][c][o]!="undefined")return!0;return!1},cleanStyle:function(o){if(!this.styles||!o||o==="")return!1;var r=this.styles,l=0,h,c,f=!0,d=0,p;for(var m in r){h=0;for(var g in r[m]){var p=r[m][g],x=p.hasOwnProperty(o);l++,x?(c?p[o]!==c&&(f=!1):c=p[o],p[o]===this[o]&&delete p[o]):f=!1,Object.keys(p).length!==0?h++:delete r[m][g]}h===0&&delete r[m]}for(var b=0;b<this._textLines.length;b++)d+=this._textLines[b].length;f&&l===d&&(this[o]=c,this.removeStyle(o))},removeStyle:function(o){if(!(!this.styles||!o||o==="")){var r=this.styles,l,h,c;for(h in r){l=r[h];for(c in l)delete l[c][o],Object.keys(l[c]).length===0&&delete l[c];Object.keys(l).length===0&&delete r[h]}}},_extendStyles:function(o,r){var l=this.get2DCursorLocation(o);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),r)},get2DCursorLocation:function(o,r){typeof o=="undefined"&&(o=this.selectionStart);for(var l=r?this._unwrappedTextLines:this._textLines,h=l.length,c=0;c<h;c++){if(o<=l[c].length)return{lineIndex:c,charIndex:o};o-=l[c].length+this.missingNewlineOffset(c)}return{lineIndex:c-1,charIndex:l[c-1].length<o?l[c-1].length:o}},getSelectionStyles:function(o,r,l){typeof o=="undefined"&&(o=this.selectionStart||0),typeof r=="undefined"&&(r=this.selectionEnd||o);for(var h=[],c=o;c<r;c++)h.push(this.getStyleAtPosition(c,l));return h},getStyleAtPosition:function(o,r){var l=this.get2DCursorLocation(o),h=r?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return h||{}},setSelectionStyles:function(o,r,l){typeof r=="undefined"&&(r=this.selectionStart||0),typeof l=="undefined"&&(l=this.selectionEnd||r);for(var h=r;h<l;h++)this._extendStyles(h,o);return this._forceClearCache=!0,this},_getStyleDeclaration:function(o,r){var l=this.styles&&this.styles[o];return l?l[r]:null},getCompleteStyleDeclaration:function(o,r){for(var l=this._getStyleDeclaration(o,r)||{},h={},c,f=0;f<this._styleProperties.length;f++)c=this._styleProperties[f],h[c]=typeof l[c]=="undefined"?this[c]:l[c];return h},_setStyleDeclaration:function(o,r,l){this.styles[o][r]=l},_deleteStyleDeclaration:function(o,r){delete this.styles[o][r]},_getLineStyle:function(o){return!!this.styles[o]},_setLineStyle:function(o){this.styles[o]={}},_deleteLineStyle:function(o){delete this.styles[o]}})}(),function(){function o(r){r.textDecoration&&(r.textDecoration.indexOf("underline")>-1&&(r.underline=!0),r.textDecoration.indexOf("line-through")>-1&&(r.linethrough=!0),r.textDecoration.indexOf("overline")>-1&&(r.overline=!0),delete r.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(r,l){this.callSuper("initialize",r,l),this.initBehavior()},setSelectionStart:function(r){r=Math.max(r,0),this._updateAndFire("selectionStart",r)},setSelectionEnd:function(r){r=Math.min(r,this.text.length),this._updateAndFire("selectionEnd",r)},_updateAndFire:function(r,l){this[r]!==l&&(this._fireSelectionChanged(),this[r]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(r){this.clearContextTop(),this.callSuper("render",r),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(r){this.callSuper("_render",r)},clearContextTop:function(r){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,h=this.canvas.viewportTransform;l.save(),l.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this.transform(l),this._clearTextArea(l),r||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var r=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(r,l):this.renderSelection(r,l),l.restore()}},_clearTextArea:function(r){var l=this.width+4,h=this.height+4;r.clearRect(-l/2,-h/2,l,h)},_getCursorBoundaries:function(r){typeof r=="undefined"&&(r=this.selectionStart);var l=this._getLeftOffset(),h=this._getTopOffset(),c=this._getCursorBoundariesOffsets(r);return{left:l,top:h,leftOffset:c.left,topOffset:c.top}},_getCursorBoundariesOffsets:function(r){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,h,c,f=0,d=0,p,m=this.get2DCursorLocation(r);c=m.charIndex,h=m.lineIndex;for(var g=0;g<h;g++)f+=this.getHeightOfLine(g);l=this._getLineLeftOffset(h);var x=this.__charBounds[h][c];return x&&(d=x.left),this.charSpacing!==0&&c===this._textLines[h].length&&(d-=this._getWidthOfCharSpacing()),p={top:f,left:l+(d>0?d:0)},this.direction==="rtl"&&(p.left*=-1),this.cursorOffsetCache=p,this.cursorOffsetCache},renderCursor:function(r,l){var h=this.get2DCursorLocation(),c=h.lineIndex,f=h.charIndex>0?h.charIndex-1:0,d=this.getValueOfPropertyAt(c,f,"fontSize"),p=this.scaleX*this.canvas.getZoom(),m=this.cursorWidth/p,g=r.topOffset,x=this.getValueOfPropertyAt(c,f,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(c)/this.lineHeight-d*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(r,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(c,f,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(r.left+r.leftOffset-m/2,g+r.top+x,m,d)},renderSelection:function(r,l){for(var h=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,c=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,f=this.textAlign.indexOf("justify")!==-1,d=this.get2DCursorLocation(h),p=this.get2DCursorLocation(c),m=d.lineIndex,g=p.lineIndex,x=d.charIndex<0?0:d.charIndex,b=p.charIndex<0?0:p.charIndex,y=m;y<=g;y++){var v=this._getLineLeftOffset(y)||0,w=this.getHeightOfLine(y),C=0,S=0,k=0;if(y===m&&(S=this.__charBounds[m][x].left),y>=m&&y<g)k=f&&!this.isEndOfWrapping(y)?this.width:this.getLineWidth(y)||5;else if(y===g)if(b===0)k=this.__charBounds[g][b].left;else{var T=this._getWidthOfCharSpacing();k=this.__charBounds[g][b-1].left+this.__charBounds[g][b-1].width-T}C=w,(this.lineHeight<1||y===g&&this.lineHeight>1)&&(w/=this.lineHeight);var N=r.left+v+S,R=k-S,L=w,z=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",L=1,z=w):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(N=this.width-N-R),l.fillRect(N,r.top+r.topOffset+z,R,L),r.topOffset+=C}},getCurrentCharFontSize:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fontSize")},getCurrentCharColor:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fill")},_getCurrentCharIndex:function(){var r=this.get2DCursorLocation(this.selectionStart,!0),l=r.charIndex>0?r.charIndex-1:0;return{l:r.lineIndex,c:l}}}),t.IText.fromObject=function(r,l){if(o(r),r.styles)for(var h in r.styles)for(var c in r.styles[h])o(r.styles[h][c]);t.Object._fromObject("IText",r,l,"text")}}(),function(){var o=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var r=this;this.on("added",function(){var l=r.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,r._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(r))})},initRemovedHandler:function(){var r=this;this.on("removed",function(){var l=r.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,r),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,r._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(r){r._mouseUpITextHandler=function(){r._iTextInstances&&r._iTextInstances.forEach(function(l){l.__isMousedown=!1})},r.on("mouse:up",r._mouseUpITextHandler)},_removeCanvasHandlers:function(r){r.off("mouse:up",r._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(r,l,h,c){var f;return f={isAborted:!1,abort:function(){this.isAborted=!0}},r.animate("_currentCursorOpacity",l,{duration:h,onComplete:function(){f.isAborted||r[c]()},onChange:function(){r.canvas&&r.selectionStart===r.selectionEnd&&r.renderCursorOrSelection()},abort:function(){return f.isAborted}}),f},_onTickComplete:function(){var r=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){r._currentTickCompleteState=r._animateCursor(r,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(r){var l=this,h=r?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},h)},abortCursorAnimation:function(){var r=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,r&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(r){var l=0,h=r-1;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)l++,h--;for(;/\S/.test(this._text[h])&&h>-1;)l++,h--;return r-l},findWordBoundaryRight:function(r){var l=0,h=r;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)l++,h++;for(;/\S/.test(this._text[h])&&h<this._text.length;)l++,h++;return r+l},findLineBoundaryLeft:function(r){for(var l=0,h=r-1;!/\n/.test(this._text[h])&&h>-1;)l++,h--;return r-l},findLineBoundaryRight:function(r){for(var l=0,h=r;!/\n/.test(this._text[h])&&h<this._text.length;)l++,h++;return r+l},searchWordBoundary:function(r,l){for(var h=this._text,c=this._reSpace.test(h[r])?r-1:r,f=h[c],d=t.reNonWord;!d.test(f)&&c>0&&c<h.length;)c+=l,f=h[c];return d.test(f)&&(c+=l===1?0:1),c},selectWord:function(r){r=r||this.selectionStart;var l=this.searchWordBoundary(r,-1),h=this.searchWordBoundary(r,1);this.selectionStart=l,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(r){r=r||this.selectionStart;var l=this.findLineBoundaryLeft(r),h=this.findLineBoundaryRight(r);return this.selectionStart=l,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(r){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(r),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(r){r._iTextInstances&&r._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(r){if(!(!this.__isMousedown||!this.isEditing)){var l=this.getSelectionStartFromPointer(r.e),h=this.selectionStart,c=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||h===c)&&(h===l||c===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==h||this.selectionEnd!==c)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(r,l,h){var c=h.slice(0,r),f=t.util.string.graphemeSplit(c).length;if(r===l)return{selectionStart:f,selectionEnd:f};var d=h.slice(r,l),p=t.util.string.graphemeSplit(d).length;return{selectionStart:f,selectionEnd:f+p}},fromGraphemeToStringSelection:function(r,l,h){var c=h.slice(0,r),f=c.join("").length;if(r===l)return{selectionStart:f,selectionEnd:f};var d=h.slice(r,l),p=d.join("").length;return{selectionStart:f,selectionEnd:f+p}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var r=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=r.selectionStart,this.hiddenTextarea.selectionEnd=r.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var r=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=r.selectionEnd,this.inCompositionMode||(this.selectionStart=r.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var r=this._calcTextareaPosition();this.hiddenTextarea.style.left=r.left,this.hiddenTextarea.style.top=r.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var r=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(r),h=this.get2DCursorLocation(r),c=h.lineIndex,f=h.charIndex,d=this.getValueOfPropertyAt(c,f,"fontSize")*this.lineHeight,p=l.leftOffset,m=this.calcTransformMatrix(),g={x:l.left+p,y:l.top+l.topOffset+d},x=this.canvas.getRetinaScaling(),b=this.canvas.upperCanvasEl,y=b.width/x,v=b.height/x,w=y-d,C=v-d,S=b.clientWidth/y,k=b.clientHeight/v;return g=t.util.transformPoint(g,m),g=t.util.transformPoint(g,this.canvas.viewportTransform),g.x*=S,g.y*=k,g.x<0&&(g.x=0),g.x>w&&(g.x=w),g.y<0&&(g.y=0),g.y>C&&(g.y=C),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:g.x+"px",top:g.y+"px",fontSize:d+"px",charHeight:d}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var r=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),r&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),r&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var r in this.styles)this._textLines[r]||delete this.styles[r]},removeStyleFromTo:function(r,l){var h=this.get2DCursorLocation(r,!0),c=this.get2DCursorLocation(l,!0),f=h.lineIndex,d=h.charIndex,p=c.lineIndex,m=c.charIndex,g,x;if(f!==p){if(this.styles[f])for(g=d;g<this._unwrappedTextLines[f].length;g++)delete this.styles[f][g];if(this.styles[p])for(g=m;g<this._unwrappedTextLines[p].length;g++)x=this.styles[p][g],x&&(this.styles[f]||(this.styles[f]={}),this.styles[f][d+g-m]=x);for(g=f+1;g<=p;g++)delete this.styles[g];this.shiftLineStyles(p,f-p)}else if(this.styles[f]){x=this.styles[f];var b=m-d,y,v;for(g=d;g<m;g++)delete x[g];for(v in this.styles[f])y=parseInt(v,10),y>=m&&(x[y-b]=x[v],delete x[v])}},shiftLineStyles:function(r,l){var h=o(this.styles);for(var c in this.styles){var f=parseInt(c,10);f>r&&(this.styles[f+l]=h[f],h[f-l]||delete this.styles[f])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(r,l,h,c){var f,d={},p=!1,m=this._unwrappedTextLines[r].length===l;h||(h=1),this.shiftLineStyles(r,h),this.styles[r]&&(f=this.styles[r][l===0?l:l-1]);for(var g in this.styles[r]){var x=parseInt(g,10);x>=l&&(p=!0,d[x-l]=this.styles[r][g],m&&l===0||delete this.styles[r][g])}var b=!1;for(p&&!m&&(this.styles[r+h]=d,b=!0),b&&h--;h>0;)c&&c[h-1]?this.styles[r+h]={0:o(c[h-1])}:f?this.styles[r+h]={0:o(f)}:delete this.styles[r+h],h--;this._forceClearCache=!0},insertCharStyleObject:function(r,l,h,c){this.styles||(this.styles={});var f=this.styles[r],d=f?o(f):{};h||(h=1);for(var p in d){var m=parseInt(p,10);m>=l&&(f[m+h]=d[m],d[m-h]||delete f[m])}if(this._forceClearCache=!0,c){for(;h--;)!Object.keys(c[h]).length||(this.styles[r]||(this.styles[r]={}),this.styles[r][l+h]=o(c[h]));return}if(!!f)for(var g=f[l?l-1:1];g&&h--;)this.styles[r][l+h]=o(g)},insertNewStyleBlock:function(r,l,h){for(var c=this.get2DCursorLocation(l,!0),f=[0],d=0,p=0;p<r.length;p++)r[p]===`
`?(d++,f[d]=0):f[d]++;f[0]>0&&(this.insertCharStyleObject(c.lineIndex,c.charIndex,f[0],h),h=h&&h.slice(f[0]+1)),d&&this.insertNewlineStyleObject(c.lineIndex,c.charIndex+f[0],d);for(var p=1;p<d;p++)f[p]>0?this.insertCharStyleObject(c.lineIndex+p,0,f[p],h):h&&this.styles[c.lineIndex+p]&&h[0]&&(this.styles[c.lineIndex+p][0]=h[0]),h=h&&h.slice(f[p]+1);f[p]>0&&this.insertCharStyleObject(c.lineIndex+p,0,f[p],h)},setSelectionStartEndWithShift:function(r,l,h){h<=r?(l===r?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=r),this.selectionStart=h):h>r&&h<l?this._selectionDirection==="right"?this.selectionEnd=h:this.selectionStart=h:(l===r?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=h)},setSelectionInBoundaries:function(){var r=this.text.length;this.selectionStart>r?this.selectionStart=r:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>r?this.selectionEnd=r:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(o){if(!!this.canvas){this.__newClickTime=+new Date;var r=o.pointer;this.isTripleClick(r)&&(this.fire("tripleclick",o),this._stopEvent(o.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=r,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(o){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===o.x&&this.__lastPointer.y===o.y},_stopEvent:function(o){o.preventDefault&&o.preventDefault(),o.stopPropagation&&o.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(o){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(o.e))},tripleClickHandler:function(o){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(o.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(o.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(o){if(this.__isMousedown=!1,!(!this.editable||this.group||o.transform&&o.transform.actionPerformed||o.e.button&&o.e.button!==1)){if(this.canvas){var r=this.canvas._activeObject;if(r&&r!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(o.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(o){var r=this.getSelectionStartFromPointer(o),l=this.selectionStart,h=this.selectionEnd;o.shiftKey?this.setSelectionStartEndWithShift(l,h,r):(this.selectionStart=r,this.selectionEnd=r),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(o){for(var r=this.getLocalPointer(o),l=0,h=0,c=0,f=0,d=0,p,m,g=0,x=this._textLines.length;g<x&&c<=r.y;g++)c+=this.getHeightOfLine(g)*this.scaleY,d=g,g>0&&(f+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));p=this._getLineLeftOffset(d),h=p*this.scaleX,m=this._textLines[d],this.direction==="rtl"&&(r.x=this.width*this.scaleX-r.x+h);for(var b=0,y=m.length;b<y&&(l=h,h+=this.__charBounds[d][b].kernedWidth*this.scaleX,h<=r.x);b++)f++;return this._getNewSelectionStartFromOffset(r,l,h,f,y)},_getNewSelectionStartFromOffset:function(o,r,l,h,c){var f=o.x-r,d=l-o.x,p=d>f||d<0?0:1,m=h+p;return this.flipX&&(m=c-m),m>this._text.length&&(m=this._text.length),m}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var o=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+o.top+"; left: "+o.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+o.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(o){if(!!this.isEditing){var r=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(o.keyCode in r)this[r[o.keyCode]](o);else if(o.keyCode in this.ctrlKeysMapDown&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapDown[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),o.keyCode>=33&&o.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(o){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(o.keyCode in this.ctrlKeysMapUp&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapUp[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(o){var r=this.fromPaste;if(this.fromPaste=!1,o&&o.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,c=l.length,f,d,p=c-h,m=this.selectionStart,g=this.selectionEnd,x=m!==g,b,y,v;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var w=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=m>w.selectionStart;x?(f=this._text.slice(m,g),p+=g-m):c<h&&(C?f=this._text.slice(g+p,g):f=this._text.slice(m,m-p)),d=l.slice(w.selectionEnd-p,w.selectionEnd),f&&f.length&&(d.length&&(b=this.getSelectionStyles(m,m+1,!1),b=d.map(function(){return b[0]})),x?(y=m,v=g):C?(y=g-f.length,v=g):(y=g,v=g+f.length),this.removeStyleFromTo(y,v)),d.length&&(r&&d.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(b=t.copiedTextStyle),this.insertNewStyleBlock(d,m,b)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(o){this.compositionStart=o.target.selectionStart,this.compositionEnd=o.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(o){return o&&o.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(o,r){var l=this._getLineLeftOffset(o),h;return r>0&&(h=this.__charBounds[o][r-1],l+=h.left+h.width),l},getDownCursorOffset:function(o,r){var l=this._getSelectionForOffset(o,r),h=this.get2DCursorLocation(l),c=h.lineIndex;if(c===this._textLines.length-1||o.metaKey||o.keyCode===34)return this._text.length-l;var f=h.charIndex,d=this._getWidthBeforeCursor(c,f),p=this._getIndexOnLine(c+1,d),m=this._textLines[c].slice(f);return m.length+p+1+this.missingNewlineOffset(c)},_getSelectionForOffset:function(o,r){return o.shiftKey&&this.selectionStart!==this.selectionEnd&&r?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(o,r){var l=this._getSelectionForOffset(o,r),h=this.get2DCursorLocation(l),c=h.lineIndex;if(c===0||o.metaKey||o.keyCode===33)return-l;var f=h.charIndex,d=this._getWidthBeforeCursor(c,f),p=this._getIndexOnLine(c-1,d),m=this._textLines[c].slice(0,f),g=this.missingNewlineOffset(c-1);return-this._textLines[c-1].length+p-m.length+(1-g)},_getIndexOnLine:function(o,r){for(var l=this._textLines[o],h=this._getLineLeftOffset(o),c=h,f=0,d,p,m=0,g=l.length;m<g;m++)if(d=this.__charBounds[o][m].width,c+=d,c>r){p=!0;var x=c-d,b=c,y=Math.abs(x-r),v=Math.abs(b-r);f=v<y?m:m-1;break}return p||(f=l.length-1),f},moveCursorDown:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",o)},moveCursorUp:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",o)},_moveCursorUpOrDown:function(o,r){var l="get"+o+"CursorOffset",h=this[l](r,this._selectionDirection==="right");r.shiftKey?this.moveCursorWithShift(h):this.moveCursorWithoutShift(h),h!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(o){var r=this._selectionDirection==="left"?this.selectionStart+o:this.selectionEnd+o;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,r),o!==0},moveCursorWithoutShift:function(o){return o<0?(this.selectionStart+=o,this.selectionEnd=this.selectionStart):(this.selectionEnd+=o,this.selectionStart=this.selectionEnd),o!==0},moveCursorLeft:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",o)},_move:function(o,r,l){var h;if(o.altKey)h=this["findWordBoundary"+l](this[r]);else if(o.metaKey||o.keyCode===35||o.keyCode===36)h=this["findLineBoundary"+l](this[r]);else return this[r]+=l==="Left"?-1:1,!0;if(typeof h!==void 0&&this[r]!==h)return this[r]=h,!0},_moveLeft:function(o,r){return this._move(o,r,"Left")},_moveRight:function(o,r){return this._move(o,r,"Right")},moveCursorLeftWithoutShift:function(o){var r=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(r=this._moveLeft(o,"selectionStart")),this.selectionEnd=this.selectionStart,r},moveCursorLeftWithShift:function(o){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(o,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(o,"selectionStart")},moveCursorRight:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",o)},_moveCursorLeftOrRight:function(o,r){var l="moveCursor"+o+"With";this._currentCursorOpacity=1,r.shiftKey?l+="Shift":l+="outShift",this[l](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(o){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(o,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(o,"selectionEnd")},moveCursorRightWithoutShift:function(o){var r=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(r=this._moveRight(o,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,r},removeChars:function(o,r){typeof r=="undefined"&&(r=o+1),this.removeStyleFromTo(o,r),this._text.splice(o,r-o),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(o,r,l,h){typeof h=="undefined"&&(h=l),h>l&&this.removeStyleFromTo(l,h);var c=t.util.string.graphemeSplit(o);this.insertNewStyleBlock(c,l,r),this._text=[].concat(this._text.slice(0,l),c,this._text.slice(h)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var o=t.util.toFixed,r=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),h=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(h)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var h=!0,c=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",c?'text-decoration="'+c+'" ':"",'style="',this.getSvgStyles(h),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,h){var c=[],f=[],d=l,p;this._setSVGBg(f);for(var m=0,g=this._textLines.length;m<g;m++)p=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(f,m,h+p,d),this._setSVGTextLineText(c,m,h+p,d),d+=this.getHeightOfLine(m);return{textSpans:c,textBgRects:f}},_createTextCharSpan:function(l,h,c,f){var d=l!==l.trim()||l.match(r),p=this.getSvgSpanStyles(h,d),m=p?'style="'+p+'"':"",g=h.deltaY,x="",b=t.Object.NUM_FRACTION_DIGITS;return g&&(x=' dy="'+o(g,b)+'" '),['<tspan x="',o(c,b),'" y="',o(f,b),'" ',x,m,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,h,c,f){var d=this.getHeightOfLine(h),p=this.textAlign.indexOf("justify")!==-1,m,g,x="",b,y,v=0,w=this._textLines[h],C;f+=d*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,k=w.length-1;S<=k;S++)C=S===k||this.charSpacing,x+=w[S],b=this.__charBounds[h][S],v===0?(c+=b.kernedWidth-b.width,v+=b.width):v+=b.kernedWidth,p&&!C&&this._reSpaceAndTab.test(w[S])&&(C=!0),C||(m=m||this.getCompleteStyleDeclaration(h,S),g=this.getCompleteStyleDeclaration(h,S+1),C=this._hasStyleChangedForSvg(m,g)),C&&(y=this._getStyleDeclaration(h,S)||{},l.push(this._createTextCharSpan(x,y,c,f)),x="",m=g,c+=v,v=0)},_pushTextBgRect:function(l,h,c,f,d,p){var m=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(h),' x="',o(c,m),'" y="',o(f,m),'" width="',o(d,m),'" height="',o(p,m),`"></rect>
`)},_setSVGTextLineBg:function(l,h,c,f){for(var d=this._textLines[h],p=this.getHeightOfLine(h)/this.lineHeight,m=0,g=0,x,b,y=this.getValueOfPropertyAt(h,0,"textBackgroundColor"),v=0,w=d.length;v<w;v++)x=this.__charBounds[h][v],b=this.getValueOfPropertyAt(h,v,"textBackgroundColor"),b!==y?(y&&this._pushTextBgRect(l,y,c+g,f,m,p),g=x.left,m=x.width,y=b):m+=x.kernedWidth;b&&this._pushTextBgRect(l,b,c+g,f,m,p)},_getFillAttributes:function(l){var h=l&&typeof l=="string"?new t.Color(l):"";return!h||!h.getSource()||h.getAlpha()===1?'fill="'+l+'"':'opacity="'+h.getAlpha()+'" fill="'+h.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var h=0,c=0,f=0;f<l;f++)h+=this.getHeightOfLine(f);return c=this.getHeightOfLine(f),{lineTop:h,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var h=t.Object.prototype.getSvgStyles.call(this,l);return h+" white-space: pre;"}})}(),function(o){var r=o.fabric||(o.fabric={});r.Textbox=r.util.createClass(r.IText,r.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:r.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var h=0,c=0,f=0,d={},p=0;p<l.graphemeLines.length;p++)l.graphemeText[f]===`
`&&p>0?(c=0,f++,h++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[f])&&p>0&&(c++,f++),d[p]={line:h,offset:c},f+=l.graphemeLines[p].length,c+=l.graphemeLines[p].length;return d},styleHas:function(l,h){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[h];c&&(h=c.line)}return r.Text.prototype.styleHas.call(this,l,h)},isEmptyStyles:function(l){if(!this.styles)return!0;var h=0,c=l+1,f,d,p=!1,m=this._styleMap[l],g=this._styleMap[l+1];m&&(l=m.line,h=m.offset),g&&(c=g.line,p=c===l,f=g.offset),d=typeof l=="undefined"?this.styles:{line:this.styles[l]};for(var x in d)for(var b in d[x])if(b>=h&&(!p||b<f))for(var y in d[x][b])return!1;return!0},_getStyleDeclaration:function(l,h){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[l];if(!c)return null;l=c.line,h=c.offset+h}return this.callSuper("_getStyleDeclaration",l,h)},_setStyleDeclaration:function(l,h,c){var f=this._styleMap[l];l=f.line,h=f.offset+h,this.styles[l][h]=c},_deleteStyleDeclaration:function(l,h){var c=this._styleMap[l];l=c.line,h=c.offset+h,delete this.styles[l][h]},_getLineStyle:function(l){var h=this._styleMap[l];return!!this.styles[h.line]},_setLineStyle:function(l){var h=this._styleMap[l];this.styles[h.line]={}},_wrapText:function(l,h){var c=[],f;for(this.isWrapping=!0,f=0;f<l.length;f++)c=c.concat(this._wrapLine(l[f],f,h));return this.isWrapping=!1,c},_measureWord:function(l,h,c){var f=0,d,p=!0;c=c||0;for(var m=0,g=l.length;m<g;m++){var x=this._getGraphemeBox(l[m],h,m+c,d,p);f+=x.kernedWidth,d=l[m]}return f},_wrapLine:function(l,h,c,N){var d=0,p=this.splitByGrapheme,m=[],g=[],x=p?r.util.string.graphemeSplit(l):l.split(this._wordJoiners),b="",y=0,v=p?"":" ",w=0,C=0,S=0,k=!0,T=this._getWidthOfCharSpacing(),N=N||0;x.length===0&&x.push([]),c-=N;for(var R=0;R<x.length;R++)b=p?x[R]:r.util.string.graphemeSplit(x[R]),w=this._measureWord(b,h,y),y+=b.length,d+=C+w-T,d>c&&!k?(m.push(g),g=[],d=w,k=!0):d+=T,!k&&!p&&g.push(v),g=g.concat(b),C=p?0:this._measureWord([v],h,y),y++,k=!1,w>S&&(S=w);return R&&m.push(g),S+N>this.dynamicMinWidth&&(this.dynamicMinWidth=S-T+N),m},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var h=r.Text.prototype._splitTextIntoLines.call(this,l),c=this._wrapText(h.lines,this.width),f=new Array(c.length),d=0;d<c.length;d++)f[d]=c[d].join("");return h.lines=f,h.graphemeLines=c,h},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var h in this._styleMap)this._textLines[h]&&(l[this._styleMap[h].line]=1);for(var h in this.styles)l[h]||delete this.styles[h]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),r.Textbox.fromObject=function(l,h){return r.Object._fromObject("Textbox",l,h,"text")}}(e),function(){var o=t.controlsUtils,r=o.scaleSkewCursorStyleHandler,l=o.scaleCursorStyleHandler,h=o.scalingEqually,c=o.scalingYOrSkewingX,f=o.scalingXOrSkewingY,d=o.scaleOrSkewActionName,p=t.Object.prototype.controls;if(p.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:r,actionHandler:f,getActionName:d}),p.mr=new t.Control({x:.5,y:0,cursorStyleHandler:r,actionHandler:f,getActionName:d}),p.mb=new t.Control({x:0,y:.5,cursorStyleHandler:r,actionHandler:c,getActionName:d}),p.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:r,actionHandler:c,getActionName:d}),p.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:h}),p.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:h}),p.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:h}),p.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:h}),p.mtr=new t.Control({x:0,y:-.5,actionHandler:o.rotationWithSnapping,cursorStyleHandler:o.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var m=t.Textbox.prototype.controls={};m.mtr=p.mtr,m.tr=p.tr,m.br=p.br,m.tl=p.tl,m.bl=p.bl,m.mt=p.mt,m.mb=p.mb,m.mr=new t.Control({x:.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:r,actionName:"resizing"}),m.ml=new t.Control({x:-.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:r,actionName:"resizing"})}}()})(jr);const gK=jr.fabric.util.createClass(jr.fabric.Object,{type:"grating",period:20,fillfactor:.5,initialize:function(e){this.callSuper("initialize",e)},_render:function(e){if(this.period==0)return;e.beginPath();const t=this.period/this.scaleX,n=Math.min(this.width/t/2,100);for(let s=-n;s<n;s++)e.rect(0+t*s,-this.height/2,this.fillfactor*t,this.height);this._renderPaintInOrder(e)}});var mK=(e,t)=>{const n=e.__vccOpts||e;for(const[s,i]of t)n[s]=i;return n};function xK(e){return lt(()=>{const n=e.div(.1).expandDims(2);return we([n,n.abs().mul(.5),n.mul(-1)],2).clipByValue(0,1)})}function bK(e){return lt(()=>{const t=e.mul(.5).pow(2).sum(2).expandDims(2).log().mul(.3);return we([t.mul(1),t.mul(.6),t.mul(.4)],2).clipByValue(0,1)})}function Kh(e,t=1.33,n=0,s=0){e.index=t,e.absorption=n,e.emission=s,e.cornerSize=6}const ve=new fK;window.fields=ve.fields;let Pe=null;const vK={data(){return{canvas:null,ctx:null,alive:!0,t:0,canvas2:document.createElement("Canvas"),ctx2:null,pause:!1,selected_object:[],wavelength:10,integrate_mode:!1}},mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.ctx2=this.canvas2.getContext("2d"),this.canvas.width=ve.sim_W,this.canvas.height=ve.sim_H,this.canvas2.width=ve.sim_W,this.canvas2.height=ve.sim_H,Pe=new jr.fabric.Canvas(this.$refs.canvas_fabric),console.log(Pe),Pe.setHeight(ve.sim_H),Pe.setWidth(ve.sim_W),window.canvas_fabric=Pe;const e=this.canvas2,t=this.ctx2;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="blue",t.beginPath(),t.ellipse(e.width/2,e.height/2,5,5,0,0,Math.PI*2),t.fill(),ve.fields.E=Ph(e).cast("float32").div(255),this.update(),Pe.on("mouse:down",this.mousedown),Pe.on("object:modified",this.modified),Pe.on("selection:created",this.selected),Pe.on("selection:updated",this.selected)},unmounted(){this.alive=!1},methods:{layerUp(e){Pe.bringFoward(Zt(e),!0)},layerDown(e){Pe.sendBackwards(Zt(e),!0)},add(e){if(e=="circle"){const t=new jr.fabric.Circle({fill:"red",width:100,height:100,radius:100});Kh(t),Pe.add(t)}else if(e=="rect"){const t=new jr.fabric.Rect({fill:"red",width:100,height:100});Kh(t),Pe.add(t)}else if(e=="grating"){const t=new gK({fill:"red",width:100,height:100});Kh(t),Pe.add(t)}},del(e){console.log("delete",e),Pe.remove(Zt(e)),this.selected_object=this.selected_object.filter(t=>t!==e),this.$forceUpdate()},clear(){ve.clear()},selected(e){console.log(e),this.selected_object=e.selected,this.$forceUpdate()},modified(e){console.log(e),this.$forceUpdate()},mousedown(e){if(e.target)return;const t=e.pointer.x,n=e.pointer.y,s=this.ctx2,i=this.canvas2;s.clearRect(0,0,this.canvas.width,this.canvas.height),s.fillStyle="white",s.beginPath(),s.ellipse(t,n,3,3,0,0,Math.PI*2),s.fill();let a=lt(()=>ve.fields.E.add(Ph(i).cast("float32").div(255)));Lt(ve.fields.E),ve.fields.E=a},update(){if(this.alive&&setTimeout(this.update,30),this.pause)return;let e=lt(()=>{let t=Pe.getObjects(),n=1,s=.1,i=.1;for(let l of t)n=Math.max(l.index,n),s=Math.max(l.absorption,s),i=Math.max(l.emission,i);for(let l of t)l.original_fill=l.fill,l.fill=`rgb(${l.index/n*255}, ${l.emission/i*255}, ${l.absorption/s*255})`,n=Math.max(l.index,n);Pe.renderAll();let a=Ph(Pe.toCanvasElement()).cast("float32").div(255),u=a.gather(0,2).expandDims(2).mul(n).maximum(1).pow(2),o=a.gather(2,2).expandDims(2).mul(s).sub(1).abs(),r=a.gather(1,2).expandDims(2).mul(i);return[u,o,r]});Lt([ve.fields.e,ve.fields.absorption,ve.fields.emission]),ve.fields.e=e[0],ve.fields.absorption=e[1],ve.fields.emission=e[2],Pe.requestRenderAll(),_s().startScope(),ve.update(),this.integrate_mode?dx(bK(ve.fields.power),this.canvas):dx(xK(ve.fields.E.gather(2,2)),this.canvas),_s().endScope()}},watch:{wavelength(){console.log("wavelength changed to",this.wavelength),ve.settings.wavelength=this.wavelength}}},ns=e=>(Jk("data-v-a7e97ccc"),e=e(),Zk(),e),yK={class:"container"},wK={class:"canvas-container"},CK={id:"fabric",ref:"canvas_fabric"},SK={id:"wave",ref:"canvas"},kK={class:"row"},IK={class:"row"},TK=ns(()=>At("label",{for:"integrate"},"Integrate Mode",-1)),_K={class:"row"},$K=ns(()=>At("label",{for:"wavelength"},"wavelength: ",-1)),EK={class:"row"},NK={class:"menu"},DK={class:"row"},AK=ns(()=>At("label",null,"x: ",-1)),RK=["onUpdate:modelValue"],OK=ns(()=>At("label",null,"y: ",-1)),FK=["onUpdate:modelValue"],PK={class:"row"},MK=ns(()=>At("label",null,"scaleX: ",-1)),LK=["onUpdate:modelValue"],BK=ns(()=>At("label",null,"scaleY: ",-1)),zK=["onUpdate:modelValue"],WK={class:"row"},VK=ns(()=>At("label",null,"angle: ",-1)),UK=["onUpdate:modelValue"],GK={class:"row"},HK=ns(()=>At("label",null,"index: ",-1)),jK=["onUpdate:modelValue"],XK={class:"row"},YK=ns(()=>At("label",null,"absorption: ",-1)),qK=["onUpdate:modelValue"],KK={class:"row"},JK=ns(()=>At("label",null,"emission: ",-1)),ZK=["onUpdate:modelValue"],QK={key:0,class:"row"},t8=ns(()=>At("label",null,"period: ",-1)),e8=["onUpdate:modelValue"],n8=ns(()=>At("label",null,"fillfactor: ",-1)),s8=["onUpdate:modelValue"],i8={class:"row"},r8=["onClick"],o8=["onClick"],a8=["onClick"];function l8(e,t,n,s,i,a){return ni(),Li("div",null,[At("div",yK,[At("div",wK,[At("canvas",CK,null,512),At("canvas",SK,null,512)]),At("div",null,[At("div",kK,[e.pause?Nh("",!0):(ni(),Li("button",{key:0,onClick:t[0]||(t[0]=u=>e.pause=!0)},"pause")),e.pause?(ni(),Li("button",{key:1,onClick:t[1]||(t[1]=u=>e.pause=!1)},"continue")):Nh("",!0),At("button",{onClick:t[2]||(t[2]=(...u)=>a.clear&&a.clear(...u))},"clear")]),At("div",IK,[Pn(At("input",{type:"checkbox",name:"integrate","onUpdate:modelValue":t[3]||(t[3]=u=>e.integrate_mode=u)},null,512),[[ST,e.integrate_mode]]),TK]),At("div",_K,[$K,Pn(At("input",{type:"text",name:"wavelength","onUpdate:modelValue":t[4]||(t[4]=u=>e.wavelength=u),size:"6"},null,512),[[ss,e.wavelength,void 0,{number:!0}]])]),At("div",EK,[At("button",{onClick:t[5]||(t[5]=u=>a.add("rect"))},"add rect"),At("button",{onClick:t[6]||(t[6]=u=>a.add("circle"))},"add circle"),At("button",{onClick:t[7]||(t[7]=u=>a.add("grating"))},"add grating")]),At("div",NK,[(ni(!0),Li(rs,null,CI(e.selected_object,(u,o)=>(ni(),Li("div",{class:"menu_obj",key:o},[mb(nk(u)+" ",1),At("div",DK,[AK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.left=r,size:"6"},null,8,RK),[[ss,u.left,void 0,{number:!0}]]),OK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.top=r,size:"6"},null,8,FK),[[ss,u.top,void 0,{number:!0}]])]),At("div",PK,[MK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.scaleX=r,size:"6"},null,8,LK),[[ss,u.scaleX]]),BK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.scaleY=r,size:"6"},null,8,zK),[[ss,u.scaleY,void 0,{number:!0}]])]),At("div",WK,[VK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.angle=r,size:"6"},null,8,UK),[[ss,u.angle,void 0,{number:!0}]])]),At("div",GK,[HK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.index=r,size:"6"},null,8,jK),[[ss,u.index,void 0,{number:!0}]])]),At("div",XK,[YK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.absorption=r,size:"6"},null,8,qK),[[ss,u.absorption,void 0,{number:!0}]])]),At("div",KK,[JK,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.emission=r,size:"6"},null,8,ZK),[[ss,u.emission,void 0,{number:!0}]])]),u.type=="grating"?(ni(),Li("div",QK,[t8,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.period=r,size:"6"},null,8,e8),[[ss,u.period,void 0,{number:!0}]]),n8,Pn(At("input",{type:"text","onUpdate:modelValue":r=>u.fillfactor=r,size:"6"},null,8,s8),[[ss,u.fillfactor,void 0,{number:!0}]])])):Nh("",!0),At("div",i8,[At("button",{onClick:r=>a.layerUp(u)},"UP",8,r8),At("button",{onClick:r=>a.layerDown(u)},"DOWN",8,o8)]),At("button",{onClick:r=>a.del(u)},"DELETE",8,a8)]))),128))])])])])}var c8=mK(vK,[["render",l8],["__scopeId","data-v-a7e97ccc"]]);const u8={class:"main-container"},h8=At("h1",null,"FDTD simulator",-1),f8={class:"main"},d8=At("div",null,[At("p",null,"Project repo:"),At("a",{href:"https://github.com/chiuhans111/fdtd-html"},"https://github.com/chiuhans111/fdtd-html")],-1),p8={__name:"App",setup(e){return(t,n)=>(ni(),Li("div",u8,[h8,At("div",f8,[As(c8)]),d8]))}};_T(p8).mount("#app");
