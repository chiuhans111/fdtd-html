import{t as b,c as H,a as N,d as V,b as z,s as O,e as L,r as P,m as R,f as E,g as $,z as v,o as A,k as X,h as C,i as U,j as k,l as M,n as q,p as g,q as w,u as s,v as D,w as m,x as T,y as p,F as Y,A as Z,B as G,C as K,D as J,E as W,G as Q,H as j,I as ee}from"./vendor.37fd245a.js";const te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerpolicy&&(d.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?d.credentials="include":l.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(l){if(l.ep)return;l.ep=!0;const d=a(l);fetch(l.href,d)}};te();function se(e,t,a,o,l){let n=b(()=>{const r=e.E.slice([0,1,0]).pad([[0,0],[0,1],[0,0]]).sub(e.E),_=e.E.slice([1,0,0]).pad([[0,1],[0,0],[0,0]]).sub(e.E),f=H([_.gather(2,2).expandDims(2),r.gather(2,2).expandDims(2).mul(-1),r.gather(1,2).sub(_.gather(0,2)).expandDims(2)],2);return N(e.H.sub(f.div(t).div(e.u).mul(a).mul(e.dilation)).mul(e.attenuation).mul(e.absorption).mul(.9999),-1e10,1e10)});V(e.H),e.H=n,n=b(()=>{const r=e.H.sub(e.H.slice([0,0,0],[-1,e.H.shape[1]-1,-1]).pad([[0,0],[1,0],[0,0]])),_=e.H.sub(e.H.slice([0,0,0],[e.H.shape[0]-1,-1,-1]).pad([[1,0],[0,0],[0,0]])),f=H([_.gather(2,2).expandDims(2),r.gather(2,2).expandDims(2).mul(-1),r.gather(1,2).sub(_.gather(0,2)).expandDims(2)],2);return e.E.add(e.emission.mul(z(o*l)).mul(l/10).mul(a).pad([[0,0],[0,0],[2,0]])).add(f.div(t).div(e.e).mul(a).mul(e.dilation)).mul(e.absorption).mul(e.attenuation)}),V(e.E),e.E=n,n=b(()=>{let r=e.E.gather(2,2).expandDims(2);return H([r.mul(z(o*l)),r.mul(O(o*l))],2).mul(a).add(e.power).mul(.998)}),V(e.power),e.power=n}L();function ie(e=600,t=400,a=40,o=1,l=.3){this.t=0,this.dx=o,this.dt=l,this.settings={wavelength:10},this.pixel_W=e,this.pixel_H=t,this.sim_W=e+a*2,this.sim_H=t+a*2;const d=this.sim_W*o,i=this.sim_H*o,x=P(0,this.sim_W).mul(o).cast("float32"),n=P(0,this.sim_H).mul(o).cast("float32"),r=R(x,n);console.log(r[0]);const _=E(E(r[0],r[1]),E($(d,r[0]),$(i,r[1]))).div(a).clipByValue(0,1),f=_.sub(1).abs().mul(-.05).exp().expandDims(2),B=_.sub(1).abs().mul(-.1).exp().expandDims(2);this.fields={E:v([this.sim_H,this.sim_W,3]),H:v([this.sim_H,this.sim_W,3]),e:A([this.sim_H,this.sim_W,1]),u:A([this.sim_H,this.sim_W,1]),power:v([this.sim_H,this.sim_W,2]),gx:r[0],gy:r[1],dilation:f,attenuation:B,absorption:v([this.sim_H,this.sim_W,1]),emission:v([this.sim_H,this.sim_W,1])},this.clear=function(){this.t=0,this.fields.E.dispose(),this.fields.E=v([this.sim_H,this.sim_W,3]),this.fields.H.dispose(),this.fields.H=v([this.sim_H,this.sim_W,3]),this.fields.power.dispose(),this.fields.power=v([this.sim_H,this.sim_W,2])},this.update=function(){const F=2*Math.PI/this.settings.wavelength,I=Math.min(.5,this.settings.wavelength/10);for(let y=0;y<5;y++)this.t+=I,se(this.fields,this.dx,I,this.t,F);for(let y in this.fields)this.fields[y]=X(this.fields[y])}}const ne=C.fabric.util.createClass(C.fabric.Object,{type:"grating",period:20,fillfactor:.5,initialize:function(e){this.callSuper("initialize",e)},_render:function(e){if(this.period==0)return;e.beginPath();const t=this.period/this.scaleX,a=Math.min(this.width/t/2,100);for(let o=-a;o<a;o++)e.rect(0+t*o,-this.height/2,this.fillfactor*t,this.height);this._renderPaintInOrder(e)}});var ae=(e,t)=>{const a=e.__vccOpts||e;for(const[o,l]of t)a[o]=l;return a};function oe(e){return b(()=>{const a=e.div(.1).expandDims(2);return H([a,a.abs().mul(.5),a.mul(-1)],2).clipByValue(0,1)})}function le(e){return b(()=>{const t=e.mul(.5).pow(2).sum(2).expandDims(2).log().mul(.3);return H([t.mul(1),t.mul(.6),t.mul(.4)],2).clipByValue(0,1)})}function S(e,t=1.33,a=0,o=0){e.index=t,e.absorption=a,e.emission=o,e.cornerSize=6}const c=new ie;window.fields=c.fields;let u=null;const de={data(){return{canvas:null,ctx:null,alive:!0,t:0,canvas2:document.createElement("Canvas"),ctx2:null,pause:!1,selected_object:[],wavelength:10,integrate_mode:!1}},mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.ctx2=this.canvas2.getContext("2d"),this.canvas.width=c.sim_W,this.canvas.height=c.sim_H,this.canvas2.width=c.sim_W,this.canvas2.height=c.sim_H,u=new C.fabric.Canvas(this.$refs.canvas_fabric),console.log(u),u.setHeight(c.sim_H),u.setWidth(c.sim_W),window.canvas_fabric=u;const e=this.canvas2,t=this.ctx2;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="blue",t.beginPath(),t.ellipse(e.width/2,e.height/2,5,5,0,0,Math.PI*2),t.fill(),c.fields.E=U(e).cast("float32").div(255),this.update(),u.on("mouse:down",this.mousedown),u.on("object:modified",this.modified),u.on("selection:created",this.selected),u.on("selection:updated",this.selected)},unmounted(){this.alive=!1},methods:{layerUp(e){u.bringForward(k(e),!0)},layerDown(e){u.sendBackwards(k(e),!0)},add(e){if(e=="circle"){const t=new C.fabric.Circle({fill:"red",width:100,height:100,radius:100});S(t),u.add(t)}else if(e=="rect"){const t=new C.fabric.Rect({fill:"red",width:100,height:100});S(t),u.add(t)}else if(e=="grating"){const t=new ne({fill:"red",width:100,height:100});S(t),u.add(t)}},del(e){console.log("delete",e),u.remove(k(e)),this.selected_object=this.selected_object.filter(t=>t!==e),this.$forceUpdate()},clear(){c.clear()},selected(e){console.log(e),this.selected_object=e.selected,this.$forceUpdate()},modified(e){console.log(e),this.$forceUpdate()},mousedown(e){if(e.target)return;const t=e.pointer.x,a=e.pointer.y,o=this.ctx2,l=this.canvas2;o.clearRect(0,0,this.canvas.width,this.canvas.height),o.fillStyle="white",o.beginPath(),o.ellipse(t,a,3,3,0,0,Math.PI*2),o.fill();let d=b(()=>c.fields.E.add(U(l).cast("float32").div(255)));V(c.fields.E),c.fields.E=d},update(){if(this.alive&&setTimeout(this.update,30),this.pause)return;let e=b(()=>{let t=u.getObjects(),a=1,o=.1,l=.1;for(let r of t)a=Math.max(r.index,a),o=Math.max(r.absorption,o),l=Math.max(r.emission,l);for(let r of t){let _=r.fill;r.fill="rgb("+[r.index/a,r.emission/l,r.absorption/o].map(f=>(f*255).toString()).join(",")+")",r.fill!==_&&(r.dirty=!0),a=Math.max(r.index,a)}u.renderAll();let d=U(u.toCanvasElement()).cast("float32").div(255),i=d.gather(0,2).expandDims(2).mul(a).maximum(1).pow(2),x=d.gather(2,2).expandDims(2).mul(o).sub(1).abs(),n=d.gather(1,2).expandDims(2).mul(l);return[i,x,n]});V([c.fields.e,c.fields.absorption,c.fields.emission]),c.fields.e=e[0],c.fields.absorption=e[1],c.fields.emission=e[2],u.requestRenderAll(),M().startScope(),c.update(),this.integrate_mode?q(le(c.fields.power),this.canvas):q(oe(c.fields.E.gather(2,2)),this.canvas),M().endScope()}},watch:{wavelength(){console.log("wavelength changed to",this.wavelength),c.settings.wavelength=this.wavelength}}},h=e=>(K("data-v-692c8df8"),e=e(),J(),e),re={class:"container"},ce={class:"canvas-container"},ue={id:"fabric",ref:"canvas_fabric"},he={id:"wave",ref:"canvas"},me=G("<div data-v-692c8df8><h2 data-v-692c8df8>How to use?</h2><div data-v-692c8df8><h4 data-v-692c8df8>Basic Interactions:</h4><ul data-v-692c8df8><li data-v-692c8df8>Click around and make ripple of waves. </li><li data-v-692c8df8>Add shapes, drag to transform, click on shapes to open menu.</li></ul></div><div data-v-692c8df8><h4 data-v-692c8df8>Simulation Controls:</h4><ul data-v-692c8df8><li data-v-692c8df8>&quot;Clear&quot; waves, &quot;Pause/Continue&quot; simulation.</li><li data-v-692c8df8>&quot;Integrate&quot; the intensity of the wave, change the &quot;Wavelength&quot; of the wave. </li></ul></div><div data-v-692c8df8><h4 data-v-692c8df8>Shape Settings:</h4><ul data-v-692c8df8><li data-v-692c8df8>Index: index of refraction.</li><li data-v-692c8df8>Absorption: 0=no absorption, 0.1=decay, 1=reflection</li><li data-v-692c8df8>Emission: amplitude of the excitation.</li></ul></div></div>",1),pe={class:"menu"},_e={class:"row"},ve={class:"row"},fe=h(()=>s("label",{for:"integrate"},"Integrate Mode",-1)),ge={class:"row"},we=h(()=>s("label",{for:"wavelength"},"wavelength: ",-1)),be={class:"row"},xe={class:"row"},ye=h(()=>s("label",null,"x: ",-1)),He=["onUpdate:modelValue"],Ve=h(()=>s("label",null,"y: ",-1)),Ce=["onUpdate:modelValue"],Ee={class:"row"},Ue=h(()=>s("label",null,"ScaleX: ",-1)),ke=["onUpdate:modelValue"],De=h(()=>s("label",null,"ScaleY: ",-1)),Se=["onUpdate:modelValue"],We={class:"row"},Ie=h(()=>s("label",null,"Angle: ",-1)),ze=["onUpdate:modelValue"],Pe={class:"row"},$e=h(()=>s("label",null,"Index: ",-1)),Ae=["onUpdate:modelValue"],Me={class:"row"},qe=h(()=>s("label",null,"Absorption: ",-1)),Be=["onUpdate:modelValue"],Fe={class:"row"},Ne=h(()=>s("label",null,"Emission: ",-1)),Oe=["onUpdate:modelValue"],Le={key:0,class:"row"},Re=h(()=>s("label",null,"Period: ",-1)),Xe=["onUpdate:modelValue","onInput"],Te=h(()=>s("label",null,"FillFactor: ",-1)),Ye=["onUpdate:modelValue","onInput"],Ze={class:"row"},Ge=h(()=>s("p",null,"Arrangement:",-1)),Ke=["onClick"],Je=["onClick"],Qe=["onClick"];function je(e,t,a,o,l,d){return g(),w("div",null,[s("div",re,[s("div",null,[s("div",ce,[s("canvas",ue,null,512),s("canvas",he,null,512)]),me]),s("div",null,[s("div",pe,[s("div",_e,[s("button",{onClick:t[0]||(t[0]=(...i)=>d.clear&&d.clear(...i))},"Clear"),e.pause?D("",!0):(g(),w("button",{key:0,onClick:t[1]||(t[1]=i=>e.pause=!0)},"Pause")),e.pause?(g(),w("button",{key:1,onClick:t[2]||(t[2]=i=>e.pause=!1)},"Continue")):D("",!0)]),s("div",ve,[m(s("input",{type:"checkbox",name:"integrate",id:"integrate","onUpdate:modelValue":t[3]||(t[3]=i=>e.integrate_mode=i)},null,512),[[T,e.integrate_mode]]),fe]),s("div",ge,[we,m(s("input",{type:"text",name:"wavelength","onUpdate:modelValue":t[4]||(t[4]=i=>e.wavelength=i),size:"6"},null,512),[[p,e.wavelength,void 0,{number:!0}]])]),s("div",be,[s("button",{onClick:t[5]||(t[5]=i=>d.add("rect"))},"Add Rect"),s("button",{onClick:t[6]||(t[6]=i=>d.add("circle"))},"Add Circle"),s("button",{onClick:t[7]||(t[7]=i=>d.add("grating"))},"Add Grating")]),(g(!0),w(Y,null,Z(e.selected_object,(i,x)=>(g(),w("div",{class:"menu_obj",key:x},[W(Q(i)+" ",1),s("div",xe,[ye,m(s("input",{type:"text","onUpdate:modelValue":n=>i.left=n,size:"6"},null,8,He),[[p,i.left,void 0,{number:!0}]]),Ve,m(s("input",{type:"text","onUpdate:modelValue":n=>i.top=n,size:"6"},null,8,Ce),[[p,i.top,void 0,{number:!0}]])]),s("div",Ee,[Ue,m(s("input",{type:"text","onUpdate:modelValue":n=>i.scaleX=n,size:"6"},null,8,ke),[[p,i.scaleX]]),De,m(s("input",{type:"text","onUpdate:modelValue":n=>i.scaleY=n,size:"6"},null,8,Se),[[p,i.scaleY,void 0,{number:!0}]])]),s("div",We,[Ie,m(s("input",{type:"text","onUpdate:modelValue":n=>i.angle=n,size:"6"},null,8,ze),[[p,i.angle,void 0,{number:!0}]])]),s("div",Pe,[$e,m(s("input",{type:"text","onUpdate:modelValue":n=>i.index=n,size:"6"},null,8,Ae),[[p,i.index,void 0,{number:!0}]])]),s("div",Me,[qe,m(s("input",{type:"text","onUpdate:modelValue":n=>i.absorption=n,size:"6"},null,8,Be),[[p,i.absorption,void 0,{number:!0}]])]),s("div",Fe,[Ne,m(s("input",{type:"text","onUpdate:modelValue":n=>i.emission=n,size:"6"},null,8,Oe),[[p,i.emission,void 0,{number:!0}]])]),i.type=="grating"?(g(),w("div",Le,[Re,m(s("input",{type:"text","onUpdate:modelValue":n=>i.period=n,size:"6",onInput:n=>i.dirty=!0},null,40,Xe),[[p,i.period,void 0,{number:!0}]]),Te,m(s("input",{type:"text","onUpdate:modelValue":n=>i.fillfactor=n,size:"6",onInput:n=>i.dirty=!0},null,40,Ye),[[p,i.fillfactor,void 0,{number:!0}]])])):D("",!0),s("div",Ze,[Ge,s("button",{onClick:n=>d.layerUp(i)},"UP",8,Ke),s("button",{onClick:n=>d.layerDown(i)},"DOWN",8,Je)]),s("button",{onClick:n=>d.del(i)},"DELETE",8,Qe)]))),128))])])])])}var et=ae(de,[["render",je],["__scopeId","data-v-692c8df8"]]);const tt={class:"main-container"},st=s("h1",null,"FDTD simulator",-1),it={class:"main"},nt=s("div",null,[s("br"),s("hr"),s("p",null,[W("Developer: "),s("a",{href:"https://chiuhans111.github.io"},"Hans Chiu")]),s("p",null,[W("Repo: "),s("a",{href:"https://github.com/chiuhans111/fdtd-html"},"https://github.com/chiuhans111/fdtd-html")])],-1),at={__name:"App",setup(e){return(t,a)=>(g(),w("div",tt,[st,s("div",it,[j(et)]),nt]))}};ee(at).mount("#app");
